/*! d3.chart.multi - v0.8.3
 * https://github.com/CSNW/d3.chart.multi
 * License: MIT
 */

!function(d3,a){function b(b,d){d=d||{};var e=d.propKey||"__properties",f=function(c,g){function h(){return c=a.isUndefined(k)?f.defaultValue:k,a.isFunction(c)&&"Function"!=d.type&&(c=c.call(this)),a.isFunction(d.get)?d.get.call(l,c):c}function i(){var e;if(a.isFunction(d.validate)&&!d.validate.call(this,c)){if(a.isFunction(this.trigger)&&(this.trigger("invalid:"+b,c),this.trigger("invalid",b,c)),!a.isUndefined(k))return j[b]=k,this;if(a.isUndefined(f.defaultValue))return this;c=f.defaultValue}if(f.previous=j[b],j[b]=c,a.isFunction(d.set)){var h=d.set.call(l,c,k,g);h&&a.has(h,"override")&&(j[b]=h.override),h&&a.isFunction(h.after)&&h.after.call(l,j[b]),h&&a.has(h,"changed")&&(e=h.changed)}return a.isUndefined(e)&&(e=!a.isEqual(j[b],k)),e&&a.isFunction(this.trigger)&&!g.silent&&(this.trigger("change:"+b,j[b]),this.trigger("change",b,j[b])),this}g=g||{};var j=this[e]=this[e]||{},k=j[b],l=a.isUndefined(f.context)?this:f.context;return arguments.length?i.call(this):h.call(this)};return f.isProperty=!0,f.setFromOptions=c(d.setFromOptions,!0),f.defaultValue=d.defaultValue,f.context=d.context,f}function c(b,c){return a.isUndefined(b)?c:b}function d(b){var c,d=b&&b.length&&b[0]&&b[0].length&&b[0][0],e=d?"svg"==d.nodeName:!1;try{c=d&&"function"==typeof d.getBBox&&d.getBBox()}catch(f){}c||(c={width:0,height:0});var g={width:d&&d.clientWidth||0,height:d&&d.clientHeight||0};if(d&&e&&(!d.clientWidth||!d.clientHeight)&&window&&window.getComputedStyle){var h=window.getComputedStyle(d);g.height=parseFloat(h.height)-parseFloat(h.borderTopWidth)-parseFloat(h.borderBottomWidth),g.width=parseFloat(h.width)-parseFloat(h.borderLeftWidth)-parseFloat(h.borderRightWidth)}var i={width:0,height:0};return b&&(i={width:b.attr("width")||0,height:b.attr("height")||0}),{width:a.max([g.width,i.width||c.width])||0,height:a.max([g.height,i.height||c.height])||0}}function e(b){var c=a.first(b);return c&&a.isObject(c)&&a.isArray(c.values)}function f(b,c){var d=function(a){return a&&d3.extent(a,c)[1]};return e(b)?a.reduce(b,function(b,c){if(c&&a.isArray(c.values)){var e=d(c.values);return e>b?e:b}return b},-1/0):d(b)}function g(b,c){var d=function(a){return a&&d3.extent(a,c)[0]};return e(b)?a.reduce(b,function(b,c){if(c&&a.isArray(c.values)){var e=d(c.values);return b>e?e:b}return b},1/0):d(b)}function h(b){if(b=b||{},a.isFunction(b))return b;var c;if(c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&"data"!=b&&"key"!=b&&c[b].apply(c,a))}),!b.domain&&b.data&&b.key){var d=function(a){return a[b.key]};if("ordinal"==b.type){var h,i=function(b){return a.map(b,d)};h=e(b.data)?a.flatten(a.map(b.data,function(b){return b&&a.isArray(b.values)?i(b.values):void 0})):i(b.data),c.domain(a.uniq(h))}else{var j=g(b.data,d);c.domain([0>j?j:0,f(b.data,d)])}}return c}function i(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),t.translate(g,h)})}}function j(b){return b?(b=a.map(b,function(a,b){return b+": "+a}),b=b.join("; "),b?b+";":""):""}function k(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function l(b){return b&&a.isFunction(b.charAt)&&a.isFunction(b.slice)?b.charAt(0).toUpperCase()+b.slice(1):""}function m(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._isDi=!0,b.original=a,b}function n(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function o(a){for(var b in a)a[b]&&a[b]._isDi&&(a[b]=n(a[b],a))}function p(a){if(a._parentData)return a._parentData;var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function q(a,b,c){a=a||"",b=b||"",c=c||"";var d=d3.chart(a+c)||d3.chart(a)||d3.chart(b+c)||d3.chart(b+a)||d3.chart(a+b)||d3.chart(b);if(!d)throw new Error("d3.chart.multi: Unable to resolve chart for type "+a+" and component "+b+" and container "+c);return d}function r(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return delete c.constructor,c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var s={component:50,axis:51,title:52,chart:100,legend:200};a.each(["extend"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=a[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.clone(b[c]());d.unshift(g);var h=f.apply(a,d);return b[c]("result"==e?h:g),h}}}),a.each(["push","pop",{name:"concat",set:"result"},"splice","shift","unshift","reverse","sort"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=Array.prototype[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.toArray(b[c]()),h=f.apply(g,d);return b[c]("result"==e?h:g),h}}});var t={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"},rotate:function(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}},u=function v(){if(v.enable){var b=a.toArray(arguments);b.unshift("d3.chart.multi:"),console.log.apply(console,b)}};u.enable=!1,u.time=function(b){u.enable&&a.isFunction(console.time)&&console.time("d3.chart.multi: "+b)},u.timeEnd=function(b){u.enable&&a.isFunction(console.timeEnd)&&console.timeEnd("d3.chart.multi: "+b)},d3.chart.helpers=a.extend({},d3.chart.helpers,{zIndex:s,property:b,valueOrDefault:c,dimensions:d,transform:t,translate:t.translate,isSeriesData:e,max:f,min:g,createScaleFromOptions:h,stack:i,style:j,getValue:k,capitalize:l,di:m,bindDi:n,bindAllDi:o,log:u,getParentData:p,resolveChart:q,mixin:r})}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f={isSeries:!0,seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"chart-series chart-index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.seriesData.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),seriesData:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.seriesData.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options().style);return b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},g={isXY:!0,xKey:c("xKey",{defaultValue:"x"}),yKey:c("yKey",{defaultValue:"y"}),xScale:c("xScale",{type:"Function",set:function(a){var c=b.createScaleFromOptions(a);return this.setXScaleRange(c),{override:c}},get:function(a){return a||(a=this.getDefaultXScale(),this.setXScaleRange(a)),a}}),yScale:c("yScale",{type:"Function",set:function(a){var c=b.createScaleFromOptions(a);return this.setYScaleRange(c),{override:c}},get:function(a){return a||(a=this.getDefaultYScale(),this.setYScaleRange(a)),a}}),xMin:c("xMin",{get:function(a){var c=b.min(this.data(),this.xValue);return+d(a,0>c?c:0)}}),xMax:c("xMax",{get:function(a){var c=b.max(this.data(),this.xValue);return+d(a,c)}}),yMin:c("yMin",{get:function(a){var c=b.min(this.data(),this.yValue);return+d(a,0>c?c:0)}}),yMax:c("yMax",{get:function(a){var c=b.max(this.data(),this.yValue);return+d(a,c)}}),initialize:function(){this.on("before:draw",this.setScales.bind(this))},x:e(function(a,b,c){return+a.xScale()(a.xValue.call(this,b,c))}),y:e(function(a,b,c){return+a.yScale()(a.yValue.call(this,b,c))}),x0:e(function(a){return+a.xScale()(0)}),y0:e(function(a){return+a.yScale()(0)}),xValue:e(function(a,b){return b[a.xKey()]}),yValue:e(function(a,b){return b[a.yKey()]}),keyValue:e(function(b,c,d){return a.isUndefined(c.key)?b.xValue.call(this,c,d):c.key}),setScales:function(){this.setXScaleRange(this.xScale()),this.setYScaleRange(this.yScale())},setXScaleRange:function(a){a.range([0,this.width()])},setYScaleRange:function(a){a.range([this.height(),0])},getDefaultXScale:function(){return b.createScaleFromOptions({data:this.data(),key:this.xKey()})},getDefaultYScale:function(){return b.createScaleFromOptions({data:this.data(),key:this.yKey()})}},h={},i={isValues:!0,itemPadding:c("itemPadding",{defaultValue:.1}),setXScaleRange:function(b){a.isFunction(b.rangeBands)?b.rangeBands([0,this.width()],this.itemPadding(),this.itemPadding()/2):g.setXScaleRange.call(this,b)},getDefaultXScale:function(){return b.createScaleFromOptions({type:"ordinal",data:this.data(),key:this.xKey()})}},j={displayAdjacent:c("displayAdjacent",{defaultValue:!1}),transform:function(b){return a.each(b,function(b){b.values=a.map(b.values,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},this),b},x:e(function(a,b,c){return a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.layeredX.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2;return e+d*a.seriesIndex.call(this,b,c)||0}),adjacentWidth:e(function(a,b,c){var d=a.seriesCount.call(this);return d>0?a.layeredWidth.call(this,b,c)/d:0}),layeredX:e(function(a,b,c){return a.xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)||0}),layeredWidth:e(function(a){var b=a.xScale().rangeBand();return isFinite(b)?b:0}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)})},k={labels:c("labels",{defaultValue:{},set:function(c){a.isBoolean(c)?c={display:c}:a.isString(c)?c={display:"display"==c||"show"==c}:c&&a.isUndefined(c.display)&&(c.display=!0),a.each(c,function(a,c){var d="label"+b.capitalize(c);this[d]&&this[d].isProperty&&this[d].setFromOptions&&this[d](a,{silent:!0})},this)}}),labelDisplay:c("labelDisplay",{defaultValue:!1}),labelFormat:c("labelFormat",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),labelPosition:c("labelPosition",{validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),labelOffset:c("labelOffset",{get:function(b){return a.isNumber(b)&&(b={top:{x:0,y:-b},right:{x:b,y:0},bottom:{x:0,y:b},left:{x:-b,y:0}}[this.labelPosition()],b||(b={x:0,y:0})),b}}),labelPadding:c("labelPadding"),labelAnchor:c("labelAnchor",{defaultValue:function(){var b=this.labelPosition();return a.isUndefined(b)?void 0:"right"==b?"start":"left"==b?"end":"middle"},validate:function(b){return a.contains(["start","middle","end"],b)}}),labelAlignment:c("labelAlignment",{defaultValue:function(){var b=this.labelPosition();if(!a.isUndefined(b)){var c={top:"bottom",right:"middle",bottom:"top",left:"middle"};return c[b]}},validate:function(b){return a.contains(["top","middle","bottom"],b)}}),labelStyle:c("labelStyle",{defaultValue:{}}),labelText:e(function(a,b,c){var d=a.yValue.call(this,b,c);return a.labelFormat()?a.labelFormat()(d):d}),_getLabels:function(){var b=[];return this.labelDisplay()&&b.push({labels:a.map(this.data(),function(b,c){return{key:this.keyValue(b,c),coordinates:{x:this.x(b,c),y:this.y(b,c)},text:this.labelText(b,c),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),alignment:this.labelAlignment(),"class":b["class"],style:a.extend({},this.labelStyle(),b.labelStyle),values:b,index:c}},this)}),b},_convertPointToLabel:function(b){return{key:this.keyValue(b.values,b.index),coordinates:b.coordinates,text:this.labelText(b.values,b.index),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),alignment:this.labelAlignment(),"class":b.values["class"],style:a.extend({},this.labelStyle(),b.labelStyle),values:b.values,index:b.index}}},l={_getLabels:function(){var b=[];return this.labelDisplay()&&(b=a.compact(a.map(this.data(),function(b,c){return b.excludeFromLabels?void 0:{key:b.key,name:b.name,"class":b["class"],index:c,labels:a.map(b.values,function(c,d){return{key:this.keyValue.call({_parentData:b},c,d),coordinates:{x:this.x.call({_parentData:b},c,d),y:this.y.call({_parentData:b},c,d)},text:this.labelText.call({_parentData:b},c,d),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),alignment:this.labelAlignment(),"class":c["class"],style:a.extend({},this.labelStyle(),c.labelStyle),values:c,index:d}},this)}},this))),b}};d3.chart.mixins=a.extend(d3.chart.mixins||{},{Series:f,XY:g,XYSeries:a.extend({},f,g,h),Values:a.extend({},g,i),ValuesSeries:a.extend({},f,g,h,i,j),Labels:k,LabelsSeries:a.extend({},k,l)})}(d3,_,d3.chart.helpers),function(d3,a,b){var c=b.property;d3.chart("Base",{initialize:function(){b.bindAllDi(this)},data:c("data"),options:c("options",{defaultValue:{},set:function(a){this.setFromOptions(a)}}),style:c("style",{get:function(a){return b.style(a)||null}}),width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},redrawFor:function(){var c=a.toArray(arguments),d=a.map(c,function(a){return"change:"+a});a.each(d,function(c){this.on(c,function(){b.log("redrawFor",c),a.isFunction(this.redraw)?this.redraw():this.container&&a.isFunction(this.container.redraw)&&this.container.redraw()})},this)},transform:function(a){return a=a||[],this.data(a),a},setFromOptions:function(b){a.each(b,function(a,b){this[b]&&this[b].isProperty&&this[b].setFromOptions&&this[b](a,{silent:!0})},this)},draw:function(a){this.trigger("before:draw",a),d3.chart().prototype.draw.apply(this,arguments),this.trigger("draw",a)}})}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b,c){b.property;d3.chart("Base").extend("Chart",{initialize:function(a){this.options(a||{}),this.redrawFor("options")}}),d3.chart("Chart").extend("SeriesChart",c.Series)}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){var c=b.property;d3.chart("Base").extend("Container",{initialize:function(a){this.chartsById={},this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart-container",!0),this.options(a||{}),this.redrawFor("options"),this.on("change:dimensions",this.redraw),this.attachHoverListeners()},rawData:c("rawData"),margins:c("margins",{defaultValue:{top:0,right:0,bottom:0,left:0},set:function(b){return{override:a.defaults({},b,{top:0,right:0,bottom:0,left:0}),after:function(){this.trigger("change:dimensions")}}}}),chartPosition:c("chartPosition",{defaultValue:function(){return{top:0,right:0,bottom:0,left:0,width:this.width(),height:this.height()}},set:function(b){return{override:a.defaults({},b,{width:this.width()-b.right-b.left,height:this.height()-b.bottom-b.top})}}}),width:c("width",{defaultValue:function(){return d3.chart("Base").prototype.width.call(this)},set:function(){this.trigger("change:dimensions")}}),height:c("height",{defaultValue:function(){return d3.chart("Base").prototype.height.call(this)},set:function(){this.trigger("change:dimensions")}}),draw:function(a){b.log("draw",a),b.log.time("Base#draw"),this.base.attr("width",this.width()||null).attr("height",this.height()||null),b.log.time("Base#draw.layout"),this.layout(a),b.log.timeEnd("Base#draw.layout"),d3.chart().prototype.draw.call(this,a),b.log.timeEnd("Base#draw")},redraw:function(){this.rawData()&&(b.log("redraw"),this.draw(this.rawData()))},chartLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.chart}),this.base.append("g").attr("class","chart-layer").attr("data-zIndex",c.zIndex)},componentLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.component}),this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",c.zIndex)},attachChart:function(a,b){this._attach(a,b),this.chartsById[a]=b},detachChart:function(a){var b=this.chartsById[a];b&&(this._detach(a,b),delete this.chartsById[a])},attachComponent:function(a,b){this._attach(a,b),this.componentsById[a]=b,b.on("change:position",this.redraw)},detachComponent:function(a){var b=this.componentsById[a];b&&(b.off("change:position"),this._detach(a,b),delete this.componentsById[a])},layout:function(b){this._positionChartLayers();var c=this._extractLayout(b),d=a.extend({},this.margins());a.each(c,function(b,c){a.each(b,function(a){d[c]+=a.offset||0})}),this.chartPosition(d),this._positionLayers(c)},attachHoverListeners:function(){var b,c=this.trigger.bind(this),d=a.throttle(function(a){b&&c("move:mouse",a)},50);this.base.on("mouseenter",function(){b=!0,c("enter:mouse",e(d3.mouse(this)))}),this.base.on("mousemove",function(){d(e(d3.mouse(this)))}),this.base.on("mouseleave",function(){b=!1,c("leave:mouse")});var e=function(a){var b=a[0],c=a[1],d=this.chartPosition(),e=b-d.left,f=c-d.top;return b>d.left+d.width?e=d.left+d.width:b<d.left&&(e=0),c>d.top+d.height?f=d.top+d.height:c<d.top&&(f=0),{container:{x:b,y:c},chart:{x:e,y:f}}}.bind(this)},_attach:function(b,c){c.id=b,c.base.attr("data-id",b),c.container=this,this.attach(b,c),c&&a.isFunction(c.trigger)&&c.trigger("attached")},_detach:function(b,c){c.base.remove(),delete this._attached[b],c&&a.isFunction(c.trigger)&&c.trigger("detached")},_positionLayers:function(a){this._positionChartLayers(),this._positionComponents(a),this._positionByZIndex()},_positionChartLayers:function(){var a=this.chartPosition();this.base.selectAll(".chart-layer").attr("transform",b.transform.translate(a.left,a.top)).attr("width",a.width).attr("height",a.height)},_positionComponents:function(b){function c(b,c,d,e){b&&a.isFunction(b.setLayout)&&b.setLayout(c,d,e)}var d=this.chartPosition(),e=this.width(),f=this.height();a.reduce(b.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:d.width}),e},d.top),a.reduce(b.right,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,h,d.top,{height:d.height}),h},e-d.right),a.reduce(b.bottom,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,d.left,h,{width:d.width}),h},f-d.bottom),a.reduce(b.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:d.height}),e},d.left)},_positionByZIndex:function(){var b=this.base.selectAll(".chart-layer, .chart-component-layer")[0];b=a.sortBy(b,function(a){return+d3.select(a).attr("data-zIndex")||0}),a.each(b,function(a){a.parentNode.appendChild(a)},this)},_extractLayout:function(b){var c={top:[],right:[],bottom:[],left:[]};return a.each(this.componentsById,function(d){if(!d.skipLayout){var e=d.getLayout(b),f=e&&e.position;a.contains(["top","right","bottom","left"],f)&&c[f].push({offset:"top"==f||"bottom"==f?e.height:e.width,component:d})}}),c},_convertPointsToLabels:function(b){var c=a.map(b,function(b){b=a.clone(b);var c=this.chartsById[b.chartId];return b.labels=c&&a.isFunction(c._convertPointToLabel)?a.map(b.points,c._convertPointToLabel,c):[],delete b.points,b},this);return c},_getLabels:function(){var b=a.reduce(this.chartsById,function(b,c,d){if(c&&a.isFunction(c._getLabels)){var e=c._getLabels();if(e&&a.isArray(e))return a.map(e,function(a){a.chartId=d,a.seriesKey=a.key,a.key=a.key?d+"-"+a.key:d}),b.concat(e);throw new Error("d3.chart.multi: Expected _getLabels to return an Array for chart with id: "+d)}return b},[],this);return b}})}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){var c=b.property;d3.chart("Base").extend("Component",{initialize:function(a){this.options(a||{}),this.redrawFor("options")},position:c("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),width:c("width",{defaultValue:function(){return b.dimensions(this.base).width}}),height:c("height",{defaultValue:function(){return b.dimensions(this.base).height}}),margins:c("margins",{get:function(b){var c=a.defaults({},b,{top:0,right:0,bottom:0,left:0}),d=this.width(),e=this.height();return{top:c.top*e,right:c.right*d,bottom:c.bottom*e,left:c.left*d}}}),skipLayout:!1,prepareLayout:function(a){this.draw(a)},getLayout:function(a){this.prepareLayout(a);var b=this.margins();return{position:this.position(),width:this.width()+b.left+b.right,height:this.height()+b.top+b.bottom}},setLayout:function(a,c,d){var e=this.margins();this.base.attr("transform",b.transform.translate(a+e.left,c+e.top)),this.height(d&&d.height),this.width(d&&d.width)}})}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){function c(b){if(!a.isFunction(b.getBBox))throw new Error("Only SVG elements with getBBox() are supported by Element helper");return this.element=b,this.selection=d3.select(b),this.removed=!1,this}function d(a){return c.call(this,a),this}function e(b,e,f){d.call(this,b),this.data=e,this.text=new c(this.selection.select("text").node()),this.rect=new c(this.selection.select("rect").node()),this.options=a.defaults({},f,{labelX:function(a){return a.x},labelY:function(a){return a.y},labelText:function(a){return a.value},padding:0,offset:{x:0,y:0},anchor:"middle",alignment:"bottom"})}var f=(b.mixin,b.property),g=b.di;d3.chart("Chart").extend("Labels",{initialize:function(){this.layer("Labels",this.base.append("g").classed("chart-labels",!0),{dataBind:function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass).attr("data-chart-id",b.seriesChartId).attr("data-series-key",b.seriesSeriesKey),c.exit().remove(),c.selectAll("g").data(b.seriesLabels,b.labelKey)},insert:function(){return this.chart().insertLabels(this)},events:{merge:function(){this.attr("opacity",0)},"merge:transition":function(){var a=this.chart();b.log.time("Labels.draw"),a.drawLabels(this),a.handleCollisions()&&(b.log.time("Chart.handleCollisions"),a.removeLabels(),a.groupLabels(),b.log.timeEnd("Chart.handleCollisions")),a.layoutLabels(),b.log.timeEnd("Labels.draw"),a.delay()&&this.delay(a.delay()),a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.attr("opacity",1)},exit:function(){this.remove()}}})},transform:function(a){return this.extractLabels(a)},excludeFromLegend:!0,labels:f("labels",{defaultValue:[]}),handleCollisions:f("handleCollisions",{defaultValue:!0}),delay:f("delay",{type:"Function"}),duration:f("duration",{type:"Function"}),ease:f("ease",{type:"Function"}),format:f("format",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),position:f("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),offset:f("offset",{defaultValue:0,get:function(a){return this.offsetByPosition(a,this.position())}}),padding:f("padding",{defaultValue:2}),anchor:f("anchor",{defaultValue:function(){var a=this.position();return"right"==a?"start":"left"==a?"end":"middle"},validate:function(b){return a.contains(["start","middle","end"],b)}}),alignment:f("alignment",{defaultValue:function(){var a={top:"bottom",right:"middle",bottom:"top",left:"middle"};return a[this.position()]},validate:function(b){return a.contains(["top","middle","bottom"],b)}}),labelKey:g(function(a,b){return b.key}),labelX:g(function(b,c){var d=a.defaults({},b.offset(),c.offset);return c.coordinates.x+d.x}),labelY:g(function(b,c){var d=a.defaults({},b.offset(),c.offset);return c.coordinates.y+d.y}),labelText:g(function(a,b){var c=a.format();return c?c(b.text):b.text}),labelClass:g(function(a,b){return"chart-label"+(b["class"]?" "+b["class"]:"")}),labelStyle:g(function(c,d){var e=a.defaults({},d.style,c.options().style);return b.style(e)||null}),seriesKey:g(function(a,b,c){return b.key||c}),seriesChartId:g(function(a,b){return b.chartId}),seriesSeriesKey:g(function(a,b){return b.seriesKey}),seriesClass:g(function(b,c){var d=a.isUndefined(c.index)?"":"chart-index-"+c.index,e=c["class"]?" "+c["class"]:"";return a.compact(["chart-series",d,e]).join(" ")}),seriesLabels:g(function(a,b){return b.labels}),seriesData:g(function(){var a=b.getParentData(this);return!a.seriesKey&&this.parentNode?b.getParentData(this.parentNode):a}),insertLabels:function(a){var b=a.append("g").attr("class",this.labelClass).attr("style",this.labelStyle);return b.append("rect").classed("chart-label-bg",!0),b.append("text").classed("chart-label-text",!0),b},drawLabels:function(b){var c=[];b.call(function(b){a.each(b,function(b,d){c.push([]),a.each(b,function(a){var b=new this.Label(a,d3.select(a).data()[0],{labelX:this.labelX,labelY:this.labelY,labelText:this.labelText,padding:this.padding(),anchor:this.anchor(),alignment:this.alignment()});c[d].push(b),b.draw()},this)},this)}.bind(this)),a.each(c,function(b){a.each(b,function(a){a.setBounds()})}),this.labels(c)},removeLabels:function(){a.each(this.labels(),function(b){var c;a.each(b,function(a){a.checkForOverlap(c,{compare:"LR"})?a.remove():c=a},this)},this)},groupLabels:function(){function b(b){a.each(b,function(d,e){a.each(b.slice(e+1),function(b){a.each(b,function(b){b.removed||a.each(d,function(a){!a.removed&&a.checkForOverlap(b)&&c(a,b)})})})})}function c(b,c){if(b.group&&c.group)a.each(c.group.labels,function(a){b.group.labels.push(a),a.group=b.group}),e(b.group);else if(b.group)d(c,b.group);else if(c.group)d(b,c.group);else{var f={labels:[]};d(b,f),d(c,f)}}function d(a,b){b.labels.push(a),a.group=b,a.originalY=a.y(),a.selection.attr("data-group-index",b.index),e(b)}function e(b){var c=a.chain(b.labels).each(function(a){a.y(a.originalY)}).sortBy(function(a){return a.y()}).reverse().value();a.each(c,function(b,d){for(var e,f=a.first(c,d),g=f.length-1;g>=0;g--)if(b.checkForOverlap(f[g])){e=f[g];break}e&&b.y(e.y()-b.height())})}b(this.labels())},layoutLabels:function(){a.each(this.labels(),function(b){a.each(b,function(a){a.removed||a.layout()})})},extractLabels:function(){return this.container&&a.isFunction(this.container._getLabels)?this.container._getLabels():[]},offsetByPosition:function(b,c){return a.isNumber(b)&&(b={top:{x:0,y:-b},right:{x:b,y:0},bottom:{x:0,y:b},left:{x:-b,y:0}}[c],b||(b={x:0,y:0})),b},Label:e}),d3.chart("Labels").extend("HoverLabels",{initialize:function(){a.bindAll(this,"onLabelsEnter","onLabelsMove","onLabelsLeave"),this.on("attached",function(){this.container.on("labels:enter:mouse",this.onLabelsEnter),this.container.on("labels:move:mouse",this.onLabelsMove),this.container.on("labels:leave:mouse",this.onLabelsLeave)}),this.on("detached",function(){this.container.off("labels:enter:mouse",this.onLabelsEnter),this.container.off("labels:move:mouse",this.onLabelsMove),this.container.off("labels:leave:mouse",this.onLabelsLeave)})},excludeFromLegend:!0,draw:function(){},_draw:function(a){d3.chart("Chart").prototype.draw.call(this,a)},onLabelsEnter:function(a){this._draw(a)},onLabelsMove:function(a){this._draw(a)},onLabelsLeave:function(){this._draw([])},extractLabels:function(a){return a}}),a.extend(c.prototype,{x:f("x",{type:"Function",defaultValue:0}),y:f("y",{type:"Function",defaultValue:0}),width:f("width",{type:"Function",defaultValue:0}),height:f("height",{type:"Function",defaultValue:0}),bounds:f("bounds",{get:function(){return{x:this.x(),y:this.y(),width:this.width(),height:this.height()}},set:function(a){this.x(a.x),this.y(a.y),this.width(a.width),this.height(a.height)}}),xCenter:f("xCenter",{get:function(){return this.x()+this.width()/2},set:function(a){this.x(a-this.width()/2)}}),layout:function(){this.selection.attr("x",this.x()).attr("y",this.y()).attr("width",this.width()).attr("height",this.height())},getBBox:function(){return this.element.getBBox()},setBounds:function(){return this.bounds(this.getBBox()),this},checkForOverlap:function(a,b){function c(a){return{left:a.x,right:a.x+a.width,top:a.y,bottom:a.y+a.height}}if(!a||!a.bounds)return!1;var d=c(this.bounds()),e=c(a.bounds()),f=e.left<d.left&&e.right>d.right,g=e.bottom<d.bottom&&e.top>d.top,h=e.left>=d.left&&e.left<d.right||e.right>d.left&&e.right<=d.right||f,i=e.top>=d.top&&e.top<d.bottom||e.bottom>d.top&&e.bottom<=d.bottom||g;return b&&"LR"==b.compare?h:b&&"TB"==b.compare?i:h&&i}}),a.extend(d.prototype,c.prototype,{getBBox:function(){var b=this.element.getBBox(),c=this.selection.attr("transform");if(c&&a.indexOf(c,"translate")){var d=c.split(")"),e={x:0,y:0};a.each(d,function(b){a.indexOf(b,"translate")&&(xy=b.replace("translate","").replace("(","").split(","),xy.length>=2&&(e.x=+xy[0].trim(),e.y=+xy[1].trim()))},this),b.x+=e.x,b.y+=e.y}return b},layout:function(){this.selection.attr("transform",b.transform.translate(this.x(),this.y())).attr("width",this.width()).attr("height",this.height())}}),a.extend(e.prototype,d.prototype,{draw:function(){return this.text.selection.attr("x",this.options.labelX).attr("y",this.options.labelY).attr("text-anchor","start").text(this.options.labelText),this},layout:function(){return this.selection.attr("transform",b.transform.translate(this.x(),this.y())),this.rect.layout(),this.text.layout(),this},setBounds:function(){var a=this.text.setBounds().bounds(),b={x:0,y:-3,width:0,height:0},c=this.data.offset||this.options.offset,d=this.data.padding||this.options.padding,e=this.data.anchor||this.options.anchor,f=this.data.alignment||this.options.alignment,g={x:a.x,y:a.y+a.height},h={width:a.width+2*d+b.width,height:a.height+2*d+b.height};return h.x=g.x-h.width/2+c.x+b.x,h.y=g.y-h.height/2+c.y+b.y,"start"==e?h.x+=h.width/2:"end"==e&&(h.x-=h.width/2),"bottom"==f?h.y-=h.height/2:"top"==f&&(h.y+=h.height/2),this.bounds(h),this.rect.bounds({x:0,y:0,width:h.width,height:h.height}),this.text.x(d).y(a.height+d+b.y),this},remove:function(){return this.removed=!0,this.selection.remove(),this}})}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){var c=a.mixin,d=a.property,e=a.di;d3.chart("SeriesChart").extend("Bars",c(b.ValuesSeries,b.LabelsSeries,{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("chart-bars",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").attr("class",a.barClass).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("y",a.y0).attr("height",0)},merge:function(){var a=this.chart();this.attr("x",a.barX).attr("width",a.itemWidth)},"merge:transition":function(){var a=this.chart();a.delay()&&this.delay(a.delay()),a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.attr("y",a.barY).attr("height",a.barHeight)},exit:function(){this.remove()}}})},delay:d("delay",{type:"Function"}),duration:d("duration",{type:"Function"}),ease:d("ease",{type:"Function"}),displayAdjacent:d("displayAdjacent",{defaultValue:!0}),barHeight:e(function(a,b,c){var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c))-a.barOffset();return d>0?d:0}),barX:e(function(a,b,c){return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e+a.barOffset()}),barClass:e(function(a,b){return"chart-bar"+(b["class"]?" "+b["class"]:"")}),barOffset:function(){if(this.__axis||(this.__axis=d3.select(this.base[0][0].parentNode).select('[data-id="axis.x"] .domain')),!this.__axis)return 0;var a=this.__axis[0][0]&&parseInt(this.__axis.style("stroke-width"))||0;return a/2},insertSwatch:function(){return this.append("rect").attr("x",0).attr("y",0).attr("width",20).attr("height",20).attr("class","chart-bar")}})),d3.chart("Bars").extend("StackedBars",{transform:function(a){return this.barPositions=[],a},barHeight:e(function(a,b,c){var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c)),e=0===a.seriesIndex.call(this,b,c)?a.barOffset():0;return d>0?d-e:0}),barX:e(function(a,b,c){return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();
if(!(d>e)){a.barPositions.length<=c&&a.barPositions.push(0);var f=a.barPositions[c]||e,g=f-(e-d);return a.barPositions[c]=g,g}}),displayAdjacent:d("displayAdjacent",{defaultValue:!1})})}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("SeriesChart").extend("Line",c(b.XYSeries,b.LabelsSeries,{initialize:function(){this.seriesLayer("Lines",this.base.append("g").classed("chart-lines",!0),{dataBind:function(){var a=this.chart(),b={};return _.each(a.data(),function(c,d){b[d]=a.createLine(c)}),a.lines(b),this.selectAll("path").data(function(b,c){return[a.data()[c]]},a.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("chart-line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();a.delay()&&this.delay(a.delay()),a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.itemStyle)}}})},lines:d("lines",{defaultValue:{}}),delay:d("delay",{type:"Function"}),duration:d("duration",{type:"Function"}),ease:d("ease",{type:"Function"}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.options().interpolate;return c&&b.interpolate(c),b},insertSwatch:function(){return this.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","chart-line")}})),d3.chart("Line").extend("LineValues",b.ValuesSeries)}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a){{var b=(a.mixin,a.property);a.di}d3.chart("Component").extend("Title",{initialize:function(){this.redrawFor("title","rotation"),this.layer("Title",this.base.append("g").classed("chart-title",!0),{dataBind:function(){return this.selectAll("text").data([0])},insert:function(){return this.append("text")},events:{merge:function(){var a=this.chart();this.attr("transform",a.transformation()).attr("style",a.style()).attr("alignment-baseline","middle").attr("text-anchor","middle").attr("class",a.options()["class"]).text(a.text())}}})},text:b("text",{get:function(){return this.options().text}}),rotation:b("rotation",{defaultValue:function(){var a={right:90,left:-90};return a[this.position()]||0}}),transformation:function(){var b=a.transform.translate(this.width()/2,this.height()/2),c=a.transform.rotate(this.rotation());return b+c}})}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("Component").extend("Axis",c(b.XY,{initialize:function(){this.axis=d3.svg.axis(),this._layoutAxis=d3.svg.axis(),this.axisBase=this.base.append("g").attr("class","chart-axis"),this._layoutBase=this.base.append("g").attr("class","chart-axis chart-layout").attr("style","display: none;"),this.layer("Axis",this.axisBase,{dataBind:function(){var a=this.chart();return a._setupAxis(a.axis),this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{enter:function(){var a=this.chart();this.attr("transform",a.translation()).call(a.axis)},update:function(){this.attr("transform",this.chart().translation())},"update:transition":function(){var a=this.chart();a.delay()&&this.delay(a.delay()),a._skip_transition?(this.duration(0),a._skip_transition=void 0):a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.call(a.axis)},exit:function(){this.selectAll("g").remove()}}}),this.layer("_LayoutAxis",this._layoutBase,{dataBind:function(){var a=this.chart();return a._setupAxis(a._layoutAxis),this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{merge:function(){var a=this.chart();this.attr("transform",a.translation()).call(a.axis)}}})},duration:d("duration",{type:"Function"}),delay:d("delay",{type:"Function"}),ease:d("ease",{type:"Function"}),scale:d("scale",{type:"Function",set:function(b){var c=a.createScaleFromOptions(b);return"vertical"==this.orientation()?this.yScale(c.copy()):this.xScale(c.copy()),{override:c}}}),position:d("position",{defaultValue:"bottom",validate:function(a){return _.contains(["top","right","bottom","left","x0","y0"],a)},set:function(){this.scale()&&this.scale(this.scale())}}),translation:d("translation",{defaultValue:function(){var a={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(),y:0},y0:{x:0,y:this.y0()}};return a[this.position()]},get:function(b){return a.translate(b)}}),orient:d("orient",{defaultValue:function(){var a=this.position();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),orientation:d("orientation",{validate:function(a){return _.contains(["horizontal","vertical"],a)},defaultValue:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.position()]},set:function(){this.scale()&&this.scale(this.scale())}}),type:d("type"),ticks:d("ticks",{type:"Function"}),tickValues:d("tickValues",{type:"Function"}),tickSize:d("tickSize",{type:"Function"}),innerTickSize:d("innerTickSize",{type:"Function"}),outerTickSize:d("outerTickSize",{type:"Function"}),tickPadding:d("tickPadding",{type:"Function"}),tickFormat:d("tickFormat",{type:"Function"}),getLayout:function(a){var b=this.getState();this.draw(a),this._layoutBase.attr("style","display: block;");var c=this._getLabelOverhang();this._layoutBase.attr("style","display: none;"),this._previous_raw_data?(this.setState(_.extend(b.previous,{duration:0})),this.draw(this._previous_raw_data),this.setState(b.current)):this._skip_transition=!0,this._previous_raw_data=a;var d=this.position();return"x0"==d?d="bottom":"y0"==d&&(d="right"),{position:d,width:c.width,height:c.height}},setLayout:function(){},getState:function(){return{previous:{scale:this.scale.previous,xScale:this.xScale.previous,yScale:this.yScale.previous,duration:this.duration.previous},current:{scale:this.scale(),xScale:this.xScale(),yScale:this.yScale(),duration:this.duration()}}},setState:function(a){this.xScale(a.xScale).yScale(a.yScale).scale(a.scale).duration(a.duration)},_setupAxis:function(a){this.axis.scale("vertical"==this.orientation()?this.yScale():this.xScale());var b=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"],c=["tickValues"];_.each(b,function(b){var d=this[b]&&this[b]();_.isUndefined(d)||(_.isArray(d)&&!_.contains(c,b)?a[b].apply(a,d):a[b](d))},this)},_getLabelOverhang:function(){var a={width:[0],height:[0]},b=this.orientation();return this._layoutBase.selectAll(".tick").each(function(){try{var c=this.getBBox();"horizontal"==b?a.height.push(c.height):a.width.push(c.width)}catch(d){}}),{width:_.max(a.width),height:_.max(a.height)}}})),d3.chart("Axis").extend("AxisValues",c(b.Values))}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a){var b=(a.mixin,a.property),c=a.di;d3.chart("Component").extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("chart-legend",!0),this.options().display?this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var b=this.chart(),c=this.append("g").attr("class",b.dataGroupClass);return c.append("g").attr("width",20).attr("height",20).attr("class","chart-legend-swatch"),c.append("text").attr("class","chart-legend-label chart-label").attr("transform",a.translate(25,0)),c},events:{merge:function(){var b=this.chart();this.select("g").each(b.createSwatch),this.select("text").text(b.dataValue).attr("alignment-baseline","before-edge");var c={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical"};this.call(a.stack.bind(this,{direction:c[b.position()],origin:"top",padding:5}))}}}):this.skipLayout=!0},isLegend:!0,transform:function(){var a=(d3.chart("Multi").prototype.demux,_.reduce(this.options().charts,function(a,b){if(b.excludeFromLegend)return a;var c=_.compact(_.map(b.data(),function(a,c){return a.excludeFromLegend?void 0:{chart:b,series:a,seriesIndex:c}}));return a.concat(c)},[],this));return a},dataKey:c(function(a,b){return b.chart.id+"."+b.series.name}),dataValue:c(function(a,b){return b.series.name}),dataGroupClass:c(function(){return"chart-legend-group"}),dataSeriesClass:c(function(a,b){return"chart-series chart-index-"+(b.seriesIndex||0)}),dataClass:c(function(a,b,c){var d=[a.dataSeriesClass.call(this,b,c)];return b.chart.options()["class"]&&d.push(b.chart.options()["class"]),b.series["class"]&&d.push(b.series["class"]),d.join(" ")||null}),dataStyle:c(function(b,c){var d=_.defaults({},c.series.style,c.chart.options().style);return a.style(d)||null}),createSwatch:c(function(a,b,c){var d=d3.select(this);d.selectAll("*").remove(),d.attr("class",a.dataClass);var e;b&&b.chart&&_.isFunction(b.chart.insertSwatch)?(d.chart=function(){return a},e=b.chart.insertSwatch.call(d)):e=d.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","chart-swatch"),e&&_.isFunction(e.attr)&&e.attr("style",a.dataStyle.call(this,b,c))})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this._positionLegend()},position:b("position",{defaultValue:{x:10,y:10},set:function(a,b){return a=a&&_.isObject(a)?a:{},a=_.defaults(a,b||{},{x:0,y:0}),{override:a,after:function(){this._positionLegend()}}}}),skipLayout:!0,_positionLegend:function(){if(this.legend){var b=this.position();this.legend.attr("transform",a.translate(b.x,b.y))}}},{layerType:"chart"})}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){var c=b.property;d3.chart("Container").extend("Multi",{initialize:function(){this.redrawFor("title","charts","axes","legend","components"),this._full_draw=!1,this._axes={},this._components={}},options:c("options",{defaultValue:function(){return{}},type:"Function",set:function(b){return this._full_draw=!0,a.isFunction(b)?void 0:{override:function(){return b}}}}),title:c("title",{set:function(c,d,e){if(!c||a.isEmpty(c))return this.detachComponent("title");a.isString(c)&&(c={text:c}),c=a.defaults({},c,d3.chart("Multi").defaults.title);var f=this.componentsById.title;if(f)f.options(c,{silent:e&&e.silent});else{var g=d3.chart(c.type);f=new g(this.componentLayer({zIndex:b.zIndex.title}),c),this.attachComponent("title",f)}}}),charts:c("charts",{set:function(b,c,d){b=b||{};var e=a.difference(a.keys(this.chartsById),a.keys(b));a.each(e,function(a){this.detachChart(a)},this),a.each(b,function(b,c){var e=this.chartsById[c];if(b=a.defaults({},b,d3.chart("Multi").defaults.charts),e)e.options(b,{silent:d&&d.silent});else{var f=d3.chart(b.type);e=new f(this.chartLayer(),b),this.attachChart(c,e)}},this)},defaultValue:{}}),axes:c("axes",{set:function(c,d,e){c=c||{};var f=a.difference(a.keys(this._axes),a.keys(c));a.each(f,function(a){this.detachComponent("axis."+a),this.detachComponent("axis_title."+a),delete this._axes[a]},this),a.each(c,function(c,d){var f=this._axes[d];if(c=a.defaults({},c,d3.chart("Multi").defaults.axes),f)f.options(c,{silent:e&&e.silent});else{var g=d3.chart(c.type);f=new g(this.chartLayer({zIndex:b.zIndex.axis}),c),this.attachComponent("axis."+d,f),this._axes[d]=f}var h="axis_title."+d,i=this.componentsById[h];if(c.title){var j=a.isString(c.title)?{text:c.title}:c.title;if(j=a.defaults({},j,{type:"Title",position:c.position,"class":"chart-title-axis"}),i)title.options(j,{silent:e&&e.silent});else{var k=d3.chart(j.type);title=new k(this.componentLayer({zIndex:b.zIndex.title}),j),this.attachComponent(h,title)}}else i&&this.detachComponent(h)},this)},defaultValue:{}}),legend:c("legend",{set:function(c,d,e){if(!c||c===!1||c.display===!1)return this.detachComponent("legend");c===!0&&(c={display:!0}),c=a.defaults({},c,d3.chart("Multi").defaults.legend),c.charts&&(c.charts=a.map(c.charts,function(a){return this.chartsById[a]},this)),d&&d.type!=c.type&&this.detachComponent("legend");var f=this.componentsById.legend;if(f)f.options(c,{silent:e&&e.silent});else{var g=d3.chart(c.type),h={zIndex:b.zIndex.legend},i="chart"==g.layerType?this.chartLayer(h):this.componentLayer(h);f=new g(i,c),this.attachComponent("legend",f)}}}),components:c("components",{set:function(b,c,d){b=b||{};var e=a.difference(a.keys(this._components),a.keys(b));a.each(e,function(a){this.detachComponent(a),delete this._components[a]},this),a.each(b,function(b,c){var e=this.componentsById[c];if(b=a.defaults({},b),e)e.options(b,{silent:d&&d.silent});else{var f=d3.chart(b.type),g="chart"==f.layerType?this.chartLayer():this.componentLayer();e=new f(g,b),this.attachComponent(c,e),this._components[c]=e}},this)}}),draw:function(a){var b=this._prepareConfig(a);this.axes(b.axes,{silent:!0}),this.charts(b.charts,{silent:!0}),this.components(b.components,{silent:!0}),this.legend(b.legend,{silent:!0}),this.title(b.title,{silent:!0}),d3.chart("Container").prototype.draw.call(this,{original:a,config:b.data})},redraw:function(){this.rawData()&&(this._full_draw?(this._full_draw=!1,this.draw(this.rawData().original)):d3.chart("Container").prototype.draw.call(this,this.rawData()))},demux:function(a,b){var c,d=this.chartsById[a];if(d){if(c=b.config.charts[a])return c}else if(d=this.componentsById[a],d&&(c=b.config.components[a]))return c;return b.original},_prepareConfig:function(b){var c=a.defaults({},this.options()(b),{charts:{},axes:{},components:{},legend:!1,title:!1,options:{}});c.legend===!0&&(c.legend={}),c.legend.charts||c.legend.data||(c.legend.charts=a.keys(c.charts)),a.isString(c.title)&&(c.title={text:c.title});var d={charts:{},components:{}};return a.each(c.charts,function(a,b){d.charts[b]=a.data,delete a.data}),a.each(c.axes,function(a,b){d.components["axis."+b]=a.data,delete a.data}),a.each(c.components,function(a,b){d.components[b]=a.data,delete a.data}),a.isObject(c.legend)&&(d.components.legend=c.legend.data,delete c.legend.data),c.data=d,c}},{defaults:{charts:{},axes:{type:"Axis"},legend:{type:"Legend",position:"right"},title:{type:"Title",position:"top","class":"chart-title-main"}}})}(d3,_,d3.chart.helpers,d3.chart.mixins);
//# sourceMappingURL=d3.chart.multi.min.map