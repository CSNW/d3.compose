/*!
 * d3.compose - Compose complex, data-driven visualizations from reusable charts and components with d3
 * v0.15.8 - https://github.com/CSNW/d3.compose - license: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.d3c=e(t.d3)}(this,function(t){"use strict";function e(t,e,i){for(var n=0,r=e.length;r>n;n++)for(var a in e[n])i&&void 0!==t[a]||(t[a]=e[n][a]);return t}function i(t,e){return t.indexOf(e)>=0}function n(t){return t.filter(function(t){return t})}function r(t,e){return t.filter(function(t){return e.indexOf(t)<0})}function a(t){return e(t,ht.call(arguments,1),!0)}function o(t){return e(t,ht.call(arguments,1))}function s(t){return t.reduce(function(t,e){return t.concat(e)},[])}function h(t,e,i){if(t)for(var n=0,r=t.length;r>n;n++)if(e.call(i,t[n],n,t))return t[n]}function c(t,e){return null==t?void 0:null==e?t[0]:Array.prototype.slice.call(t,0,e)}function l(t){return t===!0||t===!1}function u(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function f(t){return"[object Number]"===ct.call(t)}function d(t){return"[object String]"===ct.call(t)}function p(t){return void 0===t}function g(t,e,i){if(t)for(var n=Object.keys(t),r=0,a=n.length;a>r;r++)e.call(i,t[n[r]],n[r],t)}function y(t,e,i){if(t)for(var n=Object.keys(t),r=0,a=n.length;a>r;r++)if(e.call(i,t[n[r]],n[r],t))return t[n[r]]}function v(t,e){return t?t.map(function(t){return t[e]}):[]}function m(t){for(var e=[],i=0,n=t.length;n>i;i++)e.indexOf(t[i])<0&&e.push(t[i]);return e}function x(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writeable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):(t.__proto__=e,a(t,e))}function b(t,e){return p(t)?e:t}function _(t){2==arguments.length&&("undefined"!=typeof console&&console.warn&&console.warn("DEPRECATED - name argument for property is no longer supported will be removed in the next version of d3.compose"),t=arguments[1]),t=t||{};var e="property_"+ft++,i=function(n){function r(){return n=o[e],p(n)&&(n=i.default_value,lt(n)&&(n=n.call(s))),lt(t.get)?t.get.call(s,n):n}function a(){if(lt(t.validate)&&!p(n)&&!t.validate.call(s,n))throw new Error("Invalid value for property: "+JSON.stringify(n));var i=o[e];if(o[e]=n,lt(t.set)&&!p(n)){var r=t.set.call(s,n,i);r&&"override"in r&&(o[e]=r.override),r&&lt(r.after)&&r.after.call(s,o[e])}return this}var o=this.__properties=this.__properties||{},s=b(i.context,this);return arguments.length?a.call(this):r.call(this)};return i.is_property=!0,i.id=e,i.set_from_options=b(t.set_from_options,!0),i.default_value=t.default_value,i.context=t.context,i.options=t,i}function w(e){var i=S(e);if(i.width&&i.height)return i;var n=L(e);if(k(e))return{width:null!=i.width?i.width:n.width||0,height:null!=i.height?i.height:n.height||0};var r=z(e);return{width:t.max([i.width,n.width||r.width])||0,height:t.max([i.height,n.height||r.height])||0}}function S(t){var e=t.node(),i={width:e&&e.clientWidth,height:e&&e.clientHeight};if(k(t)&&(!e.clientWidth||!e.clientHeight)&&"undefined"!=typeof window&&window.getComputedStyle){var n=window.getComputedStyle(e);i.height=parseFloat(n.height)-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth),i.width=parseFloat(n.width)-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth)}return i}function L(t){return{width:t&&t.attr&&parseFloat(t.attr("width")),height:t&&t.attr&&parseFloat(t.attr("height"))}}function z(t){var e,i=t.node();try{e=i&&"function"==typeof i.getBBox&&i.getBBox()}catch(n){e={width:0,height:0}}return e}function k(t){return"svg"==t.node().nodeName}function A(e){if(e=e||{},lt(e))return e;var n;n="time"==e.type?t.time.scale():t.scale[e.type]?t.scale[e.type]():t.scale.linear(),g(e,function(t,e){n[e]&&("range"==e||"domain"==e?n[e](t):i(["type","data","value","key","centered","adjacent","series","padding"],e)||n[e].apply(n,t))}),!e.domain&&e.data&&(e.key||e.value)&&(n=B(n,e));var r=e.centered||"ordinal"==e.type&&null==e.centered;return"ordinal"==e.type&&(r||e.adjacent)&&(n=D(n,e)),"ordinal"==e.type&&(null!=e.padding||r||e.adjacent)&&(n=E(n,e)),n}function B(t,e){var i=e.value||function(t){return t[e.key]},n=e.data;P(n)||(n=[{values:n}]);var r;if("ordinal"==e.type)r=m(s(n.map(function(t){return t&&t.values?t.values.map(i):void 0})));else{var a=F(n,i);r=[0>a?a:0,j(n,i)]}return t.domain(r),t}function D(t,e){var i=e.series||(P(e.data)?e.data.length:1),n=function(t,e,i){var n=function(i,r){var a=n.width();return e.adjacent||(r=0),t(i)+.5*a+a*(r||0)};return o(n,t,{width:function(){var t=n.rangeBand&&n.rangeBand(),r=isFinite(t)?t:0;return e.adjacent&&(r/=i),r}}),n}(t,e,i);return n}function E(t,e){var i=null!=e.padding?e.padding:.1,n=t.range;return t.range=function(e){return arguments.length?void t.rangeBands(e,i,i/2):n()},e.range&&t.range(e.range),t}function I(t){var e=ht.call(arguments,1),i=[],n=[],r={};return e.forEach(function(t){g(t,function(t,e){"initialize"==e?i.push(t):"transform"==e?n.push(t):r[e]=t})}),i.length&&(r.initialize=function(){var e=ht.call(arguments);t.prototype.initialize.apply(this,e),i.forEach(function(t){t.apply(this,e)},this)}),n.length&&(r.transform=function(e){return e=t.prototype.transform.call(this,e),n.reduce(function(t,e){return e.call(this,t)}.bind(this),e)}),t.extend(r)}function T(e){function i(t){return t>0&&e.padding?e.padding:0}return e=o({direction:"vertical",origin:"top",padding:0,min_height:0,min_width:0},e),"horizontal"==e.direction&&"left"!=e.origin&&"right"!=e.origin?e.origin="left":"vertical"==e.direction&&"top"!=e.origin&&"bottom"!=e.origin&&(e.origin="top"),function(n){if(n&&n.attr){var r=0;n.attr("transform",function(n,a){var o,s=this.getBBox(),h=t.max([s.width,e.min_width]),c=t.max([s.height,e.min_height]),l=0,u=0;return"horizontal"==e.direction?(o=r+h+i(a),l="left"==e.origin?r+i(a):o,r=o):(o=r+c+i(a),u="top"==e.origin?r+i(a):o,r=o),C(l,u)})}}}function C(t,e){return u(t)&&(e=t.y,t=t.x),"translate("+(t||0)+", "+(e||0)+")"}function M(t,e){var i="rotate("+(t||0);return e&&(i+=" "+(e.x||0)+","+(e.y||0)),i+=")"}function O(t,e){var i=0;try{var n=t.getBBox().height,r=window.getComputedStyle(t),a=parseFloat(r["font-size"]),o=parseFloat(r["line-height"]);isNaN(o)&&(o=1.15*a);var s=-(o-a)/2,h=0;e&&e>0&&(h=(e-n)/2),i=n+(s||0)+(h||0)}catch(c){}return i}function P(t){var e=c(t);return e&&u(e)&&Array.isArray(e.values)}function j(e,i){var n=function(e){return e&&t.extent(e,i)[1]};return P(e)?e.reduce(function(t,e){if(e&&Array.isArray(e.values)){var i=n(e.values);return i>t?i:t}return t},-(1/0)):n(e)}function F(e,i){var n=function(e){return e&&t.extent(e,i)[0]};return P(e)?e.reduce(function(t,e){if(e&&Array.isArray(e.values)){var i=n(e.values);return t>i?i:t}return t},1/0):n(e)}function H(t){if(!t)return"";var e=[];return g(t,function(t,i){e.push(i+": "+t)}),t=e.join("; "),t?t+";":""}function V(t,e){return f(t)?{top:t,right:t,bottom:t,left:t}:a({},t,e,{top:0,right:0,bottom:0,left:0})}function W(t){var e=function(e,i,n){return t.call(this,void 0,e,i,n)};return e._is_di=!0,e.original=t,e}function Y(t,e){return function(i,n,r){return(t.original||t).call(this,e,i,n,r)}}function R(t){for(var e in t)t[e]&&t[e]._is_di&&(t[e]=Y(t[e],t))}function X(e){if(e._parent_data)return e._parent_data;var i=e&&e.parentNode;if(i){var n=t.select(i).data();return n&&n[0]}}function K(t){return function(e,i){return i||(i=e,e=void 0),o({id:e,type:t},i)}}function N(t,e){this.base=t,this._layers={},this._attached={},this._events={},R(this),e&&this.options(e),this.initialize(e)}function G(t){function e(t,e,i){return a({},t,{id:n(e,i)})}function i(t,e){t&&lt(t.position)?t.position(e):t.position=e}function n(t,e,i){var n="item-"+(t+1)+"-"+(e+1);return null!=i&&(n+="-"+(i+1)),n}function r(t){return function(e){e.data&&!lt(e.data)&&(o[t][e.id]=e.data,o[e.id]=e.data,delete e.data)}}if(t){var o={_charts:{},_components:{}},s={},h=[],c=[],l=[],u={row:!1,charts:!1};return t.forEach(function(t,r){var o=[];Array.isArray(t)||(t=[t]),t.length>1&&(u.row=!0);var f=t.map(function(h,f){if(h){if(h._layered){u.charts=u.row=!0;var d=[];return h.items.forEach(function(t,e){t&&(t=a({},t,{id:n(r,f,e)}),d.push(t.id),c.push(t),s[t.id]=t)}),d}var p=e(h,r,f);return s[p.id]=p,t.length>1?u.charts?(i(p,"right"),o.push(p)):(i(p,"left"),o.unshift(p)):u.row?(i(p,"bottom"),l.push(p)):(i(p,"top"),l.unshift(p)),p.id}});o.length&&(l=l.concat(o)),h.push(f)}),c.forEach(r("_charts")),l.forEach(r("_components")),{data:o,items:s,layout:h,charts:c,components:l}}}function U(t,e,n){var r={top:[],right:[],bottom:[],left:[]};return t.forEach(function(t){if(!t.skip_layout&&t.getLayout){var a=t.getLayout(n(t.id,e)),o=a&&a.position;i(["top","right","bottom","left"],o)&&r[o].push({offset:"top"==o||"bottom"==o?a.height:a.width,component:t})}}),r}function q(t,e,i,n){function r(t,e,i,n){t&&lt(t.setLayout)&&t.setLayout(e,i,n)}t.top.reduce(function(t,i){var n=t-i.offset;return r(i.component,e.left,n,{width:e.width}),n},e.top),t.right.reduce(function(t,i,n,a){var o=a[n-1]||{offset:0},s=t+o.offset;return r(i.component,s,e.top,{height:e.height}),s},i-e.right),t.bottom.reduce(function(t,i,n,a){var o=a[n-1]||{offset:0},s=t+o.offset;return r(i.component,e.left,s,{width:e.width}),s},n-e.bottom),t.left.reduce(function(t,i){var n=t-i.offset;return r(i.component,n,e.top,{height:e.height}),n},e.left)}function Z(t){return Array.isArray(t)||(t=Array.prototype.slice.call(arguments)),{_layered:!0,items:t}}function J(t,e){return h(t,function(t){return t.id==e})}function Q(t,e){return e?(P(e)||(e=[{values:e}]),e.map(function(e,i){return e.values.map(function(n,r){return t.getPoint.call({_parent_data:e},n,r,i)}).sort(function(t,e){return t.meta.x-e.meta.x})})):void 0}function $(t,e,i){function r(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}return t?n(t.map(function(t){function n(t){return t.distance=r(t.meta,e),t}function a(t){return t.distance<i}function o(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0}var s=t.map(n).filter(a).sort(o);return s[0]})):[]}function tt(t,e,n){var r=v(t,"key"),a=v(e,"key");g(e,function(t){i(r,t.key)?n.trigger("mousemove:point",t):n.trigger("mouseenter:point",t)}),g(t,function(t){i(a,t.key)||n.trigger("mouseleave:point",t)})}function et(t,e,i,n){var r={layer:"layer",series:"seriesLayer"}[e];if(r&&t[r]){var a={};return["enter","enter:transition","update","update:transition","merge","merge:transition","exit","exit:transition"].forEach(function(e){var i="on"+e.split(":").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("");t[i]&&(a[e]=function(){this.chart()[i](this)})}),t[r](i,n,{dataBind:function(t){return this.chart().onDataBind(this,t)},insert:function(){return this.chart().onInsert(this)},events:a})}}function it(t,e,i){return e||(e=t,t=void 0),d(e)&&(e={text:e}),o({id:t},i,e)}function nt(t,e){return it(t,e,{type:"Text"})}function rt(t){var e=8,i={top:{top:e,bottom:e},right:{right:e,left:e},bottom:{top:e,bottom:e},left:{right:e,left:e}};return V(i[t])}function at(t,e){return it(t,e,{type:"Title"})}function ot(t){var e=8,i={top:{top:e/2,bottom:e},right:{left:e/2,right:e},bottom:{bottom:e/2,top:e},left:{right:e/2,left:e}};return V(i[t])}function st(t,e){return it(t,e,{type:"AxisTitle"})}var ht=Array.prototype.slice,ct=Object.prototype.toString,lt=function(t){return"[object Function]"===ct.call(t)};"function"!=typeof/./&&"object"!=typeof Int8Array&&(lt=function(t){return"function"==typeof t||!1});var ut={slice:ht,toString:ct,contains:i,compact:n,difference:r,defaults:a,extend:o,flatten:s,find:h,first:c,isBoolean:l,isFunction:lt,isObject:u,isNumber:f,isString:d,isUndefined:p,objectEach:g,objectFind:y,pluck:v,uniq:m,inherits:x,valueOrDefault:b},ft=0,dt={property:_,dimensions:w,translate:C,rotate:M,alignText:O,isSeriesData:P,max:j,min:F,createScale:A,style:H,getMargins:V,stack:T,di:W,bindDi:Y,bindAllDi:R,getParentData:X,mixin:I,createHelper:K},pt=t.chart();x(N,pt),o(N.prototype,{initialize:function(){},transform:function(t){return t},demux:function(t,e){return e},draw:function(t){t=this.transform(t),this.data(t),this.trigger("before:draw",t),g(this._layers,function(e){e.draw(t)}),g(this._attached,function(e,i){e.draw(this.demux(i,t))},this),this.trigger("draw",t)},layer:pt.prototype.layer,unlayer:pt.prototype.unlayer,attach:pt.prototype.attach,on:pt.prototype.on,once:pt.prototype.once,off:pt.prototype.off,trigger:pt.prototype.trigger,data:_(),options:_({default_value:{},set:function(t,e){function i(t,e){return t[e]&&t[e].is_property&&t[e].set_from_options}if(e){var n=r(Object.keys(e),Object.keys(t));n.forEach(function(t){"data"!=t&&"options"!=t&&i(this,t)&&this[t](void 0)},this)}g(t,function(t,e){i(this,e)&&this[e](t)},this)}}),width:function(){return w(this.base).width},height:function(){return w(this.base).height}}),N.extend=function(t,e){var i;d(t)&&(i=t,t=e,e=arguments[2]);var n,r=this;return t&&t.hasOwnProperty("constructor")?(n=t.constructor,t=o({},t),delete t.constructor):n=function(){return r.apply(this,arguments)},x(n,r),e&&o(n,e),t&&o(n.prototype,t),i&&(pt[i]=n),n},pt.Base=N;var gt=N.extend({},{z_index:100,layer_type:"chart"});t.chart().Chart=gt;var yt=gt,vt=N.extend({position:_({default_value:"top",validate:function(t){return i(["top","right","bottom","left"],t)}}),width:_({default_value:function(){return w(this.base).width}}),height:_({default_value:function(){return w(this.base).height}}),margins:_({set:function(t){return{override:V(t)}},default_value:V()}),centered:_({default_value:!1}),skip_layout:!1,prepareLayout:function(t){this.draw(t)},getLayout:function(t){this.prepareLayout(t);var e=this.margins();return{position:this.position(),width:this.width()+e.left+e.right,height:this.height()+e.top+e.bottom}},setLayout:function(t,e,i){var n=this.margins();if(this.centered()){var r=w(this.base);e+="height"in i?(i.height-r.height)/2:n.top,t+="width"in i?(i.width-r.width)/2:n.left}else t+=n.left,e+=n.top;this.base.attr("transform",C(t,e)),this.height(i&&i.height),this.width(i&&i.width)}},{z_index:50,layer_type:"component"});t.chart().Component=vt;var mt=vt.extend({initialize:function(t){vt.prototype.initialize.call(this,t),this.base.attr("style",this.style())},skip_layout:!0,x:_({default_value:0}),y:_({default_value:0}),hidden:_({default_value:!0}),style:_({default_value:function(){var t=C(this.x()+"px",this.y()+"px"),e={position:"absolute",top:0,left:0,"-webkit-transform":t,"-ms-transform":t,transform:t};return this.hidden()&&(e.display="none"),H(e)}}),position:function(t,e){if(arguments.length>1)t={x:t,y:e};else if("container"in t)t=this.getAbsolutePosition(t.container);else if("chart"in t)if(this.container){var i=this.container.chartPosition();t=this.getAbsolutePosition({x:t.chart.x+i.left,y:t.chart.y+i.top})}else t=this.getAbsolutePosition(t.chart);this.x(t.x).y(t.y),this.base.attr("style",this.style())},show:function(){this.hidden(!1),this.base.attr("style",this.style())},hide:function(){this.hidden(!0),this.base.attr("style",this.style())},getAbsolutePosition:function(t){var e=this.container&&this.container.container;if(e&&this.container.responsive()){var i=w(e),n=this.container.width(),r=this.container.height(),a=i.width/n,o=i.height/r;return{x:a*t.x,y:o*t.y}}return t}},{layer_type:"overlay"});t.chart().Overlay=mt;var xt={top:10,right:10,bottom:10,left:10},bt=N.extend({initialize:function(t){N.prototype.initialize.call(this,t),"svg"!=this.base.node().tagName?(this.container=this.base.append("div").attr("class","chart-compose-container"),this.base=this.container.append("svg").attr("xlmns","http://www.w3.org/2000/svg").attr("version","1.1").attr("class","chart-compose")):this.base.classed("chart-compose",!0),this.attachHoverListeners()},transform:function(t){return this.rawData(t),N.prototype.transform.call(this,t)},options:_({default_value:function(){return function(){}},set:function(t){return lt(t)?void 0:{override:function(){return t}}}}),rawData:_(),margins:_({default_value:xt,set:function(t){return{override:V(t,xt)}}}),chartPosition:_({default_value:{top:0,right:0,bottom:0,left:0},set:function(t){return{override:a({},t,{top:0,right:0,bottom:0,left:0})}},get:function(t){return t.width=this._width()-t.right-t.left,t.height=this._height()-t.bottom-t.top,t}}),width:_({default_value:null}),height:_({default_value:null}),_width:function(){var t=this.width();return null!=t?t:N.prototype.width.call(this)},_height:function(){var t=this.height();return null!=t?t:N.prototype.height.call(this)},responsive:_({default_value:!0}),viewBox:_({default_value:function(){return this.responsive()&&this.width()&&this.height()?"0 0 "+this.width()+" "+this.height():null}}),preserveAspectRatio:_({default_value:function(){return this.responsive()?"xMidYMid meet":null}}),containerStyle:_({default_value:function(){if(this.responsive()){var t=1;return this.width()&&this.height()&&(t=this.height()/this.width()),H({width:"100%",height:0,"padding-top":100*t+"%",position:"relative"})}return H({position:"relative"})}}),baseStyle:_({default_value:function(){return this.responsive()&&this.container?H({position:"absolute",top:0,left:0}):null}}),charts:_({set:function(t,e){return{override:this._attachItems(t,e,this)}},default_value:[]}),components:_({set:function(t,e){return{override:this._attachItems(t,e,this)}},default_value:[]}),delay:_(),duration:_(),ease:_(),draw:function(e){var i=this._prepareConfig(this.options(),e);i||(i={data:{_charts:{},_components:{}},layout:[]}),this.charts(i.charts),this.components(i.components),e={original:e,config:i.data},this.data(e),this._setDimensions(),this.layout(i.layout,e),t.chart().prototype.draw.call(this,e)},redraw:function(){this.rawData()&&this.draw(this.rawData().original)},demux:function(t,e){return e&&e.config&&e.original?J(this.charts(),t)&&e.config._charts[t]?e.config._charts[t]:J(this.components(),t)&&e.config._components[t]?e.config._components[t]:e.original:e},createChartLayer:function(t){return this.base.append("g").attr("class","chart-layer").attr("data-zIndex",t&&t.z_index)},createComponentLayer:function(t){return this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",t&&t.z_index)},createOverlayLayer:function(){if(!this.container)throw new Error("Cannot create overlay layer if original selection \"d3.select(...).chart('Compose')\" is an svg. Use a div instead for responsive and overlay support.");return this.container.append("div").attr("class","chart-overlay-layer")},layout:function(t,e){this._positionChartLayers(),t=this._extractLayout(e);var i=o({},this.margins());g(t,function(t,e){t.forEach(function(t){i[e]+=t.offset||0})}),this.chartPosition(i),this.positionLayers(t)},attachHoverListeners:function(){function e(){var e=t.mouse(document.documentElement);return e[0]>=c.left&&e[0]<=c.right&&e[1]>=c.top&&e[1]<=c.bottom}function i(){u("mouseenter",a(t.mouse(p)))}function n(){u("mousemove",a(t.mouse(p)))}function r(){u("mouseleave")}function a(t){var e=t[0],i=t[1],n=e-h.left,r=i-h.top;return e>h.left+h.width?n=h.width:e<h.left&&(n=0),i>h.top+h.height?r=h.height:i<h.top&&(r=0),{container:{x:e,y:i},chart:{x:n,y:r}}}function s(){var t="scrollY"in window?window.scrollY:document.documentElement.scrollTop;return c=o({},p.getBoundingClientRect()),c.top+=t,c.bottom+=t,c}var h,c,l,u=this.trigger.bind(this),f=this.chartPosition.bind(this),d=this.container||this.base,p=this.base.node();d.on("mouseenter",function(){h=f(),c=s(),l=e(c),l&&i()}),d.on("mousemove",function(){h&&c||(h=f(),c=s());var t=e(c);l&&t?n():l?r():t&&i(),l=t}),d.on("mouseleave",function(){l&&(l=!1,r())})},attach:function(t,e){e.id=t,e.base.attr("data-id",t),e.container=this,N.prototype.attach.call(this,t,e),e&&lt(e.trigger)&&e.trigger("attach")},detach:function(t,e){e.base.remove(),delete this._attached[t],e&&lt(e.trigger)&&e.trigger("detach")},positionLayers:function(t){this._positionChartLayers(),this._positionComponents(t),this._positionByZIndex()},_setDimensions:function(){this.container&&this.container.attr("style",this.containerStyle()),this.base.attr("viewBox",this.viewBox()).attr("preserveAspectRatio",this.preserveAspectRatio()).attr("style",this.baseStyle()).attr("width",this.responsive()?null:this.width()).attr("height",this.responsive()?null:this.height())},_attachItems:function(e,i,n){e=e||[],i=i||[];var a=r(v(i,"id"),v(e,"id"));return a.forEach(function(t){n.detach(t,J(i,t))}),e.map(function(e){var r=e.id,a=J(i,r);if(e instanceof t.chart())return a&&n.detach(r,a),n.attach(r,e),e;var o=a&&!(a instanceof mt)&&a.position&&e.position&&a.position()!=e.position;if(a&&(a.type!=e.type||o)&&(n.detach(r,a),a=void 0),a)a.options(e);else{var s=t.chart(e.type);if(!s)throw new Error("No registered d3.chart found for "+e.type);var h={z_index:s.z_index||0},c={chart:"createChartLayer",component:"createComponentLayer",overlay:"createOverlayLayer"}[s.layer_type];if(!c)throw new Error('Unrecognized layer type "'+s.layer_type+'" for '+e.type);var l=n[c](h);a=new s(l,e),a.type=e.type,n.attach(r,a)}return a})},_prepareConfig:function(t,e){return G(t(e))},_positionChartLayers:function(){var t=this.chartPosition();this.base.selectAll(".chart-layer").attr("transform",C(t.left,t.top)).attr("width",t.width).attr("height",t.height)},_positionComponents:function(t){var e=this.chartPosition(),i=this._width(),n=this._height();q(t,e,i,n)},_positionByZIndex:function(){function e(e){return{layer:e,zIndex:parseInt(t.select(e).attr("data-zIndex"))||0}}function i(t,e){return t.zIndex<e.zIndex?-1:t.zIndex>e.zIndex?1:0}function n(t){return t.layer}var r=this.base.selectAll(".chart-layer, .chart-component-layer")[0];r=r.map(e).sort(i).map(n),r.forEach(function(t){t&&t.parentNode&&t.parentNode.appendChild&&t.parentNode.appendChild(t)})},_extractLayout:function(t){return U(this.components(),t,this.demux.bind(this))}});t.chart().Compose=bt;var _t={seriesKey:W(function(t,e){return e.key}),seriesValues:W(function(t,e,i){return e.seriesIndex=i,e.values}),seriesClass:W(function(t,e,i){return"chart-series chart-index-"+i+(e["class"]?" "+e["class"]:"")}),seriesIndex:W(function(t,e,i){var n=t.seriesData.call(this,e,i);return n&&n.seriesIndex||0}),seriesData:W(function(){return X(this)}),itemStyle:W(function(t,e){return H(e.style)||null}),seriesCount:function(){var t=this.data();return t&&P(t)?t.length:1},seriesLayer:function(e,i,n){if(n&&n.dataBind){var r=n.dataBind;n.dataBind=function(t){var e=this.chart(),i=this.selectAll("g").data(t,e.seriesKey);return i.enter().append("g"),i.attr("class",e.seriesClass).attr("style",e.itemStyle),i.exit().remove(),i.chart=function(){return e},r.call(i,e.seriesValues)}}return t.chart().prototype.layer.call(this,e,i,n)},transform:function(t){return P(t)?t:[{values:t}]}},wt={initialize:function(){this.on("before:draw",this.setScales.bind(this))},transform:function(t){function e(t,e){return u(t)?!Array.isArray(t)&&p(t.x)&&(t.x=e):t={x:e,y:t},t}return t=t||[],P(t)?t=t.map(function(t){return o({},t,{values:t.values.map(e)})}):Array.isArray(t)&&(t=t.map(e)),t},xScale:_({set:function(t){var e=A(t);return this.setXScaleRange(e),{override:e}},get:function(t){return t||(t=this.getDefaultXScale(),this.setXScaleRange(t)),t}}),yScale:_({set:function(t){var e=A(t);return this.setYScaleRange(e),{override:e}},get:function(t){return t||(t=this.getDefaultYScale(),this.setYScaleRange(t)),t}}),xKey:_({default_value:"x"}),yKey:_({default_value:"y"}),x:W(function(t,e,i){var n=t.xValue.call(this,e,i),r=t.seriesIndex&&t.seriesIndex.call(this,e,i)||0;return parseFloat(t.xScale()(n,r))}),y:W(function(t,e,i){var n=t.yValue.call(this,e,i),r=t.seriesIndex&&t.seriesIndex.call(this,e,i)||0;return parseFloat(t.yScale()(n,r))}),key:W(function(t,e,i){return b(e.key,t.xValue.call(this,e,i))}),x0:function(){return parseFloat(this.xScale()(0))},y0:function(){return parseFloat(this.yScale()(0))},xValue:W(function(t,e){var i=t.xKey();return e?i in e?e[i]:e[0]:void 0}),yValue:W(function(t,e){var i=t.yKey();return e?i in e?e[i]:e[1]:void 0}),setScales:function(){this.setXScaleRange(this.xScale()),this.setYScaleRange(this.yScale())},setXScaleRange:function(t){t.range([0,this.width()])},setYScaleRange:function(t){t.range([this.height(),0])},getDefaultXScale:function(){return A({data:this.data(),key:"x"})},getDefaultYScale:function(){return A({data:this.data(),key:"y"})}},St={adjacentWidth:function(){var t=this.seriesCount?this.seriesCount():1;return this.layeredWidth()/t},layeredWidth:function(){var t=this.xScale()&&this.xScale().rangeBand&&this.xScale().rangeBand(),e=isFinite(t)?t:0;return e},itemWidth:function(){var t=this.xScale();return t&&t.width?t.width():this.layeredWidth()},getDefaultXScale:function(){return A({type:"ordinal",data:this.data(),key:"x",centered:!0})}},Lt={x:W(function(t,e,i){var n=t.yValue.call(this,e,i),r=t.seriesIndex&&t.seriesIndex.call(this,e,i)||0;return parseFloat(t.yScale()(n,r))}),y:W(function(t,e,i){var n=t.xValue.call(this,e,i),r=t.seriesIndex&&t.seriesIndex.call(this,e,i)||0;return parseFloat(t.xScale()(n,r))}),x0:function(){return parseFloat(this.yScale()(0))},y0:function(){return parseFloat(this.xScale()(0))},setXScaleRange:function(t){t.range([this.height(),0])},setYScaleRange:function(t){t.range([0,this.width()])}},zt={attachLabels:function(){var e=this.labels();e.parent=this;var i=t.chart(e.type),n=this.base.append("g").attr("class","chart-labels"),r=this._labels=new i(n,e);this.proxyLabelMethods.forEach(function(t){r[t]=this[t]},this),this.on("draw",function(t){e=this.labels(),e.parent=this,r.options(e),r.draw(e.display!==!1?e.data||t:[])}.bind(this))},labels:_({get:function(t){return l(t)?t={display:t}:t||(t={display:!1}),a({},t,{type:"Labels"})}}),proxyLabelMethods:[]},kt=o({},zt,{proxyLabelMethods:["x","y"]}),At={initialize:function(){this.on("attach",function(){this.container.on("mouseenter",this.onMouseEnter.bind(this)),this.container.on("mousemove",this.onMouseMove.bind(this)),this.container.on("mouseleave",this.onMouseLeave.bind(this))}.bind(this))},getPoint:W(function(t,e,i,n){var r=t.key&&t.key.call(this,e,i,n),a=t.seriesData&&t.seriesData.call(this,e,i,n)||{};return{key:(a.key||n)+"."+(r||i),series:a,d:e,meta:{chart:t,i:i,j:n,x:t.x&&t.x.call(this,e,i,n),y:t.y&&t.y.call(this,e,i,n)}}}),mouseEnterPoint:W(function(t,e,i,n){t.container.trigger("mouseenter:point",t.getPoint.call(this,e,i,n))}),mouseLeavePoint:W(function(t,e,i,n){t.container.trigger("mouseleave:point",t.getPoint.call(this,e,i,n))}),onMouseEnter:function(){},onMouseMove:function(){},onMouseLeave:function(){}},Bt={initialize:function(){var t,e,i;this.on("draw",function(){t=null}),this.on("attach",function(){var n=function(n){var r=[];n&&(r=$(t,n.chart,e)),tt(i,r,this.container),i=r}.bind(this);this.container.on("mouseenter",function(i){t||(t=Q(this,this.data())),e=this.hoverTolerance(),n(i)}.bind(this)),this.container.on("mousemove",n),this.container.on("mouseleave",n)}.bind(this))},hoverTolerance:_({default_value:1/0})},Dt={delay:_({default_value:function(){return this.container&&this.container.delay&&this.container.delay()}}),duration:_({default_value:function(){return this.container&&this.container.delay&&this.container.duration()}}),ease:_({default_value:function(){return this.container&&this.container.delay&&this.container.ease()}}),setupTransition:function(t){var e=this.delay(),i=this.duration(),n=this.ease();p(e)||t.delay(e),p(i)||t.duration(i),p(n)||t.ease(n)}},Et={standardLayer:function(t,e){return et(this,"layer",t,e)},standardSeriesLayer:function(t,e){return et(this,"series",t,e)},onDataBind:function(){},onInsert:function(){},onEnter:function(){},onUpdate:function(){},onMerge:function(){},onExit:function(){}},It={Series:_t,XY:wt,XYValues:St,XYInverted:Lt,Labels:zt,LabelsXY:kt,Hover:At,HoverPoints:Bt,Transition:Dt,StandardLayer:Et},Tt=I(yt,_t,wt,kt,At,Bt,Dt,Et),Ct=Tt.extend({initialize:function(t){Tt.prototype.initialize.call(this,t),this.lines={},this.standardSeriesLayer("Lines",this.base.append("g").classed("chart-lines",!0)),this.attachLabels()},interpolate:_({default_value:"monotone"}),createLine:W(function(e,i,n,r){var a=e.lineKey.call(this,i,n,r),o=e.lines[a]=t.svg.line().x(e.x).y(e.y),s=i.interpolate||e.interpolate();s&&o.interpolate(s)}),lineKey:W(function(t,e,i,n){var r=t.seriesKey(t.seriesData.call(this,e,i,n));return null!=r?r:t.seriesIndex.call(this,e,i,n)}),lineData:W(function(t,e,i,n){var r=t.lineKey.call(this,e,i,n);return t.lines[r]?t.lines[r](e):void 0}),onDataBind:function(t,e){return t.selectAll("path").data(function(i,n,r){return[e.call(t,i,n,r)]})},onInsert:function(t){return t.append("path").classed("chart-line",!0).each(this.createLine)},onMergeTransition:function(t){this.setupTransition(t),t.attr("d",this.lineData).attr("style",this.itemStyle)}}),Mt=K("Lines");t.chart().Lines=Ct;var Ot=I(yt,_t,wt,St,kt,At,Dt,Et),Pt=Ot.extend({initialize:function(t){Ot.prototype.initialize.call(this,t),this.on("before:draw",function(){this.offset_axis=this.getOffsetAxis()}.bind(this)),this.standardSeriesLayer("Bars",this.base.append("g").classed("chart-bars",!0)),this.attachLabels()},barHeight:W(function(t,e,i){var n=Math.abs(t.y0()-t.y.call(this,e,i))-t.barOffset();return n>0?n:0}),barWidth:W(function(t){return t.itemWidth()}),barX:W(function(t,e,i){return t.x.call(this,e,i)-t.itemWidth()/2}),barY:W(function(t,e,i){var n=t.y.call(this,e,i),r=t.y0();return r>n?n:r+t.barOffset()}),bar0:W(function(t,e,i){var n=t.y0(),r=t.barOffset();return t.y.call(this,e,i)<=n?n-r:n+r}),barClass:W(function(t,e){return"chart-bar"+(e["class"]?" "+e["class"]:"")}),barOffset:function(){if(this.offset_axis){var t=parseInt(this.offset_axis.base.select(".domain").style("stroke-width"))||0;return t/2}return 0},getOffsetAxis:function(){var t=this.container&&this.container.components();return y(t,function(t){return"Axis"==t.type&&"bottom"==t.position()?t:void 0})},onDataBind:function(t,e){return t.selectAll("rect").data(e,this.key)},onInsert:function(t){return t.append("rect").on("mouseenter",this.mouseEnterPoint).on("mouseleave",this.mouseLeavePoint)},onEnter:function(t){t.attr("y",this.bar0).attr("height",0)},onMerge:function(t){t.attr("class",this.barClass).attr("style",this.itemStyle).attr("x",this.barX).attr("width",this.barWidth)},onMergeTransition:function(t){this.setupTransition(t),t.attr("y",this.barY).attr("height",this.barHeight)},onExitTransition:function(t){this.setupTransition(t),t.attr("y",this.bar0).attr("height",0).remove()}}),jt=K("Bars");t.chart().Bars=Pt;var Ft=Pt.extend({transform:function(t){t=Pt.prototype.transform.call(this,t);var e={},i=this.xKey(),n=this.yKey();return t=t.map(function(t){return t=o({},t),t.values=t.values.map(function(t){t=o({},t);var r=t[i],a=t.__original_y=t[n];return e[r]||(e[r]={pos:0,neg:0}),a>=0?(t.__previous=e[r].pos,e[r].pos=t[n]=e[r].pos+a):(t.__previous=e[r].neg,e[r].neg=t[n]=e[r].neg+a),t},this),t},this)},barHeight:W(function(t,e,i){var n=Math.abs(t.yScale()(e.__previous)-t.y.call(this,e,i)),r=0===t.seriesIndex.call(this,e,i)?t.barOffset():0;return n>0?n-r:0})}),Ht=K("StackedBars");t.chart().StackedBars=Ft;var Vt=I(Pt,Lt).extend({barX:W(function(t,e,i){var n=t.x.call(this,e,i),r=t.x0();return r>n?n:r+t.barOffset()}),barY:W(function(t,e,i){return t.y.call(this,e,i)-t.itemWidth()/2}),barWidth:W(function(t,e,i){var n=Math.abs(t.x0()-t.x.call(this,e,i))-t.barOffset();return n>0?n:0}),barHeight:W(function(t){return t.itemWidth()}),bar0:W(function(t,e,i){var n=t.x0(),r=t.barOffset();return t.x.call(this,e,i)>=n?n+r:n-r}),getOffsetAxis:function(){var t=this.container&&this.container.components();return y(t,function(t){return"Axis"==t.type&&"left"==t.position()?t:void 0})},onEnter:function(t){t.attr("x",this.bar0).attr("width",0)},onMerge:function(t){t.attr("class",this.barClass).attr("style",this.itemStyle).attr("y",this.barY).attr("height",this.barHeight)},onMergeTransition:function(t){this.setupTransition(t),t.attr("x",this.barX).attr("width",this.barWidth)},onExitTransition:function(t){this.setupTransition(t),t.attr("x",this.bar0).attr("width",0).remove()}}),Wt=K("HorizontalBars");t.chart().HorizontalBars=Vt;var Yt=Vt.extend({transform:function(t){return t=Ft.prototype.transform.call(this,t),t=Vt.prototype.transform.call(this,t)},barWidth:W(function(t,e,i){var n=Math.abs(t.yScale()(e.__previous)-t.x.call(this,e,i)),r=0===t.seriesIndex.call(this,e,i)?t.barOffset():0;

return n>0?n-r:0}),barX:W(function(t,e,i){var n=t.x.call(this,e,i),r=t.yScale()(e.__previous);return r>n?n:r+t.barOffset()})}),Rt=K("HorizontalStackedBars");t.chart().HorizontalStackedBars=Yt;var Xt=I(yt,_t,wt,At,Dt,Et),Kt=Xt.extend({initialize:function(t){Xt.prototype.initialize.call(this,t);var e=this.options().parent;e&&(this.parent=e,e.on("attach",function(){this.container=e.container,this.trigger("attach")}.bind(this))),this.standardSeriesLayer("Labels",this.base)},transform:function(t){return t=Xt.prototype.transform.call(this,t),P(t)||(t=[{key:"labels",name:"Labels",values:t}]),t},format:_({set:function(e){return d(e)?{override:t.format(e)}:void 0}}),position:_({default_value:"top|bottom",get:function(t){if(d(t)&&t.indexOf("|")>=0){var e=this,i=t.split("|");return function(t,n,r){var a=e.yValue.call(this,t,n,r);return a>=0?i[0]:i[1]}}return t}}),offset:_({default_value:0}),padding:_({default_value:1}),anchor:_({validate:function(t){return i(["start","middle","end"],t)}}),alignment:_({validate:function(t){return i(["top","middle","bottom"],t)}}),labelText:W(function(t,e,i){var n=b(e.label,b(e.__original_y,t.yValue.call(this,e,i))),r=t.format();return r?r(n):n}),labelClass:W(function(t,e){return"chart-label"+(e["class"]?" "+e["class"]:"")}),onDataBind:function(t,e){return t.selectAll("g").data(e,this.key)},onInsert:function(t){return t.append("g").call(this.insertLabels)},onMerge:function(t){t.attr("class",this.labelClass),this.mergeLabels(t),this.layoutLabels(t)},onMergeTransition:function(t){this.setupTransition(t),this.transitionLabels(t)},insertLabels:function(t){t.append("rect").attr("class","chart-label-bg"),t.append("text").attr("class","chart-label-text")},mergeLabels:function(t){t.selectAll("text").text(this.labelText)},layoutLabels:function(t){function e(t,e,i,n){var r,h=o({},s);if(r=lt(a)?a.call(t,e,i,n):a,f(h.offset)){var c={top:{x:0,y:-h.offset},right:{x:h.offset,y:0},bottom:{x:0,y:h.offset},left:{x:-h.offset,y:0}}[r];c||(c={x:0,y:0}),h.offset=c}return p(h.anchor)&&(h.anchor={top:"middle",right:"start",bottom:"middle",left:"end"}[r]),p(h.alignment)&&(h.alignment={top:"bottom",right:"middle",bottom:"top",left:"middle"}[r]),h}var i,n=this,r=[],a=n.position(),s={offset:n.offset(),padding:n.padding(),anchor:n.anchor(),alignment:n.alignment()};d(a)&&(i=e()),t.each(function(t,a,o){r[o]||(r[o]=[]);var s=n._prepareLabel(n,this,t,a,o);r[o].push(s);var h=i||e.call(n,this,t,a,o);n._calculateLayout(n,h,s)}),this._handleCollisions(n,r),r.forEach(function(t){t.forEach(function(t){this._setLayout(n,t)},this)},this)},transitionLabels:function(t){t.attr("opacity",1)},_prepareLabel:function(e,i,n,r){var a=t.select(i),o=a.select("text"),s=a.select("rect");return{x:e.x.call(i,n,r),y:e.y.call(i,n,r),element:i,selection:a,text:{element:o.node(),selection:o},bg:{element:s.node(),selection:s}}},_calculateLayout:function(t,e,i){var n=i.text.element.getBBox(),r=O(i.text.element),a=i.bg.layout={x:e.offset.x,y:e.offset.y,width:n.width+2*e.padding,height:n.height+2*e.padding};i.width=a.width,i.height=a.height,"end"==e.anchor?i.x-=a.width:"middle"==e.anchor&&(i.x-=a.width/2),"bottom"==e.alignment?i.y-=a.height:"middle"==e.alignment&&(i.y-=a.height/2),i.text.layout={x:a.x+a.width/2-n.width/2,y:a.y+a.height/2-n.height/2+r}},_handleCollisions:function(t,e){function i(t,e){function i(t){return{left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height}}var n=i(t),r=i(e),a=r.left<n.left&&r.right>n.right,o=r.bottom<n.bottom&&r.top>n.top,s=r.left>=n.left&&r.left<n.right||r.right>n.left&&r.right<=n.right||a,h=r.top>=n.top&&r.top<n.bottom||r.bottom>n.top&&r.bottom<=n.bottom||o;return s&&h}function n(t,e){if(t.group&&e.group)g(e.group.labels,function(e){t.group.labels.push(e),e.group=t.group}),a(t.group);else if(t.group)r(e,t.group);else if(e.group)r(t,e.group);else{var i={labels:[]};r(t,i),r(e,i)}}function r(t,e){e.labels.push(t),t.group=e,t.originalY=t.y,a(e)}function a(t){function e(t){return t.y=t.originalY,t}function n(t,e){return t.y<e.y?-1:t.y>e.y?1:0}var r=t.labels.map(e).sort(n).reverse();r.forEach(function(t,e){for(var n,a=c(r,e),o=a.length-1;o>=0;o--)if(i(t,a[o])){n=a[o];break}n&&(t.y=n.y-t.height)})}e.forEach(function(t,r){e.slice(r+1).forEach(function(e){e.forEach(function(e){t.forEach(function(t){i(t,e)&&n(t,e)})})})})},_setLayout:function(t,e){e.bg.selection.attr("transform",C(e.bg.layout.x,e.bg.layout.y)).attr("width",e.bg.layout.width).attr("height",e.bg.layout.height),e.text.selection.attr("transform",C(e.text.layout.x,e.text.layout.y)),e.selection.attr("transform",C(e.x,e.y)).attr("opacity",0)}},{z_index:150}),Nt=K("Labels");t.chart().Labels=Kt;var Gt=I(Kt,At),Ut=Gt.extend({initialize:function(t){Gt.prototype.initialize.call(this,t),this.on("attach",function(){this.container.on("mouseenter:point",this.onMouseEnterPoint.bind(this)),this.container.on("mouseleave:point",this.onMouseLeavePoint.bind(this))}.bind(this))},hoverTolerance:_({set:function(t){this.parent&&this.parent.hoverTolerance&&this.parent.hoverTolerance(t)},default_value:1/0}),transitionLabels:function(){},onMouseEnterPoint:function(e){var i=this.findLabelForPoint(e);i&&t.select(i).attr("opacity",1)},onMouseLeavePoint:function(e){var i=this.findLabelForPoint(e);i&&t.select(i).attr("opacity",0)},findLabelForPoint:function(t){var e,i=this.base.selectAll("g.chart-series").selectAll("g"),n=this;return i.each(function(i,r,a){var o=n.seriesData.call(this,i,r,a);i===t.d&&o===t.series&&(e=this)}),e}}),qt=K("HoverLabels");t.chart().HoverLabels=Ut;var Zt=I(vt,Et),Jt=Zt.extend({initialize:function(t){Zt.prototype.initialize.call(this,t),this.standardLayer("Text",this.base.append("g").classed("chart-text",!0))},text:_(),rotation:_({default_value:0}),textAlign:_({default_value:"center",validate:function(t){return i(["left","center","right"],t)}}),anchor:_({default_value:function(){return{left:"start",center:"middle",right:"end"}[this.textAlign()]},validate:function(t){return i(["start","middle","end","inherit"],t)}}),verticalAlign:_({default_value:"middle",validate:function(t){return i(["top","middle","bottom"],t)}}),style:_({default_value:{},get:function(t){return H(t)||null}}),onDataBind:function(t){return t.selectAll("text").data([0])},onInsert:function(t){return t.append("text")},onMerge:function(t){t.attr("transform",this.transformation()).attr("style",this.style()).attr("text-anchor",this.anchor()).attr("class",this.options()["class"]).text(this.text())},transformation:function(){var t={left:0,center:this.width()/2,right:this.width()}[this.textAlign()],e={top:0,middle:this.height()/2,bottom:this.height()}[this.verticalAlign()],i=C(t,e),n=M(this.rotation());return i+" "+n}},{z_index:70});t.chart().Text=Jt;var Qt=Jt.extend({initialize:function(t){Jt.prototype.initialize.call(this,t),this.base.select(".chart-text").classed("chart-title",!0)},margins:_({set:function(t){return{override:V(t,rt(this.position()))}},default_value:function(){return rt(this.position())}}),rotation:_({default_value:function(){var t={right:90,left:-90};return t[this.position()]||0}})});t.chart().Title=Qt;var $t=I(vt,wt,Dt,Et),te=$t.extend({initialize:function(t){$t.prototype.initialize.call(this,t);var e=this.options().parent;e&&(this.parent=e,e.on("attach",function(){this.container=e.container,this.trigger("attach")}.bind(this))),this.standardLayer("Gridlines",this.base.append("g").attr("class","chart-gridlines"))},orientation:_({default_value:"horizontal",validate:function(t){return i(["horizontal","vertical"],t)},set:function(){this.scale()&&this.scale(this.scale())}}),scale:_({set:function(t){return"vertical"==this.orientation()?(this.xScale(t),t=this.xScale()):(this.yScale(t),t=this.yScale()),{override:t}}}),ticks:_({default_value:[10]}),tickValues:_(),drawLine:W(function(e,i){var n,r,a,o;"vertical"==e.orientation()?(n=r=e.xScale()(i),a=0,o=e.height()):(n=0,r=e.width(),a=o=e.yScale()(i)),t.select(this).attr("x1",n).attr("x2",r).attr("y1",a).attr("y2",o)}),width:function(){return this.container?this.container.chartPosition().width:w(this.base).width},height:function(){return this.container?this.container.chartPosition().height:w(this.base).width},onDataBind:function(t,e){var i=e&&e[0]&&e[0].y===!1,n=this.tickValues();if(null==n&&!i){var r="vertical"==this.orientation()?this.xScale():this.yScale(),a=this.ticks();a||(a=[10]),Array.isArray(a)||(a=[a]),n=r.ticks?r.ticks.apply(r,a):r.domain()}return t.selectAll("line").data(i?[]:n)},onInsert:function(t){return t.append("line").attr("class","chart-gridline")},onMerge:function(t){t.attr("opacity",0).each(this.drawLine)},onMergeTransition:function(t){t.attr("opacity",1)},onExit:function(t){t.remove()},skip_layout:!0},{layer_type:"chart",z_index:55}),ee=K("Gridlines");t.chart().Gridlines=te;var ie=I(vt,wt,Dt,Et),ne=ie.extend({initialize:function(e){ie.prototype.initialize.call(this,e),this.axis=t.svg.axis(),this._layout_axis=t.svg.axis(),this.axis_base=this.base.append("g").attr("class","chart-axis"),this._layout_base=this.base.append("g").attr("class","chart-axis chart-layout").append("g").style("display","none"),this.standardLayer("Axis",this.axis_base),this.attachGridlines()},scale:_({set:function(t){return"vertical"==this.orientation()?(this.yScale(t),t=this.yScale()):(this.xScale(t),t=this.xScale()),{override:t}}}),position:_({default_value:"bottom",validate:function(t){return i(["top","right","bottom","left"],t)},set:function(){this.scale()&&this.scale(this.scale())}}),translation:_({default_value:function(){switch(this.position()){case"top":return{x:0,y:0};case"right":return{x:this.width(),y:0};case"bottom":return{x:0,y:this.height()};case"left":return{x:0,y:0};case"x0":return{x:this.x0(),y:0};case"y0":return{x:0,y:this.y0()}}},get:function(t){return C(t)}}),orient:_({default_value:function(){var t=this.position();return"x0"==t?t="left":"y0"==t&&(t="bottom"),t}}),orientation:_({validate:function(t){return i(["horizontal","vertical"],t)},default_value:function(){return{top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"}[this.position()]},set:function(){this.scale()&&this.scale(this.scale())}}),gridlines:_({get:function(t){return l(t)?t={display:t}:t||(t={display:!1}),t}}),ticks:_(),tickValues:_(),tickSize:_(),innerTickSize:_(),outerTickSize:_(),tickPadding:_(),tickFormat:_(),onDataBind:function(t){return this._setupAxis(this.axis),t.selectAll("g").data([0])},onInsert:function(t){return t.append("g")},onEnter:function(t){t.call(this.axis)},onMerge:function(t){t.attr("transform",this.translation())},onUpdateTransition:function(t){this.setupTransition(t),t.call(this.axis)},onExit:function(t){t.selectAll("g").remove()},getLayout:function(){this.setScales(),this._setupAxis(this._layout_axis),this._layout_base.call(this._layout_axis),this._layout_base.style("display","block");var t=this._getLabelOverhang();return this._layout_base.style("display","none"),{position:this.position(),width:t.width,height:t.height}},setLayout:function(){},attachGridlines:function(){function t(t){return a({},t.gridlines(),{parent:t,xScale:t.xScale(),yScale:t.yScale(),ticks:t.ticks(),tickValues:t.tickValues(),orientation:"horizontal"==t.orientation()?"vertical":"horizontal"})}function e(t,e){var i=t.base.append("g").attr("class","chart-axis-gridlines");return new te(i,e)}var i=t(this),n=this._gridlines=i.display&&e(this,i);this.on("draw",function(){i=t(this),n?n.options(i):i.display&&(n=this._gridlines=e(this,i)),n&&i.display?n.draw():n&&n.draw([!1])}.bind(this))},_setupAxis:function(t){t.scale("vertical"==this.orientation()?this.yScale():this.xScale());var e=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"],n=["tickValues"];e.forEach(function(e){var r=this[e]&&this[e]();p(r)||(Array.isArray(r)&&!i(n,e)?t[e].apply(t,r):t[e](r))},this)},_getLabelOverhang:function(){var e={width:[0],height:[0]},i=this.orientation();return this._layout_base.selectAll("g").each(function(){try{var t=this.getBBox();"horizontal"==i?e.height.push(t.height):e.width.push(t.width)}catch(n){}}),{width:t.max(e.width),height:t.max(e.height)}}},{layer_type:"chart",z_index:60}),re=K("Axis");t.chart().Axis=ne;var ae=Qt.extend({initialize:function(t){Qt.prototype.initialize.call(this,t),this.base.select(".chart-text").classed("chart-title",!1).classed("chart-axis-title",!0)},margins:_({set:function(t){return{override:V(t,ot(this.position()))}},default_value:function(){return ot(this.position())}})});t.chart().AxisTitle=ae;var oe={top:8,right:8,bottom:8,left:8},se=I(vt,Et),he=se.extend({initialize:function(t){se.prototype.initialize.call(this,t),this.legend_base=this.base.append("g").classed("chart-legend",!0),this.standardLayer("Legend",this.legend_base)},charts:_(),swatchDimensions:_({default_value:{width:20,height:20}}),margins:_({default_value:oe,set:function(t){return{override:V(t,oe)}}}),stackDirection:_({validate:function(t){return i(["vertical","horizontal"],t)},default_value:function(){var t={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical"};return t[this.position()]}}),transform:function(t){if(this.charts()){var e=this.container.charts();t=this.charts().reduce(function(t,i){var n=h(e,function(t){return t.id==i});if(!n||n.exclude_from_legend||n.options().exclude_from_legend)return t;var r=this.container.demux(i,this.container.data());P(r)||(r=[r]);var a=r.reduce(function(t,e,i){return e&&!e.exclude_from_legend&&t.push(this.getLegendData(n,e,i)),t}.bind(this),[]);return t.concat(a)}.bind(this),[])}return t},itemKey:W(function(t,e){return e.key}),itemText:W(function(t,e){return e.text}),swatchClass:W(function(t,e){return n(["chart-legend-swatch",e["class"]]).join(" ")}),createSwatch:W(function(e,i,n){var r=t.select(this);r.selectAll("*").remove(),r.attr("class",e.swatchClass);var a=he.swatches;a&&(i&&i.type&&a[i.type]?a[i.type].call(r,e,i,n):a["default"]&&a["default"].call(r,e,i,n))}),onDataBind:function(t,e){return t.selectAll(".chart-legend-group").data(e,this.itemKey)},onInsert:function(t){var e=t.append("g").attr("class","chart-legend-group").style("pointer-events","all").on("mouseenter",function(t,e){this.container.trigger("mouseenter:legend",this._itemDetails(t,e))}.bind(this)).on("mousemove",function(t,e){this.container.trigger("mousemove:legend",this._itemDetails(t,e))}.bind(this)).on("mouseleave",function(t,e){this.container.trigger("mouseleave:legend",this._itemDetails(t,e))}.bind(this));return e.append("g").attr("width",this.swatchDimensions().width).attr("height",this.swatchDimensions().height).attr("class","chart-legend-swatch"),e.append("text").attr("class","chart-legend-label"),e.append("rect").attr("class","chart-legend-hover").style("visibility","hidden"),e},onMerge:function(e){var i=this.swatchDimensions();e.select(".chart-legend-swatch").each(this.createSwatch),e.select(".chart-legend-label").text(this.itemText).each(function(){var e=O(this,i.height);t.select(this).attr("transform",C(i.width+5,e))}),e.call(T({direction:this.stackDirection(),origin:"top",padding:5,min_height:i.height,min_width:i.width}));var n=[];e.each(function(){n.push(this.getBBox())}),e.select(".chart-legend-hover").each(function(){var e=n.shift();t.select(this).attr("width",e.width).attr("height",e.height)})},onExit:function(t){t.remove()},getLegendData:function(t,e,i){return{text:e.name||"Series "+(i+1),key:t.id+"."+(e.key||i),type:t.type,"class":n(["chart-series","chart-index-"+i,t.options()["class"],e["class"]]).join(" ")}},_itemDetails:function(t,e){return{legend:this,d:t,i:e}}},{z_index:200,swatches:{"default":function(e){var i=e.swatchDimensions();this.append("circle").attr("cx",i.width/2).attr("cy",i.height/2).attr("r",t.min([i.width,i.height])/2).attr("class","chart-swatch")}},registerSwatch:function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){this.swatches[t]=e},this)}});he.registerSwatch(["Lines"],function(t){var e=t.swatchDimensions();return this.append("line").attr("x1",0).attr("y1",e.height/2).attr("x2",e.width).attr("y2",e.height/2).attr("class","chart-line")}),he.registerSwatch(["Bars","StackedBars","HorizontalBars","HorizontalStackedBars"],function(t){var e=t.swatchDimensions();return this.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).attr("class","chart-bar")});var ce=K("Legend");t.chart().Legend=he;var le=he.extend({initialize:function(t){he.prototype.initialize.call(this,t),this.on("draw",function(){var t=this.translation();this.legend_base.attr("transform",C(t.x,t.y))}.bind(this))},translation:_({default_value:{x:10,y:0,relative_to:"left-top"},get:function(t){var e=t.x||0,i=t.y||0,n=t.relative_to&&t.relative_to.split("-")[0]||"left",r=t.relative_to&&t.relative_to.split("-")[1]||"top";return"right"===n&&(e=this.width()-w(this.legend_base).width-e),"bottom"===r&&(i=this.height()-w(this.legend_base).height-i),{x:e,y:i}}}),skip_layout:!0},{layer_type:"chart"}),ue=K("InsetLegend");t.chart().InsetLegend=le;var fe=t.compose={VERSION:"0.15.8",utils:ut,helpers:dt,Base:N,Chart:yt,Component:vt,Overlay:mt,Compose:bt,layered:Z,mixins:It,Lines:Ct,lines:Mt,Bars:Pt,bars:jt,StackedBars:Ft,stackedBars:Ht,HorizontalBars:Vt,horizontalBars:Wt,HorizontalStackedBars:Yt,horizontalStackedBars:Rt,Labels:Kt,labels:Nt,HoverLabels:Ut,hoverLabels:qt,Text:Jt,text:nt,Title:Qt,title:at,Axis:ne,axis:re,AxisTitle:ae,axisTitle:st,Legend:he,legend:ce,InsetLegend:le,insetLegend:ue,Gridlines:te,gridlines:ee},de=fe;return de});
//# sourceMappingURL=d3.compose-all.min.js.map