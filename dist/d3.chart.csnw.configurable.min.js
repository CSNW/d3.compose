/*! d3.chart.csnw.configurable - v0.0.0
 * https://github.com/CSNW/d3.chart.csnw.configurable
 * License: MIT
 */

!function(d3,a){function b(b,c){function d(c){return a.isUndefined(c[f])?void 0:c[f][b]}function e(a,c){a[f]=a[f]||{},a[f][b]=c}c=c||{};var f=c.propKey||"__properties",g=function(b){var f=d(this);if(!arguments.length)return b=a.isUndefined(f)?g.defaultValue:f,b&&"function"==typeof b&&"function"!=c.type&&(b=b.call(this)),"function"==typeof c.get?c.get.call(this,b):b;var h=f;if(e(this,b),"function"==typeof c.set){var i=c.set.call(this,b,h);i&&i.override&&e(this,i.override),i&&i.after&&i.after.call(this,d(this))}return this};return g.isProperty=!0,g.setFromOptions=i(c.setFromOptions,!0),g.defaultValue=c.defaultValue,g}function c(a){var b=a&&a.length&&a[0]&&a[0].length&&a[0][0];return{width:parseFloat(a&&a.attr("width")||b&&b.clientWidth||0),height:parseFloat(a&&a.attr("height")||b&&b.clientHeight||0)}}function d(b){if(b=b||{},a.isFunction(b))return b;var c;return c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&c[b].apply(c,a))}),c}function e(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),j.translate(g,h)})}}function f(b){return b=a.reduce(b,function(a,b,c){return b?a+c+":"+b+";":a},"")}function g(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function h(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}function i(b,c){return a.isUndefined(b)?c:b}var j={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"}};d3.chart().mixin=function(b){var c=this;return b=a.isArray(b)?b:a.toArray(arguments),{extend:function(a,d,e){return d&&b.push(d),d3.chart().extend.call(c,a,h(b),e)}}},d3.chart.helpers={valueOrDefault:i,property:b,dimensions:c,transform:j,translate:j.translate,createScaleFromOptions:d,stack:e,style:f,getValue:g,mixin:h}}(d3,_),function(d3,a){var b=a.property,c=a.valueOrDefault,d=d3.chart.extensions={};d.Series={seriesKey:function(a){return a.key},seriesValues:function(a,b){return a.seriesIndex=b,_.map(a.values,function(a){return a.seriesIndex=b,a})},seriesClass:function(a,b){return"series index-"+b+(a["class"]?" "+a["class"]:"")},seriesIndex:function(a){return a.seriesIndex||0},seriesCount:function(){return this.data()?this.data().length:1},seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey.bind(b));return c.enter().append("g").attr("class",b.seriesClass.bind(b)),c.chart=function(){return b},d.call(c,b.seriesValues.bind(b))}}return d3.chart().prototype.layer.call(this,a,b,c)}},d.XY={initialize:function(){this.on("change:data",this.setScales),this.options.xScale&&this.xScale(a.createScaleFromOptions(this.options.xScale)),this.options.yScale&&this.yScale(a.createScaleFromOptions(this.options.yScale))},x:function(a,b){return this._xScale()(this.xValue(a,b))},y:function(a,b){return this._yScale()(this.yValue(a,b))},x0:function(){return this._xScale()(0)},y0:function(){return this._yScale()(0)},xValue:function(a){return a.x},yValue:function(a){return a.y},keyValue:function(a){return a.key},setScales:function(){var a=this.xScale(),b=this.yScale();a||(a=this.setXScaleDomain(this.defaultXScale(),this.data()||[],this)),b||(b=this.setYScaleDomain(this.defaultYScale(),this.data()||[],this)),a=this.setXScaleRange(a,this.data()||[],this),b=this.setYScaleRange(b,this.data()||[],this),this._xScale(a)._yScale(b)},setXScaleDomain:function(a){return a.domain([this.xMin(),this.xMax()])},setYScaleDomain:function(a){return a.domain([this.yMin(),this.yMax()])},setXScaleRange:function(a,b,c){return a.range([0,c.width()])},setYScaleRange:function(a,b,c){return a.range([c.height(),0])},defaultXScale:function(){return d3.scale.linear()},defaultYScale:function(){return d3.scale.linear()},_xScale:b("_xScale",{type:"function"}),_yScale:b("_yScale",{type:"function"}),xScale:b("xScale",{type:"function",setFromOptions:!1}),yScale:b("yScale",{type:"function",setFromOptions:!1}),xMin:b("xMin",{get:function(a){var b=_.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[0];return a>d?d:a},1/0,this);return c(a,0>b?b:0)}}),xMax:b("xMax",{get:function(a){var b=_.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[1];return d>a?d:a},-1/0,this);return c(a,b)}}),yMin:b("yMin",{get:function(a){var b=_.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[0];return a>d?d:a},1/0,this);return c(a,0>b?b:0)}}),yMax:b("yMax",{get:function(a){var b=_.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[1];return d>a?d:a},-1/0,this);return c(a,b)}})},d.Values={isValues:!0,transform:function(a){return _.each(a,function(a){a.values=_.map(a.values,function(a){return a=_.isObject(a)?a:{y:a},{x:c(a.x,a.key),y:a.y,key:a.key}},this)},this),a},x:function(a,b){return this._xScale()(this.xValue(a,b))+.5*this.layeredWidth()},defaultXScale:function(){return d3.scale.ordinal()},setXScaleDomain:function(a,b){var c=_.reduce(b,function(a,b,c){var d=_.map(this.seriesValues(b,c),this.xValue.bind(this));return d.length>a.length?d:a},[],this);return a.domain(c)},setXScaleRange:function(a,b,c){return a.rangeBands([0,c.width()],this.itemPadding(),this.itemPadding()/2)},adjacentX:function(a,b){var c=this.adjacentWidth(a,b),d=this.x(a,b)-this.layeredWidth(a,b)/2+c/2;return d+c*this.seriesIndex(a,b)},adjacentWidth:function(a,b){return this.layeredWidth(a,b)/this.seriesCount()},layeredX:function(a,b){return this.x(a,b)},layeredWidth:function(){return this._xScale().rangeBand()},itemX:function(a,b){return this.displayAdjacent()?this.adjacentX(a,b):this.layeredX(a,b)},itemWidth:function(a,b){return this.displayAdjacent()?this.adjacentWidth(a,b):this.layeredWidth(a,b)},itemPadding:b("itemPadding",{defaultValue:.1}),displayAdjacent:b("displayAdjacent",{defaultValue:!1})}}(d3,d3.chart.helpers),function(d3,a,b,c){var d=b.property;d3.chart("Base",{initialize:function(b){this.options=b||{},a.each(this.options,function(a,b){this[b]&&this[b].isProperty&&this[b].setFromOptions&&this[b](a)},this)},transform:function(a){return this.data(a||[]),a||[]},width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},data:d("data",{set:function(a){this.trigger("change:data",a)}})}),d3.chart("Base").mixin(c.Series).extend("Chart"),d3.chart("Base").extend("Container",{initialize:function(){this.charts=[],this.chartsById={},this.components=[],this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart",!0),this.chartBase(this.base.append("g").classed("chart-base",!0)),this.updateDimensions(),this.on("change:dimensions",function(){this.updateDimensions(),this.redraw()})},updateDimensions:function(){this.base.attr("width",this.width()).attr("height",this.height());var a=this.updateChartMargins();this.chartBase().attr("transform",b.translate(a.left,a.top)).attr("width",this.chartWidth()).attr("height",this.chartHeight())},redraw:function(){this.rawData()&&this.draw(this.rawData())},attachChart:function(a,b){b.id=a,this.attach(a,b),this.charts.push(b),this.chartsById[a]=b},attachComponent:function(a,b){b.id=a,this.attach(a,b),this.components.push(b),this.componentsById[a]=b,b.on("change:dimensions",function(){this.trigger("change:dimensions")})},updateChartMargins:function(){var b=this.chartMargins();return a.each(this.components,function(a){var c=a&&a.chartOffset&&a.chartOffset();c&&(b.top+=c.top||0,b.right+=c.right||0,b.bottom+=c.bottom||0,b.left+=c.left||0)},this),this._chartMargins(b),b},rawData:d("rawData"),chartBase:d("chartBase"),chartMargins:d("chartMargins",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}}),_chartMargins:d("_chartMargins",{defaultValue:function(){return a.extend({},this.chartMargins())}}),chartWidth:function(){var a=this._chartMargins();return this.width()-a.left-a.right},chartHeight:function(){var a=this._chartMargins();return this.height()-a.top-a.bottom},width:d("width",{defaultValue:function(){return b.dimensions(this.base).width},set:function(){this.trigger("change:dimensions")}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height},set:function(){this.trigger("change:dimensions")}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.property;d3.chart("Chart").mixin(c.XY).extend("Labels",{initialize:function(){this.seriesLayer("Labels",this.base.append("g").classed("labels",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("text").data(a,b.keyValue.bind(b))},insert:function(){var a=this.chart();return this.append("text").classed("label",!0).attr("font-family",a.labelFontFamily()).attr("font-size",a.labelFontSize()).attr("alignment-baseline",a.labelAlignment.bind(a))},events:{enter:function(){var a=this.chart();this.attr("x",a.labelX.bind(a)).attr("y",a.y0.bind(a)).attr("text-anchor",a.labelAnchor.bind(a)).text(0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.labelY.bind(a)).text(a.yValue.bind(a))}}})},labelX:function(a,b){return this.x(a,b)+this.calculatedLabelOffset(a,b).x},labelY:function(a,b){return this.y(a,b)+this.calculatedLabelOffset(a,b).y},calculatedLabelOffset:function(a,b){var c=this.labelOffset(),d={top:{x:0,y:-c},right:{x:c,y:0},bottom:{x:0,y:c},left:{x:-c,y:0}};return d[this.calculatedLabelPosition(a,b)]},labelAnchor:function(a,b){return"right"==this.calculatedLabelPosition(a,b)?"start":"left"==this.calculatedLabelPosition(a,b)?"end":"middle"},labelAlignment:function(a,b){var c={top:"after-edge",right:"middle",bottom:"before-edge",left:"middle"};return c[this.calculatedLabelPosition(a,b)]},calculatedLabelPosition:function(a,b){var c=this.labelPosition(),d=c.split("|");if(d.length>1){var e="top"==d[0]||"bottom"==d[0]?this.yValue(a,b):this.xValue(a,b);return e>=0?d[0]:d[1]}return d[0]},labelPosition:d("labelPosition",{defaultValue:"top"}),labelOffset:d("labelOffset",{defaultValue:14}),labelFontSize:d("labelFontSize",{defaultValue:"14px"}),labelFontFamily:d("labelFontFamily",{defaultValue:"sans-serif"})}),d3.chart("Chart").mixin(d3.chart("Labels").prototype,c.Values).extend("LabelValues",{labelX:function(a,b){return this.itemX(a,b)+this.calculatedLabelOffset(a,b).x}}),d3.chart("Chart").extend("ChartWithLabels",{initialize:function(){this.showLabels()&&(this.labels=this.base.chart(this.isValues?"LabelValues":"Labels",this.options),this.labels.displayAdjacent&&this.displayAdjacent&&this.labels.displayAdjacent(this.displayAdjacent()),this.attach("Labels",this.labels))},showLabels:d("showLabels",{defaultValue:!0})}),d3.chart("ChartWithLabels").mixin(c.XY,c.Values).extend("Bars",{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("bar-chart",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue.bind(b))},insert:function(){return this.append("rect").classed("bar",!0)},events:{enter:function(){var a=this.chart();this.attr("x",a.barX.bind(a)).attr("y",a.y0.bind(a)).attr("width",a.itemWidth.bind(a)).attr("height",0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.barY.bind(a)).attr("height",a.barHeight.bind(a))}}})},barHeight:function(a,b){return Math.abs(this.y0(a,b)-this.y(a,b))},barX:function(a,b){return this.itemX(a,b)-this.itemWidth(a,b)/2},barY:function(a,b){var c=this.y(a,b),d=this.y0();return d>c?c:d},displayAdjacent:d("displayAdjacent",{defaultValue:!0})}),d3.chart("ChartWithLabels").mixin(c.XY).extend("Line",{initialize:function(){this.seriesLayer("Line",this.base.append("g").classed("line-chart",!0),{dataBind:function(){var b=this.chart();return b.lines(a.map(b.data(),function(a){return b.createLine(a)})),this.selectAll("path").data(function(a,c){return[b.data()[c]]},b.seriesKey.bind(b))},insert:function(){return this.append("path").classed("line",!0)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();this.attr("d",function(c,d){return b[a.seriesIndex(c,d)](a.seriesValues(c,d))}).attr("style",a.lineStyle.bind(a))}}})},lines:d("lines",{defaultValue:[]}),lineStyle:function(a,c){return b.style({stroke:this.lineStroke(a,c),"stroke-dasharray":this.lineStrokeDashArray(a,c)})},lineStroke:function(a){return b.getValue(["stroke","color"],a,this.options)},lineStrokeDashArray:function(a){return b.getValue(["stroke-dasharray"],a,this.options)},createLine:function(a){var b=d3.svg.line().x(this.x.bind(this)).y(this.y.bind(this)),c=a.interpolate||this.options.interpolate;return c&&b.interpolate(c),b}}),d3.chart("ChartWithLabels").mixin(d3.chart("Line").prototype,c.Values).extend("LineValues")}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.property;d3.chart("Base").extend("Component",{chartOffset:d("chartOffset",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}})}),d3.chart("Component").mixin(c.Series,c.XY).extend("Axis",{initialize:function(){this.axis=d3.svg.axis(),this.layer("Axis",this.base.append("g").classed("axis",!0),{dataBind:function(){return this.selectAll("g").data([0])},insert:function(){var a=this.chart(),b=(a.axisPosition(),a.axisOrientation()),c="horizontal"==b?a._xScale():a._yScale();return a.axis.scale(c).orient(a.axisOrient()),this.append("g")},events:{merge:function(){var a=this.chart();this.attr("transform",a.axisTranlation.call(a)).call(a.axis)}}})},axisTranlation:function(a,c){var d={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(a,c),y:0},y0:{x:0,y:this.y0(a,c)}};return b.translate(d[this.axisPosition()])},axisPosition:d("axisPosition",{defaultValue:"bottom",set:function(){var a=this.chartOffset(),b=this.axisOffset(),c=this.axisOrient();a[c]||(a[c]=b,this.chartOffset(a))}}),axisOffset:d("axisOffset",{defaultValue:function(){var a=this.axisOrientation();return"horizontal"==a?30:60}}),axisOrient:d("axisOrient",{defaultValue:function(){var a=this.axisPosition();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),axisOrientation:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.axisPosition()]}}),d3.chart("Component").mixin(d3.chart("Axis").prototype,c.Values).extend("AxisValues"),d3.chart("Component").mixin().extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("legend",!0),this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var a=(this.chart(),this.append("g").attr("class",function(a,b){return"legend-group index-"+b}));return a.append("g").attr("width",20).attr("height",20).attr("class","legend-swatch"),a.append("text").attr("class","legend-label").attr("transform",b.translate(25,0)),a},events:{merge:function(){var a=this.chart();this.select("g").each(a.createSwatches()),this.select("text").text(a.dataValue.bind(a)).attr("alignment-baseline","before-edge"),this.call(b.stack.bind(this,{origin:"top",padding:5}))}}})},dataKey:function(a){return a.key},dataValue:function(a){return a.name},dataSwatchProperties:function(b){return a.defaults({},b,{type:"swatch",color:"blue","class":""})},createSwatches:function(){var a=this;return function(b,c){a.createSwatch(d3.select(this),b,c)}},createSwatch:function(a,b,c){var d=this.dataSwatchProperties(b,c);if(a.empty(),a.classed(d["class"],!0),"Line"==d.type||"LineValues"==d.type){a.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","line")}else a.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","bar")},legendPosition:d("legendPosition",{defaultValue:"right",set:function(a){var b={top:0,right:0,bottom:0,left:0};b[a]=100,this.chartOffset(b)}})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this.positionLegend()},positionLegend:function(){if(this.legend){var a=this.legendPosition();this.legend.attr("transform",b.translate(a.x,a.y))}},legendPosition:d("legendPosition",{defaultValue:{x:10,y:10},set:function(b,c){return b=b&&a.isObject(b)?b:{},b=a.defaults(b,c||{},{x:0,y:0}),{override:b,after:function(){this.positionLegend()}}}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){b.property;d3.chart("Container").extend("Configurable",{initialize:function(){if(a.each(this.options.charts,function(b,c){if(b=a.defaults(b||{},d3.chart("Configurable").defaultChartOptions),d3.chart(b.type)){var d=this.chartBase().chart(b.type,b),e="chart_"+c;this.attachChart(e,d)}},this),a.each(this.options.axes,function(b,c){if(b=a.defaults(b||{},d3.chart("Configurable").defaultAxisOptions),d3.chart(b.type)){var d=this.chartBase().chart(b.type,b),e="axis_"+c;this.attachComponent(e,d)}},this),this.options.legend){var b=a.defaults(this.options.legend,d3.chart("Configurable").defaultLegendOptions);if(!d3.chart(b.type))return;var c="InsetLegend"==b.type?this.chartBase():this.base,d=c.chart(b.type,b);this.attachComponent("legend",d)}},demux:function(a,b){var c=this.chartsById[a]||this.componentsById[a];return"legend"==a?this.extractLegendData(c,b):this.extractData(c,a,b)},extractData:function(a,b,c){var d=a&&a.options&&a.options.dataKey||b;return c[d]||[]},extractLegendData:function(b,c){function d(b){if(b){var d=this.extractData(b,b.id,c);return a.map(d,function(c){return a.defaults(c,b.options)},this)}return[]}if(b&&b.options&&b.options.dataKey)return this.extractData(b,"legend",c);var e,f=b&&b.options&&b.options.data||{};return e=f.charts?a.reduce(f.charts,function(a,b){return a.concat(d.call(this,this.charts&&this.charts[b]))},[],this):a.reduce(this.charts,function(a,b){return a.concat(d.call(this,b))},[],this)}},{defaultChartOptions:{},defaultAxisOptions:{type:"Axis"},defaultLegendOptions:{type:"Legend",legendPosition:"right"}})}(d3,_,d3.chart.helpers,d3.chart.extensions);
//# sourceMappingURL=d3.chart.csnw.configurable.min.map