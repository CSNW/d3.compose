/*! d3.chart.csnw.configurable - v0.5.1
 * https://github.com/CSNW/d3.chart.csnw.configurable
 * License: MIT
 */

!function(d3,a){function b(b,d){d=d||{};var e=d.propKey||"__properties",f=function(c,g){function h(){return c=a.isUndefined(k)?f.defaultValue:k,a.isFunction(c)&&"Function"!=d.type&&(c=c.call(this)),a.isFunction(d.get)?d.get.call(l,c):c}function i(){var e;if(a.isFunction(d.validate)&&!d.validate.call(this,c)){if(a.isFunction(this.trigger)&&(this.trigger("invalid:"+b,c),this.trigger("invalid",b,c)),!a.isUndefined(k))return j[b]=k,this;if(a.isUndefined(f.defaultValue))return this;c=f.defaultValue}if(j[b]=c,a.isFunction(d.set)){var h=d.set.call(l,c,k);h&&a.has(h,"override")&&(j[b]=h.override),h&&a.isFunction(h.after)&&h.after.call(l,j[b]),h&&a.has(h,"changed")&&(e=h.changed)}return a.isUndefined(e)&&(e=!a.isEqual(j[b],k)),e&&a.isFunction(this.trigger)&&!g.silent&&(this.trigger("change:"+b,j[b]),this.trigger("change",b,j[b])),this}g=g||{};var j=this[e]=this[e]||{},k=j[b],l=a.isUndefined(f.context)?this:f.context;return arguments.length?i.call(this):h.call(this)};return f.isProperty=!0,f.setFromOptions=c(d.setFromOptions,!0),f.defaultValue=d.defaultValue,f.context=d.context,f}function c(b,c){return a.isUndefined(b)?c:b}function d(b){{var c=b&&b.length&&b[0]&&b[0].length&&b[0][0],d=c&&"function"==typeof c.getBBox&&c.getBBox()||{},e=c?{width:c.clientWidth,height:c.clientHeight}:{width:0,height:0},f=b?{width:b.attr("width"),height:b.attr("height")}:{width:0,height:0};c?"svg"==c.nodeName:!1}return{width:a.max([e.width,f.width||d.width])||0,height:a.max([e.height,f.height||d.height])||0}}function e(b){if(b=b||{},a.isFunction(b))return b;var c;return c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&c[b].apply(c,a))}),c}function f(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),p.translate(g,h)})}}function g(b){return b?(b=a.map(b,function(a,b){return b+": "+a}),b=b.join("; "),b?b+";":""):""}function h(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function i(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._isDi=!0,b.original=a,b}function j(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function k(a){for(var b in a)a[b]&&a[b]._isDi&&(a[b]=j(a[b],a))}function l(a){var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function m(a,b,c){a=a||"",b=b||"",c=c||"";var d=d3.chart(a+c)||d3.chart(a)||d3.chart(b+c)||d3.chart(b+a)||d3.chart(a+b)||d3.chart(b);if(!d)throw new Error("d3.chart.csnw.configurable: Unable to resolve chart for type "+a+" and component "+b+" and container "+c);return d}function n(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return delete c.constructor,c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var o={component:50,axis:51,title:52,chart:100,legend:200};a.each(["extend"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=a[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.clone(b[c]());d.unshift(g);var h=f.apply(a,d);return b[c]("result"==e?h:g),h}}}),a.each(["push","pop",{name:"concat",set:"result"},"splice","shift","unshift","reverse","sort"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=Array.prototype[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.toArray(b[c]()),h=f.apply(g,d);return b[c]("result"==e?h:g),h}}});var p={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"},rotate:function(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}};d3.chart.helpers=a.extend({},d3.chart.helpers,{zIndex:o,property:b,valueOrDefault:c,dimensions:d,transform:p,translate:p.translate,createScaleFromOptions:e,stack:f,style:g,getValue:h,di:i,bindDi:j,bindAllDi:k,getParentData:l,resolveChart:m,mixin:n})}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f=d3.chart.extensions=d3.chart.extensions||{};f.Series={seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"chart-series chart-index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.dataSeries.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),dataSeries:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.dataSeries.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options().style);return b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},f.XY={initialize:function(){function a(){this.options().xScale&&this.xScale(b.createScaleFromOptions(this.options().xScale)),this.options().yScale&&this.yScale(b.createScaleFromOptions(this.options().yScale))}this.on("change:data",this.setScales),this.on("change:options",a.bind(this)),a.call(this)},x:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))}),y:e(function(a,b,c){return a._yScale()(a.yValue.call(this,b,c))}),x0:e(function(a){return a._xScale()(0)}),y0:e(function(a){return a._yScale()(0)}),xValue:e(function(a,b){return b.x}),yValue:e(function(a,b){return b.y}),keyValue:e(function(b,c,d){return a.isUndefined(c.key)?b.xValue.call(this,c,d):c.key}),setScales:function(){var a=this.xScale(),b=this.yScale();a||(a=this.setXScaleDomain(this.defaultXScale(),this.data()||[],this)),b||(b=this.setYScaleDomain(this.defaultYScale(),this.data()||[],this)),a=this.setXScaleRange(a,this.data()||[],this),b=this.setYScaleRange(b,this.data()||[],this),this._xScale(a)._yScale(b)},setXScaleDomain:function(a){return a.domain([this.xMin(),this.xMax()])},setYScaleDomain:function(a){return a.domain([this.yMin(),this.yMax()])},setXScaleRange:function(a,b,c){return a.range([0,c.width()])},setYScaleRange:function(a,b,c){return a.range([c.height(),0])},defaultXScale:function(){return d3.scale.linear()},defaultYScale:function(){return d3.scale.linear()},_xScale:c("_xScale",{type:"Function"}),_yScale:c("_yScale",{type:"Function"}),xScale:c("xScale",{type:"Function",setFromOptions:!1}),yScale:c("yScale",{type:"Function",setFromOptions:!1}),xMin:c("xMin",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.xValue)[0];return b>f?f:b}return b},1/0,this);return d(b,0>c?c:0)}}),xMax:c("xMax",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.xValue)[1];return f>b?f:b}return b},-1/0,this);return d(b,c)}}),yMin:c("yMin",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.yValue)[0];return b>f?f:b}return b},1/0,this);return d(b,0>c?c:0)}}),yMax:c("yMax",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.yValue)[1];return f>b?f:b}return b},-1/0,this);return d(b,c)}})},f.Values={isValues:!0,transform:function(b){return a.each(b,function(b){b.values=a.map(b.values,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},this),b},x:e(function(a,b,c){return a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),defaultXScale:function(){return d3.scale.ordinal()},setXScaleDomain:function(b,c){var d=a.map(c,function(b,c){return a.map(this.seriesValues(b,c),this.xValue)},this),e=a.uniq(a.flatten(d));return b.domain(e)},setXScaleRange:function(a,b,c){return a.rangeBands([0,c.width()],this.itemPadding(),this.itemPadding()/2)},adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.layeredX.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2;return e+d*a.seriesIndex.call(this,b,c)}),adjacentWidth:e(function(a,b,c){return a.layeredWidth.call(this,b,c)/a.seriesCount.call(this)}),layeredX:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)}),layeredWidth:e(function(a){return a._xScale().rangeBand()}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)}),itemPadding:c("itemPadding",{defaultValue:.1}),displayAdjacent:c("displayAdjacent",{defaultValue:!1})}}(d3,_,d3.chart.helpers),function(d3,a,b,c){var d=b.property;d3.chart("Base",{initialize:function(){b.bindAllDi(this)},data:d("data",{set:function(){this.trigger("change:data","BUG")}}),style:d("style",{get:function(a){return b.style(a)||null}}),options:d("options",{defaultValue:{},set:function(a){this.setFromOptions(a)}}),width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},redrawFor:function(){var b=a.toArray(arguments),c=a.map(b,function(a){return"change:"+a});a.each(c,function(b){this.on(b,function(){console.log("REDRAW",arguments),a.isFunction(this.redraw)?this.redraw():this.container&&a.isFunction(this.container.redraw)&&this.container.redraw()})},this)},transform:function(a){return a=a||[],this.data(a),a},setFromOptions:function(b){a.each(b,function(a,b){this[b]&&this[b].isProperty&&this[b].setFromOptions&&this[b](a,{silent:!0})},this)}}),d3.chart("Base").extend("Chart",b.mixin(c.Series,{initialize:function(a){this.options(a||{}),this.redrawFor("options")}})),d3.chart("Base").extend("Container",{initialize:function(a){this.chartsById={},this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart",!0),this.on("change:dimensions",function(){this.redraw()}),this.options(a||{}),this.redrawFor("options")},draw:function(a){this.base.attr("width",this.width()).attr("height",this.height()),this._preDraw(a),this.layout(),d3.chart().prototype.draw.call(this,a)},redraw:function(){this.rawData()&&this.draw(this.rawData())},chartLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.chart}),this.base.append("g").attr("class","chart-layer").attr("data-zIndex",c.zIndex)},componentLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.component}),this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",c.zIndex)},attachChart:function(a,b){b.id=a,b.base.attr("data-id",a),b.container=this,this.attach(a,b),this.chartsById[a]=b},detachChart:function(a){var b=this.chartsById[a];b&&(b.base.remove(),delete this._attached[a],delete this.chartsById[a])},attachComponent:function(a,b){b.id=a,b.base.attr("data-id",a),b.container=this,this.attach(a,b),this.componentsById[a]=b,b.on("change:position",function(){this.trigger("change:dimensions")})},detachComponent:function(a){var b=this.componentsById[a];b&&(b.base.remove(),b.off("change:position"),delete this._attached[a],delete this.componentsById[a])},layout:function(){var a=this._extractLayout();this._updateChartMargins(a),this._positionLayers(a)},rawData:d("rawData"),chartMargins:d("chartMargins",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}}),chartWidth:function(){var a=this._chartMargins();return this.width()-a.left-a.right},chartHeight:function(){var a=this._chartMargins();return this.height()-a.top-a.bottom},width:d("width",{defaultValue:function(){return b.dimensions(this.base).width},set:function(){this.trigger("change:dimensions")}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height},set:function(){this.trigger("change:dimensions")}}),_preDraw:function(b){this._positionChartLayers(),a.each(this.componentsById,function(a,c){a.skipLayout||a.draw(this.demux?this.demux(c,b):b)},this)},_positionLayers:function(a){this._positionChartLayers(),this._positionComponents(a),this._positionByZIndex()},_positionChartLayers:function(){var a=this._chartMargins();this.base.selectAll(".chart-layer").attr("transform",b.transform.translate(a.left,a.top)).attr("width",this.chartWidth()).attr("height",this.chartHeight())},_positionComponents:function(b){function c(b,c,d,e){b&&a.isFunction(b.setLayout)&&b.setLayout(c,d,e)}var d=this._chartMargins(),e=this.width(),f=this.height(),g=this.chartWidth(),h=this.chartHeight();a.reduce(b.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:g}),e},d.top),a.reduce(b.right,function(a,b,e,f){var g=f[e-1]||{offset:0},i=a+g.offset;return c(b.component,i,d.top,{height:h}),i},e-d.right),a.reduce(b.bottom,function(a,b,e,f){var h=f[e-1]||{offset:0},i=a+h.offset;return c(b.component,d.left,i,{width:g}),i},f-d.bottom),a.reduce(b.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:h}),e},d.left)},_positionByZIndex:function(){var b=this.base.selectAll(".chart-layer, .chart-component-layer")[0];b=a.sortBy(b,function(a){return+d3.select(a).attr("data-zIndex")||0}),a.each(b,function(a){a.parentNode.appendChild(a)},this)},_updateChartMargins:function(b){var c=a.extend({},this.chartMargins());return a.each(b,function(b,d){a.each(b,function(a){c[d]+=a.offset||0})}),this._chartMargins(c),c},_extractLayout:function(){var b={top:[],right:[],bottom:[],left:[]};return a.each(this.componentsById,function(c){if(!c.skipLayout){var d=c.layoutPosition();if(a.contains(["top","right","bottom","left"],d)){var e;e="top"==d||"bottom"==d?c.layoutHeight():c.layoutWidth(),b[d].push({offset:e,component:c})}}}),b},_chartMargins:d("_chartMargins",{defaultValue:function(){return a.extend({},this.chartMargins())}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.mixin,e=b.property,f=b.di;d3.chart("Chart").extend("Labels",d(c.XY,{initialize:function(){this.seriesLayer("Labels",this.base.append("g").classed("chart-labels",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("text").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("text").classed("chart-label",!0).attr("alignment-baseline",a.labelAlignment).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.labelX).attr("y",a.y0).attr("text-anchor",a.labelAnchor).text(0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.labelY).text(a.labelValue)}}})},transform:function(a){return a},display:e("display",{defaultValue:!0}),format:e("format",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),position:e("position",{defaultValue:"top"}),offset:e("offset",{defaultValue:14}),labelX:f(function(a,b,c){return a.x.call(this,b,c)+a.calculatedOffset.call(this,b,c).x}),labelY:f(function(a,b,c){return a.y.call(this,b,c)+a.calculatedOffset.call(this,b,c).y}),labelValue:f(function(a,b,c){if(a.display()){var d=a.yValue.call(this,b,c);return a.format()?a.format()(d):d}}),calculatedOffset:f(function(a,b,c){var d=a.offset(),e={top:{x:0,y:-d},right:{x:d,y:0},bottom:{x:0,y:d},left:{x:-d,y:0}};return e[a.calculatedPosition.call(this,b,c)]}),labelAnchor:f(function(a,b,c){return"right"==a.calculatedPosition.call(this,b,c)?"start":"left"==a.calculatedPosition.call(this,b,c)?"end":"middle"}),labelAlignment:f(function(a,b,c){var d={top:"after-edge",right:"middle",bottom:"before-edge",left:"middle"};return d[a.calculatedPosition.call(this,b,c)]}),calculatedPosition:f(function(a,b,c){var d=a.position(),e=d.split("|");if(e.length>1){var f="top"==e[0]||"bottom"==e[0]?a.yValue.call(this,b,c):a.xValue.call(this,b,c);return f>=0?e[0]:e[1]}return e[0]}),itemStyle:f(function(c,d,e){var f=c.dataSeries.call(this,d,e)||{},g=a.defaults({},d.labels&&d.labels.style,f.labels&&f.labels.style,c.options().style);return b.style(g)||null})})),d3.chart("Labels").extend("LabelsValues",d(c.Values,{labelX:f(function(a,b,c){return a.x.call(this,b,c)+a.calculatedOffset.call(this,b,c).x})})),d3.chart("Chart").extend("ChartWithLabels",{attachLabels:function(){var a=this.labelOptions(),c=b.resolveChart(a.type,"Labels",this.isValues?"Values":"XY");this.labels=new c(this.base,a),this.labels.xScale=e("xScale",{get:function(){return this._xScale()},context:this}),this.labels.yScale=e("yScale",{get:function(){return this._yScale()},context:this}),this.attach("Labels",this.labels)},options:e("options",{set:function(a){this.setFromOptions(a),this.labels&&this.labels.options(this.labelOptions(),{silent:!0})}}),labelOptions:e("labelOptions",{get:function(){var b=this.options().labels;return b=b?b===!0?{display:!0}:a.clone(b):{display:!1},b=a.defaults(b,{displayAdjacent:this.displayAdjacent?this.displayAdjacent():!1})}})}),d3.chart("ChartWithLabels").extend("Bars",d(c.XY,c.Values,{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("chart-bars",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").classed("chart-bar",!0).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.barX).attr("y",a.y0).attr("width",a.itemWidth).attr("height",0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.barY).attr("height",a.barHeight)}}}),this.attachLabels()},barHeight:f(function(a,b,c){var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c));return d>0?d-a.barOffset():0}),barX:f(function(a,b,c){return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:f(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e+a.barOffset()}),displayAdjacent:e("displayAdjacent",{defaultValue:!0}),barOffset:function(){this.__axis||(this.__axis=d3.select(this.base[0][0].parentNode).select('[data-id="axis.x"] .domain'));var a=this.__axis[0][0]&&parseInt(this.__axis.style("stroke-width"))||0;return a/2}})),d3.chart("ChartWithLabels").extend("Line",d(c.XY,{initialize:function(){this.seriesLayer("Lines",this.base.append("g").classed("chart-lines",!0),{dataBind:function(){var b=this.chart();return b.lines(a.map(b.data(),function(a){return b.createLine(a)})),this.selectAll("path").data(function(a,c){return[b.data()[c]]},b.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("chart-line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.itemStyle)}}}),this.attachLabels()},lines:e("lines",{defaultValue:[]}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.options().interpolate;return c&&b.interpolate(c),b},insertSwatch:function(){return this.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","chart-line")}})),d3.chart("Line").extend("LineValues",c.Values)}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.mixin,e=b.property,f=b.di;d3.chart("Base").extend("Component",{initialize:function(a){this.options(a||{}),this.redrawFor("options")},position:e("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),width:e("width",{defaultValue:function(){return b.dimensions(this.base).width}}),height:e("height",{defaultValue:function(){return b.dimensions(this.base).height}}),margins:e("margins",{get:function(b){var c=a.defaults({},b,{top:0,right:0,bottom:0,left:0}),d=this.width(),e=this.height();return{top:c.top*e,right:c.right*d,bottom:c.bottom*e,left:c.left*d}}}),skipLayout:!1,layoutWidth:function(){var a=this.margins();return this.width()+a.left+a.right},layoutHeight:function(){var a=this.margins();return this.height()+a.top+a.bottom},layoutPosition:function(){return this.position()},setLayout:function(a,c,d){var e=this.margins();this.base.attr("transform",b.transform.translate(a+e.left,c+e.top)),this.height(d&&d.height),this.width(d&&d.width)}}),d3.chart("Component").extend("Title",{initialize:function(){this.redrawFor("title","rotation"),this.layer("Title",this.base.append("g").classed("chart-title",!0),{dataBind:function(){return this.selectAll("text").data([0])},insert:function(){return this.append("text")},events:{merge:function(){var a=this.chart();this.attr("transform",a.transformation()).attr("style",a.style()).attr("alignment-baseline","middle").attr("text-anchor","middle").attr("class",a.options()["class"]).text(a.text())}}})},text:e("text",{get:function(){return this.options().text}}),rotation:e("rotation",{defaultValue:function(){var a={right:90,left:-90};return a[this.position()]||0}}),transformation:function(){var a=b.transform.translate(this.width()/2,this.height()/2),c=b.transform.rotate(this.rotation());return a+c}}),d3.chart("Component").extend("Axis",d(c.Series,c.XY,{initialize:function(){function a(){if(this.options().scale){var a=this.isXAxis()?"xScale":"yScale";this[a](b.createScaleFromOptions(this.options().scale))}}this.on("change:options",a.bind(this)),a.call(this),this.axis=d3.svg.axis(),this.axisLayer=this.base.append("g").attr("class","chart-axis"),this.options().display?this.layer("Axis",this.axisLayer,{dataBind:function(){return this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{merge:function(){var a=this.chart();a._setupAxis(),this.attr("transform",a.translation()).call(a.axis)}}}):this.skipLayout=!0},position:e("position",{defaultValue:"bottom",validate:function(b){return a.contains(["top","right","bottom","left","x0","y0"],b)}}),translation:e("translation",{defaultValue:function(){var a={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(),y:0},y0:{x:0,y:this.y0()}};return a[this.position()]},get:function(a){return b.translate(a)}}),orient:e("orient",{defaultValue:function(){var a=this.position();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),orientation:e("orientation",{validate:function(b){return a.contains(["horizontal","vertical"],b)},defaultValue:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.position()]}}),ticks:e("ticks",{type:"Function"}),tickValues:e("tickValues",{type:"Function"}),tickSize:e("tickSize",{type:"Function"}),innerTickSize:e("innerTickSize",{type:"Function"}),outerTickSize:e("outerTickSize",{type:"Function"}),tickPadding:e("tickPadding",{type:"Function"}),tickFormat:e("tickFormat",{type:"Function"}),layoutHeight:function(){return this._labelOverhang().height},layoutWidth:function(){return this._labelOverhang().width},layoutPosition:function(){return"x0"==this.position()?"bottom":"y0"==this.position()?"right":this.position()},setLayout:function(){},isXAxis:function(){return"horizontal"==this.orientation()},isYAxis:function(){return"vertical"==this.orientation()},_setupAxis:function(){var b=this.isXAxis()?this._xScale():this._yScale();this.axis.scale(b);var c=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"],d=["tickValues"];a.each(c,function(b){var c=this[b]&&this[b]();a.isUndefined(c)||(a.isArray(c)&&!a.contains(d,b)?this.axis[b].apply(this.axis,c):this.axis[b](c))},this)},_labelOverhang:function(){var b={width:[0],height:[0]},c=this.orientation();return this.axisLayer.selectAll(".tick").each(function(){"horizontal"==c?b.height.push(this.getBBox().height):b.width.push(this.getBBox().width)}),{width:a.max(b.width),height:a.max(b.height)}}})),d3.chart("Axis").extend("AxisValues",c.Values),d3.chart("Component").extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("chart-legend",!0),this.options().display?this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var a=this.chart(),c=this.append("g").attr("class",a.dataGroupClass);return c.append("g").attr("width",20).attr("height",20).attr("class","chart-legend-swatch"),c.append("text").attr("class","chart-legend-label chart-label").attr("transform",b.translate(25,0)),c},events:{merge:function(){var a=this.chart();this.select("g").each(a.createSwatch),this.select("text").text(a.dataValue).attr("alignment-baseline","before-edge");var c={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical"};this.call(b.stack.bind(this,{direction:c[a.position()],origin:"top",padding:5}))}}}):this.skipLayout=!0},isLegend:!0,transform:function(b){var c=d3.chart("Configurable").prototype.extractData,d=a.reduce(this.options().charts,function(d,e){var f=a.map(c(e,b),function(a,b){return{chart:e,series:a,seriesIndex:b}});return d.concat(f)},[],this);return d},dataKey:f(function(a,b){return b.chart.id+"."+b.series.name}),dataValue:f(function(a,b){return b.series.name}),dataGroupClass:f(function(){return"chart-legend-group"}),dataSeriesClass:f(function(a,b){return"chart-series chart-index-"+(b.seriesIndex||0)}),dataClass:f(function(a,b,c){var d=[a.dataSeriesClass.call(this,b,c)];return b.chart.options()["class"]&&d.push(b.chart.options()["class"]),b.series["class"]&&d.push(b.series["class"]),d.join(" ")||null}),dataStyle:f(function(c,d){var e=a.defaults({},d.series.style,d.chart.options().style);return b.style(e)||null}),createSwatch:f(function(b,c,d){var e=d3.select(this);e.empty(),e.attr("class",b.dataClass);var f;c&&c.chart&&a.isFunction(c.chart.insertSwatch)?(e.chart=function(){return b},f=c.chart.insertSwatch.call(e)):f=e.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","chart-swatch"),f&&a.isFunction(f.attr)&&f.attr("style",b.dataStyle.call(this,c,d))})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this._positionLegend()},position:e("position",{defaultValue:{x:10,y:10},set:function(b,c){return b=b&&a.isObject(b)?b:{},b=a.defaults(b,c||{},{x:0,y:0}),{override:b,after:function(){this._positionLegend()}}}}),skipLayout:!0,_positionLegend:function(){if(this.legend){var a=this.position();this.legend.attr("transform",b.translate(a.x,a.y))}}})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){var c=b.property;d3.chart("Container").extend("Configurable",{initialize:function(){this.redrawFor("title","charts","axes","legend")},options:c("options",{defaultValue:{},set:function(b){return b?(this.type(b.type||"XY",{silent:!0}),this.axes(b.axes,{silent:!0}),this.charts(b.charts,{silent:!0}),this.components(b.components,{silent:!0}),this.legend(b.legend,{silent:!0}),this.title(b.title,{silent:!0}),{override:a.clone(b)}):void 0}}),type:c("type",{defaultValue:"XY"}),title:c("title",{set:function(c,d){var e=!1;if(!c||a.isEmpty(c))return this.detachComponent("title"),{override:void 0};if(a.isString(c)&&(c={text:c}),c=a.defaults({},c,d3.chart("Configurable").defaults.title),d)a.isEqual(d.options(),c)||(d.options(c),e=!0);else{var f=b.resolveChart(c.type,"Title",this.type());d=new f(this.componentLayer({zIndex:b.zIndex.title}),c),this.attachComponent("title",d),e=!0}return{override:d,changed:e}}}),charts:c("charts",{set:function(c,d){c=c||{},d=d||{};var e=a.difference(a.keys(d),a.keys(c)),f=e.length>0;return a.each(e,function(a){this.detachChart(a),delete d[a]},this),a.each(c,function(c,e){var g=d[e];if(c=a.defaults({},c,d3.chart("Configurable").defaults.charts),g)a.isEqual(g.options(),c)||(g.options(c),f=!0);else{var h=b.resolveChart(c.type,"Chart",this.type());g=new h(this.chartLayer(),c),this.attachChart(e,g),d[e]=g,f=!0}},this),{override:d,changed:f,after:function(){this.bindChartScales()}}},defaultValue:{}}),axes:c("axes",{set:function(c,d){c=c||{},d=d||{};var e=a.uniq(["x","y"].concat(a.keys(c))),f=a.difference(a.keys(d),e),g=f.length>0;return a.each(f,function(a){this.detachComponent("axis."+a),this.detachComponent("axis_title."+a),delete d[a]},this),a.each(e,function(e){var f=d[e],h={x:"bottom",y:"left",secondaryX:"top",secondaryY:"right"},i={position:h[e]};if(i=c[e]===!1?a.defaults({display:!1},i,d3.chart("Configurable").defaults.axes):a.defaults({},c[e],i,d3.chart("Configurable").defaults.axes),"x"!=e&&"y"!=e&&!i.dataKey)throw new Error("d3.chart.csnw.configurable: dataKey(s) are required for axes other than x and y");if(f)a.isEqual(f.options(),i)||(g=!0),f.options(i);else{var j=b.resolveChart(i.type,"Axis",this.type());f=new j(this.chartLayer({zIndex:b.zIndex.axis}),i),this.attachComponent("axis."+e,f),d[e]=f,g=!0}if(i.title){var k="axis_title."+e,l=this.componentsById[k],m=a.isString(i.title)?{text:i.title}:i.title;if(m=a.defaults({},m,{position:i.position,"class":"chart-title-axis"}),l)l.options(m);else{var n=b.resolveChart(m.type,"Title",this.type());l=new n(this.componentLayer({zIndex:b.zIndex.title}),m),this.attachComponent(k,l)}}},this),a.each(["x","y"],function(b){var c=d[b];if(!c.options().dataKey){var e=[];a.each(d,function(c){if(("x"!=b||c.isXAxis())&&("y"!=b||c.isYAxis())){var d=c.options().dataKey;d&&(e=e.concat(a.isArray(d)?d:[d]))}},this),a.isEqual(c.options().filterKeys,e)||(g=!0),c.options().filterKeys=e}},this),{override:d,changed:g,after:function(){this.bindChartScales()}}},defaultValue:{}}),legend:c("legend",{set:function(c,d){c=c===!1?{display:!1}:c||{},c=a.defaults({},c,d3.chart("Configurable").defaults.legend);var e=!1;if(c.dataKey){var f=a.isArray(c.dataKey)?c.dataKey:[c.dataKey];c.charts=a.filter(this.charts(),function(b){return a.contains(f,b.options().dataKey)})}else c.charts=this.charts();if(d&&d.options().type!=c.type&&(this.detachComponent("legend"),d=void 0),d)a.isEqual(d.options(),c)||(e=!0),d.options(c);else{var g=b.resolveChart(c.type,"Legend",this.type()),h="Inset"==c.type||"InsetLegend"==c.type?this.chartLayer({zIndex:b.zIndex.legend}):this.componentLayer({zIndex:b.zIndex.legend});d=new g(h,c),this.attachComponent("legend",d),e=!0}return{override:d,changed:e}}}),components:c("components",{set:function(c,d){c=c||{},d=d||{};var e=a.difference(a.keys(d),a.keys(c)),f=e.length>0;return a.each(e,function(a){this.detachComponent(a),delete d[a]},this),a.each(c,function(c,e){var g=d[e];if(c=a.defaults({},c),g)a.isEqual(g.options(),c)||(g.options(c),charted=!0);else{var h=b.resolveChart(c.type,"Component",this.type()),i=h.layer&&"chart"==h.layer?this.chartLayer():this.componentLayer();g=new h(i,c),this.attachComponent(e,g),d[e]=g,f=!0}},this),{override:d,changed:f,after:function(b){a.each(b,function(b){a.isFunction(b.xScale)&&a.isFunction(b.yScale)&&(b.xScale=this.axes().x._xScale.bind(this.axes().x),b.yScale=this.axes().y._yScale.bind(this.axes().y))},this)}}}}),demux:function(a,b){var c=this.chartsById[a]||this.componentsById[a];return c?this.extractData(c,b):b},extractData:function(b,c){var d=b.options().dataKey,e=b.options().filterKeys;if(b&&b.isLegend)return c;if(d||e){var f=a.isArray(d)?d:d?[d]:[];e=a.isArray(e)?e:e?[e]:[];var g=a.reduce(c,function(b,c,d){var g=a.contains(e,d),h=a.contains(f,d),i=!f.length;return!h&&!i||g?b:b.concat(c)},[]);return g}return c},bindChartScales:function(){a.each(this.charts(),function(a){a.xScale=this.getScale(a.options().dataKey,"x"),a.yScale=this.getScale(a.options().dataKey,"y")},this)},getScale:function(b,c){var d=a.find(this.axes(),function(d){if("x"==c&&!d.isXAxis()||"y"==c&&!d.isYAxis())return!1;var e=d.options().dataKey;return a.isArray(e)?a.contains(e,b):e==b}),e=d||this.axes()[c],f="x"==c?"_xScale":"_yScale";
return e[f].bind(e)}},{defaults:{charts:{type:"Line"},axes:{display:!0},legend:{display:!0,position:"right"},title:{position:"top","class":"chart-title-main"}}})}(d3,_,d3.chart.helpers,d3.chart.extensions);
//# sourceMappingURL=d3.chart.csnw.configurable.min.map