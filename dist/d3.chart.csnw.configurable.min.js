/*! d3.chart.csnw.configurable - v0.0.0
 * https://github.com/CSNW/d3.chart.csnw.configurable
 * License: MIT
 */

!function(d3,a){function b(b,d){function e(c){return a.isUndefined(c[g])?void 0:c[g][b]}function f(a,c){a[g]=a[g]||{},a[g][b]=c}d=d||{};var g=d.propKey||"__properties",h=function(b){var c=e(this);if(!arguments.length)return b=a.isUndefined(c)?h.defaultValue:c,b&&"function"==typeof b&&"function"!=d.type&&(b=b.call(this)),"function"==typeof d.get?d.get.call(this,b):b;var g=c;if(f(this,b),"function"==typeof d.set){var i=d.set.call(this,b,g);i&&i.override&&f(this,i.override),i&&i.after&&i.after.call(this,e(this))}return this};return h._isProperty=!0,h.setFromOptions=c(d.setFromOptions,!0),h.defaultValue=d.defaultValue,h}function c(b,c){return a.isUndefined(b)?c:b}function d(a){var b=a&&a.length&&a[0]&&a[0].length&&a[0][0];return{width:parseFloat(a&&a.attr("width")||b&&b.clientWidth||0),height:parseFloat(a&&a.attr("height")||b&&b.clientHeight||0)}}function e(b){if(b=b||{},a.isFunction(b))return b;var c;return c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&c[b].apply(c,a))}),c}function f(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),n.translate(g,h)})}}function g(b){return b=a.reduce(b,function(a,b,c){return b?a+c+":"+b+";":a},"")}function h(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function i(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._isDi=!0,b.original=a,b}function j(a,b){return function(c,d,e){return a.call(this,b,c,d,e)}}function k(a){for(var b in a)a[b]&&a[b]._isDi&&(a[b]=j(a[b].original,a))}function l(a){var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function m(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var n={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"}};d3.chart().mixin=function(b){var c=this;return b=a.isArray(b)?b:a.toArray(arguments),{extend:function(a,d,e){return d&&b.push(d),d3.chart().extend.call(c,a,m(b),e)}}},d3.chart.helpers={property:b,valueOrDefault:c,dimensions:d,transform:n,translate:n.translate,createScaleFromOptions:e,stack:f,style:g,getValue:h,di:i,bindDi:j,bindAllDi:k,getParentData:l,mixin:m}}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f=d3.chart.extensions={};f.Series={seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"series index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.dataSeries.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),dataSeries:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.dataSeries.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options.style);return console.log(d,d.style,f.style,c.options.style),b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},f.XY={initialize:function(){this.on("change:data",this.setScales),this.options.xScale&&this.xScale(b.createScaleFromOptions(this.options.xScale)),this.options.yScale&&this.yScale(b.createScaleFromOptions(this.options.yScale))},x:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))}),y:e(function(a,b,c){return a._yScale()(a.yValue.call(this,b,c))}),x0:e(function(a){return a._xScale()(0)}),y0:e(function(a){return a._yScale()(0)}),xValue:e(function(a,b){return b.x}),yValue:e(function(a,b){return b.y}),keyValue:e(function(a,b){return b.key}),setScales:function(){var a=this.xScale(),b=this.yScale();a||(a=this.setXScaleDomain(this.defaultXScale(),this.data()||[],this)),b||(b=this.setYScaleDomain(this.defaultYScale(),this.data()||[],this)),a=this.setXScaleRange(a,this.data()||[],this),b=this.setYScaleRange(b,this.data()||[],this),this._xScale(a)._yScale(b)},setXScaleDomain:function(a){return a.domain([this.xMin(),this.xMax()])},setYScaleDomain:function(a){return a.domain([this.yMin(),this.yMax()])},setXScaleRange:function(a,b,c){return a.range([0,c.width()])},setYScaleRange:function(a,b,c){return a.range([c.height(),0])},defaultXScale:function(){return d3.scale.linear()},defaultYScale:function(){return d3.scale.linear()},_xScale:c("_xScale",{type:"function"}),_yScale:c("_yScale",{type:"function"}),xScale:c("xScale",{type:"function",setFromOptions:!1}),yScale:c("yScale",{type:"function",setFromOptions:!1}),xMin:c("xMin",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[0];return a>d?d:a},1/0,this);return d(b,0>c?c:0)}}),xMax:c("xMax",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[1];return d>a?d:a},-1/0,this);return d(b,c)}}),yMin:c("yMin",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[0];return a>d?d:a},1/0,this);return d(b,0>c?c:0)}}),yMax:c("yMax",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[1];return d>a?d:a},-1/0,this);return d(b,c)}})},f.Values={isValues:!0,transform:function(b){return a.each(b,function(b){b.values=a.map(b.values,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},this),b},x:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)}),defaultXScale:function(){return d3.scale.ordinal()},setXScaleDomain:function(b,c){var d=a.map(c,function(b,c){return a.map(this.seriesValues(b,c),this.xValue)},this),e=a.uniq(a.flatten(d));return b.domain(e)},setXScaleRange:function(a,b,c){return a.rangeBands([0,c.width()],this.itemPadding(),this.itemPadding()/2)},adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.x.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2;return e+d*a.seriesIndex.call(this,b,c)}),adjacentWidth:e(function(a,b,c){return a.layeredWidth.call(this,b,c)/a.seriesCount.call(this)}),layeredX:e(function(a,b,c){return a.x.call(this,b,c)}),layeredWidth:e(function(a){return a._xScale().rangeBand()}),itemX:e(function(a,b,c){return a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)}),itemPadding:c("itemPadding",{defaultValue:.1}),displayAdjacent:c("displayAdjacent",{defaultValue:!1})}}(d3,_,d3.chart.helpers),function(d3,a,b,c){var d=b.property;d3.chart("Base",{initialize:function(c){this.options=c||{},a.each(this.options,function(a,b){this[b]&&this[b]._isProperty&&this[b].setFromOptions&&this[b](a)},this),b.bindAllDi(this)},transform:function(a){return this.data(a||[]),a||[]},width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},data:d("data",{set:function(a){this.trigger("change:data",a)}})}),d3.chart("Base").mixin(c.Series).extend("Chart"),d3.chart("Base").extend("Container",{initialize:function(){this.charts=[],this.chartsById={},this.components=[],this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart",!0),this.chartBase(this.base.append("g").classed("chart-base",!0)),this.updateDimensions(),this.on("change:dimensions",function(){this.updateDimensions(),this.redraw()})},updateDimensions:function(){this.base.attr("width",this.width()).attr("height",this.height());var a=this.updateChartMargins();this.chartBase().attr("transform",b.translate(a.left,a.top)).attr("width",this.chartWidth()).attr("height",this.chartHeight())},redraw:function(){this.rawData()&&this.draw(this.rawData())},attachChart:function(a,b){b.id=a,this.attach(a,b),this.charts.push(b),this.chartsById[a]=b},attachComponent:function(a,b){b.id=a,this.attach(a,b),this.components.push(b),this.componentsById[a]=b,b.on("change:dimensions",function(){this.trigger("change:dimensions")})},updateChartMargins:function(){var b=this.chartMargins();return a.each(this.components,function(a){var c=a&&a.chartOffset&&a.chartOffset();c&&(b.top+=c.top||0,b.right+=c.right||0,b.bottom+=c.bottom||0,b.left+=c.left||0)},this),this._chartMargins(b),b},rawData:d("rawData"),chartBase:d("chartBase"),chartMargins:d("chartMargins",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}}),_chartMargins:d("_chartMargins",{defaultValue:function(){return a.extend({},this.chartMargins())}}),chartWidth:function(){var a=this._chartMargins();return this.width()-a.left-a.right},chartHeight:function(){var a=this._chartMargins();return this.height()-a.top-a.bottom},width:d("width",{defaultValue:function(){return b.dimensions(this.base).width},set:function(){this.trigger("change:dimensions")}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height},set:function(){this.trigger("change:dimensions")}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.property,e=b.di;d3.chart("Chart").mixin(c.XY).extend("Labels",{initialize:function(){this.seriesLayer("Labels",this.base.append("g").classed("labels",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("text").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("text").classed("label",!0).attr("alignment-baseline",a.labelAlignment).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.labelX).attr("y",a.y0).attr("text-anchor",a.labelAnchor).text(0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.labelY).text(a.yValue)}}})},labelX:e(function(a,b,c){return a.x.call(this,b,c)+a.calculatedOffset.call(this,b,c).x}),labelY:e(function(a,b,c){return a.y.call(this,b,c)+a.calculatedOffset.call(this,b,c).y}),calculatedOffset:e(function(a,b,c){var d=a.offset(),e={top:{x:0,y:-d},right:{x:d,y:0},bottom:{x:0,y:d},left:{x:-d,y:0}};return e[a.calculatedPosition.call(this,b,c)]}),labelAnchor:e(function(a,b,c){return"right"==a.calculatedPosition.call(this,b,c)?"start":"left"==a.calculatedPosition.call(this,b,c)?"end":"middle"}),labelAlignment:e(function(a,b,c){var d={top:"after-edge",right:"middle",bottom:"before-edge",left:"middle"};return d[a.calculatedPosition.call(this,b,c)]}),calculatedPosition:e(function(a,b,c){var d=a.position(),e=d.split("|");if(e.length>1){var f="top"==e[0]||"bottom"==e[0]?a.yValue.call(this,b,c):a.xValue.call(this,b,c);return f>=0?e[0]:e[1]}return e[0]}),itemStyle:e(function(c,d,e){var f=d.labels||{},g=c.dataSeries.call(this,d,e)||{};g=g.labels||{};var h=a.defaults({},f.style,g.style,c.options.style);return b.style(h)||null}),position:d("position",{defaultValue:"top"}),offset:d("offset",{defaultValue:14})}),d3.chart("Chart").mixin(d3.chart("Labels").prototype,c.Values).extend("LabelValues",{labelX:e(function(a,b,c){return a.itemX.call(this,b,c)+a.calculatedOffset.call(this,b,c).x})}),d3.chart("Chart").extend("ChartWithLabels",{initialize:function(){if(this.showLabels()){var b=a.extend(this.options.labels||{},{displayAdjacent:this.options.displayAdjacent,xScale:this.options.xScale,yScale:this.options.yScale});this.labels=this.base.chart(this.isValues?"LabelValues":"Labels",b),this.attach("Labels",this.labels)}},showLabels:d("showLabels",{defaultValue:!0})}),d3.chart("ChartWithLabels").mixin(c.XY,c.Values).extend("Bars",{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("bar-chart",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").classed("bar",!0).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.barX).attr("y",a.y0).attr("width",a.itemWidth).attr("height",0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.barY).attr("height",a.barHeight)}}})},barHeight:e(function(a,b,c){return Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c))}),barX:e(function(a,b,c){return a.itemX.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e}),displayAdjacent:d("displayAdjacent",{defaultValue:!0})}),d3.chart("ChartWithLabels").mixin(c.XY).extend("Line",{initialize:function(){this.seriesLayer("Line",this.base.append("g").classed("line-chart",!0),{dataBind:function(){var b=this.chart();return b.lines(a.map(b.data(),function(a){return b.createLine(a)})),this.selectAll("path").data(function(a,c){return[b.data()[c]]},b.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.lineStyle)}}})},lines:d("lines",{defaultValue:[]}),lineStyle:e(function(a,c,d){return b.style({stroke:a.lineStroke.call(this,c,d),"stroke-dasharray":a.lineStrokeDashArray.call(this,c,d)})}),lineStroke:e(function(a,c){return b.getValue(["stroke","color"],c,a.options)}),lineStrokeDashArray:e(function(a,c){return b.getValue(["stroke-dasharray"],c,a.options)}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.options.interpolate;return c&&b.interpolate(c),b}}),d3.chart("ChartWithLabels").mixin(d3.chart("Line").prototype,c.Values).extend("LineValues")}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.property;d3.chart("Base").extend("Component",{chartOffset:d("chartOffset",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}})}),d3.chart("Component").mixin(c.Series,c.XY).extend("Axis",{initialize:function(){this.axis=d3.svg.axis(),this.layer("Axis",this.base.append("g").classed("axis",!0),{dataBind:function(){return this.selectAll("g").data([0])},insert:function(){var a=this.chart(),b=(a.axisPosition(),a.axisOrientation()),c="horizontal"==b?a._xScale():a._yScale();return a.axis.scale(c).orient(a.axisOrient()),this.append("g")},events:{merge:function(){var a=this.chart();this.attr("transform",a.axisTranlation.call(a)).call(a.axis)}}})},axisTranlation:function(a,c){var d={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(a,c),y:0},y0:{x:0,y:this.y0(a,c)}};return b.translate(d[this.axisPosition()])},axisPosition:d("axisPosition",{defaultValue:"bottom",set:function(){var a=this.chartOffset(),b=this.axisOffset(),c=this.axisOrient();a[c]||(a[c]=b,this.chartOffset(a))}}),axisOffset:d("axisOffset",{defaultValue:function(){var a=this.axisOrientation();return"horizontal"==a?30:60}}),axisOrient:d("axisOrient",{defaultValue:function(){var a=this.axisPosition();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),axisOrientation:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.axisPosition()]}}),d3.chart("Component").mixin(d3.chart("Axis").prototype,c.Values).extend("AxisValues"),d3.chart("Component").mixin().extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("legend",!0),this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var a=(this.chart(),this.append("g").attr("class",function(a,b){return"legend-group series index-"+b}));return a.append("g").attr("width",20).attr("height",20).attr("class","legend-swatch"),a.append("text").attr("class","legend-label").attr("transform",b.translate(25,0)),a},events:{merge:function(){var a=this.chart();this.select("g").each(a.createSwatches()),this.select("text").text(a.dataValue.bind(a)).attr("alignment-baseline","before-edge"),this.call(b.stack.bind(this,{origin:"top",padding:5}))}}})},dataKey:function(a){return a.key},dataValue:function(a){return a.name},dataSwatchProperties:function(b){return a.defaults({},b,{type:"swatch",color:"blue","class":""})},createSwatches:function(){var a=this;return function(b,c){a.createSwatch(d3.select(this),b,c)}},createSwatch:function(a,b,c){var d=this.dataSwatchProperties(b,c);if(a.empty(),a.classed(d["class"],!0),"Line"==d.type||"LineValues"==d.type){a.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","line")}else a.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","bar")},legendPosition:d("legendPosition",{defaultValue:"right",set:function(a){var b={top:0,right:0,bottom:0,left:0};b[a]=100,this.chartOffset(b)}})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this.positionLegend()},positionLegend:function(){if(this.legend){var a=this.legendPosition();this.legend.attr("transform",b.translate(a.x,a.y))}},legendPosition:d("legendPosition",{defaultValue:{x:10,y:10},set:function(b,c){return b=b&&a.isObject(b)?b:{},b=a.defaults(b,c||{},{x:0,y:0}),{override:b,after:function(){this.positionLegend()}}}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){b.property;d3.chart("Container").extend("Configurable",{initialize:function(){if(a.each(this.options.charts,function(b,c){if(b=a.defaults(b||{},d3.chart("Configurable").defaultChartOptions),d3.chart(b.type)){var d=this.chartBase().chart(b.type,b),e="chart_"+c;this.attachChart(e,d)}},this),a.each(this.options.axes,function(b,c){if(b=a.defaults(b||{},d3.chart("Configurable").defaultAxisOptions),d3.chart(b.type)){var d=this.chartBase().chart(b.type,b),e="axis_"+c;this.attachComponent(e,d)}},this),this.options.legend){var b=a.defaults(this.options.legend,d3.chart("Configurable").defaultLegendOptions);if(!d3.chart(b.type))return;var c="InsetLegend"==b.type?this.chartBase():this.base,d=c.chart(b.type,b);this.attachComponent("legend",d)}},demux:function(a,b){var c=this.chartsById[a]||this.componentsById[a];return"legend"==a?this.extractLegendData(c,b):this.extractData(c,a,b)},extractData:function(a,b,c){var d=a&&a.options&&a.options.dataKey||b;return c[d]||[]},extractLegendData:function(b,c){function d(b){if(b){var d=this.extractData(b,b.id,c);return a.map(d,function(c){return a.defaults(c,b.options)},this)}return[]}if(b&&b.options&&b.options.dataKey)return this.extractData(b,"legend",c);var e,f=b&&b.options&&b.options.data||{};return e=f.charts?a.reduce(f.charts,function(a,b){return a.concat(d.call(this,this.charts&&this.charts[b]))},[],this):a.reduce(this.charts,function(a,b){return a.concat(d.call(this,b))},[],this)}},{defaultChartOptions:{},defaultAxisOptions:{type:"Axis"},defaultLegendOptions:{type:"Legend",legendPosition:"right"}})}(d3,_,d3.chart.helpers,d3.chart.extensions);
//# sourceMappingURL=d3.chart.csnw.configurable.min.map