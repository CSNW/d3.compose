/*! d3.chart.csnw.configurable - v0.5.0
 * https://github.com/CSNW/d3.chart.csnw.configurable
 * License: MIT
 */

!function(d3,a){function b(b,d){function e(c){return a.isUndefined(c[g])?void 0:c[g][b]}function f(a,c){a[g]=a[g]||{},a[g][b]=c}d=d||{};var g=d.propKey||"__properties",h=function(c){var g=e(this),i=a.isUndefined(h.context)?this:h.context;if(!arguments.length)return c=a.isUndefined(g)?h.defaultValue:g,c&&"function"==typeof c&&"function"!=d.type&&(c=c.call(this)),"function"==typeof d.get?d.get.call(i,c):c;var j=g;if("function"==typeof d.validate&&!d.validate(c)){if(a.isFunction(this.trigger)&&this.trigger("invalid:"+b,c),!a.isUndefined(j))return f(this,j);if(a.isUndefined(h.defaultValue))return;c=h.defaultValue}if(f(this,c),"function"==typeof d.set){var k=d.set.call(i,c,j);k&&k.override&&f(this,k.override),k&&k.after&&k.after.call(i,e(this))}return!a.isEqual(e(this),j)&&a.isFunction(this.trigger)&&this.trigger("change:"+b,e(this)),this};return h._isProperty=!0,h.setFromOptions=c(d.setFromOptions,!0),h.defaultValue=d.defaultValue,h.context=d.context,h}function c(b,c){return a.isUndefined(b)?c:b}function d(b){{var c=b&&b.length&&b[0]&&b[0].length&&b[0][0],d=c&&"function"==typeof c.getBBox&&c.getBBox()||{},e=c?{width:c.clientWidth,height:c.clientHeight}:{width:0,height:0},f=b?{width:b.attr("width"),height:b.attr("height")}:{width:0,height:0};c?"svg"==c.nodeName:!1}return{width:a.max([e.width,f.width||d.width])||0,height:a.max([e.height,f.height||d.height])||0}}function e(b){if(b=b||{},a.isFunction(b))return b;var c;return c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&c[b].apply(c,a))}),c}function f(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),o.translate(g,h)})}}function g(b){return b?(b=a.map(b,function(a,b){return b+": "+a}),b=b.join("; "),b?b+";":""):""}function h(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function i(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._isDi=!0,b.original=a,b}function j(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function k(a){for(var b in a)a[b]&&a[b]._isDi&&(a[b]=j(a[b],a))}function l(a){var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function m(a,b,c){a=a||"",b=b||"",c=c||"";var d=d3.chart(a+c)||d3.chart(a)||d3.chart(b+c)||d3.chart(b+a)||d3.chart(a+b);if(!d)throw new Error("d3.chart.csnw.configurable: Unable to resolve chart for type "+a+" and component "+b+" and container "+c);return d}function n(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return delete c.constructor,c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var o={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"},rotate:function(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}};d3.chart.helpers=a.extend({},d3.chart.helpers,{property:b,valueOrDefault:c,dimensions:d,transform:o,translate:o.translate,createScaleFromOptions:e,stack:f,style:g,getValue:h,di:i,bindDi:j,bindAllDi:k,getParentData:l,resolveChart:m,mixin:n})}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f=d3.chart.extensions=d3.chart.extensions||{};f.Series={seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"chart-series chart-index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.dataSeries.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),dataSeries:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.dataSeries.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options.style);return b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},f.XY={initialize:function(){this.on("change:data",this.setScales),this.options.xScale&&this.xScale(b.createScaleFromOptions(this.options.xScale)),this.options.yScale&&this.yScale(b.createScaleFromOptions(this.options.yScale))},x:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))}),y:e(function(a,b,c){return a._yScale()(a.yValue.call(this,b,c))}),x0:e(function(a){return a._xScale()(0)}),y0:e(function(a){return a._yScale()(0)}),xValue:e(function(a,b){return b.x}),yValue:e(function(a,b){return b.y}),keyValue:e(function(a,b){return b.key}),setScales:function(){var a=this.xScale(),b=this.yScale();a||(a=this.setXScaleDomain(this.defaultXScale(),this.data()||[],this)),b||(b=this.setYScaleDomain(this.defaultYScale(),this.data()||[],this)),a=this.setXScaleRange(a,this.data()||[],this),b=this.setYScaleRange(b,this.data()||[],this),this._xScale(a)._yScale(b)},setXScaleDomain:function(a){return a.domain([this.xMin(),this.xMax()])},setYScaleDomain:function(a){return a.domain([this.yMin(),this.yMax()])},setXScaleRange:function(a,b,c){return a.range([0,c.width()])},setYScaleRange:function(a,b,c){return a.range([c.height(),0])},defaultXScale:function(){return d3.scale.linear()},defaultYScale:function(){return d3.scale.linear()},_xScale:c("_xScale",{type:"function"}),_yScale:c("_yScale",{type:"function"}),xScale:c("xScale",{type:"function",setFromOptions:!1}),yScale:c("yScale",{type:"function",setFromOptions:!1}),xMin:c("xMin",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[0];return a>d?d:a},1/0,this);return d(b,0>c?c:0)}}),xMax:c("xMax",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.xValue)[1];return d>a?d:a},-1/0,this);return d(b,c)}}),yMin:c("yMin",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[0];return a>d?d:a},1/0,this);return d(b,0>c?c:0)}}),yMax:c("yMax",{get:function(b){var c=a.reduce(this.data(),function(a,b,c){var d=d3.extent(this.seriesValues(b,c),this.yValue)[1];return d>a?d:a},-1/0,this);return d(b,c)}})},f.Values={isValues:!0,transform:function(b){return a.each(b,function(b){b.values=a.map(b.values,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},this),b},x:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)}),defaultXScale:function(){return d3.scale.ordinal()},setXScaleDomain:function(b,c){var d=a.map(c,function(b,c){return a.map(this.seriesValues(b,c),this.xValue)},this),e=a.uniq(a.flatten(d));return b.domain(e)},setXScaleRange:function(a,b,c){return a.rangeBands([0,c.width()],this.itemPadding(),this.itemPadding()/2)},adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.x.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2;return e+d*a.seriesIndex.call(this,b,c)}),adjacentWidth:e(function(a,b,c){return a.layeredWidth.call(this,b,c)/a.seriesCount.call(this)}),layeredX:e(function(a,b,c){return a.x.call(this,b,c)}),layeredWidth:e(function(a){return a._xScale().rangeBand()}),itemX:e(function(a,b,c){return a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)}),itemPadding:c("itemPadding",{defaultValue:.1}),displayAdjacent:c("displayAdjacent",{defaultValue:!1})}}(d3,_,d3.chart.helpers),function(d3,a,b,c){var d=b.property;d3.chart("Base",{initialize:function(c){this.options=c||{},a.each(this.options,function(a,b){this[b]&&this[b]._isProperty&&this[b].setFromOptions&&this[b](a)},this),b.bindAllDi(this)},data:d("data",{set:function(a){this.trigger("change:data",a)}}),style:d("style",{get:function(a){return b.style(a)||null}}),width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},transform:function(a){return this.data(a||[]),a||[]}}),d3.chart("Base").extend("Chart",c.Series),d3.chart("Base").extend("Container",{initialize:function(){this.charts=[],this.chartsById={},this.components=[],this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart",!0),this.chartBase(this.base.append("g").classed("chart-base",!0)),this.on("change:dimensions",function(){this.redraw()})},draw:function(a){this.base.attr("width",this.width()).attr("height",this.height()),this._preDraw(a),this.updateLayout(),d3.chart().prototype.draw.call(this,a)},redraw:function(){this.rawData()&&this.draw(this.rawData())},attachChart:function(a,b){b.id=a,this.attach(a,b),this.charts.push(b),this.chartsById[a]=b},attachComponent:function(a,b){b.id=a,this.attach(a,b),this.components.push(b),this.componentsById[a]=b,b.on("change:position",function(){this.trigger("change:dimensions")})},componentBase:function(){return this.base.append("g").attr("class","chart-component")},updateLayout:function(){var a=this._extractLayout();this._updateChartMargins(a),this._positionChartBase(),this._positionComponents(a)},rawData:d("rawData"),chartBase:d("chartBase"),chartMargins:d("chartMargins",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}}),chartWidth:function(){var a=this._chartMargins();return this.width()-a.left-a.right},chartHeight:function(){var a=this._chartMargins();return this.height()-a.top-a.bottom},width:d("width",{defaultValue:function(){return b.dimensions(this.base).width},set:function(){this.trigger("change:dimensions")}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height},set:function(){this.trigger("change:dimensions")}}),_preDraw:function(b){this._positionChartBase(),a.each(this.componentsById,function(a,c){a.skipLayout||a.draw(this.demux?this.demux(c,b):b)},this)},_positionChartBase:function(){var a=this._chartMargins();this.chartBase().attr("transform",b.transform.translate(a.left,a.top)).attr("width",this.chartWidth()).attr("height",this.chartHeight())},_positionComponents:function(b){function c(b,c,d,e){b&&a.isFunction(b.setLayout)&&b.setLayout(c,d,e)}var d=this._chartMargins(),e=this.width(),f=this.height(),g=this.chartWidth(),h=this.chartHeight();a.reduce(b.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:g}),e},d.top),a.reduce(b.right,function(a,b,e,f){var g=f[e-1]||{offset:0},i=a+g.offset;return c(b.component,i,d.top,{height:h}),i},e-d.right),a.reduce(b.bottom,function(a,b,e,f){var h=f[e-1]||{offset:0},i=a+h.offset;return c(b.component,d.left,i,{width:g}),i},f-d.bottom),a.reduce(b.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:h}),e},d.left)},_updateChartMargins:function(b){var c=this.chartMargins();return a.each(b,function(b,d){a.each(b,function(a){c[d]+=a.offset||0})}),this._chartMargins(c),c},_extractLayout:function(){var b={top:[],right:[],bottom:[],left:[]};return a.each(this.components,function(c){if(!c.skipLayout){var d=c.layoutPosition();if(a.contains(["top","right","bottom","left"],d)){var e;e="top"==d||"bottom"==d?c.layoutHeight():c.layoutWidth(),b[d].push({offset:e,component:c})}}}),b},_chartMargins:d("_chartMargins",{defaultValue:function(){return a.extend({},this.chartMargins())}})})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.mixin,e=b.property,f=b.di;d3.chart("Chart").extend("Labels",d(c.XY,{initialize:function(){this.seriesLayer("Labels",this.base.append("g").classed("chart-labels",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("text").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("text").classed("chart-label",!0).attr("alignment-baseline",a.labelAlignment).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.labelX).attr("y",a.y0).attr("text-anchor",a.labelAnchor).text(0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.labelY).text(a.labelValue)}}})},position:e("position",{defaultValue:"top"}),offset:e("offset",{defaultValue:14}),format:e("format",{type:"function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),labelX:f(function(a,b,c){return a.x.call(this,b,c)+a.calculatedOffset.call(this,b,c).x}),labelY:f(function(a,b,c){return a.y.call(this,b,c)+a.calculatedOffset.call(this,b,c).y}),labelValue:f(function(a,b,c){var d=a.yValue.call(this,b,c);return a.format()?a.format()(d):d}),calculatedOffset:f(function(a,b,c){var d=a.offset(),e={top:{x:0,y:-d},right:{x:d,y:0},bottom:{x:0,y:d},left:{x:-d,y:0}};return e[a.calculatedPosition.call(this,b,c)]}),labelAnchor:f(function(a,b,c){return"right"==a.calculatedPosition.call(this,b,c)?"start":"left"==a.calculatedPosition.call(this,b,c)?"end":"middle"}),labelAlignment:f(function(a,b,c){var d={top:"after-edge",right:"middle",bottom:"before-edge",left:"middle"};return d[a.calculatedPosition.call(this,b,c)]}),calculatedPosition:f(function(a,b,c){var d=a.position(),e=d.split("|");if(e.length>1){var f="top"==e[0]||"bottom"==e[0]?a.yValue.call(this,b,c):a.xValue.call(this,b,c);return f>=0?e[0]:e[1]}return e[0]}),itemStyle:f(function(c,d,e){var f=d.labels||{},g=c.dataSeries.call(this,d,e)||{};g=g.labels||{};var h=a.defaults({},f.style,g.style,c.options.style);return b.style(h)||null})})),d3.chart("Labels").extend("LabelValues",d(c.Values,{labelX:f(function(a,b,c){return a.itemX.call(this,b,c)+a.calculatedOffset.call(this,b,c).x})})),d3.chart("Chart").extend("ChartWithLabels",{initialize:function(){this.once("transform",function(){if(this.showLabels()){var c=a.defaults({},this.options.labels,{displayAdjacent:this.displayAdjacent()}),d=b.resolveChart(this.isValues?"LabelValues":"Labels","Chart",this.isValues);this.labels=new d(this.base,c),this.labels.xScale=e("xScale",{get:function(){return this._xScale()},context:this}),this.labels.yScale=e("yScale",{get:function(){return this._yScale()},context:this}),this.attach("Labels",this.labels)}})},transform:function(a){return this.trigger("transform"),a},showLabels:e("showLabels",{defaultValue:!0})}),d3.chart("ChartWithLabels").extend("Bars",d(c.XY,c.Values,{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("chart-bars",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").classed("chart-bar",!0).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("x",a.barX).attr("y",a.y0).attr("width",a.itemWidth).attr("height",0)},"merge:transition":function(){var a=this.chart();this.attr("y",a.barY).attr("height",a.barHeight)}}})},barHeight:f(function(a,b,c){return Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c))}),barX:f(function(a,b,c){return a.itemX.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:f(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e}),displayAdjacent:e("displayAdjacent",{defaultValue:!0})})),d3.chart("ChartWithLabels").extend("Line",d(c.XY,{initialize:function(){this.seriesLayer("Lines",this.base.append("g").classed("chart-lines",!0),{dataBind:function(){var b=this.chart();return b.lines(a.map(b.data(),function(a){return b.createLine(a)})),this.selectAll("path").data(function(a,c){return[b.data()[c]]},b.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("chart-line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.lineStyle)}}})},lines:e("lines",{defaultValue:[]}),lineStyle:f(function(a,c,d){return b.style({stroke:a.lineStroke.call(this,c,d),"stroke-dasharray":a.lineStrokeDashArray.call(this,c,d)})}),lineStroke:f(function(a,c){return b.getValue(["stroke","color"],c,a.options)}),lineStrokeDashArray:f(function(a,c){return b.getValue(["stroke-dasharray"],c,a.options)}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.options.interpolate;return c&&b.interpolate(c),b},insertSwatch:function(){return this.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","chart-line")}})),d3.chart("Line").extend("LineValues",c.Values)}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b,c){var d=b.mixin,e=b.property,f=b.di;d3.chart("Base").extend("Component",{position:e("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),width:e("width",{defaultValue:function(){return b.dimensions(this.base).width}}),height:e("height",{defaultValue:function(){return b.dimensions(this.base).height}}),skipLayout:!1,layoutWidth:function(){return this.width()},layoutHeight:function(){return this.height()},layoutPosition:function(){return this.position()},setLayout:function(a,c,d){this.base.attr("transform",b.transform.translate(a,c)),this.height(d&&d.height),this.width(d&&d.width)}}),d3.chart("Component").extend("Title",{initialize:function(){this.layer("Title",this.base.append("g").classed("chart-title",!0),{dataBind:function(){return this.selectAll("text").data([0])},insert:function(){return this.append("text")},events:{merge:function(){var a=this.chart();this.attr("transform",a.transformation()).attr("style",a.style()).attr("alignment-baseline","middle").attr("text-anchor","middle").attr("class",a.options["class"]).text(a.title())}}})},title:e("title"),rotation:e("rotation",{defaultValue:function(){var a={right:90,left:-90};return a[this.position()]||0}}),transformation:function(){var a=b.transform.translate(this.width()/2,this.height()/2),c=b.transform.rotate(this.rotation());return a+c}}),d3.chart("Component").extend("Axis",d(c.Series,c.XY,{initialize:function(){if(this.options.scale){var a=this.isXAxis()?"xScale":"yScale";this[a](b.createScaleFromOptions(this.options.scale))}this.axis=d3.svg.axis(),this.axisLayer=this.base.append("g").attr("class","chart-axis"),this.options.display?this.layer("Axis",this.axisLayer,{dataBind:function(){return this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{merge:function(){var a=this.chart();a._setupAxis(),this.attr("transform",a.translation()).call(a.axis)}}}):this.skipLayout=!0},position:e("position",{defaultValue:"bottom",validate:function(b){return a.contains(["top","right","bottom","left","x0","y0"],b)}}),translation:e("translation",{defaultValue:function(){var a={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(),y:0},y0:{x:0,y:this.y0()}};return b.translate(a[this.position()])}}),orient:e("orient",{defaultValue:function(){var a=this.position();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),orientation:e("orientation",{validate:function(b){return a.contains(["horizontal","vertical"],b)},defaultValue:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.position()]}}),ticks:e("ticks",{type:"function"}),tickValues:e("tickValues",{type:"function"}),tickSize:e("tickSize",{type:"function"}),innerTickSize:e("innerTickSize",{type:"function"}),outerTickSize:e("outerTickSize",{type:"function"}),tickPadding:e("tickPadding",{type:"function"}),tickFormat:e("tickFormat",{type:"function"}),layoutHeight:function(){return this._labelOverhang().height},layoutWidth:function(){return this._labelOverhang().width},layoutPosition:function(){return"x0"==this.position()?"bottom":"y0"==this.position()?"right":this.position()},setLayout:function(){},isXAxis:function(){return"horizontal"==this.orientation()},isYAxis:function(){return"vertical"==this.orientation()},_setupAxis:function(){var b=this.isXAxis()?this._xScale():this._yScale();this.axis.scale(b);var c=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"];a.each(c,function(b){var c=this[b]&&this[b]();a.isUndefined(c)||(a.isArray(c)?this.axis[b].apply(this.axis,c):this.axis[b](c))},this)},_labelOverhang:function(){var b={width:[0],height:[0]},c=this.orientation();return this.axisLayer.selectAll(".tick").each(function(){"horizontal"==c?b.height.push(this.getBBox().height):b.width.push(this.getBBox().width)}),{width:a.max(b.width),height:a.max(b.height)}}})),d3.chart("Axis").extend("AxisValues",c.Values),d3.chart("Component").extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("chart-legend",!0),this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var a=this.chart(),c=this.append("g").attr("class",a.dataGroupClass);return c.append("g").attr("width",20).attr("height",20).attr("class","chart-legend-swatch"),c.append("text").attr("class","chart-legend-label chart-label").attr("transform",b.translate(25,0)),c},events:{merge:function(){var a=this.chart();this.select("g").each(a.createSwatch),this.select("text").text(a.dataValue.bind(a)).attr("alignment-baseline","before-edge"),this.call(b.stack.bind(this,{origin:"top",padding:5}))}}})},isLegend:!0,transform:function(b){var c=d3.chart("Configurable").prototype.extractData,d=a.reduce(this.options.charts,function(d,e){var f=a.map(c(e,b),function(a,b){return{chart:e,series:a,seriesIndex:b}});return d.concat(f)},[],this);return d},dataKey:f(function(a,b){return b.chart.id+"."+b.series.name}),dataValue:f(function(a,b){return b.series.name}),dataGroupClass:f(function(){return"chart-legend-group"}),dataSeriesClass:f(function(a,b){return"chart-series chart-index-"+(b.seriesIndex||0)}),dataClass:f(function(a,b,c){var d=[a.dataSeriesClass.call(this,b,c)];return b.chart.options["class"]&&d.push(b.chart.options["class"]),b.series["class"]&&d.push(b.series["class"]),d.join(" ")||null}),dataStyle:f(function(c,d){var e=a.defaults({},d.series.style,d.chart.options.style);return b.style(e)||null}),createSwatch:f(function(b,c,d){var e=d3.select(this);e.empty(),e.attr("class",b.dataClass);var f;c&&c.chart&&a.isFunction(c.chart.insertSwatch)?(e.chart=function(){return b},f=c.chart.insertSwatch.call(e)):f=e.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","chart-swatch"),f&&a.isFunction(f.attr)&&f.attr("style",b.dataStyle.call(this,c,d))})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this._positionLegend()},position:e("position",{defaultValue:{x:10,y:10},set:function(b,c){return b=b&&a.isObject(b)?b:{},b=a.defaults(b,c||{},{x:0,y:0}),{override:b,after:function(){this._positionLegend()}}}}),skipLayout:!0,_positionLegend:function(){if(this.legend){var a=this.position();this.legend.attr("transform",b.translate(a.x,a.y))}}})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){var c=b.property;d3.chart("Container").extend("Configurable",{initialize:function(){this.type=this.options.type||"XY",this.setupAxes(this.options.axes),this.setupCharts(this.options.charts),this.setupLegend(this.options.legend),this.setupTitle(this.options.title)},setupAxes:function(c){c=c||{},this.axes={};var d=a.uniq(["x","y"].concat(a.keys(this.options.axes)));a.each(d,function(d){positionByKey={x:"bottom",y:"left",secondaryX:"top",secondaryY:"right"};var e,f={display:!0,position:positionByKey[d]};if(e=c[d]===!1?a.defaults({display:!1},f,d3.chart("Configurable").defaultAxisOptions):a.defaults({},c[d],f,d3.chart("Configurable").defaultAxisOptions),"x"!=d&&"y"!=d&&!e.dataKey)throw new Error("d3.chart.csnw.configurable: dataKey(s) are required for axes other than x and y");var g=b.resolveChart(e.type,"Axis",this.type),h=new g(this.chartBase(),e),i="axis_"+d;if(this.attachComponent(i,h),this.axes[d]=h,e.title){var j=a.isString(e.title)?{title:e.title}:e.title;j=a.defaults({},j,{position:e.position,"class":"chart-title-axis"});var k=b.resolveChart(j.type,"Title",this.type),l=new k(this.componentBase(),j);i+="_title",this.attachComponent(i,l)}},this),a.each(["x","y"],function(b){var c=this.axes[b];if(!c.options.dataKey){var d=[];a.each(this.axes,function(c){if(("x"!=b||c.isXAxis())&&("y"!=b||c.isYAxis())){var e=c.options.dataKey;e&&(d=d.concat(a.isArray(e)?e:[e]))}},this),c.options.filterKeys=d}},this)},setupCharts:function(c){c=c||[],a.each(c,function(c,d){c=a.defaults({},c,d3.chart("Configurable").defaultChartOptions);var e,f=b.resolveChart(c.type,"Chart",this.type),g=new f(this.chartBase(),c),h="chart_"+d;c.xScale||(e=this.getMatchingAxisScale(c.dataKey,"x"),e&&(g.xScale=e)),c.yScale||(e=this.getMatchingAxisScale(c.dataKey,"y"),e&&(g.yScale=e)),this.attachChart(h,g)},this)},setupLegend:function(c){if(c=c===!1?{display:!1}:c||{},c=a.defaults({},c,d3.chart("Configurable").defaultLegendOptions),c.dataKey){var d=a.isArray(c.dataKey)?c.dataKey:[c.dataKey];c.charts=a.filter(this.charts,function(b){return a.contains(d,b.options.dataKey)})}else c.charts=this.charts;var e=b.resolveChart(c.type,"Legend",this.type),f="Inset"==c.type||"InsetLegend"==c.type?this.chartBase():this.componentBase(),g=new e(f,c);this.attachComponent("legend",g)},setupTitle:function(c){if(c){a.isString(c)&&(c={title:c}),c=a.defaults({},c,d3.chart("Configurable").defaultTitleOptions);var d=b.resolveChart(c.type,"Title",this.type),e=new d(this.componentBase(),c);this.attachComponent("title",e)}},demux:function(a,b){var c=this.chartsById[a]||this.componentsById[a];return c?this.extractData(c,b):b},extractData:function(b,c){var d=b.options.dataKey,e=b.options.filterKeys;if(b&&b.isLegend)return c;if(d||e){var f=a.isArray(d)?d:d?[d]:[];e=a.isArray(e)?e:e?[e]:[];var g=a.reduce(c,function(b,c,d){var g=a.contains(e,d),h=a.contains(f,d),i=!f.length;return!h&&!i||g?b:b.concat(c)},[]);return g}return c},getMatchingAxisScale:function(b,d){var e=a.find(this.axes,function(c){if("x"==d&&!c.isXAxis()||"y"==d&&!c.isYAxis())return!1;var e=c.options.dataKey;return a.isArray(e)?a.contains(e,b):e==b}),f="x"==d?"_xScale":"_yScale",g=e||this.axes[d];return c(d+"Scale",{get:function(){return g[f]()}})}},{defaultChartOptions:{type:"Line"},defaultAxisOptions:{display:!0},defaultLegendOptions:{position:"right"},defaultTitleOptions:{position:"top","class":"chart-title-main"}})}(d3,_,d3.chart.helpers,d3.chart.extensions);
//# sourceMappingURL=d3.chart.csnw.configurable.min.map