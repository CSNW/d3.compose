/*! d3.chart.multi - v0.9.1
 * https://github.com/CSNW/d3.chart.multi
 * License: MIT
 */

!function(d3,a){function b(b,d){d=d||{};var e=d.prop_key||"__properties",f=function(g){function h(){var e=c(j[b],f.default_value);return a.isFunction(e)&&"Function"!=d.type&&(e=e.call(this)),a.isFunction(d.get)?d.get.call(k,e):e}function i(c){if(a.isFunction(d.validate)&&!d.validate.call(this,c))throw new Error("Invalid value for "+b+": "+JSON.stringify(c));if(f.previous=j[b],j[b]=c,a.isFunction(d.set)){var e=d.set.call(k,c,f.previous);e&&a.has(e,"override")&&(j[b]=e.override),e&&a.isFunction(e.after)&&e.after.call(k,j[b])}var g=!a.isEqual(j[b],f.previous);return g&&a.isFunction(this.trigger)&&(this.trigger("change:"+b,j[b]),this.trigger("change",b,j[b])),this}var j=this[e]=this[e]||{},k=(j[b],c(f.context,this));return arguments.length?i.call(this,g):h.call(this)};return f.is_property=!0,f.set_from_options=c(d.set_from_options,!0),f.default_value=d.default_value,f.context=d.context,f}function c(b,c){return a.isUndefined(b)?c:b}function d(b){var c=b&&b.length&&b[0]&&b[0].length&&b[0][0],d=c?"svg"==c.nodeName:!1,e={width:c&&c.clientWidth,height:c&&c.clientHeight};if(d&&(!c.clientWidth||!c.clientHeight)&&"undefined"!=typeof window&&window.getComputedStyle){var f=window.getComputedStyle(c);e.height=parseFloat(f.height)-parseFloat(f.borderTopWidth)-parseFloat(f.borderBottomWidth),e.width=parseFloat(f.width)-parseFloat(f.borderLeftWidth)-parseFloat(f.borderRightWidth)}if(e.width&&e.height)return e;var g={width:b&&b.attr&&parseFloat(b.attr("width")),height:b&&b.attr&&parseFloat(b.attr("height"))};if(d)return{width:null!=e.width?e.width:g.width||0,height:null!=e.height?e.height:g.height||0};var h={width:0,height:0};try{h=c&&"function"==typeof c.getBBox&&c.getBBox()}catch(i){}return{width:a.max([e.width,g.width||h.width])||0,height:a.max([e.height,g.height||h.height])||0}}function e(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"}function f(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}function g(b){var c=a.first(b);return c&&a.isObject(c)&&a.isArray(c.values)}function h(b,c){var d=function(a){return a&&d3.extent(a,c)[1]};return g(b)?a.reduce(b,function(b,c){if(c&&a.isArray(c.values)){var e=d(c.values);return e>b?e:b}return b},-1/0):d(b)}function i(b,c){var d=function(a){return a&&d3.extent(a,c)[0]};return g(b)?a.reduce(b,function(b,c){if(c&&a.isArray(c.values)){var e=d(c.values);return b>e?e:b}return b},1/0):d(b)}function j(b){if(b=b||{},a.isFunction(b))return b;var c;if(c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&"data"!=b&&"key"!=b&&c[b].apply(c,a))}),!b.domain&&b.data&&b.key){var d=function(a){return a[b.key]};if("ordinal"==b.type){var e,f=function(b){return a.map(b,d)};e=g(b.data)?a.flatten(a.map(b.data,function(b){return b&&a.isArray(b.values)?f(b.values):void 0})):f(b.data),c.domain(a.uniq(e))}else{var j=i(b.data,d);c.domain([0>j?j:0,h(b.data,d)])}}return c}function k(b){return b?(b=a.map(b,function(a,b){return b+": "+a}),b=b.join("; "),b?b+";":""):""}function l(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._is_di=!0,b.original=a,b}function m(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function n(a){for(var b in a)a[b]&&a[b]._is_di&&(a[b]=m(a[b],a))}function o(a){if(a._parent_data)return a._parent_data;var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function p(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return delete c.constructor,c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var q={component:50,axis:51,title:52,chart:100,labels:150,legend:200};d3.chart.helpers=a.extend({},d3.chart.helpers,{z_index:q,property:b,valueOrDefault:c,dimensions:d,translate:e,rotate:f,isSeriesData:g,max:h,min:i,createScaleFromOptions:j,style:k,di:l,bindDi:m,bindAllDi:n,getParentData:o,mixin:p})}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f={seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"chart-series chart-index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.seriesData.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),seriesData:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.seriesData.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options().style);return b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.exit().remove(),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},g={initialize:function(){this.on("before:draw",this.setScales.bind(this))},xKey:c("xKey",{default_value:"x"}),yKey:c("yKey",{default_value:"y"}),xScale:c("xScale",{type:"Function",set:function(a){var c=b.createScaleFromOptions(a);return this.setXScaleRange(c),{override:c}},get:function(a){return a||(a=this.getDefaultXScale(),this.setXScaleRange(a)),a}}),yScale:c("yScale",{type:"Function",set:function(a){var c=b.createScaleFromOptions(a);return this.setYScaleRange(c),{override:c}},get:function(a){return a||(a=this.getDefaultYScale(),this.setYScaleRange(a)),a}}),xMin:c("xMin",{get:function(a){var c=b.min(this.data(),this.xValue);return parseFloat(d(a,0>c?c:0))}}),xMax:c("xMax",{get:function(a){var c=b.max(this.data(),this.xValue);return parseFloat(d(a,c))}}),yMin:c("yMin",{get:function(a){var c=b.min(this.data(),this.yValue);return parseFloat(d(a,0>c?c:0))}}),yMax:c("yMax",{get:function(a){var c=b.max(this.data(),this.yValue);return parseFloat(d(a,c))}}),x:e(function(a,b,c){return parseFloat(a.xScale()(a.xValue.call(this,b,c)))}),y:e(function(a,b,c){return parseFloat(a.yScale()(a.yValue.call(this,b,c)))}),x0:e(function(a){return parseFloat(a.xScale()(0))}),y0:e(function(a){return parseFloat(a.yScale()(0))}),xValue:e(function(a,b){return b[a.xKey()]}),yValue:e(function(a,b){return b[a.yKey()]}),keyValue:e(function(b,c,d){return a.isUndefined(c.key)?b.xValue.call(this,c,d):c.key}),setScales:function(){this.setXScaleRange(this.xScale()),this.setYScaleRange(this.yScale())},setXScaleRange:function(a){a.range([0,this.width()])},setYScaleRange:function(a){a.range([this.height(),0])},getDefaultXScale:function(){return b.createScaleFromOptions({data:this.data(),key:this.xKey()})},getDefaultYScale:function(){return b.createScaleFromOptions({data:this.data(),key:this.yKey()})}},h=a.extend({},g,{transform:function(c){function e(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b}return b.isSeriesData(c)?a.each(c,function(b){b.values=a.map(b.values,e)},this):c=a.map(c,e),c},itemPadding:c("itemPadding",{default_value:.1}),displayAdjacent:c("displayAdjacent",{default_value:!1}),x:e(function(a,b,c){return a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.layeredX.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2,f=a.seriesIndex?a.seriesIndex.call(this,b,c):1;return e+d*f}),adjacentWidth:e(function(a,b,c){var d=a.seriesCount?a.seriesCount.call(this):1;return d>0?a.layeredWidth.call(this,b,c)/d:0}),layeredX:e(function(a,b,c){return a.xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)||0}),layeredWidth:e(function(a){var b=a.xScale().rangeBand();return isFinite(b)?b:0}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)}),setXScaleRange:function(b){a.isFunction(b.rangeBands)?b.rangeBands([0,this.width()],this.itemPadding(),this.itemPadding()/2):g.setXScaleRange.call(this,b)},getDefaultXScale:function(){return b.createScaleFromOptions({type:"ordinal",data:this.data(),key:this.xKey()})}}),i={attachLabels:function(){var a=this.labels();a.parent=this;var b=d3.chart(a.type),c=this.base.append("g").attr("class","chart-labels"),d=this._labels=new b(c,a);d.x=this.x,d.y=this.y,this.on("draw",function(b){d.options(this.labels()),d.draw(a.data||b)}.bind(this))},labels:c("labels",{get:function(b){return a.isBoolean(b)&&(b={display:b}),a.defaults({},b,{display:!1,type:"XYLabels"})}})},j={initialize:function(){this.on("attach",function(){this.container&&(this.container.on("enter:mouse",this.onMouseEnter.bind(this)),this.container.on("move:mouse",this.onMouseMove.bind(this)),this.container.on("leave:mouse",this.onMouseLeave.bind(this)))}.bind(this))},onMouseEnter:function(){},onMouseMove:function(){},onMouseLeave:function(){}},k=a.extend({},j,{initialize:function(){j.initialize.apply(this,arguments),this.on("before:draw",function(){this._points=void 0})},getPoint:e(function(a,b,c,d){return{x:a.x.call(this,b,c,d),y:a.y.call(this,b,c,d),d:b,i:c,j:d}}),getPoints:function(){function c(b,c,d){var e=a.map(b,function(a,b){return this.getPoint.call(d,a,b,c)},this);return e.sort(function(a,b){return a.x-b.x}),e}var d=this.data();return!this._points&&d&&(this._points=b.isSeriesData(d)?a.map(d,function(a,b){return c.call(this,a.values,b,{_parent_data:a})},this):c.call(this,d,0)),this._points},getClosestPoints:function(b){function c(b,c){var e=a.map(b,function(a){return a.distance=d(a,c),a});return a.sortBy(e,"distance")}function d(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}var e=this.getPoints(),f=[];return e.length&&a.isArray(e[0])?a.each(e,function(a){f.push(c(a,b))}):f.push(c(e,b)),f}});d3.chart.mixins=a.extend(d3.chart.mixins||{},{Series:f,XY:g,XYValues:h,XYLabels:i,Hover:j,XYHover:k})}(d3,_,d3.chart.helpers),function(d3,a,b){var c=b.property;d3.chart("Base",{initialize:function(){b.bindAllDi(this)},data:c("data"),options:c("options",{default_value:{},set:function(b){a.each(b,function(a,b){this[b]&&this[b].is_property&&this[b].set_from_options&&this[b](a)},this)}}),style:c("style",{get:function(a){return b.style(a)||null}}),width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},transform:function(a){return a=a||[],this.data(a),a},draw:function(a){this.trigger("before:draw",a),d3.chart().prototype.draw.apply(this,arguments),this.trigger("draw",a)}})}(d3,_,d3.chart.helpers),function(d3,a){d3.chart("Base").extend("Chart",{initialize:function(a){this.options(a||{})}},{z_index:a.z_index.chart})}(d3,d3.chart.helpers),function(d3,a,b){var c=b.property;d3.chart("Base").extend("Container",{initialize:function(a){this.charts_by_id={},this.components_by_id={},this.transform=function(a){return this.rawData(a),a},this.options(a||{}),this.base.classed("chart-container",!0),this.attachHoverListeners()},rawData:c("rawData"),margins:c("margins",{default_value:{top:0,right:0,bottom:0,left:0},set:function(b){return{override:a.defaults({},b,{top:0,right:0,bottom:0,left:0})}}}),chartPosition:c("chartPosition",{default_value:function(){return{top:0,right:0,bottom:0,left:0,width:this._width(),height:this._height()}},set:function(b){return{override:a.defaults({},b,{top:0,right:0,bottom:0,left:0,width:this._width()-b.right-b.left,height:this._height()-b.bottom-b.top})}}}),width:c("width"),height:c("height"),draw:function(a){this.base.attr("width",this.width()||null).attr("height",this.height()||null),this.layout(a),d3.chart().prototype.draw.call(this,a)},redraw:function(){this.rawData()&&this.draw(this.rawData())},chartLayer:function(c){return c=a.defaults({},c,{z_index:b.z_index.chart}),this.base.append("g").attr("class","chart-layer").attr("data-zIndex",c.z_index)},componentLayer:function(c){return c=a.defaults({},c,{z_index:b.z_index.component}),this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",c.z_index)},attachChart:function(a,b){this._attach(a,b),this.charts_by_id[a]=b},detachChart:function(a){var b=this.charts_by_id[a];b&&(this._detach(a,b),delete this.charts_by_id[a])},attachComponent:function(a,b){this._attach(a,b),this.components_by_id[a]=b},detachComponent:function(a){var b=this.components_by_id[a];b&&(this._detach(a,b),delete this.components_by_id[a])},_width:function(){return b.valueOrDefault(this.width(),d3.chart("Base").prototype.width.call(this))},_height:function(){return b.valueOrDefault(this.height(),d3.chart("Base").prototype.height.call(this))},layout:function(b){this._positionChartLayers();var c=this._extractLayout(b),d=a.extend({},this.margins());a.each(c,function(b,c){a.each(b,function(a){d[c]+=a.offset||0})}),this.chartPosition(d),this._positionLayers(c)},attachHoverListeners:function(){function b(a,b){var c=a[0],d=a[1],e=c-b.left,f=d-b.top;return c>b.left+b.width?e=b.left+b.width:c<b.left&&(e=0),d>b.top+b.height?f=b.top+b.height:d<b.top&&(f=0),{container:{x:c,y:d},chart:{x:e,y:f}}}var c,d,e=this.trigger.bind(this),f=this.chartPosition.bind(this),g=a.throttle(function(a){c&&e("move:mouse",a)},50);this.base.on("mouseenter",function(){c=!0,d=f(),e("enter:mouse",b(d3.mouse(this),d))}),this.base.on("mousemove",function(){g(b(d3.mouse(this),d))}),this.base.on("mouseleave",function(){c=!1,e("leave:mouse")})},_attach:function(b,c){c.id=b,c.base.attr("data-id",b),c.container=this,this.attach(b,c),c&&a.isFunction(c.trigger)&&c.trigger("attach")},_detach:function(b,c){c.base.remove(),delete this._attached[b],c&&a.isFunction(c.trigger)&&c.trigger("detach")},_positionLayers:function(a){this._positionChartLayers(),this._positionComponents(a),this._positionByZIndex()},_positionChartLayers:function(){var a=this.chartPosition();this.base.selectAll(".chart-layer").attr("transform",b.translate(a.left,a.top)).attr("width",a.width).attr("height",a.height)},_positionComponents:function(b){function c(b,c,d,e){b&&a.isFunction(b.setLayout)&&b.setLayout(c,d,e)}var d=this.chartPosition(),e=this._width(),f=this._height();a.reduce(b.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:d.width}),e},d.top),a.reduce(b.right,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,h,d.top,{height:d.height}),h},e-d.right),a.reduce(b.bottom,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,d.left,h,{width:d.width}),h},f-d.bottom),a.reduce(b.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:d.height}),e},d.left)},_positionByZIndex:function(){var b=this.base.selectAll(".chart-layer, .chart-component-layer")[0];b=a.sortBy(b,function(a){return parseInt(d3.select(a).attr("data-zIndex"))||0}),a.each(b,function(a){a.parentNode.appendChild(a)},this)},_extractLayout:function(b){var c={top:[],right:[],bottom:[],left:[]};return a.each(this.components_by_id,function(d){if(!d.skip_layout){var e=d.getLayout(b),f=e&&e.position;a.contains(["top","right","bottom","left"],f)&&c[f].push({offset:"top"==f||"bottom"==f?e.height:e.width,component:d})}}),c}})}(d3,_,d3.chart.helpers),function(d3,a,b){var c=b.property;d3.chart("Base").extend("Component",{initialize:function(a){this.options(a||{})},position:c("position",{default_value:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),width:c("width",{default_value:function(){return b.dimensions(this.base).width}}),height:c("height",{default_value:function(){return b.dimensions(this.base).height}}),margins:c("margins",{get:function(b){var c=a.defaults({},b,{top:0,right:0,bottom:0,left:0}),d=this.width(),e=this.height();return{top:c.top*e,right:c.right*d,bottom:c.bottom*e,left:c.left*d}}}),skip_layout:!1,prepareLayout:function(a){this.draw(a)},getLayout:function(a){this.prepareLayout(a);var b=this.margins();return{position:this.position(),width:this.width()+b.left+b.right,height:this.height()+b.top+b.bottom}},setLayout:function(a,c,d){var e=this.margins();this.base.attr("transform",b.translate(a+e.left,c+e.top)),this.height(d&&d.height),this.width(d&&d.width)}})}(d3,_,d3.chart.helpers),function(d3,a,b,c){function d(a,b,c,d){var e=d3.select(b),f=e.select("text"),g=e.select("rect");return{x:a.x.call(b,c,d),y:a.y.call(b,c,d),element:b,selection:e,text:{element:f.node(),selection:f},bg:{element:g.node(),selection:g}}}function e(a,b,c){var d=c.text.element.getBBox(),e=0;try{var f=window.getComputedStyle(c.text.element);e=-(parseInt(f["line-height"])-parseInt(f["font-size"]))/2}catch(g){}var h=c.bg.layout={x:b.offset.x,y:b.offset.y,width:d.width+2*b.padding,height:d.height+2*b.padding};c.width=h.width,c.height=h.height,"end"==b.anchor?h.x-=h.width:"middle"==b.anchor&&(h.x-=h.width/2),"bottom"==b.alignment?h.y-=h.height:"middle"==b.alignment&&(h.y-=h.height/2),c.text.layout={x:h.x+h.width/2-d.width/2,y:h.y+h.height/2-d.height/2+d.height+e}}function f(b,c){function d(a,b){function c(a){return{left:a.x,right:a.x+a.width,top:a.y,bottom:a.y+a.height}}var d=c(a),e=c(b),f=e.left<d.left&&e.right>d.right,g=e.bottom<d.bottom&&e.top>d.top,h=e.left>=d.left&&e.left<d.right||e.right>d.left&&e.right<=d.right||f,i=e.top>=d.top&&e.top<d.bottom||e.bottom>d.top&&e.bottom<=d.bottom||g;return h&&i}function e(b,c){if(b.group&&c.group)a.each(c.group.labels,function(a){b.group.labels.push(a),a.group=b.group}),g(b.group);else if(b.group)f(c,b.group);else if(c.group)f(b,c.group);else{var d={labels:[]};f(b,d),f(c,d)}}function f(a,b){b.labels.push(a),a.group=b,a.originalY=a.y,g(b)}function g(b){var c=a.chain(b.labels).each(function(a){a.y=a.originalY}).sortBy(function(a){return a.y}).reverse().value();a.each(c,function(b,e){for(var f,g=a.first(c,e),h=g.length-1;h>=0;h--)if(d(b,g[h])){f=g[h];break}f&&(b.y=f.y-b.height)})}a.each(c,function(b,f){a.each(c.slice(f+1),function(c){a.each(c,function(c){a.each(b,function(a){d(a,c)&&e(a,c)})})})})}function g(a,c){c.bg.selection.attr("transform",b.translate(c.bg.layout.x,c.bg.layout.y)).attr("width",c.bg.layout.width).attr("height",c.bg.layout.height),c.text.selection.attr("transform",b.translate(c.text.layout.x,c.text.layout.y)),c.selection.attr("transform",b.translate(c.x,c.y)).attr("opacity",0)}var h=b.mixin,i=b.property,j=b.di;d3.chart("Chart").extend("XYLabels",h(c.Series,c.XY,c.XYHover,{initialize:function(){var a=this.options().parent;a&&a.on("attach",function(){this.container=a.container,this.trigger("attach")}.bind(this)),this.seriesLayer("Labels",this.base,{dataBind:function(a){return this.selectAll("g").data(a,this.chart().keyValue)},insert:function(){var a=this.chart(),b=this.append("g").attr("class",a.labelClass).call(a.insertLabels);return b},events:{merge:function(){this.chart().mergeLabels(this)},"merge:transition":function(){var a=this.chart();a.delay&&a.delay()&&this.delay(a.delay()),a.duration&&a.duration()&&this.duration(a.duration()),a.ease&&a.ease()&&this.ease(a.ease()),a.transitionLabels(this)}}})},transform:function(a){return b.isSeriesData(a)||(a=[{key:"labels",name:"Labels",values:a}]),a},format:i("format",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),position:i("position",{default_value:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),offset:i("offset",{default_value:{x:0,y:0},set:function(b){return a.isNumber(b)?(b={top:{x:0,y:-b},right:{x:b,y:0},bottom:{x:0,y:b},left:{x:-b,y:0}}[this.position()],b||(b={x:0,y:0}),{override:b}):void 0}}),padding:i("padding",{default_value:2}),anchor:i("anchor",{default_value:function(){return{top:"middle",right:"start",bottom:"middle",left:"end"}[this.position()]},validate:function(b){return a.contains(["start","middle","end"],b)}}),alignment:i("labelAlignment",{default_value:function(){return{top:"bottom",right:"middle",bottom:"top",left:"middle"}[this.position()]},validate:function(b){return a.contains(["top","middle","bottom"],b)}}),delay:i("delay",{type:"Function"}),duration:i("duration",{type:"Function"}),ease:i("ease",{type:"Function"}),labelText:j(function(a,c,d){var e=b.valueOrDefault(c.label,a.yValue.call(this,c,d)),f=a.format();return f?f(e):e}),labelClass:j(function(a,b){return"chart-label"+(b["class"]?" "+b["class"]:"")}),insertLabels:function(a){a.append("rect").attr("class","chart-label-bg"),a.append("text").attr("class","chart-label-text")},mergeLabels:function(b){var c=this;b.selectAll("text").text(this.labelText);var h=[],i={offset:c.offset(),padding:c.padding(),anchor:c.anchor(),alignment:c.alignment()};b.each(function(a,b,f){h[f]||(h[f]=[]);var g=d(c,this,a,b,f);h[f].push(g),e(c,i,g)}),f(c,h),a.each(h,function(b){a.each(b,function(a){g(c,a)})})},transitionLabels:function(a){a.attr("opacity",1)},onMouseEnter:function(b){var c=this.getClosestPoints(b.chart);this.removeHighlight(),a.each(c,function(a){if(a&&a.length){var b=a[0];b.distance<50&&this.highlightLabel(b)}},this)},onMouseMove:function(b){var c=this.getClosestPoints(b.chart);this.removeHighlight(),a.each(c,function(a){if(a&&a.length){var b=a[0];b.distance<50&&this.highlightLabel(b)}},this)},onMouseLeave:function(){this.removeHighlight()},highlightLabel:function(a){var b=this.base.selectAll("g.chart-series").selectAll("g")[a.j][a.i];b&&d3.select(b).classed("highlight",!0)},removeHighlight:function(){this.base.selectAll("g").selectAll("g").classed("highlight",!1)}}),{z_index:b.z_index.labels})}(d3,_,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){var c=a.mixin,d=a.property,e=a.di;d3.chart("Chart").extend("Bars",c(b.Series,b.XYValues,b.XYLabels,{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("chart-bars",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").attr("class",a.barClass).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();this.attr("y",a.y0).attr("height",0)},merge:function(){var a=this.chart();this.attr("x",a.barX).attr("width",a.itemWidth)},"merge:transition":function(){var a=this.chart();a.delay()&&this.delay(a.delay()),a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.attr("y",a.barY).attr("height",a.barHeight)},exit:function(){this.remove()}}}),this.attachLabels()},delay:d("delay",{type:"Function"}),duration:d("duration",{type:"Function"}),ease:d("ease",{type:"Function"}),displayAdjacent:d("displayAdjacent",{default_value:!0}),barHeight:e(function(a,b,c){var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c))-a.barOffset();return d>0?d:0}),barX:e(function(a,b,c){return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e+a.barOffset()}),barClass:e(function(a,b){return"chart-bar"+(b["class"]?" "+b["class"]:"")}),barOffset:function(){if(this.__axis||(this.__axis=d3.select(this.base[0][0].parentNode).select('[data-id="axis.x"] .domain')),!this.__axis)return 0;var a=this.__axis[0][0]&&parseInt(this.__axis.style("stroke-width"))||0;return a/2},insertSwatch:function(){return this.append("rect").attr("x",0).attr("y",0).attr("width",20).attr("height",20).attr("class","chart-bar")}})),d3.chart("Bars").extend("StackedBars",{transform:function(a){return this.bar_positions=[],a},barHeight:e(function(a,b,c){var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c)),e=0===a.seriesIndex.call(this,b,c)?a.barOffset():0;return d>0?d-e:0}),barX:e(function(a,b,c){return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){var d=a.y.call(this,b,c),e=a.y0();if(!(d>e)){a.bar_positions.length<=c&&a.bar_positions.push(0);var f=a.bar_positions[c]||e,g=f-(e-d);return a.bar_positions[c]=g,g}}),displayAdjacent:d("displayAdjacent",{default_value:!1})})}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("Chart").extend("Line",c(b.Series,b.XY,b.XYLabels,{initialize:function(){this.seriesLayer("Lines",this.base.append("g").classed("chart-lines",!0),{dataBind:function(){var a=this.chart(),b=a.lines=[];return _.each(a.data(),function(c,d){b[d]=a.createLine(c)}),this.selectAll("path").data(function(b,c){return[a.data()[c]]},a.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("chart-line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines;a.delay()&&this.delay(a.delay()),a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.itemStyle)}}}),this.attachLabels()},interpolate:d("interpolate"),delay:d("delay",{type:"Function"}),duration:d("duration",{type:"Function"}),ease:d("ease",{type:"Function"}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.interpolate();return c&&b.interpolate(c),b},insertSwatch:function(){return this.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","chart-line")}})),d3.chart("Line").extend("LineValues",b.XYValues)}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a){{var b=(a.mixin,a.property);a.di}d3.chart("Component").extend("Title",{initialize:function(){this.layer("Title",this.base.append("g").classed("chart-title",!0),{dataBind:function(){return this.selectAll("text").data([0])},insert:function(){return this.append("text")},events:{merge:function(){var a=this.chart();this.attr("transform",a.transformation()).attr("style",a.style()).attr("text-anchor","middle").attr("class",a.options()["class"]).text(a.text())}}})},text:b("text",{get:function(){return this.options().text}}),rotation:b("rotation",{default_value:function(){var a={right:90,left:-90};return a[this.position()]||0}}),transformation:function(){var b=a.translate(this.width()/2,this.height()/2),c=a.rotate(this.rotation());return b+" "+c}},{z_index:a.z_index.title})}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("Component").extend("Axis",c(b.XY,{initialize:function(){this.axis=d3.svg.axis(),this._layout_axis=d3.svg.axis(),this.axis_base=this.base.append("g").attr("class","chart-axis"),this._layout_base=this.base.append("g").attr("class","chart-axis chart-layout").attr("style","display: none;"),this.layer("Axis",this.axis_base,{dataBind:function(){var a=this.chart();return a._setupAxis(a.axis),this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{enter:function(){var a=this.chart();this.attr("transform",a.translation()).call(a.axis)},update:function(){this.attr("transform",this.chart().translation())},"update:transition":function(){var a=this.chart();a.delay()&&this.delay(a.delay()),a._skip_transition?(this.duration(0),a._skip_transition=void 0):a.duration()&&this.duration(a.duration()),a.ease()&&this.ease(a.ease()),this.call(a.axis)},exit:function(){this.selectAll("g").remove()}}}),this.layer("_LayoutAxis",this._layout_base,{dataBind:function(){var a=this.chart();return a._setupAxis(a._layout_axis),this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{merge:function(){var a=this.chart();this.attr("transform",a.translation()).call(a.axis)}}})},duration:d("duration",{type:"Function"}),delay:d("delay",{type:"Function"}),ease:d("ease",{type:"Function"}),scale:d("scale",{type:"Function",set:function(b){var c=a.createScaleFromOptions(b);return"vertical"==this.orientation()?this.yScale(c.copy()):this.xScale(c.copy()),{override:c}}}),position:d("position",{default_value:"bottom",validate:function(a){return _.contains(["top","right","bottom","left","x0","y0"],a)},set:function(){this.scale()&&this.scale(this.scale())}}),translation:d("translation",{default_value:function(){return{top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(),y:0},y0:{x:0,y:this.y0()}}[this.position()]},get:function(b){return a.translate(b)}}),orient:d("orient",{default_value:function(){var a=this.position();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),orientation:d("orientation",{validate:function(a){return _.contains(["horizontal","vertical"],a)},default_value:function(){return{top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"}[this.position()]},set:function(){this.scale()&&this.scale(this.scale())}}),type:d("type"),ticks:d("ticks",{type:"Function"}),tickValues:d("tickValues",{type:"Function"}),tickSize:d("tickSize",{type:"Function"}),innerTickSize:d("innerTickSize",{type:"Function"}),outerTickSize:d("outerTickSize",{type:"Function"}),tickPadding:d("tickPadding",{type:"Function"}),tickFormat:d("tickFormat",{type:"Function"}),getLayout:function(a){var b=this.getState();this.draw(a),this._layout_base.attr("style","display: block;");var c=this._getLabelOverhang();this._layout_base.attr("style","display: none;"),this._previous_raw_data?(this.setState(_.extend(b.previous,{duration:0})),this.draw(this._previous_raw_data),this.setState(b.current)):this._skip_transition=!0,this._previous_raw_data=a;var d=this.position();return"x0"==d?d="bottom":"y0"==d&&(d="right"),{position:d,width:c.width,height:c.height}},setLayout:function(){},getState:function(){return{previous:{scale:this.scale.previous,xScale:this.xScale.previous,yScale:this.yScale.previous,duration:this.duration.previous},current:{scale:this.scale(),xScale:this.xScale(),yScale:this.yScale(),duration:this.duration()}}},setState:function(a){this.xScale(a.xScale).yScale(a.yScale).scale(a.scale).duration(a.duration)},_setupAxis:function(a){this.axis.scale("vertical"==this.orientation()?this.yScale():this.xScale());var b=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"],c=["tickValues"];_.each(b,function(b){var d=this[b]&&this[b]();_.isUndefined(d)||(_.isArray(d)&&!_.contains(c,b)?a[b].apply(a,d):a[b](d))},this)},_getLabelOverhang:function(){var a={width:[0],height:[0]},b=this.orientation();return this._layout_base.selectAll(".tick").each(function(){try{var c=this.getBBox();"horizontal"==b?a.height.push(c.height):a.width.push(c.width)}catch(d){}}),{width:_.max(a.width),height:_.max(a.height)}}}),{layer_type:"chart",z_index:a.z_index.axis}),d3.chart("Axis").extend("AxisValues",c(b.XYValues))}(d3,d3.chart.helpers,d3.chart.mixins),function(d3,a){function b(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),transform.translate(g,h)})}}var c=a.property,d=a.di;d3.chart("Component").extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("chart-legend",!0),this.options().display?this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var b=this.chart(),c=this.append("g").attr("class",b.dataGroupClass);return c.append("g").attr("width",20).attr("height",20).attr("class","chart-legend-swatch"),c.append("text").attr("class","chart-legend-label chart-label").attr("transform",a.translate(25,0)),c},events:{merge:function(){var a=this.chart();this.select("g").each(a.createSwatch),this.select("text").text(a.dataValue).attr("alignment-baseline","before-edge");var c={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical"};this.call(b.bind(this,{direction:c[a.position()],origin:"top",padding:5}))}}}):this.skip_layout=!0},transform:function(){var a=(d3.chart("Multi").prototype.demux,_.reduce(this.options().charts,function(a,b){if(b.exclude_from_legend)return a;var c=_.compact(_.map(b.data(),function(a,c){return a.exclude_from_legend?void 0:{chart:b,series:a,series_index:c}
}));return a.concat(c)},[],this));return a},dataKey:d(function(a,b){return b.chart.id+"."+b.series.name}),dataValue:d(function(a,b){return b.series.name}),dataGroupClass:d(function(){return"chart-legend-group"}),dataSeriesClass:d(function(a,b){return"chart-series chart-index-"+(b.series_index||0)}),dataClass:d(function(a,b,c){var d=[a.dataSeriesClass.call(this,b,c)];return b.chart.options()["class"]&&d.push(b.chart.options()["class"]),b.series["class"]&&d.push(b.series["class"]),d.join(" ")||null}),dataStyle:d(function(b,c){var d=_.defaults({},c.series.style,c.chart.options().style);return a.style(d)||null}),createSwatch:d(function(a,b,c){var d=d3.select(this);d.selectAll("*").remove(),d.attr("class",a.dataClass);var e;b&&b.chart&&_.isFunction(b.chart.insertSwatch)?(d.chart=function(){return a},e=b.chart.insertSwatch.call(d)):e=d.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","chart-swatch"),e&&_.isFunction(e.attr)&&e.attr("style",a.dataStyle.call(this,b,c))})},{z_index:a.z_index.legend}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this._positionLegend()},position:c("position",{default_value:{x:10,y:10},set:function(a,b){return a=a&&_.isObject(a)?a:{},_.defaults(a,b||{},{x:0,y:0}),{override:a,after:function(){this._positionLegend()}}}}),skip_layout:!0,_positionLegend:function(){if(this.legend){var b=this.position();this.legend.attr("transform",a.translate(b.x,b.y))}}},{layer_type:"chart"})}(d3,d3.chart.helpers),function(d3,a,b){var c=b.property;d3.chart("Container").extend("Multi",{initialize:function(){this._full_redraw=!1,this._components={},this._axes={}},options:c("options",{default_value:function(){return{}},type:"Function",set:function(b){return this._full_redraw=!0,a.isFunction(b)?void 0:{override:function(){return b}}}}),title:c("title",{set:function(b){return!b||a.isEmpty(b)?void this.detachComponent("title"):(a.isString(b)&&(b={text:b}),b=a.defaults({},b,d3.chart("Multi").defaults.title),void this.attachComponents({title:b}))}}),charts:c("charts",{set:function(b){b=b||{};var c=a.difference(a.keys(this.charts_by_id),a.keys(b));a.each(c,function(a){this.detachChart(a)},this),a.each(b,function(b,c){var d=this.charts_by_id[c];if(b=a.defaults({},b,d3.chart("Multi").defaults.charts),d)d.options(b);else{var e=d3.chart(b.type);d=new e(this.chartLayer(),b),this.attachChart(c,d)}},this)},default_value:{}}),axes:c("axes",{set:function(b){var c={};a.each(b||{},function(b,d){if(b=a.defaults({},b,d3.chart("Multi").defaults.axes),c["axis."+d]=b,b.title){var e=a.isString(b.title)?{text:b.title}:b.title;e=a.defaults({},e,{type:"Title",position:b.position,"class":"chart-title-axis"}),c["axis_title."+d]=e}}),this.attachComponents(c,this._axes)},default_value:{}}),legend:c("legend",{set:function(b){return b&&b!==!1&&b.display!==!1?(b=a.defaults({},b,d3.chart("Multi").defaults.legend),b.charts&&(b.charts=a.map(b.charts,function(a){return this.charts_by_id[a]},this)),void this.attachComponents({legend:b})):void this.detachComponent("legend")}}),components:c("components",{set:function(a){this.attachComponents(a,this._components)},default_value:{}}),draw:function(a){var b=this._prepareConfig(a);this.axes(b.axes),this.charts(b.charts),this.components(b.components),this.legend(b.legend),this.title(b.title),d3.chart("Container").prototype.draw.call(this,{original:a,config:b.data})},redraw:function(){this.rawData()&&(this._full_redraw?(this._full_redraw=!1,this.draw(this.rawData().original)):d3.chart("Container").prototype.draw.call(this,this.rawData()))},demux:function(a,b){var c,d=this.charts_by_id[a];if(d){if(c=b.config.charts[a])return c}else if(d=this.components_by_id[a],d&&(c=b.config.components[a]))return c;return b.original},attachComponents:function(c,d){if(d){var e=a.difference(a.keys(d),a.keys(c));a.each(e,function(a){this.detachComponent(a),delete d[a]},this)}a.each(c,function(a,c){var e=this.components_by_id[c];if(e&&e.type!=a.type&&(this.detachComponent(componentId),e=void 0),e)e.options(a);else{var f=d3.chart(a.type),g={z_index:b.valueOrDefault(f.z_index,b.z_index.component)},h="chart"==f.layer_type?this.chartLayer(g):this.componentLayer(g);e=new f(h,a),e.type=a.type,this.attachComponent(c,e),d&&(d[c]=e)}},this)},_prepareConfig:function(b){var c=a.defaults({},this.options()(b),{charts:{},axes:{},components:{},legend:!1,title:!1,options:{}});c.legend===!0&&(c.legend={}),c.legend.charts||c.legend.data||(c.legend.charts=a.keys(c.charts)),a.isString(c.title)&&(c.title={text:c.title});var d={charts:{},components:{}};return a.each(c.charts,function(a,b){d.charts[b]=a.data,delete a.data}),a.each(c.axes,function(a,b){d.components["axis."+b]=a.data,delete a.data}),a.each(c.components,function(a,b){d.components[b]=a.data,delete a.data}),a.isObject(c.legend)&&(d.components.legend=c.legend.data,delete c.legend.data),c.data=d,c}},{defaults:{charts:{},axes:{type:"Axis"},legend:{type:"Legend",position:"right"},title:{type:"Title",position:"top","class":"chart-title-main"}}})}(d3,_,d3.chart.helpers);
//# sourceMappingURL=d3.chart.multi.min.map