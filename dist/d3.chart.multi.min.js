/*! d3.chart.multi - v0.7.0
 * https://github.com/CSNW/d3.chart.multi
 * License: MIT
 */

!function(d3,a){function b(b,d){d=d||{};var e=d.propKey||"__properties",f=function(c,g){function h(){return c=a.isUndefined(k)?f.defaultValue:k,a.isFunction(c)&&"Function"!=d.type&&(c=c.call(this)),a.isFunction(d.get)?d.get.call(l,c):c}function i(){var e;if(a.isFunction(d.validate)&&!d.validate.call(this,c)){if(a.isFunction(this.trigger)&&(this.trigger("invalid:"+b,c),this.trigger("invalid",b,c)),!a.isUndefined(k))return j[b]=k,this;if(a.isUndefined(f.defaultValue))return this;c=f.defaultValue}if(j[b]=c,a.isFunction(d.set)){var h=d.set.call(l,c,k);h&&a.has(h,"override")&&(j[b]=h.override),h&&a.isFunction(h.after)&&h.after.call(l,j[b]),h&&a.has(h,"changed")&&(e=h.changed)}return a.isUndefined(e)&&(e=!a.isEqual(j[b],k)),e&&a.isFunction(this.trigger)&&!g.silent&&(this.trigger("change:"+b,j[b]),this.trigger("change",b,j[b])),this}g=g||{};var j=this[e]=this[e]||{},k=j[b],l=a.isUndefined(f.context)?this:f.context;return arguments.length?i.call(this):h.call(this)};return f.isProperty=!0,f.setFromOptions=c(d.setFromOptions,!0),f.defaultValue=d.defaultValue,f.context=d.context,f}function c(b,c){return a.isUndefined(b)?c:b}function d(b){var c=b&&b.length&&b[0]&&b[0].length&&b[0][0],d=c&&"function"==typeof c.getBBox&&c.getBBox()||{width:0,height:0},e=c?"svg"==c.nodeName:!1,f={width:c&&c.clientWidth||0,height:c&&c.clientHeight||0};if(c&&e&&(!c.clientWidth||!c.clientHeight)&&window&&window.getComputedStyle){var g=window.getComputedStyle(c);f.height=parseFloat(g.height)-parseFloat(g.borderTopWidth)-parseFloat(g.borderBottomWidth),f.width=parseFloat(g.width)-parseFloat(g.borderLeftWidth)-parseFloat(g.borderRightWidth)}var h={width:0,height:0};return b&&(h={width:b.attr("width")||0,height:b.attr("height")||0}),{width:a.max([f.width,h.width||d.width])||0,height:a.max([f.height,h.height||d.height])||0}}function e(b){if(b=b||{},a.isFunction(b))return b;var c;return c=b.type&&"time"==b.type?d3.time.scale():b.type&&d3.scale[b.type]?d3.scale[b.type]():d3.scale.linear(),a.each(b,function(a,b){c[b]&&("range"==b||"domain"==b?c[b](a):"type"!=b&&c[b].apply(c,a))}),c}function f(a,b){function c(b,c){return c>0&&a.padding?a.padding:0}if(a&&!b&&(b=a,a={direction:"vertical",origin:"top",padding:0}),b&&b.attr){var d=0;b.attr("transform",function(b,e){var f=this.getBBox(),g=0,h=0;return"horizontal"==a.direction?("left"!=a.origin&&"right"!=a.origin&&(a.origin="left"),g="left"==a.origin?d+c(b,e):d+f.width+c(b,e),d=d+f.width+c(b,e)):("top"!=a.origin&&"bottom"!=a.origin&&(a.origin="top"),h="top"==a.origin?d+c(b,e):d+f.height+c(b,e),d=d+f.height+c(b,e)),q.translate(g,h)})}}function g(b){return b?(b=a.map(b,function(a,b){return b+": "+a}),b=b.join("; "),b?b+";":""):""}function h(b,c){var d=a.isArray(b)?b:[b];c=a.toArray(arguments).slice(1);var e;return a.find(c,function(b){return a.isObject(b)&&a.find(d,function(c){return e=b[c],!a.isUndefined(e)})}),e}function i(b){return b&&a.isFunction(b.charAt)&&a.isFunction(b.slice)?b.charAt(0).toUpperCase()+b.slice(1):""}function j(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._isDi=!0,b.original=a,b}function k(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function l(a){for(var b in a)a[b]&&a[b]._isDi&&(a[b]=k(a[b],a))}function m(a){if(a._parentData)return a._parentData;var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function n(a,b,c){a=a||"",b=b||"",c=c||"";var d=d3.chart(a+c)||d3.chart(a)||d3.chart(b+c)||d3.chart(b+a)||d3.chart(a+b)||d3.chart(b);if(!d)throw new Error("d3.chart.multi: Unable to resolve chart for type "+a+" and component "+b+" and container "+c);return d}function o(b){b=a.isArray(b)?b:a.toArray(arguments);var c=a.extend.apply(this,[{}].concat(b));return delete c.constructor,c.initialize&&(c.initialize=function(){var c=a.toArray(arguments);a.each(b,function(a){a.initialize&&a.initialize.apply(this,c)},this)}),c.transform&&(c.transform=function(c){return a.reduceRight(b,function(a,b){return b&&b.transform?b.transform.call(this,a):a},c,this)}),c}var p={component:50,axis:51,title:52,chart:100,legend:200};a.each(["extend"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=a[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.clone(b[c]());d.unshift(g);var h=f.apply(a,d);return b[c]("result"==e?h:g),h}}}),a.each(["push","pop",{name:"concat",set:"result"},"splice","shift","unshift","reverse","sort"],function(c){var d=a.isObject(c)?c.name:c,e=c&&c.set||"cloned",f=Array.prototype[d];b[d]=function(b,c){if(b[c]&&f){var d=a.toArray(arguments).slice(2),g=a.toArray(b[c]()),h=f.apply(g,d);return b[c]("result"==e?h:g),h}}});var q={translate:function(b,c){return a.isObject(b)&&(c=b.y,b=b.x),"translate("+(b||0)+", "+(c||0)+")"},rotate:function(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}};d3.chart.helpers=a.extend({},d3.chart.helpers,{zIndex:p,property:b,valueOrDefault:c,dimensions:d,transform:q,translate:q.translate,createScaleFromOptions:e,stack:f,style:g,getValue:h,capitalize:i,di:j,bindDi:k,bindAllDi:l,getParentData:m,resolveChart:n,mixin:o})}(d3,_),function(d3,a,b){var c=b.property,d=b.valueOrDefault,e=b.di,f={isSeries:!0,seriesKey:e(function(a,b){return b.key}),seriesValues:e(function(a,b,c){return b.seriesIndex=c,b.values}),seriesClass:e(function(a,b,c){return"chart-series chart-index-"+c+(b["class"]?" "+b["class"]:"")}),seriesIndex:e(function(a,b,c){var d=a.seriesData.call(this,b,c);return d&&d.seriesIndex||0}),seriesCount:e(function(a){return a.data()?a.data().length:1}),seriesData:e(function(){return b.getParentData(this)}),itemStyle:e(function(c,d,e){var f=c.seriesData.call(this,d,e)||{},g=a.defaults({},d.style,f.style,c.options().style);return b.style(g)||null}),seriesLayer:function(a,b,c){if(c&&c.dataBind){var d=c.dataBind;c.dataBind=function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass),c.chart=function(){return b},d.call(c,b.seriesValues)}}return d3.chart().prototype.layer.call(this,a,b,c)}},g={isXY:!0,xScale:c("xScale",{type:"Function",setFromOptions:!1}),yScale:c("yScale",{type:"Function",setFromOptions:!1}),xMin:c("xMin",{get:function(a){var b=this.data()&&d3.extent(this.data(),this.xValue)[0];return d(a,0>b?b:0)}}),xMax:c("xMax",{get:function(a){var b=this.data()&&d3.extent(this.data(),this.xValue)[1];return d(a,b)}}),yMin:c("yMin",{get:function(a){var b=this.data()&&d3.extent(this.data(),this.yValue)[0];return d(a,0>b?b:0)}}),yMax:c("yMax",{get:function(a){var b=this.data()&&d3.extent(this.data(),this.yValue)[1];return d(a,b)}}),invertedXY:c("invertedXY",{defaultValue:!1}),initialize:function(){function a(){this.options().xScale&&this.xScale(b.createScaleFromOptions(this.options().xScale)),this.options().yScale&&this.yScale(b.createScaleFromOptions(this.options().yScale)),this.setScales()}this.on("change:data",this.setScales),this.on("change:options",a.bind(this)),a.call(this)},x:e(function(a,b,c){return a.invertedXY()?a._yScale()(a.yValue.call(this,b,c)):a._xScale()(a.xValue.call(this,b,c))}),y:e(function(a,b,c){return a.invertedXY()?a._xScale()(a.xValue.call(this,b,c)):a._yScale()(a.yValue.call(this,b,c))}),x0:e(function(a){return a.invertedXY()?a._yScale()(0):a._xScale()(0)}),y0:e(function(a){return a.invertedXY()?a._xScale()(0):a._yScale()(0)}),xValue:e(function(a,b){return b.x}),yValue:e(function(a,b){return b.y}),keyValue:e(function(b,c,d){return a.isUndefined(c.key)?b.xValue.call(this,c,d)+","+b.yValue.call(this,c,d):c.key}),setScales:function(){var a=this.xScale(),b=this.yScale();a||(a=this.setXScaleDomain(this.defaultXScale(),this.data()||[],this)),b||(b=this.setYScaleDomain(this.defaultYScale(),this.data()||[],this)),a=this.setXScaleRange(a,this.data()||[],this),b=this.setYScaleRange(b,this.data()||[],this),this._xScale(a)._yScale(b)},setXScaleDomain:function(a){return a.domain([this.xMin(),this.xMax()])},setYScaleDomain:function(a){return a.domain([this.yMin(),this.yMax()])},setXScaleRange:function(a,b,c){return a.range(this.invertedXY()?[c.height(),0]:[0,c.width()])},setYScaleRange:function(a,b,c){return a.range(this.invertedXY()?[0,c.width()]:[c.height(),0])},defaultXScale:function(){return d3.scale.linear()},defaultYScale:function(){return d3.scale.linear()},_xScale:c("_xScale",{type:"Function"}),_yScale:c("_yScale",{type:"Function"}),_translateCoordinatesToPoints:function(b,c){var d=[],e={distance:1/0,coordinates:{x:0,y:0}};return a.each(this.data(),function(a,d){var f=this._distance(a,d,b,c);f.distance<e.distance&&(e.distance=f.distance,e.coordinates.x=f.x,e.coordinates.y=f.y,e.values=a,e.index=d)},this),e.distance<1/0&&d.push({points:[e]}),d},_distance:function(a,b,c,d){var e,f=this.x(a,b),g=this.y(a,b);return e="x"==d.measurement?Math.abs(f-c.x):"y"==d.measurement?Math.abs(g-c.y):Math.sqrt(Math.pow(f-c.x,2)+Math.pow(g-c.y,2)),{x:f,y:g,distance:e}}},h={xMin:c("xMin",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.xValue)[0];return b>f?f:b}return b},1/0,this);return d(b,0>c?c:0)}}),xMax:c("xMax",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.xValue)[1];return f>b?f:b}return b},-1/0,this);return d(b,c)}}),yMin:c("yMin",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.yValue)[0];return b>f?f:b}return b},1/0,this);return d(b,0>c?c:0)}}),yMax:c("yMax",{get:function(b){var c=a.reduce(this.data(),function(b,c,d){var e=this.seriesValues(c,d);if(a.isArray(e)){var f=d3.extent(e,this.yValue)[1];return f>b?f:b}return b},-1/0,this);return d(b,c)}}),_translateCoordinatesToPoints:function(b,c){var d=[];return a.each(this.data(),function(e,f){var g={distance:1/0,coordinates:{x:0,y:0},series:{key:e.key,name:e.name,index:f}};a.each(e.values,function(a,d){var f=this._distance(a,d,b,e,c);f.distance<g.distance&&(g.distance=f.distance,g.coordinates.x=f.x,g.coordinates.y=f.y,g.values=a,g.index=d)},this),g.distance<1/0&&d.push({key:e.key,name:e.name,"class":e["class"],index:f,points:[g]})},this),d},_distance:function(a,b,c,d,e){var f,g=this.x.call({_parentData:d},a,b),h=this.y.call({_parentData:d},a,b);return f="x"==e.measurement?Math.abs(g-c.x):"y"==e.measurement?Math.abs(h-c.y):Math.sqrt(Math.pow(g-c.x,2)+Math.pow(h-c.y,2)),{x:g,y:h,distance:f}}},i={isValues:!0,itemPadding:c("itemPadding",{defaultValue:.1}),transform:function(b){return a.map(b,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},defaultXScale:function(){return d3.scale.ordinal()},setXScaleDomain:function(b){var c=a.map(this.data(),this.xValue),d=a.uniq(a.flatten(c));return b.domain(d)},setXScaleRange:function(b,c,d){return a.isFunction(b.rangeBands)?this.invertedXY()?b.rangeBands([d.height(),0],d.itemPadding(),d.itemPadding()/2):b.rangeBands([0,d.width()],d.itemPadding(),d.itemPadding()/2):g.setXScaleRange.call(this,b,c,d)}},j={displayAdjacent:c("displayAdjacent",{defaultValue:!1}),transform:function(b){return a.each(b,function(b){b.values=a.map(b.values,function(b){return b=a.isObject(b)?b:{y:b},b.x=d(b.x,b.key),b},this)},this),b},x:e(function(a,b,c){return a.invertedXY()?g.x.original.call(this,a,b,c):a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c)}),y:e(function(a,b,c){return a.invertedXY()?a.displayAdjacent()?a.adjacentX.call(this,b,c):a.layeredX.call(this,b,c):g.y.original.call(this,a,b,c)}),setXScaleDomain:function(b,c){var d=a.map(c,function(b,c){return a.map(this.seriesValues(b,c),this.xValue)},this),e=a.uniq(a.flatten(d));return b.domain(e)},adjacentX:e(function(a,b,c){var d=a.adjacentWidth.call(this,b,c),e=a.layeredX.call(this,b,c)-a.layeredWidth.call(this,b,c)/2+d/2;return e+d*a.seriesIndex.call(this,b,c)||0}),adjacentWidth:e(function(a,b,c){var d=a.seriesCount.call(this);return d>0?a.layeredWidth.call(this,b,c)/d:0}),layeredX:e(function(a,b,c){return a._xScale()(a.xValue.call(this,b,c))+.5*a.layeredWidth.call(this)||0}),layeredWidth:e(function(a){var b=a._xScale().rangeBand();return isFinite(b)?b:0}),itemWidth:e(function(a,b,c){return a.displayAdjacent()?a.adjacentWidth.call(this,b,c):a.layeredWidth.call(this,b,c)})},k={labels:c("labels",{defaultValue:{},set:function(c){a.isBoolean(c)?c={display:c}:a.isString(c)?c={display:"display"==c||"show"==c}:c&&a.isUndefined(c.display)&&(c.display=!0),a.each(c,function(a,c){var d="label"+b.capitalize(c);this[d]&&this[d].isProperty&&this[d].setFromOptions&&this[d](a,{silent:!0})},this)}}),labelDisplay:c("labelDisplay",{defaultValue:!1}),labelFormat:c("labelFormat",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),labelPosition:c("labelPosition",{validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),labelOffset:c("labelOffset",{get:function(b){return a.isNumber(b)&&(b={top:{x:0,y:-b},right:{x:b,y:0},bottom:{x:0,y:b},left:{x:-b,y:0}}[this.labelPosition()],b||(b={x:0,y:0})),b}}),labelPadding:c("labelPadding",{defaultValue:2}),labelAnchor:c("labelAnchor",{defaultValue:function(){var b=this.labelPosition();return a.isUndefined(b)?void 0:"right"==b?"start":"left"==b?"end":"middle"},validate:function(b){return a.contains(["start","middle","end"],b)}}),labelStyle:c("labelStyle",{defaultValue:{}}),labelText:e(function(a,b,c){var d=a.yValue.call(this,b,c);return a.labelFormat()?a.labelFormat()(d):d}),_getLabels:function(){var b=[];return this.labelDisplay()&&b.push({labels:a.map(this.data(),function(a,b){return{key:this.keyValue(a,b),coordinates:{x:this.x(a,b),y:this.y(a,b)},text:this.labelText(a,b),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),"class":a["class"],style:this.labelStyle(),values:a,index:b}},this)}),b},_convertPointToLabel:function(a){return{key:this.keyValue(a.values,a.index),coordinates:a.coordinates,text:this.labelText(a.values,a.index),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),"class":a.values["class"],style:this.labelStyle(),values:a.values,index:a.index}}},l={_getLabels:function(){var b=[];return this.labelDisplay()&&(b=a.map(this.data(),function(b,c){return{key:b.key,name:b.name,"class":b["class"],index:c,labels:a.map(b.values,function(a,c){return{key:this.keyValue.call({_parentData:b},a,c),coordinates:{x:this.x.call({_parentData:b},a,c),y:this.y.call({_parentData:b},a,c)},text:this.labelText.call({_parentData:b},a,c),offset:this.labelOffset(),padding:this.labelPadding(),anchor:this.labelAnchor(),"class":a["class"],style:this.labelStyle(),values:a,index:c}},this)}},this)),b}};d3.chart.extensions=a.extend(d3.chart.extensions||{},{Series:f,XY:g,XYSeries:a.extend({},f,g,h),Values:a.extend({},g,i),ValuesSeries:a.extend({},f,g,h,i,j),Labels:k,LabelsSeries:a.extend({},k,l)})}(d3,_,d3.chart.helpers),function(d3,a,b,c){var d=b.property;d3.chart("Base",{initialize:function(){b.bindAllDi(this)},data:d("data",{set:function(){this.trigger("change:data","BUG")}}),style:d("style",{get:function(a){return b.style(a)||null}}),options:d("options",{defaultValue:{},set:function(a){this.setFromOptions(a)}}),width:function(){return b.dimensions(this.base).width},height:function(){return b.dimensions(this.base).height},redrawFor:function(){var b=a.toArray(arguments),c=a.map(b,function(a){return"change:"+a});a.each(c,function(b){this.on(b,function(){a.isFunction(this.redraw)?this.redraw():this.container&&a.isFunction(this.container.redraw)&&this.container.redraw()})},this)},transform:function(a){return a=a||[],this.data(a),a},setFromOptions:function(b){a.each(b,function(a,b){this[b]&&this[b].isProperty&&this[b].setFromOptions&&this[b](a,{silent:!0})},this)}}),d3.chart("Base").extend("Chart",{initialize:function(a){this.options(a||{}),this.redrawFor("options")}}),d3.chart("Chart").extend("SeriesChart",c.Series),d3.chart("Base").extend("Container",{initialize:function(a){this.chartsById={},this.componentsById={},this.transform=function(a){return this.rawData(a),a},this.base.classed("chart",!0),this.on("change:dimensions",this.redraw),this.options(a||{}),this.redrawFor("options"),this.handleResize(),this.handleHover()},rawData:d("rawData"),chartMargins:d("chartMargins",{get:function(b){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,{top:0,right:0,bottom:0,left:0})},set:function(b,c){return b=b&&"object"==typeof b?b:{},b=a.defaults(b,c,{top:0,right:0,bottom:0,left:0}),{override:b,after:function(){this.trigger("change:dimensions")}}}}),width:d("width",{defaultValue:function(){return b.dimensions(this.base).width},set:function(){this.trigger("change:dimensions")}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height},set:function(){this.trigger("change:dimensions")}}),draw:function(a){this.base.attr("width",this.width()||null).attr("height",this.height()||null),this._preDraw(a),this.layout(),d3.chart().prototype.draw.call(this,a)},redraw:function(){this.rawData()&&this.draw(this.rawData())},chartLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.chart}),this.base.append("g").attr("class","chart-layer").attr("data-zIndex",c.zIndex)},componentLayer:function(c){return c=a.defaults({},c,{zIndex:b.zIndex.component}),this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",c.zIndex)},attachChart:function(a,b){this._attach(a,b),this.chartsById[a]=b},detachChart:function(a){var b=this.chartsById[a];b&&(this._detach(a,b),delete this.chartsById[a])},attachComponent:function(a,b){this._attach(a,b),this.componentsById[a]=b,b.on("change:position",function(){this.trigger("change:dimensions")})},detachComponent:function(a){var b=this.componentsById[a];b&&(b.off("change:position"),this._detach(a,b),delete this.componentsById[a])},layout:function(){var a=this._extractLayout();this._updateChartMargins(a),this._positionLayers(a)},chartWidth:function(){var a=this._chartMargins();return this.width()-a.left-a.right},chartHeight:function(){var a=this._chartMargins();return this.height()-a.top-a.bottom},handleResize:function(){},handleHover:function(){function b(a){return{x:a[0],y:a[1]}}var c,d=this.trigger.bind(this),e=a.throttle(function(a){c&&d("move:mouse",a)},100);this.base.on("mouseenter",function(){c=!0,d("enter:mouse",b(d3.mouse(this)))}),this.base.on("mousemove",function(){e(b(d3.mouse(this)))}),this.base.on("mouseleave",function(){c=!1,d("leave:mouse")});var f;this.on("enter:mouse",function(a){var b=this._translateCoordinatesToChart(a);b&&(f=!0,d("chart:enter:mouse",b))}),this.on("move:mouse",function(a){var b=this._translateCoordinatesToChart(a);b?f?d("chart:move:mouse",b):(f=!0,d("chart:enter:mouse",b)):f&&(f=!1,d("chart:leave:mouse"))}),this.on("leave:mouse",function(){f&&(f=!1,d("chart:leave:mouse"))});var g;this.on("chart:enter:mouse",function(a){var b=this._translateCoordinatesToPoints(a);b.length&&(g=!0,d("points:enter:mouse",b))}),this.on("chart:move:mouse",function(a){var b=this._translateCoordinatesToPoints(a);b.length?g?d("points:move:mouse",b):(g=!0,d("points:enter:mouse",b)):g&&(g=!1,d("points:leave:mouse"))}),this.on("chart:leave:mouse",function(){g&&(g=!1,d("points:leave:mouse"))});var h;this.on("points:enter:mouse",function(a){var b=this._convertPointsToLabels(a);b.length&&(h=!0,d("labels:enter:mouse",b))}),this.on("points:move:mouse",function(a){var b=this._convertPointsToLabels(a);b.length?h?d("labels:move:mouse",b):(h=!0,d("labels:enter:mouse",b)):h&&(h=!1,d("labels:leave:mouse"))}),this.on("points:leave:mouse",function(){h&&(h=!1,d("labels:leave:mouse"))})},_attach:function(b,c){c.id=b,c.base.attr("data-id",b),c.container=this,this.attach(b,c),c&&a.isFunction(c.trigger)&&c.trigger("attached")},_detach:function(b,c){c.base.remove(),delete this._attached[b],c&&a.isFunction(c.trigger)&&c.trigger("detached")},_preDraw:function(b){this._positionChartLayers(),a.each(this.componentsById,function(a,c){a.skipLayout||a.draw(this.demux?this.demux(c,b):b)},this)},_positionLayers:function(a){this._positionChartLayers(),this._positionComponents(a),this._positionByZIndex()},_positionChartLayers:function(){var a=this._chartMargins();this.base.selectAll(".chart-layer").attr("transform",b.transform.translate(a.left,a.top)).attr("width",this.chartWidth()).attr("height",this.chartHeight())},_positionComponents:function(b){function c(b,c,d,e){b&&a.isFunction(b.setLayout)&&b.setLayout(c,d,e)}var d=this._chartMargins(),e=this.width(),f=this.height(),g=this.chartWidth(),h=this.chartHeight();a.reduce(b.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:g}),e},d.top),a.reduce(b.right,function(a,b,e,f){var g=f[e-1]||{offset:0},i=a+g.offset;return c(b.component,i,d.top,{height:h}),i},e-d.right),a.reduce(b.bottom,function(a,b,e,f){var h=f[e-1]||{offset:0},i=a+h.offset;return c(b.component,d.left,i,{width:g}),i},f-d.bottom),a.reduce(b.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:h}),e},d.left)},_positionByZIndex:function(){var b=this.base.selectAll(".chart-layer, .chart-component-layer")[0];b=a.sortBy(b,function(a){return+d3.select(a).attr("data-zIndex")||0}),a.each(b,function(a){a.parentNode.appendChild(a)},this)},_updateChartMargins:function(b){var c=a.extend({},this.chartMargins());return a.each(b,function(b,d){a.each(b,function(a){c[d]+=a.offset||0})}),this._chartMargins(c),c},_extractLayout:function(){var b={top:[],right:[],bottom:[],left:[]};return a.each(this.componentsById,function(c){if(!c.skipLayout){var d=c.layoutPosition();if(a.contains(["top","right","bottom","left"],d)){var e;e="top"==d||"bottom"==d?c.layoutHeight():c.layoutWidth(),b[d].push({offset:e,component:c})}}}),b},_chartMargins:d("_chartMargins",{defaultValue:function(){return a.extend({},this.chartMargins())}}),_translateCoordinatesToChart:function(a){var b=this._chartMargins(),c=this.chartWidth(),d=this.chartHeight(),e={top:b.top,right:b.left+c,bottom:b.top+d,left:b.left};if(a.x>=e.left&&a.x<=e.right&&a.y>=e.top&&a.y<=e.bottom){var f={x:a.x-e.left,y:a.y-e.top};return f}},_translateCoordinatesToPoints:function(b){var c=a.reduce(this.chartsById,function(c,d,e){if(d&&a.isFunction(d._translateCoordinatesToPoints)){var f=d._translateCoordinatesToPoints(b,{measurement:"x"});if(f&&a.isArray(f))return a.map(f,function(a){a.chartId=e,a.seriesKey=a.key,a.key=a.key?e+"-"+a.key:e}),c.concat(f);throw new Error("d3.chart.multi: Expected _translateCoordinatesToPoints to return an Array for chart with id: "+e)}return c},[],this);return c},_convertPointsToLabels:function(b){var c=a.map(b,function(b){b=a.clone(b);var c=this.chartsById[b.chartId];return b.labels=c&&a.isFunction(c._convertPointToLabel)?a.map(b.points,c._convertPointToLabel,c):[],delete b.points,b},this);return c},_getLabels:function(){var b=a.reduce(this.chartsById,function(b,c,d){if(c&&a.isFunction(c._getLabels)){var e=c._getLabels();if(e&&a.isArray(e))return a.map(e,function(a){a.chartId=d,a.seriesKey=a.key,a.key=a.key?d+"-"+a.key:d}),b.concat(e);throw new Error("d3.chart.multi: Expected _getLabels to return an Array for chart with id: "+d)}return b},[],this);return b}}),d3.chart("Base").extend("Component",{initialize:function(a){this.options(a||{}),this.redrawFor("options")},position:d("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),width:d("width",{defaultValue:function(){return b.dimensions(this.base).width}}),height:d("height",{defaultValue:function(){return b.dimensions(this.base).height}}),margins:d("margins",{get:function(b){var c=a.defaults({},b,{top:0,right:0,bottom:0,left:0}),d=this.width(),e=this.height();return{top:c.top*e,right:c.right*d,bottom:c.bottom*e,left:c.left*d}}}),skipLayout:!1,layoutWidth:function(){var a=this.margins();return this.width()+a.left+a.right},layoutHeight:function(){var a=this.margins();return this.height()+a.top+a.bottom},layoutPosition:function(){return this.position()},setLayout:function(a,c,d){var e=this.margins();this.base.attr("transform",b.transform.translate(a+e.left,c+e.top)),this.height(d&&d.height),this.width(d&&d.width)}})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){function c(b){if(!a.isFunction(b.getBBox))throw new Error("Only SVG elements with getBBox() are supported by Element helper");return this.element=b,this.selection=d3.select(b),this.refreshBounds(),this.removed=!1,this}function d(a){return c.call(this,a),this}function e(b,e,f){d.call(this,b),this.data=e,this.text=new c(this.selection.select("text").node()),this.rect=new c(this.selection.select("rect").node()),this.options=a.defaults({},f,{labelX:function(a){return a.x},labelY:function(a){return a.y},labelText:function(a){return a.value},padding:0,anchor:"middle"})}var f=(b.mixin,b.property),g=b.di;d3.chart("Chart").extend("Labels",{initialize:function(){this.layer("Labels",this.base.append("g").classed("chart-labels",!0),{dataBind:function(a){var b=this.chart(),c=this.selectAll("g").data(a,b.seriesKey);return c.enter().append("g").attr("class",b.seriesClass).attr("data-chart-id",b.seriesChartId).attr("data-series-key",b.seriesSeriesKey),c.exit().remove(),c.selectAll("g").data(b.seriesLabels,b.labelKey)},insert:function(){return this.chart().insertLabels(this)},events:{"merge:transition":function(){var a=this.chart();a.drawLabels(this),a.handleCollisions()&&(a.removeLabels(),a.groupLabels())},exit:function(){this.remove()}}})},transform:function(a){return this.extractLabels(a)},excludeFromLegend:!0,labels:f("labels",{defaultValue:[]}),handleCollisions:f("handleCollisions",{defaultValue:!0}),format:f("format",{type:"Function",set:function(b){return a.isString(b)?{override:d3.format(b)}:void 0}}),position:f("position",{defaultValue:"top",validate:function(b){return a.contains(["top","right","bottom","left"],b)}}),offset:f("offset",{defaultValue:0,get:function(a){return this.offsetByPosition(a,this.position())}}),padding:f("padding",{defaultValue:2}),anchor:f("anchor",{defaultValue:function(){var a=this.position();return"right"==a?"start":"left"==a?"end":"middle"},validate:function(b){return a.contains(["start","middle","end"],b)}}),labelKey:g(function(a,b){return b.key}),labelX:g(function(b,c){var d=a.defaults({},b.offset(),c.offset);return c.coordinates.x+d.x}),labelY:g(function(b,c){var d=a.defaults({},b.offset(),c.offset);return c.coordinates.y+d.y}),labelText:g(function(a,b){var c=a.format();return c?c(b.text):b.text}),labelStyle:g(function(c,d){var e=a.defaults({},d.style,c.options().style);return b.style(e)||null}),seriesKey:g(function(a,b,c){return b.key||c}),seriesChartId:g(function(a,b){return b.chartId}),seriesSeriesKey:g(function(a,b){return b.seriesKey}),seriesClass:g(function(b,c){var d=a.isUndefined(c.index)?"":"chart-index-"+c.index,e=c["class"]?" "+c["class"]:"";return a.compact(["chart-series",d,e]).join(" ")}),seriesLabels:g(function(a,b){return b.labels}),seriesData:g(function(){var a=b.getParentData(this);return!a.seriesKey&&this.parentNode?b.getParentData(this.parentNode):a}),insertLabels:function(a){var b=a.append("g").classed("chart-label",!0).attr("style",this.labelStyle);return b.append("rect").classed("chart-label-bg",!0),b.append("text").classed("chart-label-text",!0),b},drawLabels:function(b){var c=[];b.call(function(b){a.each(b,function(b,d){c.push([]),a.each(b,function(a){var b=new e(a,d3.select(a).data()[0],{labelX:this.labelX,labelY:this.labelY,labelText:this.labelText,padding:this.padding(),anchor:this.anchor()});c[d].push(b),b.draw()},this)},this)}.bind(this)),this.labels(c)},removeLabels:function(){a.each(this.labels(),function(b){var c;a.each(b,function(a){a.checkForOverlap(c,{compare:"LR"})?a.remove():c=a},this)},this)},groupLabels:function(){function b(b){a.each(b,function(d,e){a.each(b.slice(e+1),function(b){a.each(b,function(b){b.removed||a.each(d,function(a){!a.removed&&a.checkForOverlap(b)&&c(a,b)})})})})}function c(b,c){if(b.group&&c.group)a.each(c.group.labels,function(a){b.group.labels.push(a),a.group=b.group}),e(b.group);else if(b.group)d(c,b.group);else if(c.group)d(b,c.group);else{var f={labels:[]};d(b,f),d(c,f)}}function d(a,b){b.labels.push(a),a.group=b,a.selection.attr("data-group-index",b.index),e(b)}function e(b){var c=f(b.labels);a.each(b.labels,function(a,b){a.xCenter(c[b].xCenter).y(c[b].y)})}function f(b){var c=a.chain(b).map(function(a,b){return a.index=b,a}).sortBy(function(a){return a.y()}).reverse().value();return a.each(c,function(b,d){for(var e,f=a.first(c,d),g=f.length-1;g>=0;g--)if(b.checkForOverlap(f[g])){e=f[g];break}b.groupedY=e?e.y()-b.height():b.y()}),c=a.sortBy(c,"index"),positions=a.map(b,function(a,b){return delete a.index,{xCenter:c[b].xCenter(),y:c[b].groupedY}})}b(this.labels())},extractLabels:function(){return this.container&&a.isFunction(this.container._getLabels)?this.container._getLabels():[]},offsetByPosition:function(b,c){return a.isNumber(b)&&(b={top:{x:0,y:-b},right:{x:b,y:0},bottom:{x:0,y:b},left:{x:-b,y:0}}[c],b||(b={x:0,y:0})),b}}),d3.chart("Labels").extend("HoverLabels",{initialize:function(){a.bindAll(this,"onLabelsEnter","onLabelsMove","onLabelsLeave"),this.on("attached",function(){this.container.on("labels:enter:mouse",this.onLabelsEnter),this.container.on("labels:move:mouse",this.onLabelsMove),this.container.on("labels:leave:mouse",this.onLabelsLeave)}),this.on("detached",function(){this.container.off("labels:enter:mouse",this.onLabelsEnter),this.container.off("labels:move:mouse",this.onLabelsMove),this.container.off("labels:leave:mouse",this.onLabelsLeave)})},excludeFromLegend:!0,draw:function(){},_draw:function(a){d3.chart("Chart").prototype.draw.call(this,a)},onLabelsEnter:function(a){this._draw(a)},onLabelsMove:function(a){this._draw(a)},onLabelsLeave:function(){this._draw([])},extractLabels:function(a){return a}}),a.extend(c.prototype,{x:f("x",{set:function(a){this.selection.attr("x",a)}}),y:f("y",{set:function(a){this.selection.attr("y",a)}}),width:f("width",{set:function(a){this.selection.attr("width",a)}}),height:f("height",{set:function(a){this.selection.attr("height",a)}}),bounds:f("bounds",{get:function(){return{x:this.x(),y:this.y(),width:this.width(),height:this.height()}},set:function(a){this.x(a.x),this.y(a.y),this.width(a.width),this.height(a.height)}}),xCenter:f("xCenter",{get:function(){return this.x()+this.width()/2},set:function(a){this.x(a-this.width()/2)}}),getBBox:function(){return this.element.getBBox()},refreshBounds:function(){return this.bounds(this.getBBox()),this},checkForOverlap:function(a,b){function c(a){return{left:a.x,right:a.x+a.width,top:a.y,bottom:a.y+a.height}}if(!a||!a.bounds)return!1;var d=c(this.bounds()),e=c(a.bounds()),f=d.left==e.left&&d.right==e.right,g=d.top==e.top&&d.bottom==e.bottom,h=e.left<d.left&&e.right>d.right,i=e.bottom<d.bottom&&e.top>d.top,j=e.left>d.left&&e.left<d.right||e.right>d.left&&e.right<d.right||f||h,k=e.top>d.top&&e.top<d.bottom||e.bottom>d.top&&e.bottom<d.bottom||g||i;return b&&"LR"==b.compare?j:b&&"TB"==b.compare?k:j&&k}}),a.extend(d.prototype,c.prototype,{getBBox:function(){var b=this.element.getBBox(),c=this.selection.attr("transform");if(c&&a.indexOf(c,"translate")){var d=c.split(")"),e={x:0,y:0};a.each(d,function(b){a.indexOf(b,"translate")&&(xy=b.replace("translate","").replace("(","").split(","),xy.length>=2&&(e.x=+xy[0].trim(),e.y=+xy[1].trim()))},this),b.x+=e.x,b.y+=e.y}return b},x:f("x",{set:function(a){this.selection.attr("transform",b.transform.translate(a,this.y()))}}),y:f("y",{set:function(a){this.selection.attr("transform",b.transform.translate(this.x(),a))}})}),a.extend(e.prototype,d.prototype,{draw:function(){this.text.x(this.options.labelX).y(this.options.labelY).selection.attr("text-anchor","start").text(this.options.labelText);var a=this.text.refreshBounds().bounds(),b={x:-1,y:0,width:3,height:0},c=this.data.padding||this.options.padding,d=this.data.anchor||this.options.anchor,e={x:a.x-a.width/2+b.x-c,y:a.y+b.y-2*c,width:a.width+b.width+2*c,height:a.height+b.height+2*c};return"start"==d?e.x+=e.width/2:"end"==d&&(e.x-=e.width/2),this.x(e.x).y(e.y),this.rect.bounds({x:0,y:0,width:e.width,height:e.height}),this.text.x(this.data.padding||0).y(a.height),this.refreshBounds(),this
},remove:function(){return this.removed=!0,this.selection.remove(),this}})}(d3,_,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){var c=a.mixin,d=a.property,e=a.di;d3.chart("SeriesChart").extend("Bars",c(b.ValuesSeries,b.LabelsSeries,{initialize:function(){this.seriesLayer("Bars",this.base.append("g").classed("chart-bars",!0),{dataBind:function(a){var b=this.chart();return this.selectAll("rect").data(a,b.keyValue)},insert:function(){var a=this.chart();return this.append("rect").classed("chart-bar",!0).attr("style",a.itemStyle)},events:{enter:function(){var a=this.chart();a.invertedXY()?this.attr("x",a.x0).attr("width",0):this.attr("y",a.y0).attr("height",0)},merge:function(){var a=this.chart();a.invertedXY()?this.attr("y",a.barY).attr("height",a.itemWidth):this.attr("x",a.barX).attr("width",a.itemWidth)},"merge:transition":function(){var a=this.chart();a.invertedXY()?this.attr("x",a.barX).attr("width",a.barHeight):this.attr("y",a.barY).attr("height",a.barHeight)},exit:function(){this.remove()}}})},barHeight:e(function(a,b,c){if(a.invertedXY())return Math.abs(a.x.call(this,b,c)-a.x0.call(this,b,c));var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c));return d>0?d-a.barOffset():0}),barX:e(function(a,b,c){if(a.invertedXY()){var d=a.x.call(this,b,c),e=a.x0();return e>d?d:e+a.barOffset()}return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){if(a.invertedXY())return a.y.call(this,b,c)-a.itemWidth.call(this,b,c)/2;var d=a.y.call(this,b,c),e=a.y0();return e>d?d:e+a.barOffset()}),displayAdjacent:d("displayAdjacent",{defaultValue:!0}),barOffset:function(){this.__axis||(this.__axis=d3.select(this.base[0][0].parentNode).select(this.invertedXY()?'[data-id="axis.y"] .domain':'[data-id="axis.x"] .domain'));var a=this.__axis[0][0]&&parseInt(this.__axis.style("stroke-width"))||0;return a/2},insertSwatch:function(){return this.append("rect").attr("x",0).attr("y",0).attr("width",20).attr("height",20).attr("class","chart-bar")}})),d3.chart("Bars").extend("StackedBars",{transform:function(a){return this.barPositions=[],a},barHeight:e(function(a,b,c){if(a.invertedXY())return Math.abs(a.x.call(this,b,c)-a.x0.call(this,b,c));var d=Math.abs(a.y0.call(this,b,c)-a.y.call(this,b,c)),e=0===a.seriesIndex.call(this,b,c)?a.barOffset():0;return d>0?d-e:0}),barX:e(function(a,b,c){if(a.invertedXY()){var d=a.x.call(this,b,c),e=a.x0();if(e>d)return;a.barPositions.length<=c&&a.barPositions.push(0);var f=a.barPositions[c];a.barPositions[c]=f+(d-e);var g=0===a.seriesIndex.call(this,b,c)?a.barOffset():0;return f+g}return a.x.call(this,b,c)-a.itemWidth.call(this,b,c)/2}),barY:e(function(a,b,c){if(a.invertedXY())return a.y.call(this,b,c)-a.itemWidth.call(this,b,c)/2;var d=a.y.call(this,b,c),e=a.y0();if(!(d>e)){a.barPositions.length<=c&&a.barPositions.push(0);var f=a.barPositions[c]||e,g=f-(e-d);return a.barPositions[c]=g,g}}),displayAdjacent:d("displayAdjacent",{defaultValue:!1})})}(d3,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("SeriesChart").extend("Line",c(b.XYSeries,b.LabelsSeries,{initialize:function(){this.seriesLayer("Lines",this.base.append("g").classed("chart-lines",!0),{dataBind:function(){var a=this.chart(),b={};return _.each(a.data(),function(c){b[c.seriesIndex]=a.createLine(c)}),a.lines(b),this.selectAll("path").data(function(b,c){return[a.data()[c]]},a.seriesKey)},insert:function(){var a=this.chart();return this.append("path").classed("chart-line",!0).attr("style",a.itemStyle)},events:{"merge:transition":function(){var a=this.chart(),b=a.lines();this.attr("d",function(c,d){return b[a.seriesIndex.call(this,c,d)](a.seriesValues.call(this,c,d))}).attr("style",a.itemStyle)}}})},lines:d("lines",{defaultValue:{}}),createLine:function(a){var b=d3.svg.line().x(this.x).y(this.y),c=a.interpolate||this.options().interpolate;return c&&b.interpolate(c),b},insertSwatch:function(){return this.append("line").attr("x1",0).attr("y1",10).attr("x2",20).attr("y2",10).attr("class","chart-line")}})),d3.chart("Line").extend("LineValues",b.ValuesSeries)}(d3,d3.chart.helpers,d3.chart.extensions),function(d3,a){{var b=(a.mixin,a.property);a.di}d3.chart("Component").extend("Title",{initialize:function(){this.redrawFor("title","rotation"),this.layer("Title",this.base.append("g").classed("chart-title",!0),{dataBind:function(){return this.selectAll("text").data([0])},insert:function(){return this.append("text")},events:{merge:function(){var a=this.chart();this.attr("transform",a.transformation()).attr("style",a.style()).attr("alignment-baseline","middle").attr("text-anchor","middle").attr("class",a.options()["class"]).text(a.text())}}})},text:b("text",{get:function(){return this.options().text}}),rotation:b("rotation",{defaultValue:function(){var a={right:90,left:-90};return a[this.position()]||0}}),transformation:function(){var b=a.transform.translate(this.width()/2,this.height()/2),c=a.transform.rotate(this.rotation());return b+c}})}(d3,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){{var c=a.mixin,d=a.property;a.di}d3.chart("Component").extend("Axis",c(b.XYSeries,{initialize:function(){function b(){if(this.options().scale){var b=this.isXAxis()?"xScale":"yScale";this[b](a.createScaleFromOptions(this.options().scale))}}this.on("change:options",b.bind(this)),b.call(this),this.axis=d3.svg.axis(),this.axisLayer=this.base.append("g").attr("class","chart-axis"),this.options().display?this.layer("Axis",this.axisLayer,{dataBind:function(){return this.selectAll("g").data([0])},insert:function(){return this.append("g")},events:{merge:function(){var a=this.chart();a._setupAxis(),this.attr("transform",a.translation()).call(a.axis)}}}):this.skipLayout=!0},position:d("position",{defaultValue:"bottom",validate:function(a){return _.contains(["top","right","bottom","left","x0","y0"],a)}}),translation:d("translation",{defaultValue:function(){var a={top:{x:0,y:0},right:{x:this.width(),y:0},bottom:{x:0,y:this.height()},left:{x:0,y:0},x0:{x:this.x0(),y:0},y0:{x:0,y:this.y0()}};return a[this.position()]},get:function(b){return a.translate(b)}}),orient:d("orient",{defaultValue:function(){var a=this.position();return"x0"==a?a="left":"y0"==a&&(a="bottom"),a}}),orientation:d("orientation",{validate:function(a){return _.contains(["horizontal","vertical"],a)},defaultValue:function(){var a={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical",x0:"vertical",y0:"horizontal"};return a[this.position()]}}),type:d("type"),ticks:d("ticks",{type:"Function"}),tickValues:d("tickValues",{type:"Function"}),tickSize:d("tickSize",{type:"Function"}),innerTickSize:d("innerTickSize",{type:"Function"}),outerTickSize:d("outerTickSize",{type:"Function"}),tickPadding:d("tickPadding",{type:"Function"}),tickFormat:d("tickFormat",{type:"Function"}),layoutHeight:function(){return this._labelOverhang().height},layoutWidth:function(){return this._labelOverhang().width},layoutPosition:function(){return"x0"==this.position()?"bottom":"y0"==this.position()?"right":this.position()},setLayout:function(){},isXAxis:function(){return"x"==this.type()},isYAxis:function(){return"y"==this.type()},_setupAxis:function(){var a=this.isXAxis()?this._xScale():this._yScale();this.axis.scale(a);var b=["orient","ticks","tickValues","tickSize","innerTickSize","outerTickSize","tickPadding","tickFormat"],c=["tickValues"];_.each(b,function(a){var b=this[a]&&this[a]();_.isUndefined(b)||(_.isArray(b)&&!_.contains(c,a)?this.axis[a].apply(this.axis,b):this.axis[a](b))},this)},_labelOverhang:function(){var a={width:[0],height:[0]},b=this.orientation();return this.axisLayer.selectAll(".tick").each(function(){"horizontal"==b?a.height.push(this.getBBox().height):a.width.push(this.getBBox().width)}),{width:_.max(a.width),height:_.max(a.height)}}})),d3.chart("Axis").extend("AxisValues",b.ValuesSeries)}(d3,d3.chart.helpers,d3.chart.extensions),function(d3,a){var b=(a.mixin,a.property),c=a.di;d3.chart("Component").extend("Legend",{initialize:function(){this.legend=this.base.append("g").classed("chart-legend",!0),this.options().display?this.layer("Legend",this.legend,{dataBind:function(a){var b=this.chart();return this.selectAll("g").data(a,b.dataKey.bind(b))},insert:function(){var b=this.chart(),c=this.append("g").attr("class",b.dataGroupClass);return c.append("g").attr("width",20).attr("height",20).attr("class","chart-legend-swatch"),c.append("text").attr("class","chart-legend-label chart-label").attr("transform",a.translate(25,0)),c},events:{merge:function(){var b=this.chart();this.select("g").each(b.createSwatch),this.select("text").text(b.dataValue).attr("alignment-baseline","before-edge");var c={top:"horizontal",right:"vertical",bottom:"horizontal",left:"vertical"};this.call(a.stack.bind(this,{direction:c[b.position()],origin:"top",padding:5}))}}}):this.skipLayout=!0},isLegend:!0,transform:function(a){var b=d3.chart("Multi").prototype.extractData,c=_.reduce(this.options().charts,function(c,d){if(d.excludeFromLegend)return c;var e=_.map(b(d,a),function(a,b){return{chart:d,series:a,seriesIndex:b}});return c.concat(e)},[],this);return c},dataKey:c(function(a,b){return b.chart.id+"."+b.series.name}),dataValue:c(function(a,b){return b.series.name}),dataGroupClass:c(function(){return"chart-legend-group"}),dataSeriesClass:c(function(a,b){return"chart-series chart-index-"+(b.seriesIndex||0)}),dataClass:c(function(a,b,c){var d=[a.dataSeriesClass.call(this,b,c)];return b.chart.options()["class"]&&d.push(b.chart.options()["class"]),b.series["class"]&&d.push(b.series["class"]),d.join(" ")||null}),dataStyle:c(function(b,c){var d=_.defaults({},c.series.style,c.chart.options().style);return a.style(d)||null}),createSwatch:c(function(a,b,c){var d=d3.select(this);d.empty(),d.attr("class",a.dataClass);var e;b&&b.chart&&_.isFunction(b.chart.insertSwatch)?(d.chart=function(){return a},e=b.chart.insertSwatch.call(d)):e=d.append("circle").attr("cx",10).attr("cy",10).attr("r",10).attr("class","chart-swatch"),e&&_.isFunction(e.attr)&&e.attr("style",a.dataStyle.call(this,b,c))})}),d3.chart("Legend").extend("InsetLegend",{initialize:function(){this._positionLegend()},position:b("position",{defaultValue:{x:10,y:10},set:function(a,b){return a=a&&_.isObject(a)?a:{},a=_.defaults(a,b||{},{x:0,y:0}),{override:a,after:function(){this._positionLegend()}}}}),skipLayout:!0,_positionLegend:function(){if(this.legend){var b=this.position();this.legend.attr("transform",a.translate(b.x,b.y))}}})}(d3,d3.chart.helpers,d3.chart.extensions),function(d3,a,b){var c=b.property;d3.chart("Container").extend("Multi",{initialize:function(){this.redrawFor("title","charts","axes","legend")},options:c("options",{defaultValue:{},set:function(b){return b?(this.type(b.type||"XY",{silent:!0}),this.invertedXY(b.invertedXY||!1,{silent:!0}),this.axes(b.axes,{silent:!0}),this.charts(b.charts,{silent:!0}),this.components(b.components,{silent:!0}),this.legend(b.legend,{silent:!0}),this.title(b.title,{silent:!0}),{override:a.clone(b)}):void 0}}),type:c("type",{defaultValue:"XY"}),invertedXY:c("invertedXY",{defaultValue:!1}),title:c("title",{set:function(c,d){var e=!1;if(!c||a.isEmpty(c))return this.detachComponent("title"),{override:void 0};if(a.isString(c)&&(c={text:c}),c=a.defaults({},c,d3.chart("Multi").defaults.title,{invertedXY:this.invertedXY()}),d)a.isEqual(d.options(),c)||(d.options(c),e=!0);else{var f=b.resolveChart(c.type,"Title",this.type());d=new f(this.componentLayer({zIndex:b.zIndex.title}),c),this.attachComponent("title",d),e=!0}return{override:d,changed:e}}}),charts:c("charts",{set:function(c,d){c=c||{},d=d||{};var e=a.difference(a.keys(d),a.keys(c)),f=e.length>0;return a.each(e,function(a){this.detachChart(a),delete d[a]},this),a.each(c,function(c,e){var g=d[e];if(c=a.defaults({},c,d3.chart("Multi").defaults.charts,{invertedXY:this.invertedXY()}),g)a.isEqual(g.options(),c)||(g.options(c),f=!0);else{var h=b.resolveChart(c.type,"Chart",this.type());g=new h(this.chartLayer(),c),this.attachChart(e,g),d[e]=g,f=!0}},this),{override:d,changed:f,after:function(){this.bindChartScales()}}},defaultValue:{}}),axes:c("axes",{set:function(c,d){c=c||{},d=d||{};var e=a.uniq(["x","y"].concat(a.keys(c))),f=a.difference(a.keys(d),e),g=f.length>0;return a.each(f,function(a){this.detachComponent("axis."+a),this.detachComponent("axis_title."+a),delete d[a]},this),a.each(e,function(e){var f=d[e],h={notInverted:{x:"bottom",y:"left",secondaryX:"top",secondaryY:"right"},inverted:{x:"left",y:"bottom",secondaryX:"right",secondaryY:"top"}},i={position:h[this.invertedXY()?"inverted":"notInverted"][e],type:"y"==e||"secondaryY"==e?"y":"x"};if(i=c[e]===!1?a.defaults({display:!1},i,d3.chart("Multi").defaults.axes,{invertedXY:this.invertedXY()}):a.defaults({},c[e],i,d3.chart("Multi").defaults.axes,{invertedXY:this.invertedXY()}),"x"!=e&&"y"!=e&&!i.dataKey)throw new Error("d3.chart.Multi: dataKey(s) are required for axes other than x and y");if(f)a.isEqual(f.options(),i)||(g=!0),f.options(i);else{var j=b.resolveChart(i.type,"Axis",this.type());f=new j(this.chartLayer({zIndex:b.zIndex.axis}),i),this.attachComponent("axis."+e,f),d[e]=f,g=!0}if(i.title){var k="axis_title."+e,l=this.componentsById[k],m=a.isString(i.title)?{text:i.title}:i.title;if(m=a.defaults({},m,{position:i.position,"class":"chart-title-axis"}),l)l.options(m);else{var n=b.resolveChart(m.type,"Title",this.type());l=new n(this.componentLayer({zIndex:b.zIndex.title}),m),this.attachComponent(k,l)}}},this),a.each(["x","y"],function(b){var c=d[b];if(!c.options().dataKey){var e=[];a.each(d,function(c){if(("x"!=b||c.isXAxis())&&("y"!=b||c.isYAxis())){var d=c.options().dataKey;d&&(e=e.concat(a.isArray(d)?d:[d]))}},this),a.isEqual(c.options().filterKeys,e)||(g=!0),c.options().filterKeys=e}},this),{override:d,changed:g,after:function(){this.bindChartScales()}}},defaultValue:{}}),legend:c("legend",{set:function(c,d){c=c===!1?{display:!1}:c||{},c=a.defaults({},c,d3.chart("Multi").defaults.legend);var e=!1;if(c.dataKey){var f=a.isArray(c.dataKey)?c.dataKey:[c.dataKey];c.charts=a.filter(this.charts(),function(b){return a.contains(f,b.options().dataKey)})}else c.charts=this.charts();if(d&&d.options().type!=c.type&&(this.detachComponent("legend"),d=void 0),d)a.isEqual(d.options(),c)||(e=!0),d.options(c);else{var g=b.resolveChart(c.type,"Legend",this.type()),h="Inset"==c.type||"InsetLegend"==c.type?this.chartLayer({zIndex:b.zIndex.legend}):this.componentLayer({zIndex:b.zIndex.legend});d=new g(h,c),this.attachComponent("legend",d),e=!0}return{override:d,changed:e}}}),components:c("components",{set:function(c,d){c=c||{},d=d||{};var e=a.difference(a.keys(d),a.keys(c)),f=e.length>0;return a.each(e,function(a){this.detachComponent(a),delete d[a]},this),a.each(c,function(c,e){var g=d[e];if(c=a.defaults({},c),g)a.isEqual(g.options(),c)||(g.options(c),charted=!0);else{var h=b.resolveChart(c.type,"Component",this.type()),i=h.layer&&"chart"==h.layer?this.chartLayer():this.componentLayer();g=new h(i,c),this.attachComponent(e,g),d[e]=g,f=!0}},this),{override:d,changed:f,after:function(b){a.each(b,function(b){a.isFunction(b.xScale)&&a.isFunction(b.yScale)&&(b.xScale=this.axes().x._xScale.bind(this.axes().x),b.yScale=this.axes().y._yScale.bind(this.axes().y))},this)}}}}),demux:function(a,b){var c=this.chartsById[a]||this.componentsById[a];return c?this.extractData(c,b):b},extractData:function(b,c){var d=b.options().dataKey,e=b.options().filterKeys;if(b&&b.isLegend)return c;if(d||e){var f=a.isArray(d)?d:d?[d]:[];e=a.isArray(e)?e:e?[e]:[];var g=a.reduce(c,function(b,c,d){var g=a.contains(e,d),h=a.contains(f,d),i=!f.length;return!h&&!i||g?b:b.concat(c)},[]);return g}return c},bindChartScales:function(){a.each(this.charts(),function(a){a.xScale=this.getScale(a.options().dataKey,"x"),a.yScale=this.getScale(a.options().dataKey,"y")},this)},getScale:function(b,c){var d=a.find(this.axes(),function(d){if("x"==c&&!d.isXAxis()||"y"==c&&!d.isYAxis())return!1;var e=d.options().dataKey;return a.isArray(e)?a.contains(e,b):e==b}),e=d||this.axes()[c],f="x"==c?"_xScale":"_yScale";return e[f].bind(e)}},{defaults:{charts:{type:"Line"},axes:{display:!0},legend:{display:!0,position:"right"},title:{position:"top","class":"chart-title-main"}}})}(d3,_,d3.chart.helpers,d3.chart.extensions);
//# sourceMappingURL=d3.chart.multi.min.map