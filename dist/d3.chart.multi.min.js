/*! d3.chart.multi - v0.10.0
 * https://github.com/CSNW/d3.chart.multi
 * License: MIT
 */

!function(d3,a){function b(a,b){b=b||{};var d=b.prop_key||"__properties",e=function(f){function g(){var d=c(i[a],e.default_value);return utils.isFunction(d)&&"Function"!=b.type&&(d=d.call(this)),utils.isFunction(b.get)?b.get.call(j,d):d}function h(c){if(utils.isFunction(b.validate)&&!b.validate.call(this,c))throw new Error("Invalid value for "+a+": "+JSON.stringify(c));if(e.previous=i[a],i[a]=c,utils.isFunction(b.set)){var d=b.set.call(j,c,e.previous);d&&utils.has(d,"override")&&(i[a]=d.override),d&&utils.isFunction(d.after)&&d.after.call(j,i[a])}return this}var i=this[d]=this[d]||{},j=(i[a],c(e.context,this));return arguments.length?h.call(this,f):g.call(this)};return e.is_property=!0,e.set_from_options=c(b.set_from_options,!0),e.default_value=b.default_value,e.context=b.context,e}function c(a,b){return utils.isUndefined(a)?b:a}function d(a){var b=a&&a.length&&a[0]&&a[0].length&&a[0][0],c=b?"svg"==b.nodeName:!1,d={width:b&&b.clientWidth,height:b&&b.clientHeight};if(c&&(!b.clientWidth||!b.clientHeight)&&"undefined"!=typeof window&&window.getComputedStyle){var e=window.getComputedStyle(b);d.height=parseFloat(e.height)-parseFloat(e.borderTopWidth)-parseFloat(e.borderBottomWidth),d.width=parseFloat(e.width)-parseFloat(e.borderLeftWidth)-parseFloat(e.borderRightWidth)}if(d.width&&d.height)return d;var f={width:a&&a.attr&&parseFloat(a.attr("width")),height:a&&a.attr&&parseFloat(a.attr("height"))};if(c)return{width:null!=d.width?d.width:f.width||0,height:null!=d.height?d.height:f.height||0};var g={width:0,height:0};try{g=b&&"function"==typeof b.getBBox&&b.getBBox()}catch(h){}return{width:utils.max([d.width,f.width||g.width])||0,height:utils.max([d.height,f.height||g.height])||0}}function e(a,b){return utils.isObject(a)&&(b=a.y,a=a.x),"translate("+(a||0)+", "+(b||0)+")"}function f(a,b){var c="rotate("+(a||0);return b&&(c+=" "+(b.x||0)+","+(b.y||0)),c+=")"}function g(a){var b=utils.first(a);return b&&utils.isObject(b)&&utils.isArray(b.values)}function h(a,b){var c=function(a){return a&&d3.extent(a,b)[1]};return g(a)?utils.reduce(a,function(a,b){if(b&&utils.isArray(b.values)){var d=c(b.values);return d>a?d:a}return a},-1/0):c(a)}function i(a,b){var c=function(a){return a&&d3.extent(a,b)[0]};return g(a)?utils.reduce(a,function(a,b){if(b&&utils.isArray(b.values)){var d=c(b.values);return a>d?d:a}return a},1/0):c(a)}function j(a){if(a=a||{},utils.isFunction(a))return a;var b;if(b=a.type&&"time"==a.type?d3.time.scale():a.type&&d3.scale[a.type]?d3.scale[a.type]():d3.scale.linear(),utils.each(a,function(a,c){b[c]&&("range"==c||"domain"==c?b[c](a):"type"!=c&&"data"!=c&&"key"!=c&&b[c].apply(b,a))}),!a.domain&&a.data&&a.key){var c=function(b){return b[a.key]};if("ordinal"==a.type){var d,e=function(a){return utils.map(a,c)};d=g(a.data)?utils.flatten(utils.map(a.data,function(a){return a&&utils.isArray(a.values)?e(a.values):void 0})):e(a.data),b.domain(utils.uniq(d))}else{var f=i(a.data,c);b.domain([0>f?f:0,h(a.data,c)])}}return b}function k(a){return a?(a=utils.map(a,function(a,b){return b+": "+a}),a=a.join("; "),a?a+";":""):""}function l(a){var b=function(b,c,d){return a.call(this,void 0,b,c,d)};return b._is_di=!0,b.original=a,b}function m(a,b){return function(c,d,e){return(a.original||a).call(this,b,c,d,e)}}function n(a){for(var b in a)a[b]&&a[b]._is_di&&(a[b]=m(a[b],a))}function o(a){if(a._parent_data)return a._parent_data;var b=a&&a.parentNode;if(b){var c=d3.select(b).data();return c&&c[0]}}function p(a){a=utils.isArray(a)?a:utils.toArray(arguments);var b=utils.extend.apply(null,[{}].concat(a));return delete b.constructor,b.initialize&&(b.initialize=function(){var b=utils.toArray(arguments);utils.each(a,function(a){a.initialize&&a.initialize.apply(this,b)},this)}),b.transform&&(b.transform=function(b){return utils.reduceRight(a,function(a,b){return b&&b.transform?b.transform.call(this,a):a},b,this)}),b}utils={chain:a.chain,clone:a.clone,contains:a.contains,compact:a.compact,difference:a.difference,defaults:a.defaults,each:a.each,extend:a.extend,flatten:a.flatten,first:a.first,has:a.has,isArray:a.isArray,isBoolean:a.isBoolean,isFunction:a.isFunction,isObject:a.isObject,isNumber:a.isNumber,isString:a.isString,isUndefined:a.isUndefined,keys:a.keys,map:a.map,max:a.max,reduce:a.reduce,reduceRight:a.reduceRight,reverse:a.reverse,sortBy:a.sortBy,throttle:a.throttle,toArray:a.toArray,uniq:a.uniq,value:a.value},d3.chart.helpers=utils.extend({},d3.chart.helpers,{utils:utils,property:b,valueOrDefault:c,dimensions:d,translate:e,rotate:f,isSeriesData:g,max:h,min:i,createScale:j,style:k,di:l,bindDi:m,bindAllDi:n,getParentData:o,mixin:p})}(d3,_),function(d3,a){var b=a.utils.each,c=a.property;d3.chart("Base",{initialize:function(){a.bindAllDi(this)},data:c("data"),options:c("options",{default_value:{},set:function(a){b(a,function(a,b){this[b]&&this[b].is_property&&this[b].set_from_options&&this[b](a)},this)}}),style:c("style",{get:function(b){return a.style(b)||null}}),width:function(){return a.dimensions(this.base).width},height:function(){return a.dimensions(this.base).height},transform:function(a){return a=a||[],this.data(a),a},draw:function(a){this.trigger("before:draw",a),d3.chart().prototype.draw.apply(this,arguments),this.trigger("draw",a)}})}(d3,d3.chart.helpers),function(d3){d3.chart("Base").extend("Chart",{initialize:function(a){this.options(a||{})}},{z_index:100})}(d3,d3.chart.helpers),function(d3,a){var b=a.utils,c=a.property;d3.chart("Base").extend("Component",{initialize:function(a){this.options(a||{})},position:c("position",{default_value:"top",validate:function(a){return b.contains(["top","right","bottom","left"],a)}}),width:c("width",{default_value:function(){return a.dimensions(this.base).width}}),height:c("height",{default_value:function(){return a.dimensions(this.base).height}}),margins:c("margins",{get:function(a){var c=b.defaults({},a,{top:0,right:0,bottom:0,left:0}),d=this.width(),e=this.height();return{top:c.top*e,right:c.right*d,bottom:c.bottom*e,left:c.left*d}}}),skip_layout:!1,prepareLayout:function(a){this.draw(a)},getLayout:function(a){this.prepareLayout(a);var b=this.margins();return{position:this.position(),width:this.width()+b.left+b.right,height:this.height()+b.top+b.bottom}},setLayout:function(b,c,d){var e=this.margins();this.base.attr("transform",a.translate(b+e.left,c+e.top)),this.height(d&&d.height),this.width(d&&d.width)}},{z_index:50})}(d3,d3.chart.helpers),function(d3,a){var b=a.utils,c=a.property;d3.chart("Base").extend("Multi",{initialize:function(a){this.transform=function(a){return this.rawData(a),a},a&&this.options(a),this.base.classed("chart-multi",!0),this.attachHoverListeners()},options:c("options",{default_value:function(){return{}},type:"Function",set:function(a){return this._config=null,b.isFunction(a)?void 0:{override:function(){return a}}}}),rawData:c("rawData"),margins:c("margins",{default_value:{top:0,right:0,bottom:0,left:0},set:function(a){return{override:b.defaults({},a,{top:0,right:0,bottom:0,left:0})}}}),chartPosition:c("chartPosition",{default_value:{top:0,right:0,bottom:0,left:0},set:function(a){return{override:b.defaults({},a,{top:0,right:0,bottom:0,left:0})}},get:function(a){return a.width=this._width()-a.right-a.left,a.height=this._height()-a.bottom-a.top,a}}),width:c("width"),height:c("height"),_width:function(){var a=this.width();return null!=a?a:d3.chart("Base").prototype.width.call(this)},_height:function(){var a=this.height();return null!=a?a:d3.chart("Base").prototype.height.call(this)},charts:c("charts",{set:function(a,c){a=a||{},c=c||{};var d=b.difference(b.keys(c),b.keys(a));return b.each(d,function(a){this.detach(a,c[a]),delete c[a]},this),b.each(a,function(a,b){var d=c[b];if(a instanceof d3.chart())d&&this.detach(b,d),this.attach(b,a),c[b]=a;else if(d&&d.type!=a.type&&(this.detach(b,d),d=void 0),d)d.options(a);else{var e=d3.chart(a.type);if(!e)throw new Error("No registered d3.chart found for "+a.type);var f=this.chartLayer();d=new e(f,a),d.type=a.type,this.attach(b,d),c[b]=d}},this),{override:c}},default_value:{}}),components:c("components",{set:function(a,c){a=a||{},c=c||{};var d=b.difference(b.keys(c),b.keys(a));return b.each(d,function(a){this.detach(a,c[a]),delete c[a]},this),b.each(a,function(a,b){var d=c[b];if(a instanceof d3.chart())d&&this.detach(b,d),this.attach(b,a),c[b]=a;else if(d&&d.type!=a.type&&(this.detach(b,d),d=void 0),d)d.options(a);else{var e=d3.chart(a.type);if(!e)throw new Error("No registered d3.chart found for "+a.type);var f={z_index:e.z_index},g="chart"==e.layer_type?this.chartLayer(f):this.componentLayer(f);d=new e(g,a),d.type=a.type,this.attach(b,d),c[b]=d}},this),{override:c}},default_value:{}}),draw:function(a){this._config||(a=a.original||a,this._config=this._prepareConfig(a),b.each(this._config,function(a,b){this[b]&&this[b].is_property&&this[b].set_from_options&&this[b](a)},this)),a={original:a,config:this._config.data},this.base.attr("width",this.width()||null).attr("height",this.height()||null),this.layout(a),d3.chart().prototype.draw.call(this,a)},redraw:function(){this.rawData()&&this.draw(this.rawData().original)},demux:function(a,b){return b&&b.config&&b.original?this.charts()[a]&&b.config.charts[a]?b.config.charts[a]:this.components()[a]&&b.config.components[a]?b.config.components[a]:b.original:b},chartLayer:function(a){return a=b.defaults({},a,{z_index:d3.chart("Chart").z_index}),this.base.append("g").attr("class","chart-layer").attr("data-zIndex",a.z_index)},componentLayer:function(a){return a=b.defaults({},a,{z_index:d3.chart("Component").z_index}),this.base.append("g").attr("class","chart-component-layer").attr("data-zIndex",a.z_index)},layout:function(a){this._positionChartLayers();var c=this._extractLayout(a),d=b.extend({},this.margins());b.each(c,function(a,c){b.each(a,function(a){d[c]+=a.offset||0})}),this.chartPosition(d),this._positionLayers(c)},attachHoverListeners:function(){function a(a,b){var c=a[0],d=a[1],e=c-b.left,f=d-b.top;return c>b.left+b.width?e=b.left+b.width:c<b.left&&(e=0),d>b.top+b.height?f=b.top+b.height:d<b.top&&(f=0),{container:{x:c,y:d},chart:{x:e,y:f}}}var c,d,e=this.trigger.bind(this),f=this.chartPosition.bind(this),g=b.throttle(function(a){c&&e("move:mouse",a)},50);this.base.on("mouseenter",function(){c=!0,d=f(),e("enter:mouse",a(d3.mouse(this),d))}),this.base.on("mousemove",function(){g(a(d3.mouse(this),d))}),this.base.on("mouseleave",function(){c=!1,e("leave:mouse")})},_prepareConfig:function(a){var c=this.options()(a);return c=b.defaults({},c,{charts:{},components:{}}),c.data={charts:{},components:{}},b.each(c.charts,function(a,d){a.data&&(c.data.charts[d]=a.data,a=b.clone(a),delete a.data,c.charts[d]=a)}),b.each(c.components,function(a,d){a.data&&(c.data.components[d]=a.data,a=b.clone(a),delete a.data,c.components[d]=a)}),c},attach:function(a,c){c.id=a,c.base.attr("data-id",a),c.container=this,d3.chart("Base").prototype.attach.call(this,a,c),c&&b.isFunction(c.trigger)&&c.trigger("attach")},detach:function(a,c){c.base.remove(),delete this._attached[a],c&&b.isFunction(c.trigger)&&c.trigger("detach")},_positionLayers:function(a){this._positionChartLayers(),this._positionComponents(a),this._positionByZIndex()},_positionChartLayers:function(){var b=this.chartPosition();this.base.selectAll(".chart-layer").attr("transform",a.translate(b.left,b.top)).attr("width",b.width).attr("height",b.height)},_positionComponents:function(a){function c(a,c,d,e){a&&b.isFunction(a.setLayout)&&a.setLayout(c,d,e)}var d=this.chartPosition(),e=this._width(),f=this._height();b.reduce(a.top,function(a,b){var e=a-b.offset;return c(b.component,d.left,e,{width:d.width}),e},d.top),b.reduce(a.right,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,h,d.top,{height:d.height}),h},e-d.right),b.reduce(a.bottom,function(a,b,e,f){var g=f[e-1]||{offset:0},h=a+g.offset;return c(b.component,d.left,h,{width:d.width}),h},f-d.bottom),b.reduce(a.left,function(a,b){var e=a-b.offset;return c(b.component,e,d.top,{height:d.height}),e},d.left)},_positionByZIndex:function(){var a=this.base.selectAll(".chart-layer, .chart-component-layer")[0];a=b.sortBy(a,function(a){return parseInt(d3.select(a).attr("data-zIndex"))||0}),b.each(a,function(a){a.parentNode.appendChild(a)},this)},_extractLayout:function(a){var c={top:[],right:[],bottom:[],left:[]};return b.each(this.components(),function(d,e){if(!d.skip_layout){var f=d.getLayout(this.demux(e,a)),g=f&&f.position;b.contains(["top","right","bottom","left"],g)&&c[g].push({offset:"top"==g||"bottom"==g?f.height:f.width,component:d})}},this),c}})}(d3,d3.chart.helpers);
//# sourceMappingURL=d3.chart.multi.min.js.map