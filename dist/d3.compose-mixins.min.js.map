{"version":3,"sources":["d3.compose-mixins.js"],"names":["global","factory","exports","module","require","define","amd","d3c","d3","d3_chart","this","_extend","target","extensions","undefined_only","i","length","key","contains","arr","item","indexOf","compact","filter","difference","a","b","value","defaults","slice","call","arguments","extend","flatten","reduce","memo","concat","find","fn","context","first","n","Array","prototype","isBoolean","obj","isObject","type","isNumber","toString","isString","isUndefined","objectEach","keys","Object","objectFind","pluck","objs","map","uniq","result","push","inherits","Child","Parent","create","constructor","enumerable","writeable","configurable","setPrototypeOf","__proto__","valueOrDefault","default_value","deprecate","message","version","console","warn","property","options","id","unique_index","get","properties","isFunction","set","validate","Error","JSON","stringify","previous","response","override","after","__properties","is_property","set_from_options","mixin","mixins","initializes","transforms","mixed","forEach","mix","initialize","args","apply","init","transform","data","trans","bind","stack","padding","direction","origin","min_height","min_width","elements","attr","d","next_position","element_dimensions","getBBox","spacing_width","max","width","spacing_height","height","x","y","translate","createScale","scale","time","linear","domain","setDomain","centered","adjacent","addCentered","addPadding","getValue","isSeriesData","values","series","min_value","min","original","series_count","series_index","range_band","rangeBand","isFinite","original_range","range","rangeBands","dimensions","selection","client","clientDimensions","attrDimensions","isSVG","bbox","bboxDimensions","element","node","clientWidth","clientHeight","window","getComputedStyle","styles","parseFloat","borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth","isNaN","ex","nodeName","rotate","degrees","center","rotation","alignText","line_height","offset","element_style","css_font_size","css_line_height","css_adjustment","height_adjustment","first_item","isArray","getMax","series_data","extent","series_max","Infinity","getMin","series_min","style","keyValues","join","getMargins","margins","default_margins","top","right","bottom","left","di","callback","wrapped","j","undefined","_is_di","bindDi","diFn","chart","bindAllDi","getParentData","_parent_data","parent","parentNode","select","createHelper","checkProp","definition","createPrepare","steps","base","props","step","createDraw","prepared","prepareSteps","selected","exit","update","enter","merge","remove","curry","createTransition","duration","delay","ease","getLayer","layer","empty","append","Base","_layers","_attached","_events","extractLayout","prepareComponent","component","row_index","col_index","getId","setPosition","position","layered_index","extractData","_charts","_components","items","layout","charts","components","found","row","row_components","row_layout","_layered","chart_ids","chart_index","unshift","calculateLayout","demux","overall_layout","skip_layout","getLayout","applyLayout","chart_position","setLayout","part","index","parts","previousPart","layered","findById","createLayer","name","events","event","method","split","str","charAt","toUpperCase","dataBind","onDataBind","insert","onInsert","getPoints","getPoint","sort","meta","getClosestPoints","points","tolerance","getDistance","Math","sqrt","pow","setDistance","point","distance","closePoints","sortPoints","by_distance","updateActive","active","closest","container","active_keys","closest_keys","trigger","Int8Array","utils","types","string","number","array","object","any","helpers","d3Chart","draw","attachment","unlayer","attach","on","once","off","isProperty","unset","proto_props","static_props","hasOwnProperty","Component","prepareLayout","actual_dimensions","getDefault","z_index","layer_type","Overlay","hidden","-webkit-transform","-ms-transform","display","getAbsolutePosition","chartPosition","show","hide","container_position","responsive","container_dimensions","chart_width","chart_height","width_ratio","height_ratio","default_compose_margins","Compose","tagName","classed","attachHoverListeners","rawData","_width","_height","viewBox","preserveAspectRatio","containerStyle","aspect_ratio","padding-top","baseStyle","chart_options","_attachItems","component_options","config","_prepareConfig","_setDimensions","redraw","createChartLayer","createComponentLayer","createOverlayLayer","_positionChartLayers","_extractLayout","positionLayers","inside","mouse","document","documentElement","bounds","translateToXY","move","leave","coordinates","chart_x","chart_y","getBounds","scroll_y","scrollY","scrollTop","getBoundingClientRect","was_inside","is_inside","detach","_positionComponents","_positionByZIndex","remove_ids","remove_id","changed_position","Item","layer_options","overlay","selectAll","setZIndex","zIndex","parseInt","sortZIndex","layers","appendChild","Chart","StandardLayer","standardLayer","standardSeriesLayer","onEnter","onUpdate","onMerge","onExit","Transition","setupTransition","Hover","onMouseEnter","onMouseMove","onMouseLeave","seriesData","mouseEnterPoint","mouseLeavePoint","HoverPoints","hoverTolerance","Labels","attachLabels","labels","LabelsClass","_labels","proxyLabelMethods","LabelsXY","XYInverted","yValue","seriesIndex","yScale","xValue","xScale","x0","y0","setXScaleRange","x_scale","setYScaleRange","y_scale","XYValues","adjacentWidth","seriesCount","layeredWidth","itemWidth","getDefaultXScale","XY","setScales","normalizeData","getDefaultYScale","xKey","yKey","Series","seriesKey","seriesValues","seriesClass","itemStyle","seriesLayer","compose","VERSION"],"mappings":"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","file":"d3.compose-mixins.min.js","sourcesContent":["/*!\n * d3.compose - Compose complex, data-driven visualizations from reusable charts and components with d3\n * v0.15.13 - https://github.com/CSNW/d3.compose - license: MIT\n */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('d3'), require('d3.chart')) :\n  typeof define === 'function' && define.amd ? define(['d3', 'd3.chart'], factory) :\n  global.d3c = factory(global.d3,global.d3_chart);\n}(this, function (d3,d3_chart) { 'use strict';\n\n  d3 = 'default' in d3 ? d3['default'] : d3;\n\n  // Many utils inlined from Underscore.js\r\n  // 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\r\n\r\n  var slice = Array.prototype.slice;\r\n  var toString = Object.prototype.toString;\r\n\r\n  function _extend(target, extensions, undefined_only) {\r\n    for (var i = 0, length = extensions.length; i < length; i++) {\r\n      for (var key in extensions[i]) {\r\n        if (!undefined_only || target[key] === void 0)\r\n          target[key] = extensions[i][key];\r\n      }\r\n    }\r\n\r\n    return target;\r\n  }\r\n\r\n  function contains(arr, item) {\r\n    return arr.indexOf(item) >= 0;\r\n  }\r\n\r\n  function compact(arr) {\r\n    return arr.filter(function(item) {\r\n      return item;\r\n    });\r\n  }\r\n\r\n  function difference(a, b) {\r\n    return a.filter(function(value) {\r\n      return b.indexOf(value) < 0;\r\n    });\r\n  }\r\n\r\n  function defaults(target) {\r\n    return _extend(target, slice.call(arguments, 1), true);\r\n  }\r\n\r\n  function extend(target) {\r\n    return _extend(target, slice.call(arguments, 1));\r\n  }\r\n\r\n  function flatten(arr) {\r\n    // Assumes all items in arr are arrays and only flattens one level\r\n    return arr.reduce(function(memo, item) {\r\n      return memo.concat(item);\r\n    }, []);\r\n  }\r\n\r\n  function find(arr, fn, context) {\r\n    if (!arr) return;\r\n    for (var i = 0, length = arr.length; i < length; i++) {\r\n      if (fn.call(context, arr[i], i, arr))\r\n        return arr[i];\r\n    }\r\n  }\r\n\r\n  function first(arr, n) {\r\n    if (arr == null) return void 0;\r\n    if (n == null) return arr[0];\r\n    return Array.prototype.slice.call(arr, 0, n);\r\n  }\r\n\r\n  function isBoolean(obj) {\r\n    return obj === true || obj === false;\r\n  }\r\n  function isObject(obj) {\r\n    var type = typeof obj;\r\n    return type === 'function' || type === 'object' && !!obj;\r\n  }\r\n  function isNumber(obj) {\r\n    return toString.call(obj) === '[object Number]';\r\n  }\r\n  function isString(obj) {\r\n    return toString.call(obj) === '[object String]';\r\n  }\r\n  function isUndefined(obj) {\r\n    return obj === void 0;\r\n  }\r\n\r\n  var isFunction = function(obj) {\r\n    return toString.call(obj) === '[object Function]';\r\n  };\r\n  if (typeof /./ != 'function' && typeof Int8Array != 'object') {\r\n    isFunction = function(obj) {\r\n      return typeof obj == 'function' || false;\r\n    };\r\n  }\r\n\r\n  function objectEach(obj, fn, context) {\r\n    if (!obj) return;\r\n    var keys = Object.keys(obj);\r\n    for (var i = 0, length = keys.length; i < length; i++) {\r\n      fn.call(context, obj[keys[i]], keys[i], obj);\r\n    }\r\n  }\r\n\r\n  function objectFind(obj, fn, context) {\r\n    if (!obj) return;\r\n    var keys = Object.keys(obj);\r\n    for (var i = 0, length = keys.length; i < length; i++) {\r\n      if (fn.call(context, obj[keys[i]], keys[i], obj))\r\n        return obj[keys[i]];\r\n    }\r\n  }\r\n\r\n  function pluck(objs, key) {\r\n    if (!objs) return [];\r\n    return objs.map(function(obj) {\r\n      return obj[key];\r\n    });\r\n  }\r\n\r\n  function uniq(arr) {\r\n    var result = [];\r\n    for (var i = 0, length = arr.length; i < length; i++) {\r\n      if (result.indexOf(arr[i]) < 0)\r\n        result.push(arr[i]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  function inherits(Child, Parent) {\r\n    Child.prototype = Object.create(Parent.prototype, {\r\n      constructor: {\r\n        value: Child,\r\n        enumerable: false,\r\n        writeable: true,\r\n        configurable: true\r\n      }\r\n    });\r\n\r\n    if (Object.setPrototypeOf) {\r\n      Object.setPrototypeOf(Child, Parent);\r\n    }\r\n    else {\r\n      Child.__proto__ = Parent; //eslint-disable-line no-proto\r\n\r\n      // __proto__ isn't supported in IE,\r\n      // use one-time copy of static properties to approximate\r\n      defaults(Child, Parent);\r\n    }\r\n  }\r\n\r\n  // If value isn't `undefined`, return `value`, otherwise use `default_value`\r\n  //\r\n  // @method valueOrDefault\r\n  // @param {Any} [value]\r\n  // @param {Any} default_value\r\n  // @return {Any}\r\n  function valueOrDefault(value, default_value) {\r\n    return !isUndefined(value) ? value : default_value;\r\n  }\r\n\r\n  function deprecate(message, version) {\r\n    if (typeof console != 'undefined' && console.warn)\r\n      console.warn('DEPRECATED (will be removed in ' + version + ') - ' + message);\r\n  }\r\n\r\n  var utils = {\r\n    slice: slice,\r\n    toString: toString,\r\n    contains: contains,\r\n    compact: compact,\r\n    difference: difference,\r\n    defaults: defaults,\r\n    extend: extend,\r\n    flatten: flatten,\r\n    find: find,\r\n    first: first,\r\n    isBoolean: isBoolean,\r\n    isFunction: isFunction,\r\n    isObject: isObject,\r\n    isNumber: isNumber,\r\n    isString: isString,\r\n    isUndefined: isUndefined,\r\n    objectEach: objectEach,\r\n    objectFind: objectFind,\r\n    pluck: pluck,\r\n    uniq: uniq,\r\n    inherits: inherits,\r\n    valueOrDefault: valueOrDefault\r\n  };\n\n  var unique_index = 0;\r\n\r\n  /**\r\n    Helper for creating properties for charts/components\r\n\r\n    @example\r\n    ```javascript\r\n    var Custom = d3.chart('Chart').extend('Custom', {\r\n      // Create property that's stored internally as 'simple'\r\n      simple: property()\r\n    });\r\n    var custom; // = new Custom(...);\r\n\r\n    // set\r\n    custom.simple('Howdy');\r\n\r\n    // get\r\n    console.log(custom.simple()); // -> 'Howdy'\r\n\r\n    // Advanced\r\n    // --------\r\n    // Default values:\r\n    Custom.prototype.message = property({\r\n      default_value: 'Howdy!'\r\n    });\r\n\r\n    console.log(custom.message()); // -> 'Howdy!'\r\n    custom.message('Goodbye');\r\n    console.log(custom.message()); // -> 'Goodbye'\r\n\r\n    // Set to undefined to reset to default value\r\n    custom.message(undefined);\r\n    console.log(custom.message()); // -> 'Howdy!'\r\n\r\n    // Computed default value:\r\n    Custom.property.computed = property({\r\n      default_value: function() {\r\n        // \"this\" = Custom instance\r\n        return this.message();\r\n      }\r\n    });\r\n\r\n    // Function default value:\r\n    // For function default_values, wrap in function to differentiate from computed\r\n    Custom.property.fn = property({\r\n      default_value: function() {\r\n        return function defaultFn() {};\r\n      }\r\n      // The following would be incorrectly evaluated\r\n      // default_value: function defaultFn() {}\r\n    })\r\n\r\n    // Custom getter:\r\n    Custom.prototype.exclaimed = property({\r\n      get: function(value) {\r\n        // Value is the underlying set value\r\n        return value + '!';\r\n      }\r\n    });\r\n\r\n    custom.exclaimed('Howdy');\r\n    console.log(custom.exclaimed()); // -> 'Howdy!'\r\n\r\n    // Custom setter:\r\n    Custom.prototype.feeling = property({\r\n      set: function(value, previous) {\r\n        if (value == 'Hate') {\r\n          // To override value, return Object with override specified\r\n          return {\r\n            override: 'Love',\r\n\r\n            // To do something after override, use after callback\r\n            after: function() {\r\n              console.log('After: ' + this.feeling()); // -> 'After: Love'\r\n            }\r\n          };\r\n        }\r\n      }\r\n\r\n      custom.feeling('Hate'); // -> 'After: Love'\r\n      console.log(custom.feeling()); // -> 'Love'\r\n    });\r\n    ```\r\n    @method property\r\n    @for helpers\r\n    @param {Object} [options]\r\n    @param {Any} [options.default_value] default value for property (when set value is `undefined`). If default value is a function, wrap in another function as default_value is evaluated by default.\r\n    @param {Function} [options.get] `function(value) {return ...}` getter, where `value` is the stored value and return desired value\r\n    @param {Function} [options.set] `function(value, previous) {return {override, after}}`. Return `override` to override stored value and `after()` to run after set\r\n    @param {Object} [options.context=this] context to evaluate get/set/after functions\r\n    @return {Function} `()`: get, `(value)`: set\r\n  */\r\n  function property(options) {\r\n    // DEPRECATED: name as first argument\r\n    if (arguments.length == 2) {\r\n      deprecate('\"name\" as the first argument for property is no longer required/supported and will be removed in the next version of d3.compose.', 'v0.17.0');\r\n      options = arguments[1];\r\n    }\r\n\r\n    options = options || {};\r\n    var id = 'property_' + unique_index++;\r\n\r\n    var property = function(value) {//eslint-disable-line no-shadow\r\n      var properties = this.__properties = this.__properties || {};\r\n      var context = valueOrDefault(property.context, this);\r\n\r\n      if (arguments.length)\r\n        return set.call(this);\r\n      else\r\n        return get.call(this);\r\n\r\n      function get() {\r\n        value = properties[id];\r\n\r\n        if (isUndefined(value)) {\r\n          // Use default value and unwrap if it's a function\r\n          value = property.default_value;\r\n          if (isFunction(value))\r\n            value = value.call(context);\r\n        }\r\n\r\n        return isFunction(options.get) ? options.get.call(context, value) : value;\r\n      }\r\n\r\n      function set() {\r\n        // Validate\r\n        if (isFunction(options.validate) && !isUndefined(value) && !options.validate.call(context, value))\r\n          throw new Error('Invalid value for property: ' + JSON.stringify(value));\r\n\r\n        var previous = properties[id];\r\n        properties[id] = value;\r\n\r\n        if (isFunction(options.set) && !isUndefined(value)) {\r\n          var response = options.set.call(context, value, previous);\r\n\r\n          if (response && 'override' in response)\r\n            properties[id] = response.override;\r\n          if (response && isFunction(response.after))\r\n            response.after.call(context, properties[id]);\r\n        }\r\n\r\n        return this;\r\n      }\r\n    };\r\n\r\n    // For checking if function is a property\r\n    property.is_property = true;\r\n    property.id = id;\r\n    property.set_from_options = valueOrDefault(options.set_from_options, true);\r\n    property.default_value = options.default_value;\r\n    property.context = options.context;\r\n    property.options = options;\r\n\r\n    return property;\r\n  }\n\n  /**\n    Combine mixins with Parent super class for extension\n\n    @example\n    ```js\n    var a = {transform: function() {}, a: 1};\n    var b = {initialize: function() {}, b: 2};\n    var c = {c: 3};\n\n    var Custom = mixin(Chart, a, b, c).extend({\n      initialize: function(options) {\n        this._super.initialize.call(this, options);\n        // d\n      },\n      transform: function(data) {\n        data = this._super.transform.call(this, data);\n        // d\n      }\n    });\n\n    // initialize: Chart, b, d\n    // transform: Chart, a, d\n    ```\n    @method mixin\n    @for helpers\n    @param {Function} Parent\n    @param {...Object} ...mixins\n    @return {Function}\n  */\n  function mixin(Parent/*, ...mixins*/) {\n    var mixins = slice.call(arguments, 1);\n    var initializes = [];\n    var transforms = [];\n    var mixed = {};\n\n    mixins.forEach(function(mix) {\n      objectEach(mix, function(value, key) {\n        if (key == 'initialize')\n          initializes.push(value);\n        else if (key == 'transform')\n          transforms.push(value);\n        else\n          mixed[key] = value;\n      });\n    });\n\n    if (initializes.length) {\n      mixed.initialize = function initialize() {\n        var args = slice.call(arguments);\n        Parent.prototype.initialize.apply(this, args);\n        initializes.forEach(function(init) {\n          init.apply(this, args);\n        }, this);\n      };\n    }\n\n    if (transforms.length) {\n      mixed.transform = function transform(data) {\n        data = Parent.prototype.transform.call(this, data);\n        return transforms.reduce(function(memo, trans) {\n          return trans.call(this, memo);\n        }.bind(this), data);\n      };\n    }\n\n    return Parent.extend(mixed);\n  }\n\n  /**\r\n    Stack given array of elements vertically or horizontally\r\n\r\n    @example\r\n    ```js\r\n    // Stack all text elements vertically, from the top, with 0px padding\r\n    d3.selectAll('text').call(helpers.stack())\r\n\r\n    // Stack all text elements horizontally, from the right, with 5px padding\r\n    d3.selectAll('text').call(helpers.stack({\r\n      direction: 'horizontal',\r\n      origin: 'right',\r\n      padding: 5\r\n    }));\r\n    ```\r\n    @method stack\r\n    @for helpers\r\n    @param {Object} [options]\r\n    @param {String} [options.direction=vertical] `\"vertical\"` or `\"horizontal\"`\r\n    @param {String} [options.origin] `\"top\"`, `\"right\"`, `\"bottom\"`, or `\"left\"` (by default, `\"top\"` for `\"vertical\"` and `\"left\"` for `\"horizontal\"`)\r\n    @param {Number} [options.padding=0] padding (in px) between elements\r\n    @param {Number} [options.min_height=0] minimum spacing height (for vertical stacking)\r\n    @param {Number} [options.min_width=0]  minimum spacing width (for horizontal stacking)\r\n    @return {Function}\r\n  */\r\n  function stack(options) {\r\n    options = extend({\r\n      direction: 'vertical',\r\n      origin: 'top',\r\n      padding: 0,\r\n      min_height: 0,\r\n      min_width: 0\r\n    }, options);\r\n\r\n    // Ensure valid origin based on direction\r\n    if (options.direction == 'horizontal' && !(options.origin == 'left' || options.origin == 'right'))\r\n      options.origin = 'left';\r\n    else if (options.direction == 'vertical' && !(options.origin == 'top' || options.origin == 'bottom'))\r\n      options.origin = 'top';\r\n\r\n    function padding(i) {\r\n      return i > 0 && options.padding ? options.padding : 0;\r\n    }\r\n\r\n    return function(elements) {\r\n      if (elements && elements.attr) {\r\n        var previous = 0;\r\n\r\n        elements.attr('transform', function(d, i) {\r\n          var element_dimensions = this.getBBox();\r\n          var spacing_width = d3.max([element_dimensions.width, options.min_width]);\r\n          var spacing_height = d3.max([element_dimensions.height, options.min_height]);\r\n          var x = 0;\r\n          var y = 0;\r\n          var next_position;\r\n\r\n          if (options.direction == 'horizontal') {\r\n            next_position = previous + spacing_width + padding(i);\r\n\r\n            if (options.origin == 'left')\r\n              x = previous + padding(i);\r\n            else\r\n              x = next_position;\r\n\r\n            previous = next_position;\r\n          }\r\n          else {\r\n            next_position = previous + spacing_height + padding(i);\r\n\r\n            if (options.origin == 'top')\r\n              y = previous + padding(i);\r\n            else\r\n              y = next_position;\r\n\r\n            previous = next_position;\r\n          }\r\n\r\n          return translate(x, y);\r\n        });\r\n      }\r\n    };\r\n  }\n\n  /**\n    Create scale from options\n\n    @example\n    ```javascript\n    // Simple type, range, and domain\n    var scale = createScale({\n      type: 'linear',\n      domain: [0, 100],\n      range: [0, 500]\n    });\n\n    // Calculate domain for data\n    var scale = createScale({\n      type: 'log',\n      data: [{y: 1}, {y: 100}, {y: 2000}, {y: 5000}],\n      key: 'y'\n    });\n\n    // Scale is passed through\n    var original = d3.scale.linear();\n    var scale = createScale(original);\n    scale === original;\n\n    // Set other properties by passing in \"arguments\" array\n    var scale = createScale({\n      type: 'ordinal',\n      domain: ['a', 'b', 'c', 'd', 'e'],\n      rangeRoundBands: [[0, 100], 0.1, 0.05] // -> rangeRoundBands([0, 100], 0.1, 0.05)\n    });\n\n    // Use ordinal + adjacent for bar charts\n    var scale = createScale({\n      type: 'ordinal',\n      adjacent: true,\n      domain: ['a', 'b', 'c'],\n      series: 2 // Series count is required for adjacent if data isn't given\n    })\n    ```\n    @method createScale\n    @for helpers\n    @param {Object|Function} options (passing in `Function` returns original function with no changes)\n    @param {String} [options.type='linear'] Any available `d3.scale` (`\"linear\"`, `\"ordinal\"`, `\"log\"`, etc.) or `\"time\"`\n    @param {Array} [options.domain] Domain for scale\n    @param {Array} [options.range] Range for scale\n    @param {Any} [options.data] Used to dynamically set domain (with given value or key)\n    @param {Function} [options.value] \"di\"-function for getting value for data\n    @param {String} [options.key] Data key to extract value\n    @param {Boolean} [options.centered] For \"ordinal\" scales, use centered x-values\n    @param {Boolean} [options.adjacent] For \"ordinal\" + centered, set x-values for different series next to each other\n\n    - Requires series-index as second argument to scale, otherwise centered x-value is used\n    - Requires \"data\" or \"series\" options to determine number of series\n    @param {Number} [options.series] Used with \"adjacent\" if no \"data\" is given to set series count\n    @param {Number} [options.padding=0.1] For \"ordinal\" scales, set padding between different x-values\n    @param {Array...} [options....] Set any other scale properties with array of arguments to pass to property\n    @return {d3.Scale}\n  */\n  function createScale(options) {\n    options = options || {};\n\n    // If function, scale was passed in as options\n    if (isFunction(options))\n      return options;\n\n    // Create scale (using d3.time.scale() if type is 'time')\n    var scale;\n    if (options.type == 'time')\n      scale = d3.time.scale();\n    else if (d3.scale[options.type])\n      scale = d3.scale[options.type]();\n    else\n      scale = d3.scale.linear();\n\n    objectEach(options, function(value, key) {\n      if (scale[key]) {\n        // If option is standard property (domain or range), pass in directly\n        // otherwise, pass in as arguments\n        // (don't pass through internal options)\n        if (key == 'range' || key == 'domain')\n          scale[key](value);\n        else if (!contains(['type', 'data', 'value', 'key', 'centered', 'adjacent', 'series', 'padding'], key))\n          scale[key].apply(scale, value);\n      }\n    });\n\n    if (!options.domain && options.data && (options.key || options.value))\n      scale = setDomain(scale, options);\n\n    // Add centered and adjacent extensions to ordinal\n    // (centered by default for ordinal)\n    var centered = options.centered || (options.type == 'ordinal' && options.centered == null);\n    if (options.type == 'ordinal' && (centered || options.adjacent))\n      scale = addCentered(scale, options);\n\n    // Add padding extension to ordinal\n    if (options.type == 'ordinal' && (options.padding != null || centered || options.adjacent))\n      scale = addPadding(scale, options);\n\n    return scale;\n  }\n\n  function setDomain(scale, options) {\n    // Use value \"di\" or create for key\n    var getValue = options.value || function(d) {\n      return d[options.key];\n    };\n\n    // Enforce series data\n    var data = options.data;\n    if (!isSeriesData(data))\n      data = [{values: data}];\n\n    var domain;\n    if (options.type == 'ordinal') {\n      // Domain for ordinal is array of unique values\n      domain = uniq(flatten(data.map(function(series) {\n        if (series && series.values)\n          return series.values.map(getValue);\n      })));\n    }\n    else {\n      var min_value = min(data, getValue);\n\n      domain = [\n        min_value < 0 ? min_value : 0,\n        max(data, getValue)\n      ];\n    }\n\n    scale.domain(domain);\n    return scale;\n  }\n\n  function addCentered(original, options) {\n    // Get series count for adjacent\n    var series_count = options.series || (!isSeriesData(options.data) ? 1 : options.data.length);\n\n    // TODO Look into removing closure\n    var scale = (function(original, options, series_count) {//eslint-disable-line no-shadow\n      var context = function(value, series_index) {\n        var width = context.width();\n\n        if (!options.adjacent)\n          series_index = 0;\n\n        return original(value) + (0.5 * width) + (width * (series_index || 0));\n      };\n      extend(context, original, {\n        width: function() {\n          var range_band = context.rangeBand && context.rangeBand();\n          var width = isFinite(range_band) ? range_band : 0;\n\n          if (options.adjacent)\n            width = width / series_count;\n\n          return width;\n        }\n      });\n\n      // TODO test copy() behavior\n\n      return context;\n    })(original, options, series_count);\n\n    return scale;\n  }\n\n  function addPadding(scale, options) {\n    var padding = options.padding != null ? options.padding : 0.1;\n\n    var original_range = scale.range;\n    scale.range = function(range) {\n      if (!arguments.length) return original_range();\n\n      scale.rangeBands(\n        range,\n        padding,\n        padding / 2\n      );\n    };\n\n    if (options.range)\n      scale.range(options.range);\n\n    // TODO test copy() behavior\n    return scale;\n  }\n\n  /**\r\n    Helper for robustly determining width/height of given selector.\r\n    Checks dimensions from css, attributes, and bounding box.\r\n\r\n    @method dimensions\r\n    @for helpers\r\n    @param {d3.Selection} selection\r\n    @return {Object} `{width, height}`\r\n  */\r\n  function dimensions(selection) {\r\n    // 1. Get width/height set via css (only valid for svg and some other elements)\r\n    var client = clientDimensions(selection);\r\n\r\n    if (client.width && client.height)\r\n      return client;\r\n\r\n    // 2. Get width/height set via attribute\r\n    var attr = attrDimensions(selection);\r\n\r\n    if (isSVG(selection)) {\r\n      return {\r\n        width: client.width != null ? client.width : attr.width || 0,\r\n        height: client.height != null ? client.height : attr.height || 0\r\n      };\r\n    }\r\n    else {\r\n      var bbox = bboxDimensions(selection);\r\n\r\n      // Size set by css -> client (only valid for svg and some other elements)\r\n      // Size set by svg -> attr override or bounding_box\r\n      // -> Take maximum\r\n      return {\r\n        width: d3.max([client.width, attr.width || bbox.width]) || 0,\r\n        height: d3.max([client.height, attr.height || bbox.height]) || 0\r\n      };\r\n    }\r\n  }\r\n\r\n  function clientDimensions(selection) {\r\n    var element = selection.node();\r\n    var width = element && element.clientWidth;\r\n    var height = element && element.clientHeight;\r\n\r\n    // Issue: Firefox does not correctly calculate clientWidth/clientHeight for svg\r\n    //        calculate from css\r\n    //        http://stackoverflow.com/questions/13122790/how-to-get-svg-element-dimensions-in-firefox\r\n    //        Note: This makes assumptions about the box model in use and that width/height are not percent values\r\n    if (isSVG(selection) && (!element.clientWidth || !element.clientHeight) && typeof window !== 'undefined' && window.getComputedStyle) {\r\n      var styles = window.getComputedStyle(element);\r\n      height = parseFloat(styles.height) - parseFloat(styles.borderTopWidth) - parseFloat(styles.borderBottomWidth);\r\n      width = parseFloat(styles.width) - parseFloat(styles.borderLeftWidth) - parseFloat(styles.borderRightWidth);\r\n    }\r\n\r\n    return {\r\n      width: width && !isNaN(width) ? width : null,\r\n      height: height && !isNaN(height) ? height : null\r\n    };\r\n  }\r\n\r\n  function attrDimensions(selection) {\r\n    return {\r\n      width: selection && selection.attr && parseFloat(selection.attr('width')),\r\n      height: selection && selection.attr && parseFloat(selection.attr('height'))\r\n    };\r\n  }\r\n\r\n  function bboxDimensions(selection) {\r\n    var element = selection.node();\r\n    var bbox;\r\n    try {\r\n      bbox = element && typeof element.getBBox == 'function' && element.getBBox();\r\n    }\r\n    catch(ex) {\r\n      // Firefox throws error when calling getBBox when svg hasn't been displayed\r\n      // Ignore error and set to empty\r\n      bbox = {width: 0, height: 0};\r\n    }\r\n\r\n    return bbox;\r\n  }\r\n\r\n  function isSVG(selection) {\r\n    return selection.node().nodeName == 'svg';\r\n  }\n\n  /**\r\n    Translate by (x, y) distance\r\n\r\n    @example\r\n    ```javascript\r\n    translate(10, 15) == 'translate(10, 15)'\r\n    translate({x: 10, y: 15}) == 'translate(10, 15)'\r\n    ```\r\n    @method translate\r\n    @param {Number|Object} [x] value or `{x, y}`\r\n    @param {Number} [y]\r\n    @return {String}\r\n  */\r\n  function translate(x, y) {\r\n    if (isObject(x)) {\r\n      y = x.y;\r\n      x = x.x;\r\n    }\r\n\r\n    return 'translate(' + (x || 0) + ', ' + (y || 0) + ')';\r\n  }\r\n\r\n  /**\r\n    Rotate by degrees, with optional center\r\n\r\n    @method rotate\r\n    @param {Number} degrees\r\n    @param {Object} [center = {x: 0, y: 0}]\r\n    @return {String}\r\n  */\r\n  function rotate(degrees, center) {\r\n    var rotation = 'rotate(' + (degrees || 0);\r\n    if (center)\r\n      rotation += ' ' + (center.x || 0) + ',' + (center.y || 0);\r\n    rotation += ')';\r\n\r\n    return rotation;\r\n  }\r\n\r\n  /**\r\n    Find vertical offset to vertically align text\r\n    (needed due to lack of `alignment-baseline` support in Firefox)\r\n\r\n    @example\r\n    ```js\r\n    var label = d3.select('text');\r\n\r\n    // Place label vertically so that origin is top-left\r\n    var offset = alignText(label);\r\n    label.attr('transform', translate(0, offset));\r\n\r\n    // Center label for line-height of 20px\r\n    var offset = alignText(label, 20);\r\n    label.attr('transform', translate(0, offset));\r\n    ```\r\n    @method alignText\r\n    @param {element} element\r\n    @param {Number} [line_height]\r\n    @return {Number} offset\r\n  */\r\n  function alignText(element, line_height) {\r\n    var offset = 0;\r\n    try {\r\n      var height = element.getBBox().height;\r\n\r\n      var element_style = window.getComputedStyle(element);\r\n      var css_font_size = parseFloat(element_style['font-size']);\r\n      var css_line_height = parseFloat(element_style['line-height']);\r\n\r\n      // If line-height: normal, use estimate 1.14em\r\n      // (actual line-height depends on browser and font)\r\n      if (isNaN(css_line_height))\r\n        css_line_height = 1.15 * css_font_size;\r\n\r\n      var css_adjustment = -(css_line_height - css_font_size) / 2;\r\n\r\n      // Add additional line-height, if specified\r\n      var height_adjustment = 0;\r\n      if (line_height && line_height > 0)\r\n        height_adjustment = (line_height - height) / 2;\r\n\r\n      offset = height + (css_adjustment || 0) + (height_adjustment || 0);\r\n    }\r\n    catch (ex) {\r\n      // Errors can occur from getBBox and getComputedStyle\r\n      // No useful information for offset, do nothing\r\n    }\r\n\r\n    return offset;\r\n  }\r\n\r\n  /**\r\n    Determine if given data is likely series data\r\n\r\n    @method isSeriesData\r\n    @param {Array} data\r\n    @return {Boolean}\r\n  */\r\n  function isSeriesData(data) {\r\n    var first_item = first(data);\r\n    return first_item && isObject(first_item) && Array.isArray(first_item.values);\r\n  }\r\n\r\n  /**\r\n    Get max for array/series by value di\r\n\r\n    @example\r\n    ```js\r\n    var data = [\r\n      {values: [{y: 1}, {y: 2}, {y: 3}]},\r\n      {values: [{y: 4}, {y: 2}, {y: 0}]}\r\n    ];\r\n    max(data, function(d, i) { return d.y; }); // -> 4\r\n    ```\r\n    @method max\r\n    @param {Array} data\r\n    @param {Function} getValue di function that returns value for given (d, i)\r\n    @return {Number}\r\n  */\r\n  function max(data, getValue) {\r\n    var getMax = function(series_data) {\r\n      return series_data && d3.extent(series_data, getValue)[1];\r\n    };\r\n\r\n    if (isSeriesData(data)) {\r\n      return data.reduce(function(memo, series) {\r\n        if (series && Array.isArray(series.values)) {\r\n          var series_max = getMax(series.values);\r\n          return series_max > memo ? series_max : memo;\r\n        }\r\n        else {\r\n          return memo;\r\n        }\r\n      }, -Infinity);\r\n    }\r\n    else {\r\n      return getMax(data);\r\n    }\r\n  }\r\n\r\n  /**\r\n    Get min for array/series by value di\r\n\r\n    @example\r\n    ```js\r\n    var data = [\r\n      {values: [{x: 1}, {x: 2}, {x: 3}]},\r\n      {values: [{x: 4}, {x: 2}, {x: 0}]}\r\n    ];\r\n    min(data, function(d, i) { return d.x; }); // -> 0\r\n    ```\r\n    @method min\r\n    @param {Array} data\r\n    @param {Function} getValue di function that returns value for given (d, i)\r\n    @return {Number}\r\n  */\r\n  function min(data, getValue) {\r\n    var getMin = function(series_data) {\r\n      return series_data && d3.extent(series_data, getValue)[0];\r\n    };\r\n\r\n    if (isSeriesData(data)) {\r\n      return data.reduce(function(memo, series) {\r\n        if (series && Array.isArray(series.values)) {\r\n          var series_min = getMin(series.values);\r\n          return series_min < memo ? series_min : memo;\r\n        }\r\n        else {\r\n          return memo;\r\n        }\r\n      }, Infinity);\r\n    }\r\n    else {\r\n      return getMin(data);\r\n    }\r\n  }\r\n\r\n  // TODO Look into converting to d3's internal style handling\r\n  // Convert key,values to style string\r\n  //\r\n  // @example\r\n  // ```js\r\n  // style({color: 'red', display: 'block'}) -> color: red; display: block;\r\n  // ```\r\n  // @method style\r\n  // @param {Object} styles\r\n  // @return {String}\r\n  function style(styles) {\r\n    if (!styles)\r\n      return '';\r\n\r\n    var keyValues = [];\r\n    objectEach(styles, function(value, key) {\r\n      keyValues.push(key + ': ' + value);\r\n    });\r\n    styles = keyValues.join('; ');\r\n\r\n    return styles ? styles + ';' : '';\r\n  }\r\n\r\n  /**\r\n    Get formatted margins for varying input\r\n\r\n    @method getMargins\r\n    @example\r\n    ```js\r\n    getMargins(4);\r\n    // -> {top: 4, right: 4, bottom: 4, left: 4}\r\n\r\n    getMargins({top: 20}, {top: 8, bottom: 8});\r\n    // -> {top: 20, right: 0, bottom: 8, left: 0}\r\n    ```\r\n    @param {Number|Object} margins\r\n    @param {Object} default_margins\r\n    @return {Object}\r\n  */\r\n  function getMargins(margins, default_margins) {\r\n    if (isNumber(margins))\r\n      return {top: margins, right: margins, bottom: margins, left: margins};\r\n    else\r\n      return defaults({}, margins, default_margins, {top: 0, right: 0, bottom: 0, left: 0});\r\n  }\r\n\r\n  /**\r\n    Create wrapped `(d, i)` function that adds chart instance as first argument.\r\n    Wrapped function uses standard d3 arguments and context.\r\n\r\n    Note: in order to pass proper context to di-functions called within di-function\r\n    use `.call(this, d, i)` (where \"this\" is d3 context)\r\n\r\n    @example\r\n    ```javascript\r\n    d3.chart('Base').extend('Custom', {\r\n      initialize: function() {\r\n        this.base.select('point')\r\n          .attr('cx', this.x);\r\n        // -> (d, i) and \"this\" used from d3, \"chart\" injected automatically\r\n      },\r\n\r\n      x: di(function(chart, d, i) {\r\n        // \"this\" is standard d3 context: node\r\n        return chart.xScale()(chart.xValue.call(this, d, i));\r\n      })\r\n\r\n      // xScale, xValue...\r\n    });\r\n    ```\r\n    @method di\r\n    @param {Function} callback with `(chart, d, i)` arguments\r\n    @return {Function}\r\n  */\r\n  function di(callback) {\r\n    // Create intermediate wrapping in case it's called without binding\r\n    var wrapped = function wrapped(d, i, j) {\r\n      return callback.call(this, undefined, d, i, j);\r\n    };\r\n    wrapped._is_di = true;\r\n    wrapped.original = callback;\r\n\r\n    return wrapped;\r\n  }\r\n\r\n  function bindDi(diFn, chart) {\r\n    return function wrapped(d, i, j) {\r\n      return (diFn.original || diFn).call(this, chart, d, i, j);\r\n    };\r\n  }\r\n\r\n  // Bind all di-functions found in chart\r\n  function bindAllDi(chart) {\r\n    for (var key in chart) {\r\n      if (chart[key] && chart[key]._is_di)\r\n        chart[key] = bindDi(chart[key], chart);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n    Get parent data for element (used to get parent series for data point)\r\n\r\n    @example\r\n    ```js\r\n    var data = [{\r\n      name: 'Input',\r\n      values: [1, 2, 3]\r\n    }];\r\n\r\n    d3.selectAll('g')\r\n      .data(data)\r\n      .enter().append('g')\r\n        .selectAll('text')\r\n          .data(function(d) { return d.values; })\r\n          .enter().append('text')\r\n            .text(function(d) {\r\n              var series_data = getParentData(this);\r\n              return series_data.name + ': ' + d;\r\n            });\r\n\r\n    // Input: 1, Input: 2, Input: 3\r\n    ```\r\n    @method getParentData\r\n    @param {Element} element\r\n    @return {Any}\r\n  */\r\n  function getParentData(element) {\r\n    // @internal Shortcut if element + parentData needs to be mocked\r\n    if (element._parent_data)\r\n      return element._parent_data;\r\n\r\n    var parent = element && element.parentNode;\r\n    if (parent) {\r\n      var data = d3.select(parent).data();\r\n      return data && data[0];\r\n    }\r\n  }\r\n\r\n  function createHelper(type) {\r\n    return function(id, options) {\r\n      if (!options) {\r\n        options = id;\r\n        id = undefined;\r\n      }\r\n\r\n      return extend({id: id, type: type}, options);\r\n    };\r\n  }\r\n\r\n  var types = {\r\n    string: {},\r\n    number: {},\r\n    array: {},\r\n    object: {},\r\n    any: {}\r\n  };\r\n\r\n  function checkProp(value, definition) {\r\n    if (definition.validate && !definition.validate(value))\r\n      throw new Error('Invalid value for property: ' + JSON.stringify(value));\r\n  }\r\n\r\n  function createPrepare(steps) {\r\n    if (!Array.isArray(steps))\r\n      steps = Array.prototype.slice.call(arguments);\r\n\r\n    return function() {\r\n      var selection = this.base;\r\n      var context = this;\r\n\r\n      return steps.reduce(function(props, step) {\r\n        return step(selection, props, context);\r\n      }, this.props);\r\n    };\r\n  }\r\n\r\n  function createDraw(steps) {\r\n    return function(selection, props) {\r\n      var prepared = prepareSteps(steps, props);\r\n\r\n      // TODO transitions\r\n      var selected = prepared.select.call(selection);\r\n      selected.exit().call(prepared.exit);\r\n      selected.call(prepared.update);\r\n      selected.enter().call(prepared.enter);\r\n      selected.call(prepared.merge);\r\n    };\r\n  }\r\n\r\n  function prepareSteps(steps, props) {\r\n    steps = defaults({}, steps, {\r\n      select: function() { return this; },\r\n      enter: function() {},\r\n      update: function() {},\r\n      merge: function() {},\r\n      exit: function() { this.remove(); }\r\n    });\r\n    // TODO transitions\r\n\r\n    return {\r\n      select: curry(steps.select, props),\r\n      enter: curry(steps.enter, props),\r\n      update: curry(steps.update, props),\r\n      merge: curry(steps.merge, props),\r\n      exit: curry(steps.exit, props)\r\n    };\r\n  }\r\n\r\n  function curry(fn) {\r\n    var values = Array.prototype.slice.call(arguments, 1);\r\n\r\n    return function() {\r\n      var args = Array.prototype.slice.call(arguments);\r\n      return fn.apply(this, values.concat(args));\r\n    };\r\n  }\r\n\r\n  function createTransition(props) {\r\n    return function() {\r\n      if (!isUndefined(props.duration))\r\n        this.duration(props.duration);\r\n      if (!isUndefined(props.delay))\r\n        this.delay(props.delay);\r\n      if (!isUndefined(props.ease))\r\n        this.ease(props.ease);\r\n    };\r\n  }\r\n\r\n  function getLayer(selection, id) {\r\n    var layer = selection.select('[data-layer=\"' + id + '\"]');\r\n    if (layer.empty())\r\n      layer = selection.append('g').attr('data-layer', id);\r\n\r\n    return layer;\r\n  }\r\n\r\n  // TODO Move to Chart/Base\r\n  var architecture = {\r\n    update: function(selection, props) {\r\n      this.base = selection;\r\n      this.props = this.prepareProps(props);\r\n    },\r\n    prepareProps: function(props) {\r\n      var properties = this.constructor && this.constructor.properties;\r\n      if (!properties)\r\n        return props;\r\n\r\n      var prepared = extend({}, props);\r\n\r\n      objectEach(properties, function(definition, key) {\r\n        var prop = prepared[key];\r\n\r\n        if (!isUndefined(prop))\r\n          checkProp(prop, definition);\r\n        else if (definition.getDefault)\r\n          prepared[key] = definition.getDefault(this.base, prepared, this);\r\n      }, this);\r\n\r\n      return prepared;\r\n    },\r\n    attach: function(id, Type, selection, props) {\r\n      var attached = this.attached[id];\r\n\r\n      if (attached)\r\n        attached.options(props);\r\n      else\r\n        attached = new Type(selection, props);\r\n\r\n      attached.draw();\r\n      this.attached[id] = attached;\r\n    },\r\n    detach: function(id) {\r\n      var attached = this.attached[id];\r\n      if (attached) {\r\n        attached.base.remove();\r\n        delete this.attached[id];\r\n      }\r\n    }\r\n  };\r\n\r\n  var helpers = {\r\n    property: property,\r\n    dimensions: dimensions,\r\n    translate: translate,\r\n    rotate: rotate,\r\n    alignText: alignText,\r\n    isSeriesData: isSeriesData,\r\n    max: max,\r\n    min: min,\r\n    createScale: createScale,\r\n    style: style,\r\n    getMargins: getMargins,\r\n    stack: stack,\r\n    di: di,\r\n    bindDi: bindDi,\r\n    bindAllDi: bindAllDi,\r\n    getParentData: getParentData,\r\n    mixin: mixin,\r\n    createHelper: createHelper,\r\n\r\n    types: types,\r\n    checkProp: checkProp,\r\n    createPrepare: createPrepare,\r\n    createDraw: createDraw,\r\n    createTransition: createTransition,\r\n    getLayer: getLayer\r\n  };\n\n  var d3Chart = d3.chart();\r\n\r\n  // TEMP Clear namespace from mixins\r\n  /**\r\n    @namespace\r\n  */\r\n\r\n  /**\r\n    Shared functionality between all charts and components.\r\n\r\n    - Set properties automatically from `options`,\r\n    - Store fully transformed data\r\n    - Adds `\"before:draw\"` and `\"draw\"` events\r\n    - Standard `width` and `height` calculations\r\n\r\n    @class Base\r\n  */\r\n  function Base(selection, options) {\r\n    // d3.chart() constructor without transform and initialize cascade\r\n    this.base = selection;\r\n    this._layers = {};\r\n    this._attached = {};\r\n    this._events = {};\r\n\r\n    // Bind all di-functions to this chart\r\n    bindAllDi(this);\r\n\r\n    // Set options (and properties with set_from_options)\r\n    if (options)\r\n      this.options(options);\r\n\r\n    // Initialize Chart (relies on explicitly calling super in initialize)\r\n    this.initialize(options);\r\n  }\r\n\r\n  inherits(Base, d3Chart);\r\n\r\n  extend(Base.prototype, {\r\n    initialize: function() {},\r\n    transform: function(data) {\r\n      return data;\r\n    },\r\n    demux: function(name, data) { return data; },\r\n\r\n    // Add events to draw: \"before:draw\" and \"draw\"\r\n    draw: function(data) {\r\n      // Transform data (relies on explicitly calling super in transform)\r\n      data = this.transform(data);\r\n\r\n      // Store fully-transformed data for reference\r\n      this.data(data);\r\n\r\n      this.trigger('before:draw', data);\r\n\r\n      objectEach(this._layers, function(layer) {\r\n        layer.draw(data);\r\n      });\r\n      objectEach(this._attached, function(attachment, name) {\r\n        attachment.draw(this.demux(name, data));\r\n      }, this);\r\n\r\n      this.trigger('draw', data);\r\n    },\r\n\r\n    // Explicitly load d3.chart prototype\r\n    layer: d3Chart.prototype.layer,\r\n    unlayer: d3Chart.prototype.unlayer,\r\n    attach: d3Chart.prototype.attach,\r\n    on: d3Chart.prototype.on,\r\n    once: d3Chart.prototype.once,\r\n    off: d3Chart.prototype.off,\r\n    trigger: d3Chart.prototype.trigger,\r\n\r\n    /**\r\n      Store fully-transformed data for direct access from the chart\r\n\r\n      @property data\r\n      @type Any\r\n    */\r\n    data: property(),\r\n\r\n    /**\r\n      Overall options for chart/component, automatically setting any matching properties.\r\n\r\n      @example\r\n      ```js\r\n      var property = d3.compose.helpers.property;\r\n\r\n      d3.chart('Base').extend('HasProperties', {\r\n        a: property(),\r\n        b: property({\r\n          set: function(value) {\r\n            return {\r\n              override: value + '!'\r\n            };\r\n          }\r\n        })\r\n      });\r\n\r\n      var instance = d3.select('#chart')\r\n        .chart('HasProperties', {\r\n          a: 123,\r\n          b: 'Howdy',\r\n          c: true\r\n        });\r\n\r\n      // Equivalent to:\r\n      // d3.select(...)\r\n      //   .chart('HasProperties')\r\n      //   .options({...});\r\n\r\n      console.log(instance.a()); // -> 123\r\n      console.log(instance.b()); // -> Howdy!\r\n      console.log(instance.options().c); // -> true\r\n      ```\r\n      @property options\r\n      @type Object\r\n    */\r\n    options: property({\r\n      default_value: {},\r\n      set: function(options, previous) {\r\n        // Clear all unset options, except for data and options\r\n        if (previous) {\r\n          var unset = difference(Object.keys(previous), Object.keys(options));\r\n          unset.forEach(function(key) {\r\n            if (key != 'data' && key != 'options' && isProperty(this, key))\r\n              this[key](undefined);\r\n          }, this);\r\n        }\r\n\r\n        objectEach(options, function setFromOptions(value, key) {\r\n          if (isProperty(this, key))\r\n            this[key](value);\r\n        }, this);\r\n\r\n        function isProperty(chart, key) {\r\n          return chart[key] && chart[key].is_property && chart[key].set_from_options;\r\n        }\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Get width of `this.base`.\r\n      (Does not include `set` for setting width of `this.base`)\r\n\r\n      @method width\r\n      @return {Number}\r\n    */\r\n    width: function width() {\r\n      return dimensions(this.base).width;\r\n    },\r\n\r\n    /**\r\n      Get height of `this.base`.\r\n      (Does not include `set` for setting height of `this.base`)\r\n\r\n      @method height\r\n      @return {Number}\r\n    */\r\n    height: function height() {\r\n      return dimensions(this.base).height;\r\n    }\r\n  });\r\n\r\n  Base.extend = function(proto_props, static_props) {\r\n    // name may be first parameter for d3.chart usage\r\n    var name;\r\n    if (isString(proto_props)) {\r\n      name = proto_props;\r\n      proto_props = static_props;\r\n      static_props = arguments[2];\r\n    }\r\n\r\n    var Parent = this;\r\n    var Child;\r\n\r\n    if (proto_props && proto_props.hasOwnProperty('constructor')) {\r\n      Child = proto_props.constructor;\r\n\r\n      // inherits sets constructor, remove from proto_props\r\n      proto_props = extend({}, proto_props);\r\n      delete proto_props.constructor;\r\n    }\r\n    else {\r\n      Child = function() { return Parent.apply(this, arguments); };\r\n    }\r\n\r\n    inherits(Child, Parent);\r\n    if (static_props)\r\n      extend(Child, static_props);\r\n    if (proto_props)\r\n      extend(Child.prototype, proto_props);\r\n\r\n    // If name is given, register with d3.chart\r\n    if (name)\r\n      d3Chart[name] = Child;\r\n\r\n    return Child;\r\n  };\n\n  /*\r\n    Extract layout from the given options\r\n\r\n    @param {Array} options\r\n    @return {Object} {data, items, layout}\r\n  */\r\n  function extractLayout(options) {\r\n    if (!options)\r\n      return;\r\n\r\n    var data = {\r\n      _charts: {},\r\n      _components: {}\r\n    };\r\n    var items = {};\r\n    var layout = [];\r\n    var charts = [];\r\n    var components = [];\r\n\r\n    // TEMP Idenfify charts from layered,\r\n    // eventually no distinction between charts and components\r\n    var found = {\r\n      row: false,\r\n      charts: false\r\n    };\r\n\r\n    // Components are added from inside-out\r\n    // so for position: top, position: left, use unshift\r\n    options.forEach(function(row, row_index) {\r\n      var row_components = [];\r\n\r\n      if (!Array.isArray(row))\r\n        row = [row];\r\n      if (row.length > 1)\r\n        found.row = true;\r\n\r\n      var row_layout = row.map(function(item, col_index) {\r\n        if (!item)\r\n          return;\r\n\r\n        if (item._layered) {\r\n          // Charts\r\n          found.charts = found.row = true;\r\n          var chart_ids = [];\r\n\r\n          item.items.forEach(function(chart, chart_index) {\r\n            if (!chart)\r\n              return;\r\n\r\n            chart = defaults({}, chart, {id: getId(row_index, col_index, chart_index)});\r\n\r\n            chart_ids.push(chart.id);\r\n            charts.push(chart);\r\n            items[chart.id] = chart;\r\n          });\r\n\r\n          return chart_ids;\r\n        }\r\n\r\n        var component = prepareComponent(item, row_index, col_index);\r\n        items[component.id] = component;\r\n\r\n        if (row.length > 1) {\r\n          if (!found.charts) {\r\n            // Left\r\n            setPosition(component, 'left');\r\n            row_components.unshift(component);\r\n          }\r\n          else {\r\n            // Right\r\n            setPosition(component, 'right');\r\n            row_components.push(component);\r\n          }\r\n        }\r\n        else {\r\n          if (!found.row) {\r\n            // Top\r\n            setPosition(component, 'top');\r\n            components.unshift(component);\r\n          }\r\n          else {\r\n            // Bottom\r\n            setPosition(component, 'bottom');\r\n            components.push(component);\r\n          }\r\n        }\r\n\r\n        return component.id;\r\n      });\r\n\r\n      if (row_components.length)\r\n        components = components.concat(row_components);\r\n\r\n      layout.push(row_layout);\r\n    });\r\n\r\n    charts.forEach(extractData('_charts'));\r\n    components.forEach(extractData('_components'));\r\n\r\n    return {\r\n      data: data,\r\n      items: items,\r\n      layout: layout,\r\n\r\n      charts: charts,\r\n      components: components\r\n    };\r\n\r\n    function prepareComponent(component, row_index, col_index) {\r\n      return defaults({}, component, {id: getId(row_index, col_index)});\r\n    }\r\n    function setPosition(component, position) {\r\n      if (component && isFunction(component.position))\r\n        component.position(position);\r\n      else\r\n        component.position = position;\r\n    }\r\n    function getId(row_index, col_index, layered_index) {\r\n      var id = 'item-' + (row_index + 1) + '-' + (col_index + 1);\r\n      if (layered_index != null)\r\n        id += '-' + (layered_index + 1);\r\n\r\n      return id;\r\n    }\r\n\r\n    function extractData(type) {\r\n      return function(item) {\r\n        if (item.data && !isFunction(item.data)) {\r\n          data[type][item.id] = item.data;\r\n          data[item.id] = item.data;\r\n          delete item.data;\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  /*\r\n    Calculate component and chart coordinates for given layout\r\n  */\r\n  function calculateLayout(components, data, demux) {\r\n    var overall_layout = {top: [], right: [], bottom: [], left: []};\r\n    components.forEach(function(component) {\r\n      if (component.skip_layout || !component.getLayout)\r\n        return;\r\n\r\n      var layout = component.getLayout(demux(component.id, data));\r\n      var position = layout && layout.position;\r\n\r\n      if (!contains(['top', 'right', 'bottom', 'left'], position))\r\n        return;\r\n\r\n      overall_layout[position].push({\r\n        offset: position == 'top' || position == 'bottom' ? layout.height : layout.width,\r\n        component: component\r\n      });\r\n    });\r\n\r\n    return overall_layout;\r\n  }\r\n\r\n  /*\r\n    Apply calculated layout to charts and components\r\n  */\r\n  function applyLayout(layout, chart_position, width, height) {\r\n    layout.top.reduce(function(previous, part) {\r\n      var y = previous - part.offset;\r\n      setLayout(part.component, chart_position.left, y, {width: chart_position.width});\r\n\r\n      return y;\r\n    }, chart_position.top);\r\n\r\n    layout.right.reduce(function(previous, part, index, parts) {\r\n      var previousPart = parts[index - 1] || {offset: 0};\r\n      var x = previous + previousPart.offset;\r\n      setLayout(part.component, x, chart_position.top, {height: chart_position.height});\r\n\r\n      return x;\r\n    }, width - chart_position.right);\r\n\r\n    layout.bottom.reduce(function(previous, part, index, parts) {\r\n      var previousPart = parts[index - 1] || {offset: 0};\r\n      var y = previous + previousPart.offset;\r\n      setLayout(part.component, chart_position.left, y, {width: chart_position.width});\r\n\r\n      return y;\r\n    }, height - chart_position.bottom);\r\n\r\n    layout.left.reduce(function(previous, part) {\r\n      var x = previous - part.offset;\r\n      setLayout(part.component, x, chart_position.top, {height: chart_position.height});\r\n\r\n      return x;\r\n    }, chart_position.left);\r\n\r\n    function setLayout(component, x, y, options) {\r\n      if (component && isFunction(component.setLayout))\r\n        component.setLayout(x, y, options);\r\n    }\r\n  }\n\n  /**\r\n    Common base for creating components that includes helpers for positioning and layout.\r\n\r\n    ### Extending\r\n\r\n    `d3.chart('Component')` contains intelligent defaults and there are no required overrides.\r\n    Create a component just like a chart, by creating layers in the `initialize` method in `extend`.\r\n\r\n    - To adjust layout calculation, use `prepareLayout`, `getLayout`, and `setLayout`.\r\n    - To layout a component within the chart, use `skip_layout: true` and the static `layer_type: 'chart'`\r\n\r\n    @example\r\n    ```js\r\n    d3.chart('Component').extend('Key', {\r\n      initialize: function() {\r\n        this.layer('Key', this.base, {\r\n          dataBind: function(data) {\r\n            return this.selectAll('text')\r\n              .data(data);\r\n          },\r\n          insert: function() {\r\n            return this.append('text');\r\n          },\r\n          events: {\r\n            merge: function() {\r\n              this.text(this.chart().keyText)\r\n            }\r\n          }\r\n        })\r\n      },\r\n\r\n      keyText: helpers.di(function(chart, d, i) {\r\n        return d.abbr + ' = ' + d.value;\r\n      })\r\n    });\r\n    ```\r\n    @class Component\r\n    @extends Base\r\n  */\r\n  var Component = Base.extend({\r\n    /**\r\n      Component's position relative to chart\r\n      (top, right, bottom, left)\r\n\r\n      @property position\r\n      @type String\r\n      @default 'top'\r\n    */\r\n    position: property({\r\n      default_value: 'top',\r\n      validate: function(value) {\r\n        return contains(['top', 'right', 'bottom', 'left'], value);\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Get/set the width of the component (in pixels)\r\n      (used in layout calculations)\r\n\r\n      @property width\r\n      @type Number\r\n      @default (actual width)\r\n    */\r\n    width: property({\r\n      default_value: function() {\r\n        return dimensions(this.base).width;\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Get/set the height of the component (in pixels)\r\n      (used in layout calculations)\r\n\r\n      @property height\r\n      @type Number\r\n      @default (actual height)\r\n    */\r\n    height: property({\r\n      default_value: function() {\r\n        return dimensions(this.base).height;\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Margins (in pixels) around component\r\n\r\n      @property margins\r\n      @type Object\r\n      @default {top: 0, right: 0, bottom: 0, left: 0}\r\n    */\r\n    margins: property({\r\n      set: function(values) {\r\n        return {\r\n          override: getMargins(values)\r\n        };\r\n      },\r\n      default_value: getMargins()\r\n    }),\r\n\r\n    /**\r\n      Center the component vertically/horizontally (depending on position)\r\n\r\n      @property centered\r\n      @type Boolean\r\n      @default false\r\n    */\r\n    centered: property({\r\n      default_value: false\r\n    }),\r\n\r\n    /**\r\n      Skip component during layout calculations and positioning\r\n      (override in prototype of extension)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('NotLaidOut', {\r\n        skip_layout: true\r\n      });\r\n      ```\r\n      @attribute skip_layout\r\n      @type Boolean\r\n      @default false\r\n    */\r\n    skip_layout: false,\r\n\r\n    /**\r\n      Perform any layout preparation required before getLayout (default is draw)\r\n      (override in prototype of extension)\r\n\r\n      Note: By default, components are double-drawn;\r\n      for every draw, they are drawn once to determine the layout size of the component and a second time for display with the calculated layout.\r\n      This can cause issues if the component uses transitions. See Axis for an example of a Component with transitions.\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('Custom', {\r\n        prepareLayout: function(data) {\r\n          // default: this.draw(data);\r\n          // so that getLayout has real dimensions\r\n\r\n          // -> custom preparation (if necessary)\r\n        }\r\n      })\r\n      ```\r\n      @method prepareLayout\r\n      @param {Any} data\r\n    */\r\n    prepareLayout: function(data) {\r\n      this.draw(data);\r\n    },\r\n\r\n    /**\r\n      Get layout details for use when laying out component\r\n      (override in prototype of extension)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('Custom', {\r\n        getLayout: function(data) {\r\n          var calculated_width, calculated_height;\r\n\r\n          // Perform custom calculations...\r\n\r\n          // Must return position, width, and height\r\n          return {\r\n            position: this.position(),\r\n            width: calculated_width,\r\n            height: calculated_height\r\n          };\r\n        }\r\n      });\r\n      ```\r\n      @method getLayout\r\n      @param {Any} data\r\n      @return {Object} position, width, and height for layout\r\n    */\r\n    getLayout: function(data) {\r\n      this.prepareLayout(data);\r\n\r\n      var margins = this.margins();\r\n      return {\r\n        position: this.position(),\r\n        width: this.width() + margins.left + margins.right,\r\n        height: this.height() + margins.top + margins.bottom\r\n      };\r\n    },\r\n\r\n    /**\r\n      Set layout of underlying base\r\n      (override in prototype of extension)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('Custom', {\r\n        setLayout: function(x, y, options) {\r\n          // Set layout of this.base...\r\n          // (the following is the default implementation)\r\n          var margins = this.margins();\r\n\r\n          // (handle this.centered())\r\n\r\n          this.base\r\n            .attr('transform', helpers.translate(x + margins.left, y + margins.top));\r\n          this.height(options && options.height);\r\n          this.width(options && options.width);\r\n        }\r\n      });\r\n      ```\r\n      @method setLayout\r\n      @param {Number} x position of base top-left\r\n      @param {Number} y position of base top-left\r\n      @param {Object} options\r\n        @param {Object} [options.height] height of component in layout\r\n        @param {Object} [options.width] width of component in layout\r\n    */\r\n    setLayout: function(x, y, options) {\r\n      var margins = this.margins();\r\n\r\n      if (this.centered()) {\r\n        var actual_dimensions = dimensions(this.base);\r\n        if ('height' in options)\r\n          y += (options.height - actual_dimensions.height) / 2;\r\n        else\r\n          y += margins.top;\r\n\r\n        if ('width' in options)\r\n          x += (options.width - actual_dimensions.width) / 2;\r\n        else\r\n          x += margins.left;\r\n      }\r\n      else {\r\n        x += margins.left;\r\n        y += margins.top;\r\n      }\r\n\r\n      this.base.attr('transform', translate(x, y));\r\n      this.height(options && options.height);\r\n      this.width(options && options.width);\r\n    }\r\n  }, {\r\n    properties: {\r\n      position: {\r\n        type: types.string,\r\n        validate: function(value) {\r\n          return contains(['top', 'right', 'bottom', 'left'], value);\r\n        }\r\n      },\r\n      width: {\r\n        type: types.number,\r\n        getDefault: function(selection, props, context) {\r\n          // TODO Move to Component.prepare\r\n          var width = context.width();\r\n          return !isUndefined(width) ? width : dimensions(selection).width;\r\n        }\r\n      },\r\n      height: {\r\n        type: types.number,\r\n        getDefault: function(selection, props, context) {\r\n          // TODO Move to Component.prepare\r\n          var height = context.height();\r\n          return !isUndefined(height) ? height : dimensions(selection).height;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n      Default z-index for component\r\n      (Charts are 100 by default, so Component = 50 is below chart by default)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('AboveChartLayers', {\r\n        // ...\r\n      }, {\r\n        z_index: 150\r\n      });\r\n      ```\r\n      @attribute z_index\r\n      @static\r\n      @type Number\r\n      @default 50\r\n    */\r\n    z_index: 50,\r\n\r\n    /**\r\n      Set to `'chart'` to use chart layer for component.\r\n      (e.g. Axis uses chart layer to position with charts, but includes layout for ticks)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Component').extend('ChartComponent', {\r\n        // ...\r\n      }, {\r\n        layer_type: 'chart'\r\n      });\r\n      ```\r\n      @attribute layer_type\r\n      @static\r\n      @type String\r\n      @default 'component'\r\n    */\r\n    layer_type: 'component'\r\n  });\n\n  /**\r\n    Common base for creating overlays that includes helpers for positioning and show/hide.\r\n\r\n    ### Extending\r\n\r\n    Create an overlay just like a chart, by creating layers in the `initialize` method in `extend`.\r\n\r\n    - To adjust positioning, override `position`\r\n    - To adjust show/hide behavior, override `show`/`hide`\r\n\r\n    @example\r\n    ```js\r\n    d3.chart('Overlay').extend('ClosestPoints', {\r\n      // TODO\r\n    });\r\n    ```\r\n    @class Overlay\r\n    @extends Component\r\n  */\r\n  var Overlay = Component.extend({\r\n    initialize: function(options) {\r\n      Component.prototype.initialize.call(this, options);\r\n      this.base.attr('style', this.style());\r\n    },\r\n    skip_layout: true,\r\n\r\n    /**\r\n      Overlay's top-left x-position in px from left\r\n\r\n      @property x\r\n      @type Number\r\n      @default 0\r\n    */\r\n    x: property({\r\n      default_value: 0\r\n    }),\r\n\r\n    /**\r\n      Overlay's top-left y-position in px from top\r\n\r\n      @property y\r\n      @type Number\r\n      @default 0\r\n    */\r\n    y: property({\r\n      default_value: 0\r\n    }),\r\n\r\n    /**\r\n      Whether overlay is currently hidden\r\n\r\n      @property hidden\r\n      @type Boolean\r\n      @default true\r\n    */\r\n    hidden: property({\r\n      default_value: true\r\n    }),\r\n\r\n    /**\r\n      Overlays base styling\r\n      (default includes position and hidden)\r\n\r\n      @property style\r\n      @type String\r\n      @default set from x, y, and hidden\r\n    */\r\n    style: property({\r\n      default_value: function() {\r\n        var transform = translate(this.x() + 'px', this.y() + 'px');\r\n        var styles = {\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          '-webkit-transform': transform,\r\n          '-ms-transform': transform,\r\n          transform: transform\r\n        };\r\n\r\n        if (this.hidden())\r\n          styles.display = 'none';\r\n\r\n        return style(styles);\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Position overlay layer at given x,y coordinates\r\n\r\n      @example\r\n      ```js\r\n      // Absolute, x: 100, y: 50\r\n      overlay.position(100, 50);\r\n      overlay.position({x: 100, y: 50});\r\n\r\n      // Relative-to-chart, x: 50, y: 40\r\n      overlay.position({chart: {x: 50, y: 40}});\r\n\r\n      // Relative-to-container, x: 75, y: 50\r\n      overlay.position({container: {x: 75, y: 50}});\r\n      ```\r\n      @method position\r\n      @param {Object|Number} position {x,y}, {container: {x,y}}, {chart: {x,y}} or x in px from left\r\n      @param {Number} [y] in px from top\r\n    */\r\n    // TODO This conflicts with component.position(), might need a rename\r\n    position: function(position, y) {\r\n      if (arguments.length > 1) {\r\n        position = {\r\n          x: position,\r\n          y: y\r\n        };\r\n      }\r\n      else {\r\n        if ('container' in position) {\r\n          position = this.getAbsolutePosition(position.container);\r\n        }\r\n        else if ('chart' in position) {\r\n          if (this.container) {\r\n            var chart = this.container.chartPosition();\r\n            position = this.getAbsolutePosition({\r\n              x: position.chart.x + chart.left,\r\n              y: position.chart.y + chart.top\r\n            });\r\n          }\r\n          else {\r\n            position = this.getAbsolutePosition(position.chart);\r\n          }\r\n        }\r\n      }\r\n\r\n      this.x(position.x).y(position.y);\r\n      this.base.attr('style', this.style());\r\n    },\r\n\r\n    /**\r\n      Show overlay (with `display: block`)\r\n\r\n      @method show\r\n    */\r\n    show: function() {\r\n      this.hidden(false);\r\n      this.base.attr('style', this.style());\r\n    },\r\n\r\n    /**\r\n      Hide overlay (with `display: none`)\r\n\r\n      @method hide\r\n    */\r\n    hide: function() {\r\n      this.hidden(true);\r\n      this.base.attr('style', this.style());\r\n    },\r\n\r\n    /**\r\n      Get absolute position from container position\r\n      (needed since container position uses viewBox and needs to be scaled to absolute position)\r\n\r\n      @method getAbsolutePosition\r\n      @param {Object} container_position ({x, y})\r\n      @return {Object} absolute {x, y} relative to container div\r\n    */\r\n    getAbsolutePosition: function(container_position) {\r\n      var container = this.container && this.container.container;\r\n\r\n      if (container && this.container.responsive()) {\r\n        var container_dimensions = dimensions(container);\r\n        var chart_width = this.container.width();\r\n        var chart_height = this.container.height();\r\n        var width_ratio = container_dimensions.width / chart_width;\r\n        var height_ratio = container_dimensions.height / chart_height;\r\n\r\n        return {\r\n          x: width_ratio * container_position.x,\r\n          y: height_ratio * container_position.y\r\n        };\r\n      }\r\n      else {\r\n        // Not attached so can't get actual dimensions\r\n        // fallback to container position\r\n        return container_position;\r\n      }\r\n    }\r\n  }, {\r\n    layer_type: 'overlay'\r\n  });\n\n  var default_compose_margins = {top: 10, right: 10, bottom: 10, left: 10};\r\n\r\n  /**\r\n    Compose rich, data-bound charts from charts (like Lines and Bars) and components (like Axis, Title, and Legend) with d3 and d3.chart.\r\n    Using the `options` property, charts and components can be bound to data and customized to create dynamic charts.\r\n\r\n    @example\r\n    ```html\r\n    <div id=\"#chart\"></div>\r\n    ```\r\n    ```js\r\n    var chart = d3.select('#chart').chart('Compose', function(data) {\r\n      // Process data...\r\n\r\n      // Create shared scales\r\n      var scales = {\r\n        x: {data: data.input, key: 'x', adjacent: true},\r\n        y: {data: data.input, key: 'y'},\r\n        y2: {data: data.output, key: 'y'}\r\n      };\r\n\r\n      // Setup charts and components\r\n      var charts = [\r\n        d3c.bars('input', {data: data.input, xScale: scales.x, yScale: scales.y}),\r\n        d3c.lines('output', {data: data.output, xScale: scales.x, yScale: scales.y2})\r\n      ];\r\n\r\n      var title = d3c.title('d3.compose');\r\n      var xAxis = d3c.axis('xAxis', {scale: scales.x});\r\n      var yAxis = d3c.axis('yAxis', {scale: scales.y});\r\n      var y2Axis = d3c.axis('y2Axis', {scale: scales.y2});\r\n\r\n      // Layout charts and components\r\n      return [\r\n        title,\r\n        [yAxis, d3c.layered(charts), y2Axis],\r\n        xAxis\r\n      ];;\r\n    });\r\n\r\n    chart.draw({input: [...], output: [...]});\r\n    ```\r\n    @class Compose\r\n    @extends Base\r\n  */\r\n  var Compose = Base.extend({\r\n    initialize: function(options) {\r\n      Base.prototype.initialize.call(this, options);\r\n\r\n      // Responsive svg based on the following approach (embedded + padding hack)\r\n      // http://tympanus.net/codrops/2014/08/19/making-svgs-responsive-with-css/\r\n      // (not enabled if selection is svg)\r\n      if (this.base.node().tagName != 'svg') {\r\n        this.container = this.base.append('div')\r\n          .attr('class', 'chart-compose-container');\r\n\r\n        this.base = this.container.append('svg')\r\n          .attr('xlmns', 'http://www.w3.org/2000/svg')\r\n          .attr('version', '1.1')\r\n          .attr('class', 'chart-compose');\r\n      }\r\n      else {\r\n        this.base.classed('chart-compose', true);\r\n      }\r\n\r\n      this.attachHoverListeners();\r\n    },\r\n\r\n    transform: function(data) {\r\n      // Save raw data for redraw\r\n      this.rawData(data);\r\n      return Base.prototype.transform.call(this, data);\r\n    },\r\n\r\n    /**\r\n      Get/set the options `object/function` for the chart that takes `data` and\r\n      returns `[...layout]` for composing child charts and components.\r\n\r\n      @example\r\n      ```js\r\n      // get\r\n      chart.options();\r\n\r\n      // set (static)\r\n      chart.options([\r\n        // ...\r\n      ]);\r\n\r\n      // set (dynamic, takes data and returns options)\r\n      chart.options(function(data) {\r\n        // process data...\r\n\r\n        return [\r\n          // ...\r\n        ];\r\n      });\r\n\r\n      // Set directly from d3.chart creation\r\n      d3.select('#chart')\r\n        .chart('Compose', function(data) {\r\n          // ...\r\n        });\r\n      ```\r\n      @property options\r\n      @type Function|Object\r\n    */\r\n    options: property({\r\n      default_value: function() { return function() {}; },\r\n      set: function(options) {\r\n        // If options is plain object,\r\n        // return from generic options function\r\n        if (!isFunction(options)) {\r\n          return {\r\n            override: function() {\r\n              return options;\r\n            }\r\n          };\r\n        }\r\n      }\r\n    }),\r\n\r\n    // Store raw data for container before it has been transformed\r\n    rawData: property(),\r\n\r\n    /**\r\n      Margins between edge of container and components/chart\r\n\r\n      @example\r\n      ```js\r\n      chart.margins({top: 10, right: 20, bottom: 10, left: 20});\r\n      ```\r\n      @property margins\r\n      @type Object {top, right, bottom, left}\r\n      @default {top: 10, right: 10, bottom: 10, left: 10}\r\n    */\r\n    margins: property({\r\n      default_value: default_compose_margins,\r\n      set: function(values) {\r\n        return {\r\n          override: getMargins(values, default_compose_margins)\r\n        };\r\n      }\r\n    }),\r\n\r\n    // Chart position\r\n    chartPosition: property({\r\n      default_value: {top: 0, right: 0, bottom: 0, left: 0},\r\n      set: function(values) {\r\n        return {\r\n          override: defaults({}, values, {top: 0, right: 0, bottom: 0, left: 0})\r\n        };\r\n      },\r\n      get: function(values) {\r\n        values.width = this._width() - values.right - values.left;\r\n        values.height = this._height() - values.bottom - values.top;\r\n\r\n        return values;\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Get/set overall width of chart\r\n\r\n      @property width\r\n      @type Number\r\n    */\r\n    width: property({\r\n      default_value: null\r\n    }),\r\n\r\n    /**\r\n      Get/set overall height of chart\r\n\r\n      @property height\r\n      @type Number\r\n    */\r\n    height: property({\r\n      default_value: null\r\n    }),\r\n\r\n    _width: function() {\r\n      var width = this.width();\r\n      return width != null ? width : Base.prototype.width.call(this);\r\n    },\r\n    _height: function() {\r\n      var height = this.height();\r\n      return height != null ? height : Base.prototype.height.call(this);\r\n    },\r\n\r\n    /**\r\n      Enable responsive container + viewBox so that chart scales to fill width\r\n      (only works if selection is not an svg)\r\n\r\n      @property responsive\r\n      @type Boolean\r\n      @default true\r\n    */\r\n    responsive: property({\r\n      default_value: true\r\n    }),\r\n\r\n    // Set svg viewBox attribute\r\n    viewBox: property({\r\n      default_value: function() {\r\n        if (this.responsive() && this.width() && this.height())\r\n          return '0 0 ' + this.width() + ' ' + this.height();\r\n        else\r\n          return null;\r\n      }\r\n    }),\r\n\r\n    // Set svg preserveAspectRatio attribute\r\n    preserveAspectRatio: property({\r\n      default_value: function() {\r\n        if (this.responsive())\r\n          return 'xMidYMid meet';\r\n        else\r\n          return null;\r\n      }\r\n    }),\r\n\r\n    // Set container style\r\n    containerStyle: property({\r\n      default_value: function() {\r\n        if (this.responsive()) {\r\n          var aspect_ratio = 1;\r\n          if (this.width() && this.height())\r\n            aspect_ratio = this.height() / this.width();\r\n\r\n          return style({\r\n            width: '100%',\r\n            height: 0,\r\n            'padding-top': (aspect_ratio * 100) + '%',\r\n            position: 'relative'\r\n          });\r\n        }\r\n        else {\r\n          return style({position: 'relative'});\r\n        }\r\n      }\r\n    }),\r\n\r\n    // Set base style\r\n    baseStyle: property({\r\n      default_value: function() {\r\n        if (this.responsive() && this.container) {\r\n          return style({\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0\r\n          });\r\n        }\r\n        else {\r\n          return null;\r\n        }\r\n      }\r\n    }),\r\n\r\n    /**\r\n      Set charts from options or get chart instances.\r\n      Each chart should use a unique key so that updates are passed to the existing chart\r\n      (otherwise they are recreated on update).\r\n      The `type` option must be a registered `d3.chart` and all other options are passed to the chart.\r\n\r\n      @example\r\n      ```js\r\n      chart.charts([\r\n        {id: 'input', type: 'Bars'}, // options to pass to Bars chart\r\n        {id: 'output', type: 'Lines'} // options to pass to Lines chart\r\n      ]);\r\n      ```\r\n      @property charts\r\n      @type Array\r\n    */\r\n    charts: property({\r\n      set: function(chart_options, charts) {\r\n        // Store actual charts rather than options\r\n        return {\r\n          override: this._attachItems(chart_options, charts, this)\r\n        };\r\n      },\r\n      default_value: []\r\n    }),\r\n\r\n    /**\r\n      Set components from options or get components instances.\r\n      Each component should use a unique key so that updates are passed to the existing chart\r\n      (otherwise they are recreated on update).\r\n      The `type` option must be a registered `d3.chart` and all other options are passed to the component.\r\n\r\n      @example\r\n      ```js\r\n      chart.components([\r\n        {id: 'axis.y', type: 'Axis'}, // options to pass to Axis component\r\n        {id: 'title', type: 'Title'} // options to pass to Title component\r\n      ])\r\n      ```\r\n      @property components\r\n      @type Array\r\n    */\r\n    components: property({\r\n      set: function(component_options, components) {\r\n        // Store actual components rather than options\r\n        return {\r\n          override: this._attachItems(component_options, components, this)\r\n        };\r\n      },\r\n      default_value: []\r\n    }),\r\n\r\n    /**\r\n      Delay start of transition by specified milliseconds.\r\n      (applied to all charts and components as default)\r\n\r\n      @property delay\r\n      @type Number|Function\r\n      @default d3 default: 0\r\n    */\r\n    delay: property(),\r\n\r\n    /**\r\n      Transition duration in milliseconds.\r\n      (applied to all charts and components as default)\r\n\r\n      @property duration\r\n      @type Number|Function\r\n      @default d3 default: 250ms\r\n    */\r\n    duration: property(),\r\n\r\n    /**\r\n      Transition ease function.\r\n      (applied to all charts and components as default)\r\n\r\n      - See: [Transitions#ease](https://github.com/mbostock/d3/wiki/Transitions#ease)\r\n      - Note: arguments to pass to `d3.ease` are not supported\r\n\r\n      @property ease\r\n      @type String|Function\r\n      @default d3 default: 'cubic-in-out'\r\n    */\r\n    ease: property(),\r\n\r\n    /**\r\n      Draw chart with given data\r\n\r\n      @example\r\n      ```js\r\n      var chart = d3.select('#chart')\r\n        .chart('Compose', function(data) {\r\n          // ...\r\n        });\r\n\r\n      chart.draw([1, 2, 3]);\r\n\r\n      chart.draw({values: [1, 2, 3]});\r\n\r\n      chart.draw([\r\n        {values: [1, 2, 3]},\r\n        {values: [4, 5, 6]}\r\n      ]);\r\n      ```\r\n      @method draw\r\n      @param {Any} data\r\n    */\r\n    draw: function(data) {\r\n      var config = this._prepareConfig(this.options(), data);\r\n      if (!config)\r\n        config = {data: {_charts: {}, _components: {}}, layout: [], charts: [], components: []};\r\n\r\n      // Set charts and components from config\r\n      this.charts(config.charts);\r\n      this.components(config.components);\r\n\r\n      // Add config data\r\n      data = {\r\n        original: data,\r\n        config: config.data\r\n      };\r\n      this.data(data);\r\n\r\n      this._setDimensions();\r\n\r\n      // Layout components\r\n      this.layout(config.layout, data);\r\n\r\n      // Full draw now that everything has been laid out\r\n      d3.chart().prototype.draw.call(this, data);\r\n    },\r\n\r\n    /**\r\n      Redraw chart with current data\r\n\r\n      @method redraw\r\n    */\r\n    redraw: function() {\r\n      if (this.rawData())\r\n        this.draw(this.rawData().original);\r\n    },\r\n\r\n    demux: function(name, data) {\r\n      if (!data || !data.config || !data.original)\r\n        return data;\r\n\r\n      if (findById(this.charts(), name) && data.config._charts[name])\r\n        return data.config._charts[name];\r\n      else if (findById(this.components(), name) && data.config._components[name])\r\n        return data.config._components[name];\r\n      else\r\n        return data.original;\r\n    },\r\n\r\n    // Create chart layer (for laying out charts)\r\n    createChartLayer: function(options) {\r\n      return this.base.append('g')\r\n        .attr('class', 'chart-layer')\r\n        .attr('data-zIndex', options && options.z_index);\r\n    },\r\n\r\n    // Create component layer\r\n    createComponentLayer: function(options) {\r\n      return this.base.append('g')\r\n        .attr('class', 'chart-component-layer')\r\n        .attr('data-zIndex', options && options.z_index);\r\n    },\r\n\r\n    // Create overlay layer\r\n    createOverlayLayer: function() {\r\n      if (!this.container)\r\n        throw new Error('Cannot create overlay layer if original selection \"d3.select(...).chart(\\'Compose\\')\" is an svg. Use a div instead for responsive and overlay support.');\r\n\r\n      return this.container.append('div')\r\n        .attr('class', 'chart-overlay-layer');\r\n    },\r\n\r\n    // Layout components and charts for given data\r\n    layout: function(layout, data) {\r\n      // 1. Place chart layers\r\n      this._positionChartLayers();\r\n\r\n      // 2. Extract layout from components\r\n      layout = this._extractLayout(data);\r\n\r\n      // 3. Set chart position from layout\r\n      var chart_position = extend({}, this.margins());\r\n      objectEach(layout, function(parts, key) {\r\n        parts.forEach(function(part) {\r\n          chart_position[key] += part.offset || 0;\r\n        });\r\n      });\r\n      this.chartPosition(chart_position);\r\n\r\n      // 4. Position layers with layout\r\n      this.positionLayers(layout);\r\n    },\r\n\r\n    attachHoverListeners: function() {\r\n      // For responsive, listen on container div and calculate enter/exit for base from bounding rectangle\r\n      // For non-responsive, bounding rectangle is container so calculations still apply\r\n\r\n      var trigger = this.trigger.bind(this);\r\n      var chartPosition = this.chartPosition.bind(this);\r\n      var container = this.container || this.base;\r\n      var base = this.base.node();\r\n      var chart_position, bounds, was_inside;\r\n\r\n      container.on('mouseenter', function() {\r\n        // Calculate chart position and bounds on enter and cache during move\r\n        chart_position = chartPosition();\r\n        bounds = getBounds();\r\n\r\n        was_inside = inside(bounds);\r\n        if (was_inside)\r\n          enter();\r\n      });\r\n      container.on('mousemove', function() {\r\n        // Mousemove may fire before mouseenter in IE\r\n        if (!chart_position || !bounds) {\r\n          chart_position = chartPosition();\r\n          bounds = getBounds();\r\n        }\r\n\r\n        var is_inside = inside(bounds);\r\n        if (was_inside && is_inside)\r\n          move();\r\n        else if (was_inside)\r\n          leave();\r\n        else if (is_inside)\r\n          enter();\r\n\r\n        was_inside = is_inside;\r\n      });\r\n      container.on('mouseleave', function() {\r\n        if (was_inside) {\r\n          was_inside = false;\r\n          leave();\r\n        }\r\n      });\r\n\r\n      function inside() {\r\n        var mouse = d3.mouse(document.documentElement);\r\n        return mouse[0] >= bounds.left && mouse[0] <= bounds.right && mouse[1] >= bounds.top && mouse[1] <= bounds.bottom;\r\n      }\r\n      function enter() {\r\n        trigger('mouseenter', translateToXY(d3.mouse(base)));\r\n      }\r\n      function move() {\r\n        trigger('mousemove', translateToXY(d3.mouse(base)));\r\n      }\r\n      function leave() {\r\n        trigger('mouseleave');\r\n      }\r\n\r\n      function translateToXY(coordinates) {\r\n        var x = coordinates[0];\r\n        var y = coordinates[1];\r\n        var chart_x = x - chart_position.left;\r\n        var chart_y = y - chart_position.top;\r\n\r\n        // Set at chart bounds if outside of chart\r\n        if (x > (chart_position.left + chart_position.width))\r\n          chart_x = chart_position.width;\r\n        else if (x < chart_position.left)\r\n          chart_x = 0;\r\n\r\n        if (y > (chart_position.top + chart_position.height))\r\n          chart_y = chart_position.height;\r\n        else if (y < chart_position.top)\r\n          chart_y = 0;\r\n\r\n        return {\r\n          container: {x: x, y: y},\r\n          chart: {x: chart_x, y: chart_y}\r\n        };\r\n      }\r\n\r\n      function getBounds() {\r\n        var scroll_y = 'scrollY' in window ? window.scrollY : document.documentElement.scrollTop;\r\n\r\n        bounds = extend({}, base.getBoundingClientRect());\r\n        bounds.top += scroll_y;\r\n        bounds.bottom += scroll_y;\r\n\r\n        return bounds;\r\n      }\r\n    },\r\n\r\n    // Attach chart/component child item with id\r\n    attach: function(id, item) {\r\n      item.id = id;\r\n      item.base.attr('data-id', id);\r\n      item.container = this;\r\n\r\n      Base.prototype.attach.call(this, id, item);\r\n\r\n      if (item && isFunction(item.trigger))\r\n        item.trigger('attach');\r\n    },\r\n\r\n    // Detach chart/component child item by id\r\n    detach: function(id, item) {\r\n      item.base.remove();\r\n\r\n      delete this._attached[id];\r\n\r\n      if (item && isFunction(item.trigger))\r\n        item.trigger('detach');\r\n    },\r\n\r\n    // Position chart and component layers\r\n    positionLayers: function(layout) {\r\n      this._positionChartLayers();\r\n      this._positionComponents(layout);\r\n      this._positionByZIndex();\r\n    },\r\n\r\n    //\r\n    // Internal\r\n    //\r\n\r\n    _setDimensions: function() {\r\n      // Set container and svg dimensions\r\n      // (if original selection is svg, no container and skip responsiveness)\r\n      if (this.container) {\r\n        this.container\r\n          .attr('style', this.containerStyle());\r\n      }\r\n\r\n      this.base\r\n        .attr('viewBox', this.viewBox())\r\n        .attr('preserveAspectRatio', this.preserveAspectRatio())\r\n        .attr('style', this.baseStyle())\r\n        .attr('width', this.responsive() ? null : this.width())\r\n        .attr('height', this.responsive() ? null : this.height());\r\n    },\r\n\r\n    _attachItems: function(items, container, context) {\r\n      items = items || [];\r\n      container = container || [];\r\n\r\n      // Remove charts that are no longer needed\r\n      var remove_ids = difference(pluck(container, 'id'), pluck(items, 'id'));\r\n      remove_ids.forEach(function(remove_id) {\r\n        context.detach(remove_id, findById(container, remove_id));\r\n      });\r\n\r\n      // Create or update charts\r\n      return items.map(function(options) {\r\n        // TODO May not have id, might need to auto-generate\r\n        // (might be during another step)\r\n        var id = options.id;\r\n        var item = findById(container, id);\r\n\r\n        if (options instanceof d3.chart()) {\r\n          // If chart instance, replace with instance\r\n          if (item)\r\n            context.detach(id, item);\r\n\r\n          context.attach(id, options);\r\n          return options;\r\n        }\r\n        else {\r\n          // TEMP Changing position has nasty side effects, disable for now\r\n          var changed_position = item && !(item instanceof Overlay) && item.position && options.position && item.position() != options.position;\r\n\r\n          if (item && (item.type != options.type || changed_position)) {\r\n            // If chart type has changed, detach and re-create\r\n            context.detach(id, item);\r\n            item = undefined;\r\n          }\r\n\r\n          if (!item) {\r\n            var Item = d3.chart(options.type);\r\n\r\n            if (!Item)\r\n              throw new Error('No registered d3.chart found for ' + options.type);\r\n\r\n            var layer_options = {z_index: Item.z_index || 0};\r\n            var createLayer = {\r\n              'chart': 'createChartLayer',\r\n              'component': 'createComponentLayer',\r\n              'overlay': 'createOverlayLayer'\r\n            }[Item.layer_type];\r\n\r\n            if (!createLayer)\r\n              throw new Error('Unrecognized layer type \"' + Item.layer_type + '\" for ' + options.type);\r\n\r\n            var base = context[createLayer](layer_options);\r\n\r\n            item = new Item(base, options);\r\n            item.type = options.type;\r\n\r\n            context.attach(id, item);\r\n          }\r\n          else {\r\n            item.options(options);\r\n          }\r\n\r\n          return item;\r\n        }\r\n      });\r\n    },\r\n\r\n    _prepareConfig: function(options, data) {\r\n      return extractLayout(options(data));\r\n    },\r\n\r\n    _positionChartLayers: function() {\r\n      var position = this.chartPosition();\r\n      this.base.selectAll('.chart-layer')\r\n        .attr('transform', translate(position.left, position.top))\r\n        .attr('width', position.width)\r\n        .attr('height', position.height);\r\n    },\r\n\r\n    _positionComponents: function(layout) {\r\n      var chart_position = this.chartPosition();\r\n      var width = this._width();\r\n      var height = this._height();\r\n\r\n      applyLayout(layout, chart_position, width, height);\r\n    },\r\n\r\n    _positionByZIndex: function() {\r\n      var layers = this.base.selectAll('.chart-layer, .chart-component-layer')[0];\r\n\r\n      // Sort by z-index\r\n      function setZIndex(layer) {\r\n        return {\r\n          layer: layer,\r\n          zIndex: parseInt(d3.select(layer).attr('data-zIndex')) || 0\r\n        };\r\n      }\r\n      function sortZIndex(a, b) {\r\n        if (a.zIndex < b.zIndex)\r\n          return -1;\r\n        else if (a.zIndex > b.zIndex)\r\n          return 1;\r\n        else\r\n          return 0;\r\n      }\r\n      function getLayer(wrapped) {\r\n        return wrapped.layer;\r\n      }\r\n\r\n      layers = layers.map(setZIndex).sort(sortZIndex).map(getLayer);\r\n\r\n      // Move layers to z-index order\r\n      layers.forEach(function(layer) {\r\n        if (layer && layer.parentNode && layer.parentNode.appendChild)\r\n          layer.parentNode.appendChild(layer);\r\n      });\r\n    },\r\n\r\n    _extractLayout: function(data) {\r\n      return calculateLayout(this.components(), data, this.demux.bind(this));\r\n    }\r\n  });\r\n\r\n  // TODO Find better place for this\r\n  function layered(items) {\r\n    if (!Array.isArray(items))\r\n      items = Array.prototype.slice.call(arguments);\r\n\r\n    return {_layered: true, items: items};\r\n  }\r\n\r\n  function findById(items, id) {\r\n    return find(items, function(item) {\r\n      return item.id == id;\r\n    });\r\n  }\n\n  /**\r\n    Common base for creating charts.\r\n    Standard `d3.chart` charts can be used with d3.compose, but extending `d3.chart('Chart')` includes helpers for properties and \"di\" functions.\r\n\r\n    ### Extending\r\n\r\n    To take advantage of \"di\"-binding (automatically injects `chart` into \"di\" methods)\r\n    and automatically setting properties from `options`, use `d3.compose.helpers.di`\r\n    and `d3.compose.helpers.property` when creating your chart.\r\n\r\n    @example\r\n    ```js\r\n    var helpers = d3.compose.helpers;\r\n\r\n    d3.chart('Chart').extend('Pie', {\r\n      initialize: function() {\r\n        // same as d3.chart\r\n      },\r\n      transform: function(data) {\r\n        // same as d3.chart\r\n      },\r\n\r\n      color: helpers.di(function(chart, d, i) {\r\n        // \"di\" function with parent chart injected (\"this\" = element)\r\n      }),\r\n\r\n      centered: helpers.property({\r\n        default_value: true\r\n        // can be automatically set from options object\r\n      })\r\n    });\r\n    ```\r\n    @class Chart\r\n    @extends Base\r\n  */\r\n  var Chart = Base.extend({}, {\r\n    /**\r\n      Default z-index for chart\r\n      (Components are 50 by default, so Chart = 100 is above component by default)\r\n\r\n      @example\r\n      ```js\r\n      d3.chart('Chart').extend('BelowComponentLayers', {\r\n        // ...\r\n      }, {\r\n        z_index: 40\r\n      });\r\n      ```\r\n      @attribute z_index\r\n      @static\r\n      @type Number\r\n      @default 100\r\n    */\r\n    z_index: 100,\r\n    layer_type: 'chart'\r\n  });\n\n  /**\n    Mixin to create standard layer to make extending charts straightforward.\n\n    @example\n    ```js\n    d3.chart('Chart').extend('Custom', helpers.mixin(StandardLayer, {\n      initialize: function() {\n        this.standardLayer('main', this.base.append('g'))\n        // dataBind, insert, events are defined on prototype\n      },\n\n      onDataBind: function(selection, data) {\n        // ...\n      },\n      onInsert: function(selection) {\n        // ...\n      },\n      onEnter: function(selection) {\n        // ...\n      },\n      onUpdateTransition: function(selection) {\n        // ...\n      },\n      // all d3.chart events are available: onMerge, onExit, ...\n    }));\n    ```\n    @class StandardLayer\n    @namespace mixins\n  */\n  var StandardLayer = {\n    /**\n      extension of `layer()` that uses standard methods on prototype for extensibility.\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(StandardLayer, {\n        initialize: function() {\n          this.standardLayer('circles', this.base.append('g'));\n        }\n\n        // onDataBind, onInsert, etc. work with \"circles\" layer\n      }));\n      ```\n      @method standardLayer\n      @param {String} name\n      @param {d3.selection} selection\n    */\n    standardLayer: function standardLayer(name, selection) {\n      return createLayer(this, 'layer', name, selection);\n    },\n\n    /**\n      extension of `seriesLayer()` that uses standard methods on prototype for extensibility.\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(StandardLayer, {\n        initialize: function() {\n          this.standardSeriesLayer('circles', this.base.append('g'));\n        },\n\n        // onDataBind, onInsert, etc. work with \"circles\" seriesLayer\n      }));\n      ```\n      @method standardSeriesLayer\n      @param {String} name\n      @param {d3.selection} selection\n    */\n    standardSeriesLayer: function standardSeriesLayer(name, selection) {\n      return createLayer(this, 'series', name, selection);\n    },\n\n    /**\n      Called for standard layer's `dataBind`\n\n      @method onDataBind\n      @param {d3.selection} selection\n      @param {Any} data\n      @return {d3.selection}\n    */\n    onDataBind: function onDataBind(/* selection, data */) {},\n\n    /**\n      Called for standard layer's `insert`\n\n      @method onInsert\n      @param {d3.selection} selection\n      @return {d3.selection}\n    */\n    onInsert: function onInsert(/* selection */) {},\n\n    /**\n      Call for standard layer's `events['enter']`\n\n      @method onEnter\n      @param {d3.selection} selection\n    */\n    onEnter: function onEnter(/* selection */) {},\n\n    /**\n      Call for standard layer's `events['enter:transition']`\n\n      @method onEnterTransition\n      @param {d3.selection} selection\n    */\n    // onEnterTransition: function onEnterTransition(selection) {},\n\n    /**\n      Call for standard layer's `events['update']`\n\n      @method onUpdate\n      @param {d3.selection} selection\n    */\n    onUpdate: function onUpdate(/* selection */) {},\n\n    /**\n      Call for standard layer's `events['update']`\n\n      @method onUpdateTransition\n      @param {d3.selection} selection\n    */\n    // onUpdateTransition: function onUpdateTransition(selection) {},\n\n    /**\n      Call for standard layer's `events['merge']`\n\n      @method onMerge\n      @param {d3.selection} selection\n    */\n    onMerge: function onMerge(/* selection */) {},\n\n    /**\n      Call for standard layer's `events['merge:transition']`\n\n      @method onMergeTransition\n      @param {d3.selection} selection\n    */\n    // onMergeTransition: function onMergeTransition(selection) {},\n\n    /**\n      Call for standard layer's `events['exit']`\n\n      @method onExit\n      @param {d3.selection} selection\n    */\n    onExit: function onExit(/* selection */) {}\n\n    /**\n      Call for standard layer's `events['exit:transition']`\n\n      @method onExitTransition\n      @param {d3.selection} selection\n    */\n    // onExitTransition: function onExitTransition(selection) {},\n  };\n\n  function createLayer(chart, type, name, selection) {\n    var layer = {\n      layer: 'layer',\n      series: 'seriesLayer'\n    }[type];\n\n    if (layer && chart[layer]) {\n      var events = {};\n      [\n        'enter',\n        'enter:transition',\n        'update',\n        'update:transition',\n        'merge',\n        'merge:transition',\n        'exit',\n        'exit:transition'\n      ].forEach(function(event) {\n        var method = 'on' + event.split(':').map(function capitalize(str) {\n          return str.charAt(0).toUpperCase() + str.slice(1);\n        }).join('');\n\n        // Only create events if chart method exists as empty transition events can cause unforeseen issues\n        if (chart[method]) {\n          events[event] = function() {\n            this.chart()[method](this);\n          };\n        }\n      });\n\n      return chart[layer](name, selection, {\n        dataBind: function(data) {\n          return this.chart().onDataBind(this, data);\n        },\n        insert: function() {\n          return this.chart().onInsert(this);\n        },\n        events: events\n      });\n    }\n  }\n\n  /**\n    Mixin for handling common transition behaviors\n\n    @class Transition\n    @namespace mixins\n  */\n  var Transition = {\n    /**\n      Delay start of transition by specified milliseconds.\n\n      @property delay\n      @type Number|Function\n      @default (use container value, if available)\n    */\n    delay: property({\n      default_value: function() {\n        return this.container && this.container.delay && this.container.delay();\n      }\n    }),\n\n    /**\n      Transition duration in milliseconds.\n\n      @property duration\n      @type Number|Function\n      @default (use container value, if available)\n    */\n    duration: property({\n      default_value: function() {\n        return this.container && this.container.delay && this.container.duration();\n      }\n    }),\n\n    /**\n      Transition ease function\n\n      - See: [Transitions#ease](https://github.com/mbostock/d3/wiki/Transitions#ease)\n      - Note: arguments to pass to `d3.ease` are not supported\n\n      @property ease\n      @type String|Function\n      @default (use container value, if available)\n    */\n    ease: property({\n      default_value: function() {\n        return this.container && this.container.delay && this.container.ease();\n      }\n    }),\n\n    /**\n      Setup delay, duration, and ease for transition\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(Transition, {\n        initialize: function() {\n          this.layer('circles', this.base, {\n            // ...\n            events: {\n              'merge:transition': function() {\n                // Set delay, duration, and ease from properties\n                this.chart().setupTransition(this);\n              }\n            }\n          });\n        }\n      }));\n      ```\n      @method setupTransition\n      @param {d3.selection} selection\n    */\n    setupTransition: function setupTransition(selection) {\n      var delay = this.delay();\n      var duration = this.duration();\n      var ease = this.ease();\n\n      if (!isUndefined(delay))\n        selection.delay(delay);\n      if (!isUndefined(duration))\n        selection.duration(duration);\n      if (!isUndefined(ease))\n        selection.ease(ease);\n    }\n  };\n\n  /**\n    Mixin for handling common hover behavior that adds standard `onMouseEnter`, `onMouseMove`, and `onMouseLeave` handlers\n    and `getPoint` helper for adding helpful meta information to raw data point.\n\n    @class Hover\n    @namespace mixins\n  */\n  var Hover = {\n    initialize: function() {\n      this.on('attach', function() {\n        this.container.on('mouseenter', this.onMouseEnter.bind(this));\n        this.container.on('mousemove', this.onMouseMove.bind(this));\n        this.container.on('mouseleave', this.onMouseLeave.bind(this));\n      }.bind(this));\n    },\n\n    /**\n      Get point information for given data-point\n\n      @method getPoint\n      @param {Any} d\n      @param {Number} i\n      @param {Number} j\n      @return {key, series, d, meta {chart, i, j, x, y}}\n    */\n    getPoint: di(function(chart, d, i, j) {\n      var key = chart.key && chart.key.call(this, d, i, j);\n      var series = chart.seriesData && chart.seriesData.call(this, d, i, j) || {};\n\n      return {\n        key: (series.key || j) + '.' + (key || i),\n        series: series,\n        d: d,\n        meta: {\n          chart: chart,\n          i: i,\n          j: j,\n          x: chart.x && chart.x.call(this, d, i, j),\n          y: chart.y && chart.y.call(this, d, i, j)\n        }\n      };\n    }),\n\n    /**\n      Call to trigger mouseenter:point when mouse enters data-point\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Bars', helpers.mixin(Hover, {\n        initialize: function() {\n          this.layer('bars', this.base, {\n            // dataBind...\n            insert: function() {\n              // Want to trigger enter/leave point\n              // when mouse enter/leaves bar (rect)\n              var chart = this.chart();\n              return this.append('rect')\n                .on('mouseenter', chart.mouseEnterPoint)\n                .on('mouseleave', chart.mouseLeavePoint);\n            }\n            // events...\n          })\n        }\n      }));\n      ```\n      @method mouseEnterPoint\n      @param {Any} d\n      @param {Number} i\n      @param {Number} j\n    */\n    mouseEnterPoint: di(function(chart, d, i, j) {\n      chart.container.trigger('mouseenter:point', chart.getPoint.call(this, d, i, j));\n    }),\n\n    /**\n      Call to trigger mouseleave:point when mouse leaves data-point\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Bars', helpers.mixin(Hover, {\n        initialize: function() {\n          this.layer('bars', this.base, {\n            // dataBind...\n            insert: function() {\n              // Want to trigger enter/leave point\n              // when mouse enter/leaves bar (rect)\n              var chart = this.chart();\n              return this.append('rect')\n                .on('mouseenter', chart.mouseEnterPoint)\n                .on('mouseleave', chart.mouseLeavePoint);\n            }\n            // events...\n          })\n        }\n      }));\n      ```\n      @method mouseleavePoint\n      @param {Any} d\n      @param {Number} i\n      @param {Number} j\n    */\n    mouseLeavePoint: di(function(chart, d, i, j) {\n      chart.container.trigger('mouseleave:point', chart.getPoint.call(this, d, i, j));\n    }),\n\n    /**\n      (Override) Called when mouse enters container\n\n      @method onMouseEnter\n      @param {Object} position (chart and container {x,y} position of mouse)\n      @param {Object} position.chart {x, y} position relative to chart origin\n      @param {Object} position.container {x, y} position relative to container origin\n    */\n    onMouseEnter: function(/* position */) {},\n\n    /**\n      (Override) Called when mouse moves within container\n\n      @method onMouseMove\n      @param {Object} position (chart and container {x,y} position of mouse)\n      @param {Object} position.chart {x, y} position relative to chart origin\n      @param {Object} position.container {x, y} position relative to container origin\n    */\n    onMouseMove: function(/* position */) {},\n\n    /**\n      (Override) Called when mouse leaves container\n\n      @method onMouseLeave\n    */\n    onMouseLeave: function() {}\n  };\n\n  /**\n    Mixin for automatically triggering \"mouseenter:point\"/\"mouseleave:point\" for chart data points that are within given `hoverTolerance`.\n\n    @class HoverPoints\n    @namespace mixins\n  */\n  var HoverPoints = {\n    initialize: function() {\n      var points, tolerance, active;\n\n      this.on('draw', function() {\n        // Clear cache on draw\n        points = null;\n      });\n\n      this.on('attach', function() {\n        var update = function update(position) {\n          var closest = [];\n          if (position)\n            closest = getClosestPoints(points, position.chart, tolerance);\n\n          updateActive(active, closest, this.container);\n          active = closest;\n        }.bind(this);\n\n        this.container.on('mouseenter', function(position) {\n          if (!points)\n            points = getPoints(this, this.data());\n\n          tolerance = this.hoverTolerance();\n          update(position);\n        }.bind(this));\n\n        this.container.on('mousemove', update);\n        this.container.on('mouseleave', update);\n      }.bind(this));\n    },\n\n    /**\n      Hover tolerance (in px) for calculating close points\n\n      @property hoverTolerance\n      @type Number\n      @default Infinity\n    */\n    hoverTolerance: property({\n      default_value: Infinity\n    })\n  };\n\n  function getPoints(chart, data) {\n    if (data) {\n      if (!isSeriesData(data))\n        data = [{values: data}];\n\n      return data.map(function(series, j) {\n        return series.values.map(function(d, i) {\n          return chart.getPoint.call({_parent_data: series}, d, i, j);\n        }).sort(function(a, b) {\n          // Sort by x\n          return a.meta.x - b.meta.x;\n        });\n      });\n    }\n  }\n\n  function getClosestPoints(points, position, tolerance) {\n    if (!points)\n      return [];\n\n    return compact(points.map(function(series) {\n      function setDistance(point) {\n        point.distance = getDistance(point.meta, position);\n        return point;\n      }\n      function closePoints(point) {\n        return point.distance < tolerance;\n      }\n      function sortPoints(a, b) {\n        if (a.distance < b.distance)\n          return -1;\n        else if (a.distance > b.distance)\n          return 1;\n        else\n          return 0;\n      }\n\n      var by_distance = series.map(setDistance).filter(closePoints).sort(sortPoints);\n\n      return by_distance[0];\n    }));\n\n    function getDistance(a, b) {\n      return Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2));\n    }\n  }\n\n  function updateActive(active, closest, container) {\n    var active_keys = pluck(active, 'key');\n    var closest_keys = pluck(closest, 'key');\n\n    objectEach(closest, function(point) {\n      if (contains(active_keys, point.key))\n        container.trigger('mousemove:point', point);\n      else\n        container.trigger('mouseenter:point', point);\n    });\n    objectEach(active, function(point) {\n      if (!contains(closest_keys, point.key))\n        container.trigger('mouseleave:point', point);\n    });\n  }\n\n  /**\n    Mixin for handling labels in charts\n\n    @class Labels\n    @namespace mixins\n  */\n  var Labels = {\n    /**\n      Call during chart initialization to add labels to chart\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(Labels, {\n        initialize: function() {\n          // this.layer()...\n\n          // Attach labels layer\n          this.attachLabels();\n        }\n      }));\n      ```\n      @method attachLabels\n    */\n    attachLabels: function() {\n      var options = this.labels();\n      options.parent = this;\n\n      var LabelsClass = d3.chart(options.type);\n      var base = this.base.append('g').attr('class', 'chart-labels');\n      var labels = this._labels = new LabelsClass(base, options);\n\n      // Proxy x and y to parent chart\n      this.proxyLabelMethods.forEach(function(method) {\n        labels[method] = this[method];\n      }, this);\n\n      this.on('draw', function(data) {\n        options = this.labels();\n        options.parent = this;\n\n        labels.options(options);\n\n        if (options.display !== false)\n          labels.draw(options.data || data);\n        else\n          labels.draw([]);\n      }.bind(this));\n    },\n\n    /**\n      Options passed to labels chart\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(Labels, {\n        // ...\n      }));\n\n      // ...\n\n      chart.labels(true); // -> display labels with defaults\n      chart.labels(false); // -> hide labels\n      chart.labels({offset: 10}); // -> pass options to labels chart\n\n      d3.select('#chart')\n        .chart('Compose', function(data) {\n          return {\n            charts: {\n              custom: {labels: {offset: 10}}\n            }\n          };\n        });\n      ```\n      @property labels\n      @type Object\n    */\n    labels: property({\n      get: function(value) {\n        if (isBoolean(value))\n          value = {display: value};\n        else if (!value)\n          value = {display: false};\n\n        return defaults({}, value, {\n          type: 'Labels'\n        });\n      }\n    }),\n\n    // Array of methods to proxy on labels chart\n    proxyLabelMethods: []\n  };\n\n  /**\n    Mixin for handling labels in XY charts\n    (proxies `x` and `y` to properly place labels for XY charts)\n\n    @class LabelsXY\n    @namespace mixins\n    @extends Labels\n  */\n  var LabelsXY = extend({}, Labels, {\n    proxyLabelMethods: ['x', 'y']\n  });\n\n  /**\n    Mixin for inverting XY calculations with x vertical, increasing bottom-to-top and y horizontal, increasing left-to-right\n\n    @class XYInverted\n    @namespace mixins\n  */\n  var XYInverted = {\n    /**\n      Get x-value for plotting (scaled y-value)\n\n      @method x\n      @param {Any} d\n      @param {Number} i\n      @return {Number}\n    */\n    x: di(function(chart, d, i) {\n      var value = chart.yValue.call(this, d, i);\n      var series_index = chart.seriesIndex && chart.seriesIndex.call(this, d, i) || 0;\n\n      return parseFloat(chart.yScale()(value, series_index));\n    }),\n\n    /**\n      Get y-value for plotting (scaled x-value)\n\n      @method y\n      @param {Any} d\n      @param {Number} i\n      @return {Number}\n    */\n    y: di(function(chart, d, i) {\n      var value = chart.xValue.call(this, d, i);\n      var series_index = chart.seriesIndex && chart.seriesIndex.call(this, d, i) || 0;\n\n      return parseFloat(chart.xScale()(value, series_index));\n    }),\n\n    /**\n      Get scaled y = 0 value (along x-axis)\n\n      @method x0\n      @return {Number}\n    */\n    x0: function() {\n      return parseFloat(this.yScale()(0));\n    },\n\n    /**\n      Get scaled x = 0 value (along y-axis)\n\n      @method x0\n      @return {Number}\n    */\n    y0: function() {\n      return parseFloat(this.xScale()(0));\n    },\n\n    /**\n      Set range (height, 0) for given x-scale\n\n      @method setXScaleRange\n      @param {d3.scale} x_scale\n    */\n    setXScaleRange: function(x_scale) {\n      x_scale.range([this.height(), 0]);\n    },\n\n    /**\n      Set range (0, width) for given y-scale\n\n      @method setYScaleRange\n      @param {d3.scale} y_scale\n    */\n    setYScaleRange: function(y_scale) {\n      y_scale.range([0, this.width()]);\n    }\n  };\n\n  /**\n    Mixin for charts of centered key,value data (x: index, y: value, key)\n\n    @class XYValues\n    @namespace mixins\n  */\n  var XYValues = {\n    /**\n      Determine width of data-point when displayed adjacent\n\n      @method adjacentWidth\n      @return {Number}\n    */\n    adjacentWidth: function() {\n      var series_count = this.seriesCount ? this.seriesCount() : 1;\n      return this.layeredWidth() / series_count;\n    },\n\n    /**\n      Determine layered width (width of group for adjacent)\n\n      @method layeredWidth\n      @return {Number}\n    */\n    layeredWidth: function() {\n      var range_band = this.xScale() && this.xScale().rangeBand && this.xScale().rangeBand();\n      var width = isFinite(range_band) ? range_band : 0;\n\n      return width;\n    },\n\n    /**\n      Determine item width based on series display type (adjacent or layered)\n\n      @method itemWidth\n      @return {Number}\n    */\n    itemWidth: function() {\n      var scale = this.xScale();\n      return scale && scale.width ? scale.width() : this.layeredWidth();\n    },\n\n    // Override default x-scale to use ordinal type\n    /**\n      Override default x-scale to use ordinal type: `{type: 'ordinal', data: this.data(), key: 'y', centered: true}`\n\n      @method getDefaultYScale\n      @return {d3.scale}\n    */\n    getDefaultXScale: function() {\n      return createScale({\n        type: 'ordinal',\n        data: this.data(),\n        key: 'x',\n        centered: true\n      });\n    }\n  };\n\n  /**\n    Mixin for handling XY data\n\n    @class XY\n    @namespace mixins\n  */\n  var XY = {\n    initialize: function() {\n      // Set scale ranges once chart is ready to be rendered\n      this.on('before:draw', this.setScales.bind(this));\n    },\n\n    transform: function(data) {\n      data = data || [];\n\n      // Transform series data from values to x,y\n      if (isSeriesData(data)) {\n        data = data.map(function(series) {\n          return extend({}, series, {\n            values: series.values.map(normalizeData)\n          });\n        });\n      }\n      else if (Array.isArray(data)) {\n        data = data.map(normalizeData);\n      }\n\n      return data;\n\n      function normalizeData(point, index) {\n        if (!isObject(point))\n          point = {x: index, y: point};\n        else if (!Array.isArray(point) && isUndefined(point.x))\n          point.x = index;\n\n        return point;\n      }\n    },\n\n    /**\n      Get/set x-scale with `d3.scale` or with object (uses `helpers.createScale`)\n\n      @property xScale\n      @type Object|d3.scale\n    */\n    xScale: property({\n      set: function(value) {\n        var scale = createScale(value);\n        this.setXScaleRange(scale);\n\n        return {\n          override: scale\n        };\n      },\n      get: function(scale) {\n        if (!scale) {\n          scale = this.getDefaultXScale();\n          this.setXScaleRange(scale);\n        }\n\n        return scale;\n      }\n    }),\n\n    /**\n      Get/set yscale with `d3.scale` or with object (uses `helpers.createScale`)\n\n      @property xScale\n      @type Object|d3.scale\n    */\n    yScale: property({\n      set: function(value) {\n        var scale = createScale(value);\n        this.setYScaleRange(scale);\n\n        return {\n          override: scale\n        };\n      },\n      get: function(scale) {\n        if (!scale) {\n          scale = this.getDefaultYScale();\n          this.setYScaleRange(scale);\n        }\n\n        return scale;\n      }\n    }),\n\n    /**\n      Key on data object for x-value\n\n      @property xKey\n      @type String\n      @default 'x'\n    */\n    xKey: property({\n      default_value: 'x'\n    }),\n\n    /**\n      Key on data object for y-value\n\n      @property yKey\n      @type String\n      @default 'y'\n    */\n    yKey: property({\n      default_value: 'y'\n    }),\n\n    /**\n      Get scaled x-value for given data-point\n\n      @method x\n      @param {Any} d\n      @param {Number} i\n      @return {Number}\n    */\n    x: di(function(chart, d, i) {\n      var value = chart.xValue.call(this, d, i);\n      var series_index = chart.seriesIndex && chart.seriesIndex.call(this, d, i) || 0;\n\n      return parseFloat(chart.xScale()(value, series_index));\n    }),\n\n    /**\n      Get scaled y-value for given data-point\n\n      @method y\n      @param {Any} d\n      @param {Number} i\n      @return {Number}\n    */\n    y: di(function(chart, d, i) {\n      var value = chart.yValue.call(this, d, i);\n      var series_index = chart.seriesIndex && chart.seriesIndex.call(this, d, i) || 0;\n\n      return parseFloat(chart.yScale()(value, series_index));\n    }),\n\n    /**\n      Get key for data-point. Looks for \"key\" on `d` first, otherwise uses x-value.\n\n      @method key\n      @param {Any} d\n      @param {Number} i\n      @return {Any}\n    */\n    key: di(function(chart, d, i) {\n      return valueOrDefault(d.key, chart.xValue.call(this, d, i));\n    }),\n\n    /**\n      Get scaled `x = 0` value\n\n      @method x0\n      @return {Number}\n    */\n    x0: function() {\n      return parseFloat(this.xScale()(0));\n    },\n\n    /**\n      Get scaled `y = 0` value\n\n      @method x0\n      @return {Number}\n    */\n    y0: function() {\n      return parseFloat(this.yScale()(0));\n    },\n\n    /**\n      Get x-value for data-point. Checks for `xKey()` on `d` first, otherwise uses `d[0]`.\n\n      @example\n      ```js\n      xValue({x: 10, y: 20}); // -> 10\n      xValue([10, 20]); // -> 10\n      ```\n      @method xValue\n      @param {Any} d\n      @return {Any}\n    */\n    xValue: di(function(chart, d) {\n      var key = chart.xKey();\n      if (d)\n        return key in d ? d[key] : d[0];\n    }),\n\n    /**\n      Get y-value for data-point. Checks for `yKey()` on `d` first, otherwise uses `d[1]`.\n\n      @example\n      ```js\n      yValue({x: 10, y: 20}); // -> 20\n      yValue([10, 20]); // -> 20\n      ```\n      @method yValue\n      @param {Any} d\n      @return {Any}\n    */\n    yValue: di(function(chart, d) {\n      var key = chart.yKey();\n      if (d)\n        return key in d ? d[key] : d[1];\n    }),\n\n    /**\n      Set x- and y-scale ranges (using `setXScaleRange` and `setYScaleRange`)\n\n      @method setScales\n    */\n    setScales: function() {\n      this.setXScaleRange(this.xScale());\n      this.setYScaleRange(this.yScale());\n    },\n\n    /**\n      Set range (0, width) for given x-scale\n\n      @method setXScaleRange\n      @param {d3.scale} x_scale\n    */\n    setXScaleRange: function(x_scale) {\n      x_scale.range([0, this.width()]);\n    },\n\n    /**\n      Set range(height, 0) for given y-scale\n\n      @method setYScaleRange\n      @param {d3.scale} y_scale\n    */\n    setYScaleRange: function(y_scale) {\n      y_scale.range([this.height(), 0]);\n    },\n\n    /**\n      Get default x-scale: `{data: this.data(), key: 'x'}`\n\n      @method getDefaultXScale\n      @return {d3.scale}\n    */\n    getDefaultXScale: function() {\n      return createScale({\n        data: this.data(),\n        key: 'x'\n      });\n    },\n\n    /**\n      Get default y-scale: `{data: this.data(), key: 'y'}`\n\n      @method getDefaultYScale\n      @return {d3.scale}\n    */\n    getDefaultYScale: function() {\n      return createScale({\n        data: this.data(),\n        key: 'y'\n      });\n    }\n  };\n\n  /**\n    Mixin for handling series data\n\n    @class Series\n    @namespace mixins\n  */\n  var Series = {\n    /**\n      Get key for given series data\n\n      @method seriesKey\n      @param {Any} d Series object with `key`\n      @return {Any}\n    */\n    seriesKey: di(function(chart, d) {\n      return d.key;\n    }),\n\n    /**\n      Get values for given series data\n\n      @method seriesValues\n      @param {Any} d Series object with `values` array\n      @return {Array}\n    */\n    seriesValues: di(function(chart, d, i) {\n      // Store seriesIndex on series\n      d.seriesIndex = i;\n      return d.values;\n    }),\n\n    /**\n      Get class for given series data\n\n      @method seriesClass\n      @param {Any} d\n      @param {Number} i\n      @return {String}\n    */\n    seriesClass: di(function(chart, d, i) {\n      return 'chart-series chart-index-' + i + (d['class'] ? ' ' + d['class'] : '');\n    }),\n\n    /**\n      Get index for given data-point of series\n\n      @method seriesIndex\n      @param {Any} d\n      @param {Number} i\n    */\n    seriesIndex: di(function(chart, d, i) {\n      var series = chart.seriesData.call(this, d, i);\n      return series && series.seriesIndex || 0;\n    }),\n\n    /**\n      Get parent series data for given data-point\n\n      @method seriesData\n      @return {Any}\n    */\n    seriesData: di(function() {\n      return getParentData(this);\n    }),\n\n    /**\n      (di) Get style given series data or data-point\n      (Uses \"style\" object on `d`, if defined)\n\n      @method itemStyle\n      @param {Any} d\n      @param {Number} [i]\n      @param {Number} [j]\n      @return {String}\n    */\n    itemStyle: di(function(chart, d) {\n      return style(d.style) || null;\n    }),\n\n    /**\n      Get series count for chart\n\n      @method seriesCount\n      @return {Number}\n    */\n    seriesCount: function() {\n      var data = this.data();\n      return (data && isSeriesData(data)) ? data.length : 1;\n    },\n\n    /**\n      Extension of layer() that handles data-binding and layering for series data.\n\n      - Updates `dataBind` method to access underlying series values\n      - Creates group layer for each series in chart\n      - Should be used just like layer()\n\n      @example\n      ```js\n      d3.chart('Chart').extend('Custom', helpers.mixin(mixins.Series, {\n        initialize: function() {\n          this.seriesLayer('Circles', this.base, {\n            // Create group for each series on this.base\n            // and calls the following for each series item\n            // (entire layer is called twice: series-1 and series-2)\n\n            dataBind: function(data) {\n              // 1. data = [1, 2, 3]\n              // 2. data = [4, 5, 6]\n            },\n            insert: function() {\n              // Same as chart.layer\n              // (where \"this\" is series group layer)\n            },\n            events: {\n              // Same as chart.layer\n            }\n          });\n        }\n      }));\n\n      // ...\n\n      chart.draw([\n        {key: 'series-1', values: [1, 2, 3]},\n        {key: 'series-2', values: [4, 5, 6]}\n      ]);\n      ```\n      @method seriesLayer\n      @param {String} name\n      @param {Selection} selection\n      @param {Object} options (`dataBind` and `insert` required)\n      @return {d3.chart.layer}\n    */\n    seriesLayer: function(name, selection, options) {\n      if (options && options.dataBind) {\n        var dataBind = options.dataBind;\n\n        options.dataBind = function(data) {\n          var chart = this.chart();\n          var series = this.selectAll('g')\n            .data(data, chart.seriesKey);\n\n          series.enter()\n            .append('g');\n\n          series\n            .attr('class', chart.seriesClass)\n            .attr('style', chart.itemStyle);\n\n          // TODO Exit layer items then exit series layer\n          series.exit()\n            .remove();\n\n          series.chart = function() { return chart; };\n\n          return dataBind.call(series, chart.seriesValues);\n        };\n      }\n\n      return d3.chart().prototype.layer.call(this, name, selection, options);\n    },\n\n    // Ensure data is in series form\n    transform: function(data) {\n      return !isSeriesData(data) ? [{values: data}] : data;\n    }\n  };\n\n  var mixins = {\n    Series: Series,\n    XY: XY,\n    XYValues: XYValues,\n    XYInverted: XYInverted,\n    Labels: Labels,\n    LabelsXY: LabelsXY,\n    Hover: Hover,\n    HoverPoints: HoverPoints,\n    Transition: Transition,\n    StandardLayer: StandardLayer\n  };\n\n  // Export charts/components to d3.chart\r\n  utils.extend(d3.chart(), {\r\n    Base: Base,\r\n    Chart: Chart,\r\n    Component: Component,\r\n    Overlay: Overlay,\r\n    Compose: Compose\r\n  });\r\n\r\n  var d3c = d3.compose = {\r\n    VERSION: '0.15.13',\r\n    utils: utils,\r\n    helpers: helpers,\r\n    Base: Base,\r\n    Chart: Chart,\r\n    Component: Component,\r\n    Overlay: Overlay,\r\n    Compose: Compose,\r\n    layered: layered,\r\n\r\n    mixins: mixins\r\n  };\n\n  return d3c;\n\n}));"],"sourceRoot":"/source/"}