<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>d3.chart.multi - Debug</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="css/default.css">

  <link rel="stylesheet" type="text/css" href="../tmp/css/d3.chart.multi.base.css">
  <style>
    .container {
      margin: 40px auto 0;
      width: 900px;
    }
    .highlight {
      fill: #2ca02c;
    }
    @media (min-width: 768px) {
      #chart {
        width: 600px;
        height: 400px;
      }  
    }
  </style>
</head>
<body>
  <div class="container">
    <svg id="chart"></svg>
    <div>
      <button id="update">Update</button>
      <button id="change">Change</button>
      <button id="redraw">Redraw</button>
    </div>
    <div>
      Container: <span id="mouse-container"></span><br>
      Chart: <span id="mouse-chart"></span>
    </div>
  </div>

  <script src="../bower_components/d3/d3.js"></script>
  <script src="../bower_components/d3.chart/d3.chart.js"></script>
  <script src="../bower_components/underscore/underscore.js"></script>
  <script src="../tmp/d3.chart.multi.js"></script>

  <script src="../bower_components/jquery/dist/jquery.js"></script>
  <script type="text/javascript">
    // Data
    // ---- //
    var highlight_class = 'highlight';
    var highlight_style = {fill: '#2ca02c'};

    var data = {
      increasing: [
        {
          key: 'inc-a',
          name: 'Increasing A',
          values: [
            {x: 0, y: 10, 'class': highlight_class},
            {x: 10, y: 20},
            {x: 20, y: 40},
            {x: 30, y: 70},
            {x: 40, y: 110},
            {x: 50, y: 160}
          ]
        },
        {
          key: 'inc-b',
          name: 'Increasing B',
          values: [
            {x: 0, y: 25, 'labelStyle': highlight_style},
            {x: 10, y: 30},
            {x: 20, y: 40},
            {x: 30, y: 55},
            {x: 40, y: 75},
            {x: 50, y: 100}
          ]
        }
      ],
      decreasing: [
        {
          key: 'dec-a',
          name: 'Decreasing A',
          values: [
            {x: 0, y: 160, 'class': highlight_class},
            {x: 10, y: 110},
            {x: 20, y: 70},
            {x: 30, y: 40},
            {x: 40, y: 20},
            {x: 50, y: 10}
          ]
        },
        {
          key: 'dec-b',
          name: 'Decreasing B',
          values: [
            {x: 0, y: 100, 'labelStyle': highlight_style},
            {x: 10, y: 75},
            {x: 20, y: 55},
            {x: 30, y: 40},
            {x: 40, y: 30},
            {x: 50, y: 25}
          ]
        }
      ],
      'increasing-dense': [
        {
          key: 'inc-dense-a',
          name: 'Increasing Dense A',
          values: []  
        },
        {
          key: 'inc-dense-b',
          name: 'Increasing Dense B',
          values: []
        }
      ],
      'decreasing-dense': [
        {
          key: 'dec-dense-a',
          name: 'Decreasing Dense A',
          values: []  
        },
        {
          key: 'dec-dense-b',
          name: 'Decreasing Dense B',
          values: []
        }
      ]
    };

    for (var i = 0; i <= 50; i++) {
      data['increasing-dense'][0].values.push({x: i, y: Math.round(0.05*Math.pow(i, 2) + 0.5*i + 10, 0)});
      data['increasing-dense'][1].values.push({x: i, y: Math.round(0.025*Math.pow(i, 2) + 0.25*i + 25, 0)});
      data['decreasing-dense'][0].values.push({x: i, y: Math.round(0.025*Math.pow(i, 2) - 2.75*i + 160, 0)});
      data['decreasing-dense'][1].values.push({x: i, y: Math.round(0.05*Math.pow(i, 2) - 5.5*i + 100, 0)});
    }
    data['increasing-dense'][0].values[0]['class'] = highlight_class;
    data['increasing-dense'][1].values[0]['labelStyle'] = highlight_style;
    data['decreasing-dense'][0].values[0]['class'] = highlight_class;
    data['decreasing-dense'][1].values[0]['labelStyle'] = highlight_style;
    
    // Config
    // ------ //
    // var config = {
    //   type: 'Values',
    //   charts: {
    //     line: {type: 'Line', dataKey: 'increasing', labels: true},
    //     bars: {type: 'Bars', dataKey: 'decreasing', labels: true},
    //     labels: {type: 'Labels', handleCollisions: true}
    //   },
    //   axes: {
    //     x: {scale: {type: 'ordinal', domain: [0, 10, 20, 30, 40, 50]}},
    //     y: {scale: {domain: [0, 200]}},
    //     secondaryY: {scale: {domain: [0, 1000]}, dataKey: 'increasing'}
    //   }
    // };
    var config = function(data) {
      var values = data['increasing-dense'];
      var scales = {
        x: {domain: [0, 50]},
        y: {domain: [0, 200]}
      };
      
      return d3.chart.xy({
        charts: {
          line: {type: 'Line', data: values, xScale: scales.x, yScale: scales.y, labels: true},
        },
        axes: {
          x: {scale: scales.x, position: 'top', title: 'Howdy'},
          y: {scale: scales.y, position: 'left', duration: 500}
        },
        title: {text: 'Howdy!', position: 'bottom'}
      });
    };

    var chart = d3.select('#chart')
      .chart('Multi', config)
      .margins({top: 10, right: 10, bottom: 10, left: 10});

    chart.draw(data);

    function update() {
      _.each(data, function(item) {
        _.each(item, function(series) {
          _.each(series.values, function(point) {
            // +/- 10%
            point.y = Math.round(point.y * (0.9 + Math.random()*0.2), 0);
          });
        });
      });
      
      chart.draw(data);
    }

    var count = 1;
    function change() {
      chart
        .options(function(data) {
          var values = data['increasing-dense'];
          var scales = {
            x: {domain: [0, 50]},
            y: {domain: [0, 200 + 5 * count]}
          };

          return {
            charts: {
              line: {type: 'Line', data: values, xScale: scales.x, yScale: scales.y, labels: true},
            },
            axes: {
              x: {scale: scales.x, position: 'top', title: 'Howdy'},
              y: {scale: scales.y, position: 'left'}
            },
            legend: false,
            title: {text: 'Howdy ' + count++ + '!', position: 'bottom'}
          };
        })
        .redraw();
    }

    function redraw() {
      chart.redraw();
    }

    $('#update').on('click', update);
    $('#change').on('click', change);
    $('#redraw').on('click', redraw);

    // DEBUG
    chart.on('enter:mouse', function(coordinates) {
      logMouse('container', coordinates.container);
      logMouse('chart', coordinates.chart);
    });
    chart.on('move:mouse', function(coordinates) {
      logMouse('container', coordinates.container);
      logMouse('chart', coordinates.chart);
    });
    chart.on('leave:mouse', function() {
      logMouse('container');
      logMouse('chart');
    });

    function logMouse(type, coordinates) {
      var $selector = $('#mouse-' + type);

      if (!coordinates) {
        $selector.empty();
      }
      else {
        var msg = '';

        // Points come in as array
        if (_.isArray(coordinates))
          msg = _.map(coordinates, function(series) {
            return _.map(series.points, function(point) {
              return series.name + ': {x = ' + point.values.x + ', y = ' + point.values.y + '}';
            }).join(', ');
          }).join(' ');
        else {
          msg = logCoordinates(coordinates);
        }

        $selector.text(msg);
      }

      function logCoordinates(coordinates) {
        return 'x = ' + coordinates.x + ', y = ' + coordinates.y;
      }
    }
  </script>
</body>
</html>